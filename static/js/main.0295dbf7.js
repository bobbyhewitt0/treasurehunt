/*! For license information please see main.0295dbf7.js.LICENSE.txt */
(()=>{var e={483:function(e){e.exports=function(){"use strict";var e,t,n;function i(i,r){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),n=r(s),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=r;else e=r}return i(["exports"],(function(e){var t="undefined"!=typeof self?self:{},n="3.0.1";let i;const r={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==i){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{i=null!={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX?new RegExp({NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX):e}catch(t){i=e}}return i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!r.API_URL)return null;try{const e=new URL(r.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},o={supported:!1,testSupport:function(e){!l&&a&&(c?u(e):s=e)}};let s,a,l=!1,c=!1;function u(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.isContextLost())return;o.supported=!0}catch(e){}e.deleteTexture(t),l=!0}t.document&&(a=t.document.createElement("img"),a.onload=function(){s&&u(s),s=null,c=!0},a.onerror=function(){l=!0,s=null},a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const h="01";function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=f;function f(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}f.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var s=0,a=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var m=d(p),_=g;function g(e,t){this.x=e,this.y=t}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(e){return e instanceof g?e:Array.isArray(e)?new g(e[0],e[1]):e};var y=d(_);function v(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!v(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!v(e[n],t[n]))return!1;return!0}return e===t}const x=Math.PI/180,b=180/Math.PI;function w(e){return e*x}function T(e){return e*b}const S=[[0,0],[1,0],[1,1],[0,1]];function E(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function C(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),i=Math.max(i,o.x),r=Math.max(r,o.y);return{min:new y(t,n),max:new y(i,r)}}function A(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=new y(n,n),o=e.sub(r),s=t.add(r),a=[o,new y(s.x,o.y),s,new y(o.x,s.y)];return i&&a.push(o.clone()),a}function I(e,t,n,i){const r=new m(e,t,n,i);return function(e){return r.solve(e)}}const M=I(.25,.1,.25,1);function k(e,t,n){return Math.min(n,Math.max(t,e))}function P(e,t,n){return(n=k((n-e)/(t-e),0,1))*n*(3-2*n)}function D(e,t,n){const i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function R(e,t,n){if(!e.length)return n(null,[]);let i=e.length;const r=new Array(e.length);let o=null;e.forEach(((e,s)=>{t(e,((e,t)=>{e&&(o=e),r[s]=t,0==--i&&n(o,r)}))}))}function z(e){const t=[];for(const n in e)t.push(e[n]);return t}function L(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}function O(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i];r in e&&(n[r]=e[r])}return n}let F=1;function B(){return F++}function N(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function j(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function U(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function V(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function G(e,t){return-1!==e.indexOf(t,e.length-t.length)}function q(e,t,n){const i={};for(const r in e)i[r]=t.call(n||this,e[r],r,e);return i}function H(e,t,n){const i={};for(const r in e)t.call(n||this,e[r],r,e)&&(i[r]=e[r]);return i}function W(e){return Array.isArray(e)?e.map(W):"object"==typeof e&&e?q(e,W):e}const Z={};function X(e){Z[e]||("undefined"!=typeof console&&console.warn(e),Z[e]=!0)}function Y(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function K(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}function Q(e){let[t,n,i]=e;const r=w(n+90),o=w(i);return{x:t*Math.cos(r)*Math.sin(o),y:t*Math.sin(r)*Math.sin(o),z:t*Math.cos(o),azimuthal:n,polar:i}}function J(e,t,n){const i=Math.sqrt(e*e+t*t+n*n),r=i>0?Math.acos(n/i)*b:0;let o=0!==e||0!==t?Math.atan2(-t,-e)*b+90:0;return o<0&&(o+=360),[i,o,r]}function $(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ee(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,n,i,r)=>{const o=i||r;return t[n]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let te=null;function ne(){return!!t.document.fullscreenElement||!!t.document.webkitFullscreenElement}function ie(e){try{const n=t[e];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function re(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function oe(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]}function se(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function ae(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}const le="mapbox-tiles";let ce,ue,he=500,de=50;function pe(){try{return t.caches}catch(e){}}function fe(){pe()&&!ce&&(ce=t.caches.open(le))}function me(e){const t=e.indexOf("?");if(t<0)return e;const n=function(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}(e),i=n.filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return i.length?"".concat(e.slice(0,t),"?").concat(i.join("&")):e.slice(0,t)}let _e=1/0;function ge(e){_e++,_e>de&&(e.getActor().send("enforceCacheSizeLimit",he),_e=0)}const ye={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(ye);class ve extends Error{constructor(e,t,n){401===t&&De(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}const xe=$()?()=>self.worker&&self.worker.referrer:()=>("blob:"===t.location.protocol?t.parent:t).location.href,be=function(e,n){if(!(/^file:/.test(i=e.url)||/^file:/.test(xe())&&!/^\w+:/.test(i))){if(t.fetch&&t.Request&&t.AbortController&&t.Request.prototype.hasOwnProperty("signal"))return function(e,n){const i=new t.AbortController,r=new t.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:xe(),referrerPolicy:e.referrerPolicy,signal:i.signal});let o=!1,s=!1;const a=(l=r.url).indexOf("sku=")>0&&De(l);var l;"json"===e.type&&r.headers.set("Accept","application/json");const c=(i,o,l)=>{if(s)return;if(i&&"SecurityError"!==i.message&&X(i.toString()),o&&l)return u(o);const c=Date.now();t.fetch(r).then((t=>{if(t.ok){const e=a?t.clone():null;return u(t,e,c)}return n(new ve(t.statusText,t.status,e.url))})).catch((t=>{"AbortError"!==t.name&&n(new Error("".concat(t.message," ").concat(e.url)))}))},u=(i,a,l)=>{("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then((e=>{s||(a&&l&&function(e,n,i){if(fe(),!ce)return;const r={status:n.status,statusText:n.statusText,headers:new t.Headers};n.headers.forEach(((e,t)=>r.headers.set(t,e)));const o=ee(n.headers.get("Cache-Control")||"");if(o["no-store"])return;o["max-age"]&&r.headers.set("Expires",new Date(i+1e3*o["max-age"]).toUTCString());const s=r.headers.get("Expires");s&&(new Date(s).getTime()-i<42e4||function(e,t){if(void 0===ue)try{new Response(new ReadableStream),ue=!0}catch(e){ue=!1}ue?t(e.body):e.blob().then(t)}(n,(n=>{const i=new t.Response(n,r);fe(),ce&&ce.then((t=>t.put(me(e.url),i))).catch((e=>X(e.message)))})))}(r,a,l),o=!0,n(null,e,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((e=>{s||n(new Error(e.message))}))};return a?function(e,t){if(fe(),!ce)return t(null);const n=me(e.url);ce.then((e=>{e.match(n).then((i=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),n=ee(e.headers.get("Cache-Control")||"");return t>Date.now()&&!n["no-cache"]}(i);e.delete(n),r&&e.put(n,i.clone()),t(null,i,r)})).catch(t)})).catch(t)}(r,c):c(null,null),{cancel:()=>{s=!0,o||i.abort()}}}(e,n);if($()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,n,void 0,!0)}var i;return function(e,n){const i=new t.XMLHttpRequest;i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer");for(const t in e.headers)i.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=()=>{n(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let t=i.response;if("json"===e.type)try{t=JSON.parse(i.response)}catch(e){return n(e)}n(null,t,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else n(new ve(i.statusText,i.status,e.url))},i.send(e.body),{cancel:()=>i.abort()}}(e,n)},we=function(e,t){return be(L(e,{type:"json"}),t)},Te=function(e,t){return be(L(e,{type:"arrayBuffer"}),t)};function Se(e){const n=t.document.createElement("a");return n.href=e,n.protocol===t.document.location.protocol&&n.host===t.document.location.host}const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ce,Ae;Ce=[],Ae=0;const Ie=function(e,n){if(o.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ae>=r.MAX_PARALLEL_IMAGE_REQUESTS){const t={requestParameters:e,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Ce.push(t),t}Ae++;let i=!1;const s=()=>{if(!i)for(i=!0,Ae--;Ce.length&&Ae<r.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Ce.shift(),{requestParameters:t,callback:n,cancelled:i}=e;i||(e.cancel=Ie(t,n).cancel)}},a=Te(e,((e,i,r,o)=>{s(),e?n(e):i&&(t.createImageBitmap?function(e,n){const i=new t.Blob([new Uint8Array(e)],{type:"image/png"});t.createImageBitmap(i).then((e=>{n(null,e)})).catch((e=>{n(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}(i,((e,t)=>n(e,t,r,o))):function(e,n){const i=new t.Image,r=t.URL;i.onload=()=>{n(null,i),r.revokeObjectURL(i.src),i.onload=null,t.requestAnimationFrame((()=>{i.src=Ee}))},i.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new t.Blob([new Uint8Array(e)],{type:"image/png"});i.src=e.byteLength?r.createObjectURL(o):Ee}(i,((e,t)=>n(e,t,r,o))))}));return{cancel:()=>{a.cancel(),s()}}},Me="NO_ACCESS_TOKEN";class ke{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",h,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Pe(e))return e;const i=Fe(e);return i.params.push("sdk=js-".concat(n)),i.path="/styles/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Pe(e))return e;const n=Fe(e);return n.path="/fonts/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}normalizeModelURL(e,t){if(!Pe(e))return e;const n=Fe(e);return n.path="/models/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(e,t,n,i){if(!Pe(e))return e;const r=Fe(e);return r.path="/v4/".concat(r.authority,".json"),r.params.push("secure"),n&&r.params.push("language=".concat(n)),i&&r.params.push("worldview=".concat(i)),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(e,t,n,i){const r=Fe(e);return Pe(e)?(r.path="/styles/v1".concat(r.path,"/sprite").concat(t).concat(n),this._makeAPIURL(r,this._customAccessToken||i)):(r.path+="".concat(t).concat(n),Be(r))}normalizeTileURL(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Pe(e))return e;const i=Fe(e);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(t||n&&"raster"!==i.authority&&512===n?"@2x":"").concat(o.supported?".webp":"$1")),"raster"===i.authority?i.path="/".concat(r.RASTER_URL_PREFIX).concat(i.path):(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path="/".concat(r.TILE_URL_VERSION).concat(i.path));const s=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(i.params)||r.ACCESS_TOKEN;return r.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&i.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(i,s)}canonicalizeTileURL(e,t){const n=Fe(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;let i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+="raster/".concat(n.path.replace("/".concat(r.RASTER_URL_PREFIX,"/"),"")):i+="tiles/".concat(n.path.replace("/".concat(r.TILE_URL_VERSION,"/"),""));let o=n.params;return t&&(o=o.filter((e=>!e.match(/^access_token=/)))),o.length&&(i+="?".concat(o.join("&"))),i}canonicalizeTileset(e,t){const n=!!t&&Pe(t),i=[];for(const r of e.tiles||[])De(r)?i.push(this.canonicalizeTileURL(r,n)):i.push(r);return i}_makeAPIURL(e,t){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=Fe(r.API_URL);if(e.protocol=i.protocol,e.authority=i.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==i.path&&(e.path="".concat(i.path).concat(e.path)),!r.REQUIRE_ACCESS_TOKEN)return Be(e);if(t=t||r.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error("An API access token is required to use Mapbox GL. ".concat(n));if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(n))}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push("access_token=".concat(t||"")),Be(e)}}function Pe(e){return 0===e.indexOf("mapbox:")}function De(e){return r.API_URL_REGEX.test(e)}function Re(e){return r.API_CDN_URL_REGEX.test(e)}function ze(e){return r.API_STYLE_REGEX.test(e)&&!Le(e)}function Le(e){return r.API_SPRITE_REGEX.test(e)}const Oe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Fe(e){const t=e.match(Oe);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Be(e){const t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}const Ne="mapbox.eventData";function je(e){if(!e)return null;const n=e.split(".");if(!n||3!==n.length)return null;try{return JSON.parse(decodeURIComponent(t.atob(n[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class Ue{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=je(r.ACCESS_TOKEN);let i="";return i=n&&n.u?t.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):r.ACCESS_TOKEN||"",e?"".concat(Ne,".").concat(e,":").concat(i):"".concat(Ne,":").concat(i)}fetchEventData(){const e=ie("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const e=t.localStorage.getItem(n);e&&(this.eventData=JSON.parse(e));const r=t.localStorage.getItem(i);r&&(this.anonId=r)}catch(e){X("Unable to read from LocalStorage")}}saveEventData(){const e=ie("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{t.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&t.localStorage.setItem(n,JSON.stringify(this.eventData))}catch(e){X("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,n,i){if(!r.EVENTS_URL)return;const o=Fe(r.EVENTS_URL);o.params.push("access_token=".concat(i||r.ACCESS_TOKEN||""));const s={event:this.type,created:new Date(e).toISOString()},a=t?L(s,t):s,l={url:Be(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(e,t){return be(L(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Ve=new class extends Ue{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){r.EVENTS_URL&&r.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>Pe(e)||De(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=je(r.ACCESS_TOKEN),i=t?t.u:r.ACCESS_TOKEN;let o=i!==this.eventData.tokenU;U(this.anonId)||(this.anonId=N(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(s),n=(s-this.eventData.lastSuccess)/864e5;o=o||n>=1||n<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:n,skuId:h,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=s,this.eventData.tokenU=i)}),e):this.processRequests()}},Ge=Ve.postTurnstileEvent.bind(Ve),qe=new class extends Ue{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,i){this.skuToken=t,this.errorCb=i,r.EVENTS_URL&&(n||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Me)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),U(this.anonId)||(this.anonId=N()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:n,skuId:h,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},He=qe.postMapLoadEvent.bind(qe),We=new class extends Ue{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){r.EVENTS_URL&&(e||r.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:r}=this.queue.shift(),o=function(e){const i=t.performance.getEntriesByType("resource"),r=t.performance.getEntriesByType("mark"),o=function(e){const t={};if(e)for(const n in e)if("other"!==n)for(const i of e[n]){const e="".concat(n,"ResolveRangeMin"),r="".concat(n,"ResolveRangeMax"),o="".concat(n,"RequestCount"),s="".concat(n,"RequestCachedCount");t[e]=Math.min(t[e]||1/0,i.startTime),t[r]=Math.max(t[r]||-1/0,i.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==i.transferSize&&0===i.transferSize&&a(s),a(o)}return t}(function(e,t){const n={};if(e)for(const i of e){const e=t(i);void 0===n[e]&&(n[e]=[]),n[e].push(i)}return n}(i,et)),s=t.devicePixelRatio,a=t.navigator.connection||t.navigator.mozConnection||t.navigator.webkitConnection,l={counters:[],metadata:[],attributes:[]},c=(e,t,n)=>{null!=n&&e.push({name:t,value:n.toString()})};for(const t in o)c(l.counters,t,o[t]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(c(l.counters,"interactionRangeMin",e.interactionRange[0]),c(l.counters,"interactionRangeMax",e.interactionRange[1])),r)for(const t of Object.keys(Je)){const e=Je[t],n=r.find((t=>t.name===e));n&&c(l.counters,e,n.startTime)}return c(l.counters,"visibilityHidden",e.visibilityHidden),c(l.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(ze(e)){const t=e.split("/").slice(-2);if(2===t.length)return"mapbox://styles/".concat(t[0],"/").concat(t[1])}}}(i)),c(l.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),c(l.attributes,"fogEnabled",e.fogEnabled?"true":"false"),c(l.attributes,"projection",e.projection),c(l.attributes,"zoom",e.zoom),c(l.metadata,"devicePixelRatio",s),c(l.metadata,"connectionEffectiveType",a?a.effectiveType:void 0),c(l.metadata,"navigatorUserAgent",t.navigator.userAgent),c(l.metadata,"screenWidth",t.screen.width),c(l.metadata,"screenHeight",t.screen.height),c(l.metadata,"windowWidth",t.innerWidth),c(l.metadata,"windowHeight",t.innerHeight),c(l.metadata,"mapWidth",e.width/s),c(l.metadata,"mapHeight",e.height/s),c(l.metadata,"webglRenderer",e.renderer),c(l.metadata,"webglVendor",e.vendor),c(l.metadata,"sdkVersion",n),c(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(r);for(const t of o.metadata);for(const t of o.counters);for(const t of o.attributes);this.postEvent(i,o,(()=>{}),e)}},Ze=We.postPerformanceEvent.bind(We),Xe=new class extends Ue{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,i){if(!r.API_URL||!r.SESSION_PATH)return;const o=Fe(r.API_URL+r.SESSION_PATH);o.params.push("sku=".concat(t||"")),o.params.push("access_token=".concat(i||r.ACCESS_TOKEN||""));const s={url:Be(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return be(L(e,{method:"GET"}),t)}(s,(e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)}))}getSessionAPI(e,t,n,i){this.skuToken=t,this.errorCb=i,r.SESSION_PATH&&r.API_URL&&(n||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Me)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},Ye=Xe.getSessionAPI.bind(Xe),Ke=new Set;function Qe(e,t){t?Ke.add(e):Ke.delete(e)}const Je={create:"create",load:"load",fullLoad:"fullLoad"},$e={mark(e){t.performance.mark(e)},measure(e,n,i){t.performance.measure(e,n,i)}};function et(e){const t=e.name.split("?")[0];return Re(t)&&t.includes("mapbox-gl.js")?"javascript":Re(t)&&t.includes("mapbox-gl.css")?"css":function(e){return r.API_FONTS_REGEX.test(e)}(t)?"fontRange":Le(t)?"sprite":ze(t)?"style":function(e){return r.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}const tt=t.performance;function nt(e){const t=e?e.url.toString():void 0;return tt.getEntriesByName(t)}var it=rt;function rt(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===ot[t=e&&e.failIfMajorPerformanceCaveat]&&(ot[t]=function(e){var t,n=function(e){var t=document.createElement("canvas"),n=Object.create(rt.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=e,t.getContext("webgl",n)||t.getContext("experimental-webgl",n)}(e);if(!n)return!1;try{t=n.createShader(n.VERTEX_SHADER)}catch(e){return!1}return!(!t||n.isContextLost())&&(n.shaderSource(t,"void main() {}"),n.compileShader(t),!0===n.getShaderParameter(t,n.COMPILE_STATUS))}(t)),ot[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var ot={};let st,at,lt,ct;rt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ut={now:()=>void 0!==lt?lt:t.performance.now(),setNow(e){lt=e},restoreNow(){lt=void 0},frame(e){const n=t.requestAnimationFrame(e);return{cancel:()=>t.cancelAnimationFrame(n)}},getImageData(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:i,height:r}=e;ct||(ct=t.document.createElement("canvas"));const o=ct.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(i>ct.width||r>ct.height)&&(ct.width=i,ct.height=r),o.clearRect(-n,-n,i+2*n,r+2*n),o.drawImage(e,0,0,i,r),o.getImageData(-n,-n,i+2*n,r+2*n)},resolveURL:e=>(st||(st=t.document.createElement("a")),st.href=e,st.href),get devicePixelRatio(){return t.devicePixelRatio},get prefersReducedMotion(){return!!t.matchMedia&&(null==at&&(at=t.matchMedia("(prefers-reduced-motion: reduce)")),at.matches)}};function ht(e,n,i){const r=t.document.createElement(e);return void 0!==n&&(r.className=n),i&&i.appendChild(r),r}function dt(e,n,i){const r=t.document.createElementNS("http://www.w3.org/2000/svg",e);for(const t of Object.keys(n))r.setAttributeNS(null,t,n[t]);return i&&i.appendChild(r),r}const pt=t.document&&t.document.documentElement.style,ft=pt&&void 0!==pt.userSelect?"userSelect":"WebkitUserSelect";let mt;function _t(){pt&&ft&&(mt=pt[ft],pt[ft]="none")}function gt(){pt&&ft&&(pt[ft]=mt)}function yt(e){e.preventDefault(),e.stopPropagation(),t.removeEventListener("click",yt,!0)}function vt(){t.addEventListener("click",yt,!0),t.setTimeout((()=>{t.removeEventListener("click",yt,!0)}),0)}function xt(e,t){const n=e.getBoundingClientRect();return Tt(e,n,t)}function bt(e,t){const n=e.getBoundingClientRect(),i=[];for(let r=0;r<t.length;r++)i.push(Tt(e,n,t[r]));return i}function wt(e){return void 0!==t.InstallTrigger&&2===e.button&&e.ctrlKey&&t.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function Tt(e,t,n){const i=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new y((n.clientX-t.left)*i,(n.clientY-t.top)*i)}function St(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Et(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class Ct{constructor(e){L(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=e}}class At extends Ct{constructor(e){super("error",L({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}class It{on(e,t){return this._listeners=this._listeners||{},St(e,t,this._listeners),this}off(e,t){return Et(e,t,this._listeners),Et(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},St(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Ct(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of i)Et(n,o,this._oneTimeListeners),o.call(this,e);const r=this._eventedParent;r&&(L(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof At&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Mt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class kt{constructor(e,t,n,i){this.message=(e?"".concat(e,": "):"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}class Pt extends kt{}function Dt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}function Rt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function zt(e){if(Array.isArray(e))return e.map(zt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=zt(e[n]);return t}return Rt(e)}class Lt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Ot=Lt;class Ft{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new Ft(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Bt=Ft;const Nt={kind:"null"},jt={kind:"number"},Ut={kind:"string"},Vt={kind:"boolean"},Gt={kind:"color"},qt={kind:"object"},Ht={kind:"value"},Wt={kind:"collator"},Zt={kind:"formatted"},Xt={kind:"resolvedImage"};function Yt(e,t){return{kind:"array",itemType:e,N:t}}function Kt(e){if("array"===e.kind){const t=Kt(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}const Qt=[Nt,jt,Ut,Vt,Gt,Zt,qt,Yt(Ht),Xt];function Jt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Jt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Qt)if(!Jt(e,t))return null}return"Expected ".concat(Kt(e)," but found ").concat(Kt(t)," instead.")}function $t(e,t){return t.some((t=>t.kind===e.kind))}function en(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var tn,nn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function rn(e){return(e=Math.round(e))<0?0:e>255?255:e}function on(e){return rn("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function sn(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function an(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{tn={}.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in nn)return nn[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var i=n.indexOf("("),r=n.indexOf(")");if(-1!==i&&r+1===n.length){var o=n.substr(0,i),s=n.substr(i+1,r-(i+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=sn(s.pop());case"rgb":return 3!==s.length?null:[on(s[0]),on(s[1]),on(s[2]),a];case"hsla":if(4!==s.length)return null;a=sn(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=sn(s[1]),u=sn(s[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[rn(255*an(d,h,l+1/3)),rn(255*an(d,h,l)),rn(255*an(d,h,l-1/3)),a];default:return null}}return null}}catch(e){}class ln{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof ln)return e;if("string"!=typeof e)return;const t=tn(e);return t?new ln(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,i]=this.toArray();return"rgba(".concat(Math.round(e),",").concat(Math.round(t),",").concat(Math.round(n),",").concat(i,")")}toArray(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*e/i,255*t/i,255*n/i,i]}toArray01(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[e/i,t/i,n/i,i]}toArray01Scaled(e){const{r:t,g:n,b:i,a:r}=this;return 0===r?[0,0,0]:[t/r*e,n/r*e,i/r*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a:i}=this;return[e,t,n,i]}toArray01Linear(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[Math.pow(e/i,2.2),Math.pow(t/i,2.2),Math.pow(n/i,2.2),i]}}ln.black=new ln(0,0,0,1),ln.white=new ln(1,1,1,1),ln.transparent=new ln(0,0,0,0),ln.red=new ln(1,0,0,1),ln.blue=new ln(0,0,1,1);var cn=ln;class un{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class hn{constructor(e,t,n,i,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=r}}class dn{constructor(e){this.sections=e}static fromString(e){return new dn([new hn(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length))}static factory(e){return e instanceof dn?e:dn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class pn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?"[".concat(this.namePrimary,",").concat(this.nameSecondary,"]"):this.namePrimary}static fromString(e,t){return e?new pn({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function fn(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function mn(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof cn)return!0;if(e instanceof un)return!0;if(e instanceof dn)return!0;if(e instanceof pn)return!0;if(Array.isArray(e)){for(const t of e)if(!mn(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!mn(e[t]))return!1;return!0}return!1}function _n(e){if(null===e)return Nt;if("string"==typeof e)return Ut;if("boolean"==typeof e)return Vt;if("number"==typeof e)return jt;if(e instanceof cn)return Gt;if(e instanceof un)return Wt;if(e instanceof dn)return Zt;if(e instanceof pn)return Xt;if(Array.isArray(e)){const t=e.length;let n;for(const i of e){const e=_n(i);if(n){if(n===e)continue;n=Ht;break}n=e}return Yt(n||Ht,t)}return qt}function gn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof cn||e instanceof dn||e instanceof pn?e.toString():JSON.stringify(e)}class yn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(!mn(e[1]))return t.error("invalid value");const n=e[1];let i=_n(n);const r=t.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new yn(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof cn?["rgba"].concat(this.value.toArray()):this.value instanceof dn?this.value.serialize():this.value}}var vn=yn,xn=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const bn={string:Ut,number:jt,boolean:Vt,object:qt};class wn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in bn)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=bn[n],i++}else r=Ht;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],i++}n=Yt(r,o)}else n=bn[r];const o=[];for(;i<e.length;i++){const n=t.parse(e[i],i,Ht);if(!n)return null;o.push(n)}return new wn(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!Jt(this.type,_n(n)))return n;if(t===this.args.length-1)throw new xn("Expected value to be of type ".concat(Kt(this.type),", but found ").concat(Kt(_n(n))," instead."))}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map((e=>e.serialize())))}}var Tn=wn;class Sn{constructor(e){this.type=Zt,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let r=!1;for(let o=1;o<=e.length-1;++o){const n=e[o];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let e=null;if(n["font-scale"]&&(e=t.parse(n["font-scale"],1,jt),!e))return null;let o=null;if(n["text-font"]&&(o=t.parse(n["text-font"],1,Yt(Ut)),!o))return null;let s=null;if(n["text-color"]&&(s=t.parse(n["text-color"],1,Gt),!s))return null;const a=i[i.length-1];a.scale=e,a.font=o,a.textColor=s}else{const n=t.parse(e[o],1,Ht);if(!n)return null;const s=n.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new Sn(i)}evaluate(e){return new dn(this.sections.map((t=>{const n=t.content.evaluate(e);return _n(n)===Xt?new hn("",n,null,null,null):new hn(gn(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class En{constructor(e,t){this.type=Xt,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const n=t.parse(e[1],1,Ut);if(!n)return t.error("No image name provided.");if(2===e.length)return new En(n);const i=t.parse(e[2],1,Ut);return i?new En(n,i):t.error("Secondary image variant is not a string.")}evaluate(e){const t=pn.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Cn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const An={"to-boolean":Vt,"to-color":Gt,"to-number":jt,"to-string":Ut};class In{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0],i=[];let r=Nt;if("to-array"===n){if(!Array.isArray(e[1]))return null;const n=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error("Expected ".concat(t.expectedType.kind," but found array."));r=Yt(t.expectedType.itemType,n)}else{if(!(n>0&&mn(e[1][0])))return null;r=Yt(_n(e[1][0]),n)}for(let o=0;o<n;o++){const n=e[1][o];let s;if("array"===Cn(n))s=t.parse(n,void 0,r.itemType);else{const e=Cn(n);if(e!==r.itemType.kind)return t.error("Expected ".concat(r.itemType.kind," but found ").concat(e,"."));s=t.registry.literal.parse(["literal",void 0===n?null:n],t)}if(!s)return null;i.push(s)}}else{if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");r=An[n];for(let n=1;n<e.length;n++){const r=t.parse(e[n],n,Ht);if(!r)return null;i.push(r)}}return new In(r,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof cn)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):fn(t[0],t[1],t[2],t[3]),!n))return new cn(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new xn(n||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new xn("Could not convert ".concat(JSON.stringify(t)," to number."))}return"formatted"===this.type.kind?dn.fromString(gn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?pn.fromString(gn(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):gn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Sn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new En(this.args[0]).serialize();const e="array"===this.type.kind?[]:["to-".concat(this.type.kind)];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Mn=In;const kn=["Unknown","Point","LineString","Polygon"];var Pn=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?kn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=cn.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Dn{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const n=e[0],i=Dn.definitions[n];if(!i)return t.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=o.filter((t=>{let[n]=t;return!Array.isArray(n)||n.length===e.length-1}));let a=null;for(const[l,c]of s){a=new qi(t.registry,t.path,null,t.scope,void 0,t.options);const i=[];let o=!1;for(let t=1;t<e.length;t++){const n=e[t],r=Array.isArray(l)?l[t-1]:l.type,s=a.parse(n,1+i.length,r);if(!s){o=!0;break}i.push(s)}if(!o)if(Array.isArray(l)&&l.length!==i.length)a.error("Expected ".concat(l.length," arguments, but found ").concat(i.length," instead."));else{for(let e=0;e<i.length;e++){const t=Array.isArray(l)?l[e]:l.type,n=i[e];a.concat(e+1).checkSubtype(t,n.type)}if(0===a.errors.length)return new Dn(n,r,c,i)}}if(1===s.length)t.errors.push(...a.errors);else{const n=(s.length?s:o).map((e=>{let[t]=e;return n=t,Array.isArray(n)?"(".concat(n.map(Kt).join(", "),")"):"(".concat(Kt(n.type),"...)");var n})).join(" | "),i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],1+i.length);if(!n)return null;i.push(Kt(n.type))}t.error("Expected arguments of type ".concat(n,", but found (").concat(i.join(", "),") instead."))}return null}static register(e,t){Dn.definitions=t;for(const n in t)e[n]=Dn}}var Rn=Dn;class zn{constructor(e,t,n){this.type=Wt,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Vt);if(!i)return null;const r=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Vt);if(!r)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,Ut),!o)?null:new zn(i,r,o)}evaluate(e){return new un(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Ln={exports:{}};Ln.exports=function(){function e(n,i,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=i-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(n,i,Math.max(r,Math.floor(i-l*u/a+h)),Math.min(o,Math.floor(i+(a-l)*u/a+h)),s)}var d=n[i],p=r,f=o;for(t(n,r,i),s(n[o],d)>0&&t(n,r,o);p<f;){for(t(n,p,f),p++,f--;s(n[p],d)<0;)p++;for(;s(n[f],d)>0;)f--}0===s(n[r],d)?t(n,r,f):t(n,++f,o),f<=i&&(r=f+1),i<=f&&(o=f-1)}}function t(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function n(e,t){return e<t?-1:e>t?1:0}return function(t,i,r,o,s){e(t,i,r||0,o||t.length-1,s||n)}}();var On=d(Ln.exports);function Fn(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}function Bn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Nn(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function jn(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],o=e[0]-n[0],s=e[1]-n[1];return i*s-o*r==0&&i*o<=0&&r*s<=0}function Un(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;for(let a=0,l=t.length;a<l;a++){const l=t[a];for(let t=0,a=l.length,c=a-1;t<a;c=t++){const a=l[c],u=l[t];if(jn(e,a,u))return n;(o=a)[1]>(r=e)[1]!=(s=u)[1]>r[1]&&r[0]<(s[0]-o[0])*(r[1]-o[1])/(s[1]-o[1])+o[0]&&(i=!i)}}var r,o,s;return i}function Vn(e,t,n,i){const r=i[0]-n[0],o=i[1]-n[1],s=(e[0]-n[0])*o-r*(e[1]-n[1]),a=(t[0]-n[0])*o-r*(t[1]-n[1]);return s>0&&a<0||s<0&&a>0}function Gn(e,t,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-r[1]*o[0]&&!(!Vn(e,t,n,i)||!Vn(n,i,e,t));var r,o}const qn=8192;function Hn(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*qn),Math.round(i*r*qn)]}function Wn(e,t){for(let n=0;n<t.length;n++)if(Un(e,t[n]))return!0;return!1}function Zn(e,t,n){for(const i of n)for(let n=0,r=i.length,o=r-1;n<r;o=n++)if(Gn(e,t,i[o],i[n]))return!0;return!1}function Xn(e,t){for(let n=0;n<e.length;++n)if(!Un(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(Zn(e[n],e[n+1],t))return!1;return!0}function Yn(e,t){for(let n=0;n<t.length;n++)if(Xn(e,t[n]))return!0;return!1}function Kn(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=[];for(let i=0;i<e[r].length;i++){const s=Hn(e[r][i],n);Bn(t,s),o.push(s)}i.push(o)}return i}function Qn(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=Kn(e[r],t,n);i.push(o)}return i}function Jn(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const t=.5*i;let r=e[0]-n[0]>t?-i:n[0]-e[0]>t?i:0;0===r&&(r=e[0]-n[2]>t?-i:n[2]-e[0]>t?i:0),e[0]+=r}Bn(t,e)}function $n(e,t,n,i){const r=Math.pow(2,i.z)*qn,o=[i.x*qn,i.y*qn],s=[];if(!e)return s;for(const a of e)for(const e of a){const i=[e.x+o[0],e.y+o[1]];Jn(i,t,n,r),s.push(i)}return s}function ei(e,t,n,i){const r=Math.pow(2,i.z)*qn,o=[i.x*qn,i.y*qn],s=[];if(!e)return s;for(const l of e){const e=[];for(const n of l){const i=[n.x+o[0],n.y+o[1]];Bn(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const i of e)Jn(i,t,n,r)}var a;return s}class ti{constructor(e,t){this.type=Vt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(mn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const n=t.features[e].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new ti(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ti(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new ti(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=Kn(t.coordinates,i,r),s=$n(e.geometry(),n,i,r);if(!Nn(n,i))return!1;for(const e of s)if(!Un(e,o))return!1}if("MultiPolygon"===t.type){const o=Qn(t.coordinates,i,r),s=$n(e.geometry(),n,i,r);if(!Nn(n,i))return!1;for(const e of s)if(!Wn(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=Kn(t.coordinates,i,r),s=ei(e.geometry(),n,i,r);if(!Nn(n,i))return!1;for(const e of s)if(!Xn(e,o))return!1}if("MultiPolygon"===t.type){const o=Qn(t.coordinates,i,r),s=ei(e.geometry(),n,i,r);if(!Nn(n,i))return!1;for(const e of s)if(!Yn(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ni=ti,ii={exports:{}};ii.exports=function(){var e={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},t=1/298.257223563,n=t*(2-t),i=Math.PI/180,r=function(t,r){if(void 0===t)throw new Error("No latitude given.");if(r&&!e[r])throw new Error("Unknown unit "+r+". Use one of: "+Object.keys(e).join(", "));var o=6378.137*i*(r?e[r]:1),s=Math.cos(t*i),a=1/(1-n*(1-s*s)),l=Math.sqrt(a);this.kx=o*l*s,this.ky=o*l*a*(1-n)},o={units:{configurable:!0}};function s(e,t){return e[0]===t[0]&&e[1]===t[1]}function a(e,t,n){var i=l(t[0]-e[0]);return[e[0]+i*n,e[1]+(t[1]-e[1])*n]}function l(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}return r.fromTile=function(e,t,n){var o=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),s=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/i;return new r(s,n)},o.units.get=function(){return e},r.prototype.distance=function(e,t){var n=l(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)},r.prototype.bearing=function(e,t){var n=l(t[0]-e[0])*this.kx;return Math.atan2(n,(t[1]-e[1])*this.ky)/i},r.prototype.destination=function(e,t,n){var r=n*i;return this.offset(e,Math.sin(r)*t,Math.cos(r)*t)},r.prototype.offset=function(e,t,n){return[e[0]+t/this.kx,e[1]+n/this.ky]},r.prototype.lineDistance=function(e){for(var t=0,n=0;n<e.length-1;n++)t+=this.distance(e[n],e[n+1]);return t},r.prototype.area=function(e){for(var t=0,n=0;n<e.length;n++)for(var i=e[n],r=0,o=i.length,s=o-1;r<o;s=r++)t+=l(i[r][0]-i[s][0])*(i[r][1]+i[s][1])*(n?-1:1);return Math.abs(t)/2*this.kx*this.ky},r.prototype.along=function(e,t){var n=0;if(t<=0)return e[0];for(var i=0;i<e.length-1;i++){var r=e[i],o=e[i+1],s=this.distance(r,o);if((n+=s)>t)return a(r,o,(t-(n-s))/s)}return e[e.length-1]},r.prototype.pointToSegmentDistance=function(e,t,n){var i=t[0],r=t[1],o=l(n[0]-i)*this.kx,s=(n[1]-r)*this.ky,a=0;return 0===o&&0===s||((a=(l(e[0]-i)*this.kx*o+(e[1]-r)*this.ky*s)/(o*o+s*s))>1?(i=n[0],r=n[1]):a>0&&(i+=o/this.kx*a,r+=s/this.ky*a)),o=l(e[0]-i)*this.kx,s=(e[1]-r)*this.ky,Math.sqrt(o*o+s*s)},r.prototype.pointOnLine=function(e,t){for(var n,i,r,o,s=1/0,a=0;a<e.length-1;a++){var c=e[a][0],u=e[a][1],h=l(e[a+1][0]-c)*this.kx,d=(e[a+1][1]-u)*this.ky,p=0;0===h&&0===d||((p=(l(t[0]-c)*this.kx*h+(t[1]-u)*this.ky*d)/(h*h+d*d))>1?(c=e[a+1][0],u=e[a+1][1]):p>0&&(c+=h/this.kx*p,u+=d/this.ky*p));var f=(h=l(t[0]-c)*this.kx)*h+(d=(t[1]-u)*this.ky)*d;f<s&&(s=f,n=c,i=u,r=a,o=p)}return{point:[n,i],index:r,t:Math.max(0,Math.min(1,o))}},r.prototype.lineSlice=function(e,t,n){var i=this.pointOnLine(n,e),r=this.pointOnLine(n,t);if(i.index>r.index||i.index===r.index&&i.t>r.t){var o=i;i=r,r=o}var a=[i.point],l=i.index+1,c=r.index;!s(n[l],a[0])&&l<=c&&a.push(n[l]);for(var u=l+1;u<=c;u++)a.push(n[u]);return s(n[c],r.point)||a.push(r.point),a},r.prototype.lineSliceAlong=function(e,t,n){for(var i=0,r=[],o=0;o<n.length-1;o++){var s=n[o],l=n[o+1],c=this.distance(s,l);if((i+=c)>e&&0===r.length&&r.push(a(s,l,(e-(i-c))/c)),i>=t)return r.push(a(s,l,(t-(i-c))/c)),r;i>e&&r.push(l)}return r},r.prototype.bufferPoint=function(e,t){var n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[0]+i,e[1]+n]},r.prototype.bufferBBox=function(e,t){var n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[2]+i,e[3]+n]},r.prototype.insideBBox=function(e,t){return l(e[0]-t[0])>=0&&l(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(r,o),r}();var ri=d(ii.exports),oi={exports:{}};oi.exports=function(){var e=function(e,n){if(void 0===e&&(e=[]),void 0===n&&(n=t),this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i},e.prototype._down=function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var o=1+(e<<1),s=t[o],a=o+1;if(a<this.length&&n(t[a],s)<0&&(o=a,s=t[a]),n(s,r)>=0)break;t[e]=s,e=o}t[e]=r},e}();var si=d(oi.exports),ai=8192;function li(e,t){return t.dist-e.dist}const ci=100,ui=50;function hi(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function di(e){return e[1]-e[0]+1}function pi(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function fi(e,t){if(e[0]>e[1])return[null,null];const n=di(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===n)return[e,null];const t=Math.floor(n/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function mi(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!pi(t,e.length))return n;for(let i=t[0];i<=t[1];++i)Bn(n,e[i]);return n}function _i(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let i=0;i<e[n].length;++i)Bn(t,e[n][i]);return t}function gi(e,t,n){if(hi(e)||hi(t))return NaN;let i=0,r=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(r=e[1]-t[3]),e[3]<t[1]&&(r=t[1]-e[3]),n.distance([0,0],[i,r])}function yi(e,t){const n=Math.pow(2,t.z);return[(r=(e.x/ai+t.x)/n,360*r-180),(i=(e.y/ai+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,r}function vi(e,t){const n=[];for(let i=0;i<e.length;++i)n.push(yi(e[i],t));return n}function xi(e,t,n){const i=n.pointOnLine(t,e).point;return n.distance(e,i)}function bi(e,t,n,i,r){const o=n.slice(i[0],i[1]+1);let s=1/0;for(let a=t[0];a<=t[1];++a)if(0===(s=Math.min(s,xi(e[a],o,r))))return 0;return s}function wi(e,t,n,i,r){const o=Math.min(r.pointToSegmentDistance(e,n,i),r.pointToSegmentDistance(t,n,i)),s=Math.min(r.pointToSegmentDistance(n,e,t),r.pointToSegmentDistance(i,e,t));return Math.min(o,s)}function Ti(e,t,n,i,r){if(!pi(t,e.length)||!pi(i,n.length))return NaN;let o=1/0;for(let s=t[0];s<t[1];++s)for(let t=i[0];t<i[1];++t){if(Gn(e[s],e[s+1],n[t],n[t+1]))return 0;o=Math.min(o,wi(e[s],e[s+1],n[t],n[t+1],r))}return o}function Si(e,t,n,i,r){if(!pi(t,e.length)||!pi(i,n.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=i[0];t<=i[1];++t)if(0===(o=Math.min(o,r.distance(e[s],n[t]))))return o;return o}function Ei(e,t,n){if(Un(e,t,!0))return 0;let i=1/0;for(const r of t){const t=r.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(r[0]!==r[t-1]&&0===(i=Math.min(i,n.pointToSegmentDistance(e,r[t-1],r[0]))))return i;if(0===(i=Math.min(i,xi(e,r,n))))return i}return i}function Ci(e,t,n,i){if(!pi(t,e.length))return NaN;for(let o=t[0];o<=t[1];++o)if(Un(e[o],n,!0))return 0;let r=1/0;for(let o=t[0];o<t[1];++o)for(const t of n)for(let n=0,s=t.length,a=s-1;n<s;a=n++){if(Gn(e[o],e[o+1],t[a],t[n]))return 0;r=Math.min(r,wi(e[o],e[o+1],t[a],t[n],i))}return r}function Ai(e,t){for(const n of e)for(let e=0;e<=n.length-1;++e)if(Un(n[e],t,!0))return!0;return!1}function Ii(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const r=_i(e),o=_i(t);if(i!==1/0&&gi(r,o,n)>=i)return i;if(Nn(r,o)){if(Ai(e,t))return 0}else if(Ai(t,e))return 0;let s=i;for(const a of e)for(let e=0,i=a.length,r=i-1;e<i;r=e++)for(const o of t)for(let t=0,i=o.length,l=i-1;t<i;l=t++){if(Gn(a[r],a[e],o[l],o[t]))return 0;s=Math.min(s,wi(a[r],a[e],o[l],o[t],n))}return s}function Mi(e,t,n,i,r,o,s){if(null===o||null===s)return;const a=gi(mi(i,o),mi(r,s),n);a<t&&e.push({dist:a,range1:o,range2:s})}function ki(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=Math.min(i.distance(e[0],n[0][0]),r);if(0===o)return o;const s=new si([{dist:0,range1:[0,e.length-1],range2:[0,0]}],li),a=t?ui:ci,l=_i(n);for(;s.length;){const r=s.pop();if(r.dist>=o)continue;const c=r.range1;if(di(c)<=a){if(!pi(c,e.length))return NaN;if(t){const t=Ci(e,c,n,i);if(0===(o=Math.min(o,t)))return o}else for(let t=c[0];t<=c[1];++t){const r=Ei(e[t],n,i);if(0===(o=Math.min(o,r)))return o}}else{const n=fi(c,t);if(null!==n[0]){const t=gi(mi(e,n[0]),l,i);t<o&&s.push({dist:t,range1:n[0],range2:[0,0]})}if(null!==n[1]){const t=gi(mi(e,n[1]),l,i);t<o&&s.push({dist:t,range1:n[1],range2:[0,0]})}}}return o}function Pi(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,s=Math.min(o,r.distance(e[0],n[0]));if(0===s)return s;const a=new si([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],li),l=t?ui:ci,c=i?ui:ci;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(di(u)<=l&&di(h)<=c){if(!pi(u,e.length)||!pi(h,n.length))return NaN;if(t&&i?s=Math.min(s,Ti(e,u,n,h,r)):t||i?t&&!i?s=Math.min(s,bi(n,h,e,u,r)):!t&&i&&(s=Math.min(s,bi(e,u,n,h,r))):s=Math.min(s,Si(e,u,n,h,r)),0===s)return s}else{const o=fi(u,t),l=fi(h,i);Mi(a,s,r,e,n,o[0],l[0]),Mi(a,s,r,e,n,o[0],l[1]),Mi(a,s,r,e,n,o[1],l[0]),Mi(a,s,r,e,n,o[1],l[1])}}return s}function Di(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=mi(e,[0,e.length-1]);for(const s of n)if(!(r!==1/0&&gi(o,mi(s,[0,s.length-1]),i)>=r)&&(r=Math.min(r,Pi(e,t,s,!0,i,r)),0===r))return r;return r}function Ri(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=mi(e,[0,e.length-1]);for(const s of n){if(r!==1/0&&gi(o,_i(s),i)>=r)continue;const n=ki(e,t,s,i,r);if(isNaN(n))return n;if(0===(r=Math.min(r,n)))return r}return r}function zi(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class Li{constructor(e,t){this.type=jt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'distance' expression requires either one argument, but found ' ".concat(e.length-1," instead."));if(mn(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(zi(t.features[e].geometry.type))return new Li(t,t.features[e].geometry)}else if("Feature"===t.type){if(zi(t.geometry.type))return new Li(t,t.geometry)}else if(zi(t.type))return new Li(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),n=e.canonicalID();if(null!=t&&null!=n){if("Point"===e.geometryType())return function(e,t,n){const i=[];for(const o of e)for(const e of o)i.push(yi(e,t));const r=new ri(i[0][1],"meters");return"Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type?Pi(i,!1,"Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,r):"MultiLineString"===n.type?Di(i,!1,n.coordinates,r):"Polygon"===n.type||"MultiPolygon"===n.type?Ri(i,!1,"Polygon"===n.type?[n.coordinates]:n.coordinates,r):null}(t,n,this.geometries);if("LineString"===e.geometryType())return function(e,t,n){const i=[];for(const o of e){const e=[];for(const n of o)e.push(yi(n,t));i.push(e)}const r=new ri(i[0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return Di("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=Di(n.coordinates[t],!0,i,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}if("Polygon"===n.type||"MultiPolygon"===n.type){let e=1/0;for(let t=0;t<i.length;t++){const o=Ri(i[t],!0,"Polygon"===n.type?[n.coordinates]:n.coordinates,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return null}(t,n,this.geometries);if("Polygon"===e.geometryType())return function(e,t,n){const i=[];for(const o of function(e,t){const n=e.length;if(n<=1)return[e];const i=[];let r,o;for(let s=0;s<n;s++){const t=Fn(e[s]);0!==t&&(e[s].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(r&&i.push(r),r=[e[s]]):r.push(e[s]))}return r&&i.push(r),i}(e)){const e=[];for(let n=0;n<o.length;++n)e.push(vi(o[n],t));i.push(e)}const r=new ri(i[0][0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return Ri("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=Ri(n.coordinates[t],!0,i,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return"Polygon"===n.type||"MultiPolygon"===n.type?function(e,t,n){let i=1/0;for(const r of e)for(const e of t){const t=Ii(r,e,n,i);if(isNaN(t))return t;if(0===(i=Math.min(i,t)))return i}return i}("Polygon"===n.type?[n.coordinates]:n.coordinates,i,r):null}(t,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Oi=Li;function Fi(e){if(e instanceof Rn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof ni)return!1;if(e instanceof Oi)return!1;let t=!0;return e.eachChild((e=>{t&&!Fi(e)&&(t=!1)})),t}function Bi(e){if(e instanceof Rn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Bi(e)&&(t=!1)})),t}function Ni(e){if(e instanceof Rn&&"config"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Ni(e)&&(t=!1)})),t}function ji(e,t){if(e instanceof Rn&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild((e=>{n&&!ji(e,t)&&(n=!1)})),n}class Ui{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new Ui(n,t.scope.get(n)):t.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Vi=Ui;class Gi{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Bt,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5?arguments[5]:void 0;this.registry=e,this.path=t,this.key=t.map((e=>"[".concat(e,"]"))).join(""),this.scope=i,this.errors=r,this.expectedType=n,this.options=o}parse(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||n?this.concat(t,n,i)._parse(e,r):this._parse(e,r)}_parse(e,t){function n(e,t,n){return"assert"===n?new Tn(t,[e]):"coerce"===n?new Mn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i="string"==typeof e[0]?this.registry[e[0]]:void 0;if(i){let r=i.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,i=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else r=n(r,e,t.typeAnnotation||"coerce");else r=n(r,e,t.typeAnnotation||"assert")}if(!(r instanceof vn)&&"resolvedImage"!==r.type.kind&&Hi(r)){const t=new Pn(this.options);try{r=new vn(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return Mn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}concat(e,t,n){const i="number"==typeof e?this.path.concat(e):this.path,r=n?this.scope.concat(n):this.scope;return new Gi(this.registry,i,t||null,r,this.errors,this.options)}error(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r="".concat(this.key).concat(n.map((e=>"[".concat(e,"]"))).join(""));this.errors.push(new Ot(r,e))}checkSubtype(e,t){const n=Jt(e,t);return n&&this.error(n),n}}var qi=Gi;function Hi(e){if(e instanceof Vi)return Hi(e.boundExpression);if(e instanceof Rn&&"error"===e.name)return!1;if(e instanceof Rn&&"config"===e.name)return!1;if(e instanceof zn)return!1;if(e instanceof ni)return!1;if(e instanceof Oi)return!1;const t=e instanceof Mn||e instanceof Tn;let n=!0;return e.eachChild((e=>{n=t?n&&Hi(e):n&&e instanceof vn})),!!n&&Fi(e)&&ji(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Wi(e,t){const n=e.length-1;let i,r,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=e[a],r=e[a+1],i<=t){if(a===n||t<r)return a;o=a+1}else{if(!(i>t))throw new xn("Input is not a number.");s=a-1}return 0}class Zi{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,jt);if(!n)return null;const i=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let o=1;o<e.length;o+=2){const n=1===o?-1/0:e[o],s=e[o+1],a=o,l=o+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new Zi(r,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[Wi(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Xi=Zi;function Yi(e,t,n){return e*(1-n)+t*n}function Ki(e,t,n){return e.map(((e,i)=>Yi(e,t[i],n)))}var Qi=Object.freeze({__proto__:null,array:Ki,color:function(e,t,n){return new cn(Yi(e.r,t.r,n),Yi(e.g,t.g,n),Yi(e.b,t.b,n),Yi(e.a,t.a,n))},number:Yi});const Ji=.95047,$i=1.08883,er=4/29,tr=6/29,nr=3*tr*tr,ir=tr*tr*tr,rr=Math.PI/180,or=180/Math.PI;function sr(e){return e>ir?Math.pow(e,1/3):e/nr+er}function ar(e){return e>tr?e*e*e:nr*(e-er)}function lr(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function cr(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ur(e){const t=cr(e.r),n=cr(e.g),i=cr(e.b),r=sr((.4124564*t+.3575761*n+.1804375*i)/Ji),o=sr((.2126729*t+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-sr((.0193339*t+.119192*n+.9503041*i)/$i)),alpha:e.a}}function hr(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*ar(t),n=Ji*ar(n),i=$i*ar(i),new cn(lr(3.2404542*n-1.5371385*t-.4985314*i),lr(-.969266*n+1.8760108*t+.041556*i),lr(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function dr(e,t,n){const i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const pr={forward:ur,reverse:hr,interpolate:function(e,t,n){return{l:Yi(e.l,t.l,n),a:Yi(e.a,t.a,n),b:Yi(e.b,t.b,n),alpha:Yi(e.alpha,t.alpha,n)}}},fr={forward:function(e){const{l:t,a:n,b:i}=ur(e),r=Math.atan2(i,n)*or;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*rr,n=e.c;return hr({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:dr(e.h,t.h,n),c:Yi(e.c,t.c,n),l:Yi(e.l,t.l,n),alpha:Yi(e.alpha,t.alpha,n)}}};var mr=Object.freeze({__proto__:null,hcl:fr,lab:pr});class _r{constructor(e,t,n,i,r){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[o,s]of r)this.labels.push(o),this.outputs.push(s)}static interpolationFactor(e,t,n,i){let r=0;if("exponential"===e.name)r=gr(t,e.base,n,i);else if("linear"===e.name)r=gr(t,1,n,i);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new m(o[0],o[1],o[2],o[3]).solve(gr(t,1,n,i))}return r}static parse(e,t){let[n,i,r,...o]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error("Unknown interpolation type ".concat(String(i[0])),1,0);{const e=i.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,jt),!r)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=Gt:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let l=0;l<o.length;l+=2){const e=o[l],n=o[l+1],i=l+3,r=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(s.length&&s[s.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(n,r,a);if(!c)return null;a=a||c.type,s.push([e,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new _r(a,n,i,r,s):t.error("Type ".concat(Kt(a)," is not interpolatable."))}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;if(i>=t[r-1])return n[r-1].evaluate(e);const o=Wi(t,i),s=_r.interpolationFactor(this.interpolation,i,t[o],t[o+1]),a=n[o].evaluate(e),l=n[o+1].evaluate(e);return"interpolate"===this.operator?Qi[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?fr.reverse(fr.interpolate(fr.forward(a),fr.forward(l),s)):pr.reverse(pr.interpolate(pr.forward(a),pr.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function gr(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}var yr=_r;class vr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const s of e.slice(1)){const e=t.parse(s,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,r.push(e)}const o=i&&r.some((e=>Jt(i,e.type)));return new vr(o?Ht:n,r)}evaluate(e){let t,n=null,i=0;for(const r of this.args){if(i++,n=r.evaluate(e),n&&n instanceof pn&&!n.available&&(t||(t=n),n=null,i===this.args.length))return t;if(null!==n)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var xr=vr;class br{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found ".concat(e.length-1," instead."));const n=[];for(let r=1;r<e.length-1;r+=2){const i=e[r];if("string"!=typeof i)return t.error("Expected string, but found ".concat(typeof i," instead."),r);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;n.push([i,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new br(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var wr=br;class Tr{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,jt),i=t.parse(e[2],2,Yt(t.expectedType||Ht));return n&&i?new Tr(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new xn("Array index out of bounds: ".concat(t," < 0."));if(t>=n.length)throw new xn("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t!==Math.floor(t))throw new xn("Array index must be an integer, but found ".concat(t," instead."));return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Sr=Tr;class Er{constructor(e,t){this.type=Vt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Ht),i=t.parse(e[2],2,Ht);return n&&i?$t(n.type,[Vt,Ut,jt,Nt,Ht])?new Er(n,i):t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Kt(n.type)," instead")):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(null==n)return!1;if(!en(t,["boolean","string","number","null"]))throw new xn("Expected first argument to be of type boolean, string, number or null, but found ".concat(Kt(_n(t))," instead."));if(!en(n,["string","array"]))throw new xn("Expected second argument to be of type array or string, but found ".concat(Kt(_n(n))," instead."));return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Cr=Er;class Ar{constructor(e,t,n){this.type=jt,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Ht),i=t.parse(e[2],2,Ht);if(!n||!i)return null;if(!$t(n.type,[Vt,Ut,jt,Nt,Ht]))return t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Kt(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,jt);return r?new Ar(n,i,r):null}return new Ar(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!en(t,["boolean","string","number","null"]))throw new xn("Expected first argument to be of type boolean, string, number or null, but found ".concat(Kt(_n(t))," instead."));if(!en(n,["string","array"]))throw new xn("Expected second argument to be of type array or string, but found ".concat(Kt(_n(n))," instead."));if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ir=Ar;class Mr{constructor(e,t,n,i,r,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r={},o=[];for(let l=2;l<e.length-1;l+=2){let s=e[l];const a=e[l+1];Array.isArray(s)||(s=[s]);const c=t.concat(l);if(0===s.length)return c.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,_n(e)))return null}else n=_n(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(a,l,i);if(!u)return null;i=i||u.type,o.push(u)}const s=t.parse(e[1],1,Ht);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,i);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(n,s.type)?null:new Mr(n,i,s,r,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(_n(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],i={};for(const o of t){const e=i[this.cases[o]];void 0===e?(i[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[e][1].push(o)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[o,s]of n)e.push(1===s.length?r(s[0]):s.map(r)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}var kr=Mr;class Pr{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const r=t.parse(e[o],o,Vt);if(!r)return null;const s=t.parse(e[o+1],o+1,n);if(!s)return null;i.push([r,s]),n=n||s.type}const r=t.parse(e[e.length-1],e.length-1,n);return r?new Pr(n,i,r):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every((e=>{let[t,n]=e;return n.outputDefined()}))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Dr=Pr;class Rr{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Ht),i=t.parse(e[2],2,jt);if(!n||!i)return null;if(!$t(n.type,[Yt(Ht),Ut,Ht]))return t.error("Expected first argument to be of type array or string, but found ".concat(Kt(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,jt);return r?new Rr(n.type,n,i,r):null}return new Rr(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!en(t,["string","array"]))throw new xn("Expected first argument to be of type array or string, but found ".concat(Kt(_n(t))," instead."));if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var zr=Rr;function Lr(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Or(e,t,n,i){return 0===i.compare(t,n)}function Fr(e,t,n){const i="=="!==e&&"!="!==e;return class r{constructor(e,t,n){this.type=Vt,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,Ht);if(!o)return null;if(!Lr(n,o.type))return t.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Kt(o.type),"'."));let s=t.parse(e[2],2,Ht);if(!s)return null;if(!Lr(n,s.type))return t.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Kt(s.type),"'."));if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot compare types '".concat(Kt(o.type),"' and '").concat(Kt(s.type),"'."));i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Tn(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Tn(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Wt),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const t=_n(o),n=_n(s);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new xn('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(t.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){const e=_n(o),n=_n(s);if("string"!==e.kind||"string"!==n.kind)return t(r,o,s)}return this.collator?n(r,o,s,this.collator.evaluate(r)):t(r,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const Br=Fr("==",(function(e,t,n){return t===n}),Or),Nr=Fr("!=",(function(e,t,n){return t!==n}),(function(e,t,n,i){return!Or(0,t,n,i)})),jr=Fr("<",(function(e,t,n){return t<n}),(function(e,t,n,i){return i.compare(t,n)<0})),Ur=Fr(">",(function(e,t,n){return t>n}),(function(e,t,n,i){return i.compare(t,n)>0})),Vr=Fr("<=",(function(e,t,n){return t<=n}),(function(e,t,n,i){return i.compare(t,n)<=0})),Gr=Fr(">=",(function(e,t,n){return t>=n}),(function(e,t,n,i){return i.compare(t,n)>=0}));class qr{constructor(e,t,n,i,r,o){this.type=Ut,this.number=e,this.locale=t,this.currency=n,this.unit=i,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,jt);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=t.parse(i.locale,1,Ut),!r))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,Ut),!o))return null;let s=null;if(i.unit&&(s=t.parse(i.unit,1,Ut),!s))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,jt),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,jt),!l)?null:new qr(n,r,o,s,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Hr{constructor(e){this.type=jt,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error("Expected argument of type string or array, but found ".concat(Kt(n.type)," instead.")):new Hr(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new xn("Expected value to be of type string or array, but found ".concat(Kt(_n(t))," instead."))}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function Wr(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Zr={"==":Br,"!=":Nr,">":Ur,"<":jr,">=":Gr,"<=":Vr,array:Tn,at:Sr,boolean:Tn,case:Dr,coalesce:xr,collator:zn,format:Sn,image:En,in:Cr,"index-of":Ir,interpolate:yr,"interpolate-hcl":yr,"interpolate-lab":yr,length:Hr,let:wr,literal:vn,match:kr,number:Tn,"number-format":qr,object:Tn,slice:zr,step:Xi,string:Tn,"to-boolean":Mn,"to-color":Mn,"to-number":Mn,"to-string":Mn,var:Vi,within:ni,distance:Oi};function Xr(e,t){let[n,i,r,o]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const s=o?o.evaluate(e):1,a=fn(n,i,r,s);if(a)throw new xn(a);return new cn(n/255*s,i/255*s,r/255*s,s)}function Yr(e,t){let[n,i,r,o]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const s=o?o.evaluate(e):1,a=function(e,t,n,i){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof n&&n>=0&&n<=100?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid hsla value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'h' must be between 0 and 360.")}(n,i,r,s);if(a)throw new xn(a);const l="hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(s,")"),c=cn.parse(l);if(!c)throw new xn("Failed to parse HSLA color: ".concat(l));return c}function Kr(e,t){return e in t}function Qr(e,t){const n=t[e];return void 0===n?null:n}function Jr(e,t,n){n.length&&(t+="\x1f".concat(n));const i=e.getConfig(t);return i?i.evaluate(e):null}function $r(e){return{type:e}}Rn.register(Zr,{error:[{kind:"error"},[Ut],(e,t)=>{let[n]=t;throw new xn(n.evaluate(e))}],typeof:[Ut,[Ht],(e,t)=>{let[n]=t;return Kt(_n(n.evaluate(e)))}],"to-rgba":[Yt(jt,4),[Gt],(e,t)=>{let[n]=t;return n.evaluate(e).toArray()}],rgb:[Gt,[jt,jt,jt],Xr],rgba:[Gt,[jt,jt,jt,jt],Xr],hsl:[Gt,[jt,jt,jt],Yr],hsla:[Gt,[jt,jt,jt,jt],Yr],has:{type:Vt,overloads:[[[Ut],(e,t)=>{let[n]=t;return Kr(n.evaluate(e),e.properties())}],[[Ut,qt],(e,t)=>{let[n,i]=t;return Kr(n.evaluate(e),i.evaluate(e))}]]},get:{type:Ht,overloads:[[[Ut],(e,t)=>{let[n]=t;return Qr(n.evaluate(e),e.properties())}],[[Ut,qt],(e,t)=>{let[n,i]=t;return Qr(n.evaluate(e),i.evaluate(e))}]]},config:{type:Ht,overloads:[[[Ut],(e,t)=>{let[n]=t;return Jr(e,n.evaluate(e),"")}],[[Ut,Ut],(e,t)=>{let[n,i]=t;return Jr(e,n.evaluate(e),i.evaluate(e))}]]},"feature-state":[Ht,[Ut],(e,t)=>{let[n]=t;return Qr(n.evaluate(e),e.featureState||{})}],properties:[qt,[],e=>e.properties()],"geometry-type":[Ut,[],e=>e.geometryType()],id:[Ht,[],e=>e.id()],zoom:[jt,[],e=>e.globals.zoom],pitch:[jt,[],e=>e.globals.pitch||0],"distance-from-center":[jt,[],e=>e.distanceFromCenter()],"measure-light":[jt,[Ut],(e,t)=>{let[n]=t;return e.measureLight(n.evaluate(e))}],"heatmap-density":[jt,[],e=>e.globals.heatmapDensity||0],"line-progress":[jt,[],e=>e.globals.lineProgress||0],"raster-value":[jt,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[jt,[],e=>e.globals.skyRadialProgress||0],accumulated:[Ht,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[jt,$r(jt),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[jt,$r(jt),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:jt,overloads:[[[jt,jt],(e,t)=>{let[n,i]=t;return n.evaluate(e)-i.evaluate(e)}],[[jt],(e,t)=>{let[n]=t;return-n.evaluate(e)}]]},"/":[jt,[jt,jt],(e,t)=>{let[n,i]=t;return n.evaluate(e)/i.evaluate(e)}],"%":[jt,[jt,jt],(e,t)=>{let[n,i]=t;return n.evaluate(e)%i.evaluate(e)}],ln2:[jt,[],()=>Math.LN2],pi:[jt,[],()=>Math.PI],e:[jt,[],()=>Math.E],"^":[jt,[jt,jt],(e,t)=>{let[n,i]=t;return Math.pow(n.evaluate(e),i.evaluate(e))}],sqrt:[jt,[jt],(e,t)=>{let[n]=t;return Math.sqrt(n.evaluate(e))}],log10:[jt,[jt],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN10}],ln:[jt,[jt],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))}],log2:[jt,[jt],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN2}],sin:[jt,[jt],(e,t)=>{let[n]=t;return Math.sin(n.evaluate(e))}],cos:[jt,[jt],(e,t)=>{let[n]=t;return Math.cos(n.evaluate(e))}],tan:[jt,[jt],(e,t)=>{let[n]=t;return Math.tan(n.evaluate(e))}],asin:[jt,[jt],(e,t)=>{let[n]=t;return Math.asin(n.evaluate(e))}],acos:[jt,[jt],(e,t)=>{let[n]=t;return Math.acos(n.evaluate(e))}],atan:[jt,[jt],(e,t)=>{let[n]=t;return Math.atan(n.evaluate(e))}],min:[jt,$r(jt),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[jt,$r(jt),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[jt,[jt],(e,t)=>{let[n]=t;return Math.abs(n.evaluate(e))}],round:[jt,[jt],(e,t)=>{let[n]=t;const i=n.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[jt,[jt],(e,t)=>{let[n]=t;return Math.floor(n.evaluate(e))}],ceil:[jt,[jt],(e,t)=>{let[n]=t;return Math.ceil(n.evaluate(e))}],"filter-==":[Vt,[Ut,Ht],(e,t)=>{let[n,i]=t;return e.properties()[n.value]===i.value}],"filter-id-==":[Vt,[Ht],(e,t)=>{let[n]=t;return e.id()===n.value}],"filter-type-==":[Vt,[Ut],(e,t)=>{let[n]=t;return e.geometryType()===n.value}],"filter-<":[Vt,[Ut,Ht],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r<o}],"filter-id-<":[Vt,[Ht],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[Vt,[Ut,Ht],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r>o}],"filter-id->":[Vt,[Ht],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[Vt,[Ut,Ht],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[Vt,[Ht],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[Vt,[Ut,Ht],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r>=o}],"filter-id->=":[Vt,[Ht],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[Vt,[Ht],(e,t)=>{let[n]=t;return n.value in e.properties()}],"filter-has-id":[Vt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Vt,[Yt(Ut)],(e,t)=>{let[n]=t;return n.value.indexOf(e.geometryType())>=0}],"filter-id-in":[Vt,[Yt(Ht)],(e,t)=>{let[n]=t;return n.value.indexOf(e.id())>=0}],"filter-in-small":[Vt,[Ut,Yt(Ht)],(e,t)=>{let[n,i]=t;return i.value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[Vt,[Ut,Yt(Ht)],(e,t)=>{let[n,i]=t;return function(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:Vt,overloads:[[[Vt,Vt],(e,t)=>{let[n,i]=t;return n.evaluate(e)&&i.evaluate(e)}],[$r(Vt),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Vt,overloads:[[[Vt,Vt],(e,t)=>{let[n,i]=t;return n.evaluate(e)||i.evaluate(e)}],[$r(Vt),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Vt,[Vt],(e,t)=>{let[n]=t;return!n.evaluate(e)}],"is-supported-script":[Vt,[Ut],(e,t)=>{let[n]=t;const i=e.globals&&e.globals.isSupportedScript;return!i||i(n.evaluate(e))}],upcase:[Ut,[Ut],(e,t)=>{let[n]=t;return n.evaluate(e).toUpperCase()}],downcase:[Ut,[Ut],(e,t)=>{let[n]=t;return n.evaluate(e).toLowerCase()}],concat:[Ut,$r(Ht),(e,t)=>t.map((t=>gn(t.evaluate(e)))).join("")],"resolved-locale":[Ut,[Wt],(e,t)=>{let[n]=t;return n.evaluate(e).resolvedLocale()}],random:[jt,[jt,jt,Ht],(e,t)=>{const[n,i,r]=t.map((t=>t.evaluate(e)));if(n>i)return n;if(n===i)return n;let o;if("string"==typeof r)o=function(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}(r);else{if("number"!=typeof r)throw new xn("Invalid seed input: ".concat(r));o=r}return n+Wr(o)()*(i-n)}]});var eo=Zr;function to(e){return{result:"success",value:e}}function no(e){return{result:"error",value:e}}function io(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function ro(e){return"data-driven"===e["property-type"]}function oo(e){return io(e.expression,"measure-light")}function so(e){return io(e.expression,"zoom")}function ao(e){return!!e.expression&&e.expression.interpolated}function lo(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function co(e){return e}function uo(e,t){const n="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],r=i||!(i||void 0!==e.property),o=e.type||(ao(t)?"exponential":"interval");if(n&&((e=Dt({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],cn.parse(e[1])]))),e.default=cn.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!mr[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let s,a,l;if("exponential"===o)s=mo;else if("interval"===o)s=fo;else if("categorical"===o){s=po,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error('Unknown function type "'.concat(o,'"'));s=_o}if(i){const n={},i=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},i.push(o)),n[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of i)r.push([n[e].zoom,uo(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:yr.interpolationFactor.bind(void 0,o),zoomStops:r.map((e=>e[0])),evaluate:(n,i)=>{let{zoom:o}=n;return mo({stops:r,base:e.base},t,o).evaluate(o,i)}}}if(r){const n="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:yr.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map((e=>e[0])),evaluate:n=>{let{zoom:i}=n;return s(e,t,i,a,l)}}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?ho(e.default,t.default):s(e,t,r,a,l)}}}function ho(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function po(e,t,n,i,r){return ho(typeof n===r?i[n]:void 0,e.default,t.default)}function fo(e,t,n){if("number"!==Cn(n))return ho(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const r=Wi(e.stops.map((e=>e[0])),n);return e.stops[r][1]}function mo(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==Cn(n))return ho(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const o=Wi(e.stops.map((e=>e[0])),n),s=function(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=Qi[t.type]||co;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=mr[e.colorSpace];c=(e,n)=>t.reverse(t.interpolate(t.forward(e),t.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=a.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return c(i,r,s)}}:c(a,l,s)}function _o(e,t,n){return"color"===t.type?n=cn.parse(n):"formatted"===t.type?n=dn.fromString(n.toString()):"resolvedImage"===t.type?n=pn.fromString(n.toString()):Cn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),ho(n,e.default,t.default)}class go{constructor(e,t,n){this.expression=e,this._warningHistory={},this._evaluator=new Pn(n),this._defaultValue=t?function(e){return"color"===e.type&&(lo(e.default)||Array.isArray(e.default))?new cn(0,0,0,0):"color"===e.type?cn.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,r,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,r,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new xn("Expected value to be one of ".concat(Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", "),", but found ").concat(JSON.stringify(e)," instead."));return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function yo(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in eo}function vo(e,t,n){const i=new qi(eo,[],t?function(e){const t={color:Gt,string:Ut,number:jt,enum:Ut,boolean:Vt,formatted:Zt,resolvedImage:Xt};return"array"===e.type?Yt(t[e.value]||Ht,e.length):t[e.type]}(t):void 0,void 0,void 0,n),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?to(new go(r,t,n)):no(i.errors)}class xo{constructor(e,t,n){this.kind=e,this._styleExpression=t,this.isLightConstant=n,this.isStateDependent="constant"!==e&&!Bi(t.expression),this.isConfigDependent=!Ni(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}}class bo{constructor(e,t,n,i,r){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Bi(t.expression),this.isLightConstant=r,this.isConfigDependent=!Ni(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}interpolationFactor(e,t,n){return this.interpolationType?yr.interpolationFactor(this.interpolationType,e,t,n):0}}function wo(e,t,n){if("error"===(e=vo(e,t,n)).result)return e;const i=e.value.expression,r=Fi(i);if(!r&&!ro(t))return no([new Ot("","data expressions not supported")]);const o=ji(i,["zoom","pitch","distance-from-center"]);if(!o&&!so(t))return no([new Ot("","zoom expressions not supported")]);const s=ji(i,["measure-light"]);if(!s&&!oo(t))return no([new Ot("","measure-light expression not supported")]);const a=t.expression&&t.expression.relaxZoomRestriction,l=So(i);return l||o||a?l instanceof Ot?no([l]):l instanceof yr&&!ao(t)?no([new Ot("",'"interpolate" expressions cannot be used with this property')]):to(l?new bo(r?"camera":"composite",e.value,l.labels,l instanceof yr?l.interpolation:void 0,s):new xo(r?"constant":"source",e.value,s)):no([new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class To{constructor(e,t){this._parameters=e,this._specification=t,Dt(this,uo(this._parameters,this._specification))}static deserialize(e){return new To(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function So(e){let t=null;if(e instanceof wr)t=So(e.result);else if(e instanceof xr){for(const n of e.args)if(t=So(n),t)break}else(e instanceof Xi||e instanceof yr)&&e.input instanceof Rn&&"zoom"===e.input.name&&(t=e);return t instanceof Ot||e.eachChild((e=>{const n=So(e);n instanceof Ot?t=n:t&&n&&t!==n&&(t=new Ot("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Eo(e){const t=e.key,n=e.value,i=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const l=Cn(n);if("object"!==l)return[new kt(t,n,"object expected, ".concat(l," found"))];for(const c in n){const e=c.split(".")[0];let l;r[e]?l=r[e]:i[e]?l=as:r["*"]?l=r["*"]:i["*"]&&(l=as),l?a=a.concat(l({key:(t?"".concat(t,"."):t)+c,value:n[c],valueSpec:i[e]||i["*"],style:o,styleSpec:s,object:n,objectKey:c},n)):a.push(new Pt(t,n[c],'unknown property "'.concat(c,'"')))}for(const c in i)r[c]||i[c].required&&void 0===i[c].default&&void 0===n[c]&&a.push(new kt(t,n,'missing required property "'.concat(c,'"')));return a}function Co(e){const t=e.value,n=e.valueSpec,i=e.style,r=e.styleSpec,o=e.key,s=e.arrayElementValidator||as;if("array"!==Cn(t))return[new kt(o,t,"array expected, ".concat(Cn(t)," found"))];if(n.length&&t.length!==n.length)return[new kt(o,t,"array length ".concat(n.length," expected, length ").concat(t.length," found"))];if(n["min-length"]&&t.length<n["min-length"])return[new kt(o,t,"array length at least ".concat(n["min-length"]," expected, length ").concat(t.length," found"))];let a={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};r.$version<7&&(a.function=n.function),"object"===Cn(n.value)&&(a=n.value);let l=[];for(let c=0;c<t.length;c++)l=l.concat(s({array:t,arrayIndex:c,value:t[c],valueSpec:a,style:i,styleSpec:r,key:"".concat(o,"[").concat(c,"]")},!0));return l}function Ao(e){const t=e.key,n=e.value,i=e.valueSpec;let r=Cn(n);if("number"===r&&n!=n&&(r="NaN"),"number"!==r)return[new kt(t,n,"number expected, ".concat(r," found"))];if("minimum"in i){let r=i.minimum;if("array"===Cn(i.minimum)&&(r=i.minimum[e.arrayIndex]),n<r)return[new kt(t,n,"".concat(n," is less than the minimum value ").concat(r))]}if("maximum"in i){let r=i.maximum;if("array"===Cn(i.maximum)&&(r=i.maximum[e.arrayIndex]),n>r)return[new kt(t,n,"".concat(n," is greater than the maximum value ").concat(r))]}return[]}function Io(e){const t=e.valueSpec,n=Rt(e.value.type);let i,r,o,s={};const a="categorical"!==n&&void 0===e.value.property,l=!a,c="array"===Cn(e.value.stops)&&"array"===Cn(e.value.stops[0])&&"object"===Cn(e.value.stops[0][0]),u=Eo({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new kt(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const i=e.value;return t=t.concat(Co({key:e.key,value:i,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Cn(i)&&0===i.length&&t.push(new kt(e.key,i,"array must have at least one stop")),t},default:function(e){return as({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&a&&u.push(new kt(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new kt(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!ao(e.valueSpec)&&u.push(new kt(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!ro(e.valueSpec)?u.push(new kt(e.key,e.value,"property functions not supported")):a&&!so(e.valueSpec)&&u.push(new kt(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new kt(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const i=e.value,a=e.key;if("array"!==Cn(i))return[new kt(a,i,"array expected, ".concat(Cn(i)," found"))];if(2!==i.length)return[new kt(a,i,"array length 2 expected, length ".concat(i.length," found"))];if(c){if("object"!==Cn(i[0]))return[new kt(a,i,"object expected, ".concat(Cn(i[0])," found"))];if(void 0===i[0].zoom)return[new kt(a,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new kt(a,i,"object stop key must have value")];const t=Rt(i[0].zoom);if("number"!=typeof t)return[new kt(a,i[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new kt(a,i[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,r=void 0,s={}),n=n.concat(Eo({key:"".concat(a,"[0]"),value:i[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Ao,value:d}}))}else n=n.concat(d({key:"".concat(a,"[0]"),value:i[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},i));return yo(zt(i[1]))?n.concat([new kt("".concat(a,"[1]"),i[1],"expressions are not allowed in function stops.")]):n.concat(as({key:"".concat(a,"[1]"),value:i[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=Cn(e.value),l=Rt(e.value),c=null!==e.value?e.value:o;if(i){if(a!==i)return[new kt(e.key,c,"".concat(a," stop domain type must match previous stop domain type ").concat(i))]}else i=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new kt(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let i="number expected, ".concat(a," found");return ro(t)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new kt(e.key,c,i)]}return"categorical"!==n||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===a&&"number"==typeof l&&"number"==typeof r&&void 0!==r&&l<r?[new kt(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in s?[new kt(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new kt(e.key,c,"integer expected, found ".concat(String(l)))]}}function Mo(e){const t=("property"===e.expressionContext?wo:vo)(zt(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new kt("".concat(e.key).concat(t.key),e.value,t.message)));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new kt(e.key,e.value,'Invalid data expression for "'.concat(e.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Bi(n))return[new kt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return ko(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!ji(n,["zoom","feature-state"]))return[new kt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Fi(n))return[new kt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ko(e,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const r of t.valueSpec.expression.parameters)n.delete(r);if(0===n.size)return[];const i=[];return e instanceof Rn&&n.has(e.name)?[new kt(t.key,t.value,'["'.concat(e.name,'"] expression is not supported in a filter for a ').concat(t.object.type," layer with id: ").concat(t.object.id))]:(e.eachChild((e=>{i.push(...ko(e,t))})),i)}function Po(e){const t=e.key,n=e.value,i=e.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(Rt(n))&&r.push(new kt(t,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(Rt(n))&&r.push(new kt(t,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),r}function Do(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Do(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Ro(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Do(e)||(e=jo(e));const n=e;let i=!0;try{i=function(e){if(!Oo(e))return e;let t=zt(e);return Lo(t),t=zo(t),t}(n)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(n,null,2),"\n        "))}const r=Mt["filter_".concat(t)],o=vo(i,r);let s=null;if("error"===o.result)throw new Error(o.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));s=(e,t,n)=>o.value.evaluate(e,t,{},n);let a=null,l=null;if(i!==n){const e=vo(n,r);if("error"===e.result)throw new Error(e.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));a=(t,n,i,r,o)=>e.value.evaluate(t,n,{},i,void 0,void 0,r,o),l=!Fi(e.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:No(i),needFeature:!!l}}function zo(e){if(!Array.isArray(e))return e;const t=function(e){if(Fo.has(e[0]))for(let t=1;t<e.length;t++)if(Oo(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>zo(e)))}function Lo(e){let t=!1;const n=[];if("case"===e[0]){for(let i=1;i<e.length-1;i+=2)t=t||Oo(e[i]),n.push(e[i+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||Oo(e[1]);for(let t=2;t<e.length-1;t+=2)n.push(e[t+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||Oo(e[1]);for(let t=1;t<e.length-1;t+=2)n.push(e[t+1])}t&&(e.length=0,e.push("any",...n));for(let i=1;i<e.length;i++)Lo(e[i])}function Oo(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(Oo(e[n]))return!0;return!1}const Fo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Bo(e,t){return e<t?-1:e>t?1:0}function No(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(No(e[t]))return!0;return!1}function jo(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Uo(e[1],e[2],"=="):"!="===t?qo(Uo(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Uo(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(jo))):"all"===t?["all"].concat(e.slice(1).map(jo)):"none"===t?["all"].concat(e.slice(1).map(jo).map(qo)):"in"===t?Vo(e[1],e.slice(2)):"!in"===t?qo(Vo(e[1],e.slice(2))):"has"===t?Go(e[1]):"!has"!==t||qo(Go(e[1]));var n}function Uo(e,t,n){switch(e){case"$type":return["filter-type-".concat(n),t];case"$id":return["filter-id-".concat(n),t];default:return["filter-".concat(n),e,t]}}function Vo(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Bo)]]:["filter-in-small",e,["literal",t]]}}function Go(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function qo(e){return["!",e]}function Ho(e){return Do(zt(e.value))?Mo(Dt({},e,{expressionContext:"filter",valueSpec:e.styleSpec["filter_".concat(e.layerType||"fill")]})):Wo(e)}function Wo(e){const t=e.value,n=e.key;if("array"!==Cn(t))return[new kt(n,t,"array expected, ".concat(Cn(t)," found"))];const i=e.styleSpec;let r,o=[];if(t.length<1)return[new kt(n,t,"filter array must have at least 1 element")];switch(o=o.concat(Po({key:"".concat(n,"[0]"),value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),Rt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Rt(t[1])&&o.push(new kt(n,t,'"$type" cannot be use with operator "'.concat(t[0],'"')));case"==":case"!=":3!==t.length&&o.push(new kt(n,t,'filter array for operator "'.concat(t[0],'" must have 3 elements')));case"in":case"!in":t.length>=2&&(r=Cn(t[1]),"string"!==r&&o.push(new kt("".concat(n,"[1]"),t[1],"string expected, ".concat(r," found"))));for(let s=2;s<t.length;s++)r=Cn(t[s]),"$type"===Rt(t[1])?o=o.concat(Po({key:"".concat(n,"[").concat(s,"]"),value:t[s],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new kt("".concat(n,"[").concat(s,"]"),t[s],"string, number, or boolean expected, ".concat(r," found")));break;case"any":case"all":case"none":for(let i=1;i<t.length;i++)o=o.concat(Wo({key:"".concat(n,"[").concat(i,"]"),value:t[i],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Cn(t[1]),2!==t.length?o.push(new kt(n,t,'filter array for "'.concat(t[0],'" operator must have 2 elements'))):"string"!==r&&o.push(new kt("".concat(n,"[1]"),t[1],"string expected, ".concat(r," found")))}return o}function Zo(e,t){const n=e.key,i=e.style,r=e.layer,o=e.styleSpec,s=e.value,a=e.objectKey,l=o["".concat(t,"_").concat(e.layerType)];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return as({key:n,value:s,valueSpec:o.transition,style:i,styleSpec:o});const u=e.valueSpec||l[a];if(!u)return[new Pt(n,s,'unknown property "'.concat(a,'"'))];let h;if("string"===Cn(s)&&ro(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s))){const e='`{ "type": "identity", "property": '.concat(h?JSON.stringify(h[1]):'"_"'," }`");return[new kt(n,s,'"'.concat(a,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(e,"."))]}const d=[];if("symbol"===e.layerType)"text-field"!==a||!i||i.glyphs||i.imports||d.push(new kt(n,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&lo(zt(s))&&"identity"===Rt(s.type)&&d.push(new kt(n,s,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===t&&r&&r.layout&&r.layout.hasOwnProperty("model-id")&&ro(u)&&(oo(u)||so(u))){const e=wo(zt(s),u),t=e.value.expression||e.value._styleExpression.expression;t&&!ji(t,["measure-light"])&&d.push(new kt(n,s,"".concat(a," does not support measure-light expressions when the model layer source is vector tile or GeoJSON.")))}return d.concat(as({key:e.key,value:s,valueSpec:u,style:i,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:a}))}function Xo(e){return Zo(e,"paint")}function Yo(e){return Zo(e,"layout")}function Ko(e){let t=[];const n=e.value,i=e.key,r=e.style,o=e.styleSpec;n.type||n.ref||t.push(new kt(i,n,'either "type" or "ref" is required'));let s=Rt(n.type);const a=Rt(n.ref);if(n.id){const o=Rt(n.id);for(let s=0;s<e.arrayIndex;s++){const e=r.layers[s];Rt(e.id)===o&&t.push(new kt(i,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(e.id.__line__)))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&t.push(new kt(i,n[e],'"'.concat(e,'" is prohibited for ref layers')))})),r.layers.forEach((t=>{Rt(t.id)===a&&(e=t)})),e?e.ref?t.push(new kt(i,n.ref,"ref cannot reference another ref layer")):s=Rt(e.type):"string"==typeof a&&t.push(new kt(i,n.ref,'ref layer "'.concat(a,'" not found')))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(n.source){const e=r.sources&&r.sources[n.source],o=e&&Rt(e.type);e?"vector"===o&&"raster"===s?t.push(new kt(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster"===o&&"raster"!==s?t.push(new kt(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new kt(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===o&&e.lineMetrics||t.push(new kt(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):t.push(new kt(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):t.push(new kt(i,n.source,'source "'.concat(n.source,'" not found')))}else t.push(new kt(i,n,'missing required property "source"'));return t=t.concat(Eo({key:i,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>as({key:"".concat(i,".type"),value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:e=>Ho(Dt({layerType:s},e)),layout:e=>Eo({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Yo(Dt({layerType:s},e))}}),paint:e=>Eo({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Xo(Dt({layerType:s,layer:n},e))}})}})),t}function Qo(e){const t=e.value,n=e.key,i=Cn(t);return"string"!==i?[new kt(n,t,"string expected, ".concat(i," found"))]:[]}const Jo={promoteId:function(e){let{key:t,value:n}=e;if("string"===Cn(n))return Qo({key:t,value:n});{const e=[];for(const i in n)e.push(...Qo({key:"".concat(t,".").concat(i),value:n[i]}));return e}}};function $o(e){const t=e.value,n=e.key,i=e.styleSpec,r=e.style;if(!t.type)return[new kt(n,t,'"type" is required')];const o=Rt(t.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=Eo({key:n,value:t,valueSpec:i["source_".concat(o.replace("-","_"))],style:e.style,styleSpec:i,objectElementValidators:Jo}),s;case"geojson":if(s=Eo({key:n,value:t,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:Jo}),t.cluster)for(const e in t.clusterProperties){const[i,r]=t.clusterProperties[e],o="string"==typeof i?[i,["accumulated"],["get",e]]:i;s.push(...Mo({key:"".concat(n,".").concat(e,".map"),value:r,expressionContext:"cluster-map"})),s.push(...Mo({key:"".concat(n,".").concat(e,".reduce"),value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return Eo({key:n,value:t,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return Eo({key:n,value:t,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new kt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Po({key:"".concat(n,".type"),value:t.type,valueSpec:{values:es(i)},style:r,styleSpec:i})}}function es(e){return e.source.reduce(((t,n)=>{const i=e[n];return"enum"===i.type.type&&(t=t.concat(Object.keys(i.type.values))),t}),[])}function ts(e){const t=e.value;let n=[];if(!t)return n;const i=Cn(t);return"string"!==i?(n=n.concat([new kt(e.key,t,'string expected, "'.concat(i,'" found'))]),n):(function(e){const t=-1===e.indexOf("://");try{return new URL(e,t?"http://example.com":void 0),!0}catch(e){return!1}}(t)||(n=n.concat([new kt(e.key,t,'invalid url "'.concat(t,'"'))])),n)}function ns(e){const t=e.value,n=e.styleSpec,i=n.light,r=e.style;let o=[];const s=Cn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new kt("light",t,"object expected, ".concat(s," found"))]),o;for(const a in t){const e=a.match(/^(.*)-transition$/);o=o.concat(e&&i[e[1]]&&i[e[1]].transition?as({key:a,value:t[a],valueSpec:n.transition,style:r,styleSpec:n}):i[a]?as({key:a,value:t[a],valueSpec:i[a],style:r,styleSpec:n}):[new kt(a,t[a],'unknown property "'.concat(a,'"'))])}return o}function is(e){const t=e.value;let n=[];if(!t)return n;const i=Cn(t);if("object"!==i)return n=n.concat([new kt("light-3d",t,"object expected, ".concat(i," found"))]),n;const r=e.styleSpec,o=r["light-3d"],s=e.key,a=e.style,l=e.style.lights;for(const h of["type","id"])if(!(h in t))return n=n.concat([new kt("light-3d",t,"missing property ".concat(h," on light"))]),n;if(t.type&&l)for(let h=0;h<e.arrayIndex;h++){const e=Rt(t.type),i=l[h];Rt(i.type)===e&&n.push(new kt(s,t.id,'duplicate light type "'.concat(t.type,'", previously defined at line ').concat(i.id.__line__)))}const c="properties_light_".concat(t.type);if(!(c in r))return n=n.concat([new kt("light-3d",t,"Invalid light type ".concat(t.type))]),n;const u=r[c];for(const h in t)if("properties"===h){const i=t[h],o=Cn(i);if("object"!==o)return n=n.concat([new kt("properties",i,"object expected, ".concat(o," found"))]),n;for(const t in i)n=n.concat(u[t]?as({key:t,value:i[t],valueSpec:u[t],style:a,styleSpec:r}):[new Pt(e.key,i[t],'unknown property "'.concat(t,'"'))])}else{const e=h.match(/^(.*)-transition$/);n=n.concat(e&&o[e[1]]&&o[e[1]].transition?as({key:h,value:t[h],valueSpec:r.transition,style:a,styleSpec:r}):o[h]?as({key:h,value:t[h],valueSpec:o[h],style:a,styleSpec:r}):[new Pt(h,t[h],'unknown property "'.concat(h,'"'))])}return n}function rs(e){const t=e.value,n=e.key,i=e.style,r=e.styleSpec,o=r.terrain;let s=[];const a=Cn(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new kt("terrain",t,"object expected, ".concat(a," found"))]),s;for(const l in t){const e=l.match(/^(.*)-transition$/);s=s.concat(e&&o[e[1]]&&o[e[1]].transition?as({key:l,value:t[l],valueSpec:r.transition,style:i,styleSpec:r}):o[l]?as({key:l,value:t[l],valueSpec:o[l],style:i,styleSpec:r}):[new Pt(l,t[l],'unknown property "'.concat(l,'"'))])}if(t.source){const e=i.sources&&i.sources[t.source],r=e&&Rt(e.type);e?"raster-dem"!==r&&s.push(new kt(n,t.source,"terrain cannot be used with a source of type ".concat(String(r),', it only be used with a "raster-dem" source type'))):s.push(new kt(n,t.source,'source "'.concat(t.source,'" not found')))}else s.push(new kt(n,t,'terrain is missing required property "source"'));return s}function os(e){const t=e.value,n=e.style,i=e.styleSpec,r=i.fog;let o=[];const s=Cn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new kt("fog",t,"object expected, ".concat(s," found"))]),o;for(const a in t){const e=a.match(/^(.*)-transition$/);o=o.concat(e&&r[e[1]]&&r[e[1]].transition?as({key:a,value:t[a],valueSpec:i.transition,style:n,styleSpec:i}):r[a]?as({key:a,value:t[a],valueSpec:r[a],style:n,styleSpec:i}):[new Pt(a,t[a],'unknown property "'.concat(a,'"'))])}return o}const ss={"*":()=>[],array:Co,boolean:function(e){const t=e.value,n=e.key,i=Cn(t);return"boolean"!==i?[new kt(n,t,"boolean expected, ".concat(i," found"))]:[]},number:Ao,color:function(e){const t=e.key,n=e.value,i=Cn(n);return"string"!==i?[new kt(t,n,"color expected, ".concat(i," found"))]:null===tn(n)?[new kt(t,n,'color expected, "'.concat(n,'" found'))]:[]},enum:Po,filter:Ho,function:Io,layer:Ko,object:Eo,source:$o,model:ts,light:ns,"light-3d":is,terrain:rs,fog:os,string:Qo,formatted:function(e){return 0===Qo(e).length?[]:Mo(e)},resolvedImage:function(e){return 0===Qo(e).length?[]:Mo(e)},projection:function(e){const t=e.value,n=e.styleSpec,i=n.projection,r=e.style;let o=[];const s=Cn(t);if("object"===s)for(const a in t)o=o.concat(as({key:a,value:t[a],valueSpec:i[a],style:r,styleSpec:n}));else"string"!==s&&(o=o.concat([new kt("projection",t,"object or string expected, ".concat(s," found"))]));return o},import:function(e){const{value:t,styleSpec:n}=e,{data:i,...r}=t;Object.defineProperty(r,"__line__",{value:t.__line__,enumerable:!1});let o=Eo(Dt({},e,{value:r,valueSpec:n.import}));return""===Rt(r.id)&&o.push(new kt("".concat(e.key,".id"),r,"import id can't be an empty string")),i&&(o=o.concat(cs(i,n,{key:"".concat(e.key,".data")}))),o}};function as(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.value,i=e.valueSpec,r=e.styleSpec;if(i.expression&&lo(Rt(n)))return Io(e);if(i.expression&&yo(zt(n)))return Mo(e);if(i.type&&ss[i.type]){const n=ss[i.type](e);return!0===t&&n.length>0&&"array"===Cn(e.value)?Mo(e):n}return Eo(Dt({},e,{valueSpec:i.type?r[i.type]:i}))}function ls(e){const t=e.value,n=e.key,i=Qo(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new kt(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new kt(n,t,'"glyphs" url must include a "{range}" token'))),i}function cs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mt;return as({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:ls,"*":()=>[]}})}function us(e){return bs(cs(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mt))}const hs=e=>bs($o(e)),ds=e=>bs(ns(e)),ps=e=>bs(is(e)),fs=e=>bs(rs(e)),ms=e=>bs(os(e)),_s=e=>bs(Ko(e)),gs=e=>bs(Ho(e)),ys=e=>bs(Xo(e)),vs=e=>bs(Yo(e)),xs=e=>bs(ts(e));function bs(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function ws(e,t){let n=!1;if(t&&t.length)for(const i of t)i instanceof Pt?X(i.message):(e.fire(new At(new Error(i.message))),n=!0);return n}var Ts=Es,Ss=3;function Es(e,t,n){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(n=r[2]);for(var o=0;o<this.d*this.d;o++){var s=r[Ss+o],a=r[Ss+o+1];i.push(s===a?null:r.subarray(s,a))}var l=r[Ss+i.length+1];this.keys=r.subarray(r[Ss+i.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var u=n/t*e;this.min=-u,this.max=e+u}Es.prototype.insert=function(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},Es.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Es.prototype._insertCell=function(e,t,n,i,r,o){this.cells[r].push(o)},Es.prototype.query=function(e,t,n,i,r){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=n&&s<=i&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,n,i,this._queryCell,a,{},r),a},Es.prototype._queryCell=function(e,t,n,i,r,o,s,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&n>=u[p+0]&&i>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},Es.prototype._forEachCell=function(e,t,n,i,r,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,n,i,f,o,s,a))return}},Es.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Es.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Es.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Ss+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(t+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];r[Ss+s]=o,r.set(a,o),o+=a.length}return r[Ss+e.length]=o,r.set(this.keys,o),r[Ss+e.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};var Cs=d(Ts);const As={};function Is(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),As[t]={klass:e,omit:n.omit||[]}}Is(Object,"Object"),Cs.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},Cs.deserialize=function(e){return new Cs(e.buffer)},Object.defineProperty(Cs,"name",{value:"Grid"}),Is(Cs,"Grid"),Is(cn,"Color"),Is(Error,"Error"),Is(ve,"AJAXError"),Is(pn,"ResolvedImage"),Is(To,"StylePropertyFunction"),Is(go,"StyleExpression",{omit:["_evaluator"]}),Is(bo,"ZoomDependentExpression"),Is(xo,"ZoomConstantExpression"),Is(Rn,"CompoundExpression",{omit:["_evaluate"]});for(const uI in eo)As[eo[uI]._classRegistryKey]||Is(eo[uI],"Expression".concat(uI));function Ms(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function ks(e){return t.ImageBitmap&&e instanceof t.ImageBitmap}function Ps(e,n){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Ms(e)||ks(e))return n&&n.add(e),e;if(ArrayBuffer.isView(e)){const t=e;return n&&n.add(t.buffer),t}if(e instanceof t.ImageData)return n&&n.add(e.data.buffer),e;if(Array.isArray(e)){const t=[];for(const i of e)t.push(Ps(i,n));return t}if(e instanceof Map){const t={$name:"Map"};for(const[n,i]of e.entries())t[n]=Ps(i);return t}if("object"==typeof e){const t=e.constructor,i=t._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class ".concat(i));const r=t.serialize?t.serialize(e,n):{};if(!t.serialize){for(const t in e)e.hasOwnProperty(t)&&(As[i].omit.indexOf(t)>=0||(r[t]=Ps(e[t],n)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof e)}function Ds(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Ms(e)||ks(e)||ArrayBuffer.isView(e)||e instanceof t.ImageData)return e;if(Array.isArray(e))return e.map(Ds);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const n of Object.keys(e))"$name"!==n&&t.set(n,Ds(e[n]));return t}const{klass:n}=As[t];if(!n)throw new Error("can't deserialize unregistered class ".concat(t));if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const r of Object.keys(e))"$name"!==r&&(i[r]=Ds(e[r]));return i}throw new Error("can't deserialize object of type "+typeof e)}const Rs={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function zs(e){for(const t of e)if(Fs(t.charCodeAt(0)))return!0;return!1}function Ls(e){for(const t of e)if(!Os(t.charCodeAt(0)))return!1;return!0}function Os(e){return!(Rs.Arabic(e)||Rs["Arabic Supplement"](e)||Rs["Arabic Extended-A"](e)||Rs["Arabic Presentation Forms-A"](e)||Rs["Arabic Presentation Forms-B"](e))}function Fs(e){return!(746!==e&&747!==e&&(e<4352||!(Rs["Bopomofo Extended"](e)||Rs.Bopomofo(e)||Rs["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Rs["CJK Compatibility Ideographs"](e)||Rs["CJK Compatibility"](e)||Rs["CJK Radicals Supplement"](e)||Rs["CJK Strokes"](e)||!(!Rs["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Rs["CJK Unified Ideographs Extension A"](e)||Rs["CJK Unified Ideographs"](e)||Rs["Enclosed CJK Letters and Months"](e)||Rs["Hangul Compatibility Jamo"](e)||Rs["Hangul Jamo Extended-A"](e)||Rs["Hangul Jamo Extended-B"](e)||Rs["Hangul Jamo"](e)||Rs["Hangul Syllables"](e)||Rs.Hiragana(e)||Rs["Ideographic Description Characters"](e)||Rs.Kanbun(e)||Rs["Kangxi Radicals"](e)||Rs["Katakana Phonetic Extensions"](e)||Rs.Katakana(e)&&12540!==e||!(!Rs["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Rs["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Rs["Unified Canadian Aboriginal Syllabics"](e)||Rs["Unified Canadian Aboriginal Syllabics Extended"](e)||Rs["Vertical Forms"](e)||Rs["Yijing Hexagram Symbols"](e)||Rs["Yi Syllables"](e)||Rs["Yi Radicals"](e))))}function Bs(e){return!(Fs(e)||function(e){return!!(Rs["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Rs["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Rs["Letterlike Symbols"](e)||Rs["Number Forms"](e)||Rs["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Rs["Control Pictures"](e)&&9251!==e||Rs["Optical Character Recognition"](e)||Rs["Enclosed Alphanumerics"](e)||Rs["Geometric Shapes"](e)||Rs["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Rs["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Rs["CJK Symbols and Punctuation"](e)||Rs.Katakana(e)||Rs["Private Use Area"](e)||Rs["CJK Compatibility Forms"](e)||Rs["Small Form Variants"](e)||Rs["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Ns(e){return e>=1424&&e<=2303||Rs["Arabic Presentation Forms-A"](e)||Rs["Arabic Presentation Forms-B"](e)}function js(e,t){return!(!t&&Ns(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Rs.Khmer(e))}function Us(e){for(const t of e)if(Ns(t.charCodeAt(0)))return!0;return!1}const Vs="deferred",Gs="loading",qs="loaded";let Hs=null,Ws="unavailable",Zs=null;const Xs=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Ws="error"),Hs&&Hs(e)};function Ys(){Ks.fire(new Ct("pluginStateChange",{pluginStatus:Ws,pluginURL:Zs}))}const Ks=new It,Qs=function(){return Ws},Js=function(){if(Ws!==Vs||!Zs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ws=Gs,Ys(),Zs&&Te({url:Zs},(e=>{e?Xs(e):(Ws=qs,Ys())}))},$s={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ws===qs||null!=$s.applyArabicShaping,isLoading:()=>Ws===Gs,setState(e){Ws=e.pluginStatus,Zs=e.pluginURL},isParsed:()=>null!=$s.applyArabicShaping&&null!=$s.processBidirectionalText&&null!=$s.processStyledBidirectionalText,getPluginURL:()=>Zs};class ea{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const n of e)if(!js(n.charCodeAt(0),t))return!1;return!0}(e,$s.isLoaded())}}class ta{constructor(e,t,n){this.property=e,this.value=t,this.expression=function(e,t,n){if(lo(e))return new To(e,t);if(yo(e)||Array.isArray(e)&&e.length>0){const i=wo(e,t,n);if("error"===i.result)throw new Error(i.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));return i.value}{let n=e;return"string"==typeof e&&"color"===t.type&&(n=cn.parse(e)),{kind:"constant",isConfigDependent:!1,evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class na{constructor(e,t){this.property=e,this.value=new ta(e,void 0,t)}transitioned(e,t){return new ra(this.property,this.value,t,L({},e.transition,this.transition),e.now)}untransitioned(){return new ra(this.property,this.value,null,{},0)}}class ia{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=t,this.isConfigDependent=!1}getValue(e){return W(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new na(this._values[e].property,this._options)),this._values[e].value=new ta(this._values[e].property,null===t?void 0:W(t),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);const n=this._properties.properties;if(e)for(const i in e){const t=e[i];if(G(i,"-transition")){const e=i.slice(0,-11);n[e]&&this.setTransition(e,t)}else n[i]&&this.setValue(i,t)}}getTransition(e){return W(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new na(this._values[e].property)),this._values[e].transition=W(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e["".concat(t,"-transition")]=i)}return e}transitioned(e,t){const n=new oa(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new oa(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ra{constructor(e,t,n,i,r){const o=i.delay||0,s=i.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+o,this.end=this.begin+s,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return o.possiblyEvaluate(e,t,n);{const s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),r,E(s))}}return r}}class oa{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new la(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class sa{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=t,this.isConfigDependent=!1}getValue(e){return W(this._values[e].value)}setValue(e,t){this._values[e]=new ta(this._values[e].property,null===t?void 0:W(t),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new la(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}}class aa{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class la{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ca{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const i=Qi[this.specification.type];return i?i(e,t,n):e}}class ua{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new aa(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new aa(this,{kind:"constant",value:void 0},e.parameters);const i=Qi[this.specification.type];return i?new aa(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,i,r,o){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,o)}}class ha{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class da{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new ea(0,{});for(const n in e){const i=e[n];i.specification.overridable&&this.overridableProperties.push(n);const r=this.defaultPropertyValues[n]=new ta(i,void 0),o=this.defaultTransitionablePropertyValues[n]=new na(i);this.defaultTransitioningPropertyValues[n]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=r.possiblyEvaluate(t)}}}function pa(e,t){return t?"".concat(e,"\x1f").concat(t):e}function fa(e){const t=e.indexOf("\x1f");return t>=0?e.slice(0,t):e}Is(ua,"DataDrivenProperty"),Is(ca,"DataConstantProperty"),Is(ha,"ColorRampProperty");const ma="-transition";class _a extends It{constructor(e,t,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=n,e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new sa(t.layout,n),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new ia(t.paint,n);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new la(t.paint)}}setScope(e){this.scope=e,this.fqid=pa(this.id,e)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(vs,"layers.".concat(this.id,".layout.").concat(e),e,t,n))return;if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const i=this._unevaluatedLayout;i._properties.properties[e]&&(i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return G(e,ma)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(ys,"layers.".concat(this.id,".paint.").concat(e),e,t,n))return!1;const i=this._transitionablePaint,r=i._properties.properties;if(G(e,ma)){const n=e.slice(0,-11);return r[n]&&i.setTransition(n,t||void 0),!1}if(!r[e])return!1;const o=i._values[e],s=o.value.isDataDriven(),a=o.value;i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const l=i._values[e].value,c=l.isDataDriven(),u=G(e,"pattern")||"line-dasharray"===e;return c||s||u||this._handleOverridablePaintPropertyUpdate(e,a,l)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return H({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!r||!1!==r.validate)&&ws(this,e.call(us,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:Mt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof aa&&ro(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ro(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}class ga{constructor(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps=new Set,this.changedImages=new Set}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id)}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this.updatedPaintProps.delete(e.fqid)}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}reset(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps.clear(),this.changedImages.clear()}}const ya={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class va{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xa{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ba(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=0;return{members:e.map((e=>{const r=ya[e.type].BYTES_PER_ELEMENT,o=n=wa(n,Math.max(t,r)),s=e.components||1;return i=Math.max(i,r),n+=r*s,{name:e.name,type:e.type,components:s,offset:o}})),size:wa(n,Math.max(i,t)),alignment:t}}function wa(e,t){return Math.ceil(e/t)*t}class Ta extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}Ta.prototype.bytesPerElement=4,Is(Ta,"StructArrayLayout2i4");class Sa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}Sa.prototype.bytesPerElement=6,Is(Sa,"StructArrayLayout3i6");class Ea extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,e}}Ea.prototype.bytesPerElement=8,Is(Ea,"StructArrayLayout4i8");class Ca extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=5*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=o,e}}Ca.prototype.bytesPerElement=10,Is(Ca,"StructArrayLayout5i10");class Aa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}Aa.prototype.bytesPerElement=12,Is(Aa,"StructArrayLayout2i4ub1f12");class Ia extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,e}}Ia.prototype.bytesPerElement=16,Is(Ia,"StructArrayLayout4f16");class Ma extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=6*e,a=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=n,this.uint16[s+2]=i,this.uint16[s+3]=r,this.float32[a+2]=o,e}}Ma.prototype.bytesPerElement=12,Is(Ma,"StructArrayLayout4ui1f12");class ka extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=n,this.uint16[o+2]=i,this.uint16[o+3]=r,e}}ka.prototype.bytesPerElement=8,Is(ka,"StructArrayLayout4ui8");class Pa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,e}}Pa.prototype.bytesPerElement=12,Is(Pa,"StructArrayLayout6i12");class Da extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,i,r,o,s,a,l,c,u,h)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}Da.prototype.bytesPerElement=24,Is(Da,"StructArrayLayout4i4ui4i24");class Ra extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=s,e}}Ra.prototype.bytesPerElement=20,Is(Ra,"StructArrayLayout3i3f20");class za extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}za.prototype.bytesPerElement=4,Is(za,"StructArrayLayout1ul4");class La extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}La.prototype.bytesPerElement=4,Is(La,"StructArrayLayout2ui4");class Oa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,i,r,o,s,a,l,c,u,h,d)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=n,this.int16[f+2]=i,this.int16[f+3]=r,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}Oa.prototype.bytesPerElement=40,Is(Oa,"StructArrayLayout5i4f1i1ul2ui40");class Fa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}Fa.prototype.bytesPerElement=16,Is(Fa,"StructArrayLayout3i2i2i16");class Ba extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.int16[a+6]=r,this.int16[a+7]=o,e}}Ba.prototype.bytesPerElement=16,Is(Ba,"StructArrayLayout2f1f2i16");class Na extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=12*e,s=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=n,this.float32[s+1]=i,this.float32[s+2]=r,e}}Na.prototype.bytesPerElement=12,Is(Na,"StructArrayLayout2ub2f12");class ja extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}ja.prototype.bytesPerElement=12,Is(ja,"StructArrayLayout3f12");class Ua extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}Ua.prototype.bytesPerElement=6,Is(Ua,"StructArrayLayout3ui6");class Va extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g,y,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g,y,v,x)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g,y,v,x,b){const w=30*e,T=15*e,S=60*e;return this.int16[w+0]=t,this.int16[w+1]=n,this.int16[w+2]=i,this.float32[T+2]=r,this.float32[T+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[T+5]=l,this.uint32[T+6]=c,this.uint32[T+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[T+10]=f,this.float32[T+11]=m,this.uint8[S+48]=_,this.uint8[S+49]=g,this.uint8[S+50]=y,this.uint32[T+13]=v,this.int16[w+28]=x,this.uint8[S+58]=b,e}}Va.prototype.bytesPerElement=60,Is(Va,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ga extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,T,S,E,C,A,I,M,k,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,T,S,E,C,A,I,M,k,P)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,T,S,E,C,A,I,M,k,P,D){const R=20*e,z=40*e,L=80*e;return this.float32[R+0]=t,this.float32[R+1]=n,this.int16[z+4]=i,this.int16[z+5]=r,this.int16[z+6]=o,this.int16[z+7]=s,this.int16[z+8]=a,this.int16[z+9]=l,this.int16[z+10]=c,this.int16[z+11]=u,this.int16[z+12]=h,this.uint16[z+13]=d,this.uint16[z+14]=p,this.uint16[z+15]=f,this.uint16[z+16]=m,this.uint16[z+17]=_,this.uint16[z+18]=g,this.uint16[z+19]=y,this.uint16[z+20]=v,this.uint16[z+21]=x,this.uint16[z+22]=b,this.uint16[z+23]=w,this.uint16[z+24]=T,this.uint16[z+25]=S,this.uint16[z+26]=E,this.uint16[z+27]=C,this.uint32[R+14]=A,this.float32[R+15]=I,this.float32[R+16]=M,this.float32[R+17]=k,this.float32[R+18]=P,this.uint8[L+76]=D,e}}Ga.prototype.bytesPerElement=80,Is(Ga,"StructArrayLayout2f9i15ui1ul4f1ub80");class qa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}qa.prototype.bytesPerElement=4,Is(qa,"StructArrayLayout1f4");class Ha extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.float32[s+3]=r,this.float32[s+4]=o,e}}Ha.prototype.bytesPerElement=20,Is(Ha,"StructArrayLayout5f20");class Wa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=n,this.float32[l+2]=i,this.float32[l+3]=r,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,e}}Wa.prototype.bytesPerElement=28,Is(Wa,"StructArrayLayout7f28");class Za extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=n,this.uint16[o+3]=i,this.uint16[o+4]=r,e}}Za.prototype.bytesPerElement=12,Is(Za,"StructArrayLayout1ul3ui12");class Xa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Xa.prototype.bytesPerElement=2,Is(Xa,"StructArrayLayout1ui2");class Ya extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}Ya.prototype.bytesPerElement=8,Is(Ya,"StructArrayLayout2f8");class Ka extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_){const g=16*e;return this.float32[g+0]=t,this.float32[g+1]=n,this.float32[g+2]=i,this.float32[g+3]=r,this.float32[g+4]=o,this.float32[g+5]=s,this.float32[g+6]=a,this.float32[g+7]=l,this.float32[g+8]=c,this.float32[g+9]=u,this.float32[g+10]=h,this.float32[g+11]=d,this.float32[g+12]=p,this.float32[g+13]=f,this.float32[g+14]=m,this.float32[g+15]=_,e}}Ka.prototype.bytesPerElement=64,Is(Ka,"StructArrayLayout16f64");class Qa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=n,this.uint16[l+2]=i,this.uint16[l+3]=r,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,e}}Qa.prototype.bytesPerElement=20,Is(Qa,"StructArrayLayout4ui3f20");class Ja extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}Ja.prototype.bytesPerElement=1,Is(Ja,"StructArrayLayout1ub1");class $a extends va{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}$a.prototype.size=40;class el extends Oa{get(e){return new $a(this,e)}}Is(el,"CollisionBoxArray");class tl extends va{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}tl.prototype.size=60;class nl extends Va{get(e){return new tl(this,e)}}Is(nl,"PlacedSymbolArray");class il extends va{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}il.prototype.size=80;class rl extends Ga{get(e){return new il(this,e)}}Is(rl,"SymbolInstanceArray");class ol extends qa{getoffsetX(e){return this.float32[1*e+0]}}Is(ol,"GlyphOffsetArray");class sl extends Ta{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Is(sl,"SymbolLineVertexArray");class al extends va{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}al.prototype.size=12;class ll extends Za{get(e){return new al(this,e)}}Is(ll,"FeatureIndexArray");class cl extends La{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Is(cl,"FillExtrusionCentroidArray");const ul=ba([{name:"a_pos",components:2,type:"Int16"}],4),hl=ba([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class dl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,n,i){let r=this.segments[this.segments.length-1];return e>dl.MAX_VERTEX_ARRAY_LENGTH&&X("Max vertices per segment is ".concat(dl.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(e)),(!r||r.vertexLength+e>dl.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:t,primitiveOffset:n,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}prepareSegment(e,t,n,i){return this._prepareSegment(e,t.length,n.length,i)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new dl([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function pl(e,t){return 256*(e=k(Math.floor(e),0,255))+k(Math.floor(t),0,255)}dl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Is(dl,"SegmentVector");const fl=ba([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ml=ba([{name:"a_dash",components:4,type:"Uint16"}]);var _l={exports:{}},gl={exports:{}};!function(e){e.exports=function(e,t){var n,i,r,o,s,a,l,c;for(i=e.length-(n=3&e.length),r=t,s=3432918353,a=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}}(gl);var yl=gl.exports,vl={exports:{}};!function(e){e.exports=function(e,t){for(var n,i=e.length,r=t^i,o=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}}(vl);var xl=yl,bl=vl.exports;_l.exports=xl,_l.exports.murmur3=xl,_l.exports.murmur2=bl;var wl=d(_l.exports);class Tl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(Sl(e)),this.positions.push(t,n,i)}eachPosition(e,t){const n=Sl(e);let i=0,r=this.ids.length-1;for(;i<r;){const e=i+r>>1;this.ids[e]>=n?r=e:i=e+1}for(;this.ids[i]===n;)t(this.positions[3*i],this.positions[3*i+1],this.positions[3*i+2]),i++}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return El(n,i,0,n.length-1),t&&(t.add(n.buffer),t.add(i.buffer)),{ids:n,positions:i}}static deserialize(e){const t=new Tl;let n;t.ids=e.ids,t.positions=e.positions;for(const i of t.ids)i!==n&&t.uniqueIds.push(i),n=i;return t.indexed=!0,t}}function Sl(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:wl(String(e))}function El(e,t,n,i){for(;n<i;){const r=e[n+i>>1];let o=n-1,s=i+1;for(;;){do{o++}while(e[o]<r);do{s--}while(e[s]>r);if(o>=s)break;Cl(e,o,s),Cl(t,3*o,3*s),Cl(t,3*o+1,3*s+1),Cl(t,3*o+2,3*s+2)}s-n<i-s?(El(e,t,n,s),n=s+1):(El(e,t,s+1,i),i=s)}}function Cl(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}Is(Tl,"FeaturePositionMap");class Al{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Il extends Al{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class Ml extends Al{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class kl extends Al{constructor(e){super(e),this.current=[0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class Pl extends Al{constructor(e){super(e),this.current=[0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class Dl extends Al{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class Rl extends Al{constructor(e){super(e),this.current=cn.transparent}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const zl=new Float32Array(16);class Ll extends Al{constructor(e){super(e),this.current=zl}set(e,t,n){if(this.fetchUniformLocation(e,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const Ol=new Float32Array(9);class Fl extends Al{constructor(e){super(e),this.current=Ol}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<9;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}const Bl=new Float32Array(4);class Nl extends Al{constructor(e){super(e),this.current=Bl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<4;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}function jl(e){return[pl(255*e.r,255*e.g),pl(255*e.b,255*e.a)]}class Ul{constructor(e,t,n){this.value=e,this.uniformNames=t.map((e=>"u_".concat(e))),this.type=n}setUniform(e,t,n,i,r){t.set(e,r,i.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Rl(e):new Ml(e)}}class Vl{constructor(e,t){this.uniformNames=t.map((e=>"u_".concat(e))),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,n,i,r){const o="u_pattern"===r||"u_dash"===r?this.pattern:"u_pixel_ratio"===r?this.pixelRatio:null;o&&t.set(e,r,o)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new Dl(e):new Ml(e)}}class Gl{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,r,o,s){const a=this.paintVertexArray.length,l=this.expression.evaluate(new ea(0,{brightness:o}),t,{},r,i,s);this.paintVertexArray.resize(e),this._setPaintValue(a,e,l)}updatePaintArray(e,t,n,i,r,o,s){const a=this.expression.evaluate({zoom:0,brightness:s},n,i,void 0,r);this._setPaintValue(e,t,a)}_setPaintValue(e,t,n){if("color"===this.type){const i=jl(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ql{constructor(e,t,n,i,r,o){this.expression=e,this.uniformNames=t.map((e=>"u_".concat(e,"_t"))),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,n,i,r,o,s){const a=this.expression.evaluate(new ea(this.zoom,{brightness:o}),t,{},r,i,s),l=this.expression.evaluate(new ea(this.zoom+1,{brightness:o}),t,{},r,i,s),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,a,l)}updatePaintArray(e,t,n,i,r,o,s){const a=this.expression.evaluate({zoom:this.zoom,brightness:s},n,i,void 0,r),l=this.expression.evaluate({zoom:this.zoom+1,brightness:s},n,i,void 0,r);this._setPaintValue(e,t,a,l)}_setPaintValue(e,t,n,i){if("color"===this.type){const r=jl(n),o=jl(i);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,i,r){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,s=k(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(e,r,s)}getBinding(e,t){return new Ml(e)}}class Hl{constructor(e,t,n,i,r){this.expression=e,this.layerId=r,this.paintVertexAttributes=("array"===n?ml:fl).members;for(let o=0;o<t.length;++o);this.paintVertexArray=new i}populatePaintArray(e,t,n){const i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,r,o,s){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],o)}_setPaintValues(e,t,n,i){if(!i||!n)return;const r=i[n];if(!r)return;const{tl:o,br:s,pixelRatio:a}=r;for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,o[0],o[1],s[0],s[1],a)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[];const i=[];for(const r in e.paint._values){const o=e.paint.get(r);if(!n(r))continue;if(!(o instanceof aa&&ro(o.property.specification)))continue;const s=Yl(r,e.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===r||r.endsWith("pattern"),h="line-dasharray"===r&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const t=Jl(r,l,"source");this.binders[r]=u?new Hl(a,s,l,t,e.id):new Gl(a,s,l,t),i.push("/a_".concat(r))}else{const e=Jl(r,l,"composite");this.binders[r]=new ql(a,s,l,c,t,e),i.push("/z_".concat(r))}else this.binders[r]=u?new Vl(a.value,s):new Ul(a.value,s,l),i.push("/u_".concat(r))}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Gl||t instanceof ql?t.maxValue:0}populatePaintArrays(e,t,n,i,r,o,s){for(const a in this.binders){const l=this.binders[a];(l instanceof Gl||l instanceof ql||l instanceof Hl)&&l.populatePaintArray(e,t,n,i,r,o,s)}}setConstantPatternPositions(e){for(const t in this.binders){const n=this.binders[t];n instanceof Vl&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,t,n,i,r,o,s,a){let l=!1;const c=Object.keys(e),u=0!==c.length,h=u?c:t.uniqueIds;for(const d in this.binders){const c=this.binders[d];if((c instanceof Gl||c instanceof ql||c instanceof Hl)&&(!0===c.expression.isStateDependent||!1===c.expression.isLightConstant)){const p=r.paint.get(d);c.expression=p.value;for(const n of h){const r=e[n.toString()];t.eachPosition(n,((e,t,n)=>{const l=i.feature(e);c.updatePaintArray(t,n,l,r,o,s,a)}))}if(!u)for(const t of n.uniqueIds){const r=e[t.toString()];n.eachPosition(t,((e,t,n)=>{const l=i.feature(e);c.updatePaintArray(t,n,l,r,o,s,a)}))}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Ul||n instanceof Vl)&&e.push(...n.uniformNames.map((e=>"#define HAS_UNIFORM_".concat(e))))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Gl||n instanceof ql||n instanceof Hl)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Ul||n instanceof Vl||n instanceof ql)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof Ul||i instanceof Vl||i instanceof ql)for(const r of i.uniformNames)t.push({name:r,property:n,binding:i.getBinding(e,r)})}return t}setUniforms(e,t,n,i,r){for(const{name:o,property:s,binding:a}of n)this.binders[s].setUniform(e,a,r,i.get(s),o)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Gl||t instanceof ql||t instanceof Hl)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Gl||n instanceof ql||n instanceof Hl)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Gl||t instanceof ql||t instanceof Hl)&&t.destroy()}}}class Zl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new Wl(i,t,n);this.needsUpload=!1,this._featureMap=new Tl,this._featureMapWithoutIds=new Tl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,n,i,r,o,s,a){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(e,t,i,r,o,s,a);void 0!==t.id?this._featureMap.add(t.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i,r,o){for(const s of n)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,s,i,r,o||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Xl={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Yl(e,t){return Xl[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}const Kl={"line-pattern":{source:Ma,composite:Ma},"fill-pattern":{source:Ma,composite:Ma},"fill-extrusion-pattern":{source:Ma,composite:Ma},"line-dasharray":{source:ka,composite:ka}},Ql={color:{source:Ya,composite:Ia},number:{source:qa,composite:Ya}};function Jl(e,t,n){const i=Kl[e];return i&&i[n]||Ql[t][n]}Is(Ul,"ConstantBinder"),Is(Vl,"PatternConstantBinder"),Is(Gl,"SourceExpressionBinder"),Is(Hl,"PatternCompositeBinder"),Is(ql,"CompositeExpressionBinder"),Is(Wl,"ProgramConfiguration",{omit:["_buffers"]}),Is(Zl,"ProgramConfigurationSet");class $l{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Nd?new Nd(e.lng,e.lat):Nd.convert(e),this}setSouthWest(e){return this._sw=e instanceof Nd?new Nd(e.lng,e.lat):Nd.convert(e),this}extend(e){const t=this._sw,n=this._ne;let i,r;if(e instanceof Nd)i=e,r=e;else{if(!(e instanceof $l))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend($l.convert(e)):this.extend(Nd.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Nd.convert(e)):this;if(i=e._sw,r=e._ne,!i||!r)return this}return t||n?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Nd(i.lng,i.lat),this._ne=new Nd(r.lng,r.lat)),this}getCenter(){return new Nd((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Nd(this.getWest(),this.getNorth())}getSouthEast(){return new Nd(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Nd.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(e){return!e||e instanceof $l?e:new $l(e)}}var ec={},tc={};Object.defineProperty(tc,"__esModule",{value:!0}),tc.setMatrixArrayType=function(e){tc.ARRAY_TYPE=ic=e},tc.toRadian=function(e){return e*oc},tc.equals=function(e,t){return Math.abs(e-t)<=nc*Math.max(1,Math.abs(e),Math.abs(t))},tc.RANDOM=tc.ARRAY_TYPE=tc.EPSILON=void 0;var nc=1e-6;tc.EPSILON=nc;var ic="undefined"!=typeof Float32Array?Float32Array:Array;tc.ARRAY_TYPE=ic;var rc=Math.random;tc.RANDOM=rc;var oc=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var sc={};function ac(e){return ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ac(e)}Object.defineProperty(sc,"__esModule",{value:!0}),sc.create=function(){var e=new lc.ARRAY_TYPE(4);return lc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},sc.clone=function(e){var t=new lc.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},sc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},sc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},sc.fromValues=function(e,t,n,i){var r=new lc.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},sc.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},sc.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},sc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*o-r*i;return s?(e[0]=o*(s=1/s),e[1]=-i*s,e[2]=-r*s,e[3]=n*s,e):null},sc.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},sc.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},sc.multiply=uc,sc.rotate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=i*-a+o*l,e[3]=r*-a+s*l,e},sc.scale=function(e,t,n){var i=t[1],r=t[2],o=t[3],s=n[0],a=n[1];return e[0]=t[0]*s,e[1]=i*s,e[2]=r*a,e[3]=o*a,e},sc.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e},sc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},sc.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},sc.LDU=function(e,t,n,i){return e[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-e[2]*n[1],[e,t,n]},sc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},sc.subtract=hc,sc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},sc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(n-s)<=lc.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=lc.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=lc.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=lc.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},sc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},sc.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},sc.sub=sc.mul=void 0;var lc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==ac(e)&&"function"!=typeof e)return{default:e};var n=cc(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(tc);function cc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(cc=function(e){return e?n:t})(e)}function uc(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*a+o*l,e[1]=r*a+s*l,e[2]=i*c+o*u,e[3]=r*c+s*u,e}function hc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}sc.mul=uc,sc.sub=hc;var dc={};function pc(e){return pc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pc(e)}Object.defineProperty(dc,"__esModule",{value:!0}),dc.create=function(){var e=new fc.ARRAY_TYPE(6);return fc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},dc.clone=function(e){var t=new fc.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},dc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},dc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},dc.fromValues=function(e,t,n,i,r,o){var s=new fc.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=n,s[3]=i,s[4]=r,s[5]=o,s},dc.set=function(e,t,n,i,r,o,s){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e},dc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=n*o-i*r;return l?(e[0]=o*(l=1/l),e[1]=-i*l,e[2]=-r*l,e[3]=n*l,e[4]=(r*a-o*s)*l,e[5]=(i*s-n*a)*l,e):null},dc.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},dc.multiply=_c,dc.rotate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=Math.sin(n),u=Math.cos(n);return e[0]=i*u+o*c,e[1]=r*u+s*c,e[2]=i*-c+o*u,e[3]=r*-c+s*u,e[4]=a,e[5]=l,e},dc.scale=function(e,t,n){var i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=n[0],c=n[1];return e[0]=t[0]*l,e[1]=i*l,e[2]=r*c,e[3]=o*c,e[4]=s,e[5]=a,e},dc.translate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=n[0],u=n[1];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=i*c+o*u+a,e[5]=r*c+s*u+l,e},dc.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e[4]=0,e[5]=0,e},dc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},dc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},dc.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},dc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},dc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},dc.subtract=gc,dc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},dc.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e},dc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},dc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5];return Math.abs(n-l)<=fc.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=fc.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-u)<=fc.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-h)<=fc.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=fc.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-p)<=fc.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},dc.sub=dc.mul=void 0;var fc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==pc(e)&&"function"!=typeof e)return{default:e};var n=mc(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(tc);function mc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(mc=function(e){return e?n:t})(e)}function _c(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=n[0],u=n[1],h=n[2],d=n[3],p=n[4],f=n[5];return e[0]=i*c+o*u,e[1]=r*c+s*u,e[2]=i*h+o*d,e[3]=r*h+s*d,e[4]=i*p+o*f+a,e[5]=r*p+s*f+l,e}function gc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}dc.mul=_c,dc.sub=gc;var yc={};function vc(e){return vc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vc(e)}Object.defineProperty(yc,"__esModule",{value:!0}),yc.create=function(){var e=new xc.ARRAY_TYPE(9);return xc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},yc.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},yc.clone=function(e){var t=new xc.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},yc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},yc.fromValues=function(e,t,n,i,r,o,s,a,l){var c=new xc.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=n,c[3]=i,c[4]=r,c[5]=o,c[6]=s,c[7]=a,c[8]=l,c},yc.set=function(e,t,n,i,r,o,s,a,l,c){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e},yc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},yc.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},yc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=n*h+i*d+r*p;return f?(e[0]=h*(f=1/f),e[1]=(-u*i+r*c)*f,e[2]=(a*i-r*s)*f,e[3]=d*f,e[4]=(u*n-r*l)*f,e[5]=(-a*n+r*o)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(s*n-i*o)*f,e):null},yc.adjoint=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=r*c-i*u,e[2]=i*a-r*s,e[3]=a*l-o*u,e[4]=n*u-r*l,e[5]=r*o-n*a,e[6]=o*c-s*l,e[7]=i*l-n*c,e[8]=n*s-i*o,e},yc.determinant=function(e){var t=e[3],n=e[4],i=e[5],r=e[6],o=e[7],s=e[8];return e[0]*(s*n-i*o)+e[1]*(-s*t+i*r)+e[2]*(o*t-n*r)},yc.multiply=wc,yc.translate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d*i+p*s+c,e[7]=d*r+p*a+u,e[8]=d*o+p*l+h,e},yc.rotate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(n),p=Math.cos(n);return e[0]=p*i+d*s,e[1]=p*r+d*a,e[2]=p*o+d*l,e[3]=p*s-d*i,e[4]=p*a-d*r,e[5]=p*l-d*o,e[6]=c,e[7]=u,e[8]=h,e},yc.scale=function(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},yc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},yc.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},yc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},yc.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},yc.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,p=r*a,f=r*l,m=o*s,_=o*a,g=o*l;return e[0]=1-h-f,e[3]=u-g,e[6]=d+_,e[1]=u+g,e[4]=1-c-f,e[7]=p-m,e[2]=d-_,e[5]=p+m,e[8]=1-c-h,e},yc.normalFromMat4=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15],y=n*a-i*s,v=n*l-r*s,x=n*c-o*s,b=i*l-r*a,w=i*c-o*a,T=r*c-o*l,S=u*m-h*f,E=u*_-d*f,C=u*g-p*f,A=h*_-d*m,I=h*g-p*m,M=d*g-p*_,k=y*M-v*I+x*A+b*C-w*E+T*S;return k?(e[0]=(a*M-l*I+c*A)*(k=1/k),e[1]=(l*C-s*M-c*E)*k,e[2]=(s*I-a*C+c*S)*k,e[3]=(r*I-i*M-o*A)*k,e[4]=(n*M-r*C+o*E)*k,e[5]=(i*C-n*I-o*S)*k,e[6]=(m*T-_*w+g*b)*k,e[7]=(_*x-f*T-g*v)*k,e[8]=(f*w-m*x+g*y)*k,e):null},yc.projection=function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},yc.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},yc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},yc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},yc.subtract=Tc,yc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},yc.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e},yc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},yc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=t[0],d=t[1],p=t[2],f=t[3],m=t[4],_=t[5],g=t[6],y=t[7],v=t[8];return Math.abs(n-h)<=xc.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-d)<=xc.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-p)<=xc.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(o-f)<=xc.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=xc.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-_)<=xc.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(l-g)<=xc.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=xc.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-v)<=xc.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))},yc.sub=yc.mul=void 0;var xc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==vc(e)&&"function"!=typeof e)return{default:e};var n=bc(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(tc);function bc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(bc=function(e){return e?n:t})(e)}function wc(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1],f=n[2],m=n[3],_=n[4],g=n[5],y=n[6],v=n[7],x=n[8];return e[0]=d*i+p*s+f*c,e[1]=d*r+p*a+f*u,e[2]=d*o+p*l+f*h,e[3]=m*i+_*s+g*c,e[4]=m*r+_*a+g*u,e[5]=m*o+_*l+g*h,e[6]=y*i+v*s+x*c,e[7]=y*r+v*a+x*u,e[8]=y*o+v*l+x*h,e}function Tc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}yc.mul=wc,yc.sub=Tc;var Sc={};function Ec(e){return Ec="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ec(e)}Object.defineProperty(Sc,"__esModule",{value:!0}),Sc.create=function(){var e=new Cc.ARRAY_TYPE(16);return Cc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},Sc.clone=function(e){var t=new Cc.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Sc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Sc.fromValues=function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){var _=new Cc.ARRAY_TYPE(16);return _[0]=e,_[1]=t,_[2]=n,_[3]=i,_[4]=r,_[5]=o,_[6]=s,_[7]=a,_[8]=l,_[9]=c,_[10]=u,_[11]=h,_[12]=d,_[13]=p,_[14]=f,_[15]=m,_},Sc.set=function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=_,e},Sc.identity=Ic,Sc.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},Sc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15],y=n*a-i*s,v=n*l-r*s,x=n*c-o*s,b=i*l-r*a,w=i*c-o*a,T=r*c-o*l,S=u*m-h*f,E=u*_-d*f,C=u*g-p*f,A=h*_-d*m,I=h*g-p*m,M=d*g-p*_,k=y*M-v*I+x*A+b*C-w*E+T*S;return k?(e[0]=(a*M-l*I+c*A)*(k=1/k),e[1]=(r*I-i*M-o*A)*k,e[2]=(m*T-_*w+g*b)*k,e[3]=(d*w-h*T-p*b)*k,e[4]=(l*C-s*M-c*E)*k,e[5]=(n*M-r*C+o*E)*k,e[6]=(_*x-f*T-g*v)*k,e[7]=(u*T-d*x+p*v)*k,e[8]=(s*I-a*C+c*S)*k,e[9]=(i*C-n*I-o*S)*k,e[10]=(f*w-m*x+g*y)*k,e[11]=(h*x-u*w-p*y)*k,e[12]=(a*E-s*A-l*S)*k,e[13]=(n*A-i*E+r*S)*k,e[14]=(m*v-f*b-_*y)*k,e[15]=(u*b-h*v+d*y)*k,e):null},Sc.adjoint=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15];return e[0]=a*(d*g-p*_)-h*(l*g-c*_)+m*(l*p-c*d),e[1]=-(i*(d*g-p*_)-h*(r*g-o*_)+m*(r*p-o*d)),e[2]=i*(l*g-c*_)-a*(r*g-o*_)+m*(r*c-o*l),e[3]=-(i*(l*p-c*d)-a*(r*p-o*d)+h*(r*c-o*l)),e[4]=-(s*(d*g-p*_)-u*(l*g-c*_)+f*(l*p-c*d)),e[5]=n*(d*g-p*_)-u*(r*g-o*_)+f*(r*p-o*d),e[6]=-(n*(l*g-c*_)-s*(r*g-o*_)+f*(r*c-o*l)),e[7]=n*(l*p-c*d)-s*(r*p-o*d)+u*(r*c-o*l),e[8]=s*(h*g-p*m)-u*(a*g-c*m)+f*(a*p-c*h),e[9]=-(n*(h*g-p*m)-u*(i*g-o*m)+f*(i*p-o*h)),e[10]=n*(a*g-c*m)-s*(i*g-o*m)+f*(i*c-o*a),e[11]=-(n*(a*p-c*h)-s*(i*p-o*h)+u*(i*c-o*a)),e[12]=-(s*(h*_-d*m)-u*(a*_-l*m)+f*(a*d-l*h)),e[13]=n*(h*_-d*m)-u*(i*_-r*m)+f*(i*d-r*h),e[14]=-(n*(a*_-l*m)-s*(i*_-r*m)+f*(i*l-r*a)),e[15]=n*(a*d-l*h)-s*(i*d-r*h)+u*(i*l-r*a),e},Sc.determinant=function(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],_=e[15];return(t*s-n*o)*(h*_-d*m)-(t*a-i*o)*(u*_-d*f)+(t*l-r*o)*(u*m-h*f)+(n*a-i*s)*(c*_-d*p)-(n*l-r*s)*(c*m-h*p)+(i*l-r*a)*(c*f-u*p)},Sc.multiply=Mc,Sc.translate=function(e,t,n){var i,r,o,s,a,l,c,u,h,d,p,f,m=n[0],_=n[1],g=n[2];return t===e?(e[12]=t[0]*m+t[4]*_+t[8]*g+t[12],e[13]=t[1]*m+t[5]*_+t[9]*g+t[13],e[14]=t[2]*m+t[6]*_+t[10]*g+t[14],e[15]=t[3]*m+t[7]*_+t[11]*g+t[15]):(r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=i=t[0],e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=i*m+a*_+h*g+t[12],e[13]=r*m+l*_+d*g+t[13],e[14]=o*m+c*_+p*g+t[14],e[15]=s*m+u*_+f*g+t[15]),e},Sc.scale=function(e,t,n){var i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Sc.rotate=function(e,t,n,i){var r,o,s,a,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,T,S,E,C,A,I=i[0],M=i[1],k=i[2],P=Math.hypot(I,M,k);return P<Cc.EPSILON?null:(I*=P=1/P,M*=P,k*=P,r=Math.sin(n),o=Math.cos(n),l=t[1],c=t[2],u=t[3],d=t[5],p=t[6],f=t[7],_=t[9],g=t[10],y=t[11],w=I*M*(s=1-o)-k*r,T=M*M*s+o,S=k*M*s+I*r,E=I*k*s+M*r,C=M*k*s-I*r,A=k*k*s+o,e[0]=(a=t[0])*(v=I*I*s+o)+(h=t[4])*(x=M*I*s+k*r)+(m=t[8])*(b=k*I*s-M*r),e[1]=l*v+d*x+_*b,e[2]=c*v+p*x+g*b,e[3]=u*v+f*x+y*b,e[4]=a*w+h*T+m*S,e[5]=l*w+d*T+_*S,e[6]=c*w+p*T+g*S,e[7]=u*w+f*T+y*S,e[8]=a*E+h*C+m*A,e[9]=l*E+d*C+_*A,e[10]=c*E+p*C+g*A,e[11]=u*E+f*C+y*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},Sc.rotateX=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e},Sc.rotateY=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=s*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r,e},Sc.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e},Sc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},Sc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Sc.fromRotation=function(e,t,n){var i,r,o,s=n[0],a=n[1],l=n[2],c=Math.hypot(s,a,l);return c<Cc.EPSILON?null:(s*=c=1/c,a*=c,l*=c,i=Math.sin(t),r=Math.cos(t),e[0]=s*s*(o=1-r)+r,e[1]=a*s*o+l*i,e[2]=l*s*o-a*i,e[3]=0,e[4]=s*a*o-l*i,e[5]=a*a*o+r,e[6]=l*a*o+s*i,e[7]=0,e[8]=s*l*o+a*i,e[9]=a*l*o-s*i,e[10]=l*l*o+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},Sc.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Sc.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Sc.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Sc.fromRotationTranslation=kc,Sc.fromQuat2=function(e,t){var n=new Cc.ARRAY_TYPE(3),i=-t[0],r=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=i*i+r*r+o*o+s*s;return h>0?(n[0]=2*(a*s+u*i+l*o-c*r)/h,n[1]=2*(l*s+u*r+c*i-a*o)/h,n[2]=2*(c*s+u*o+a*r-l*i)/h):(n[0]=2*(a*s+u*i+l*o-c*r),n[1]=2*(l*s+u*r+c*i-a*o),n[2]=2*(c*s+u*o+a*r-l*i)),kc(e,t,n),e},Sc.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},Sc.getScaling=Pc,Sc.getRotation=function(e,t){var n=new Cc.ARRAY_TYPE(3);Pc(n,t);var i=1/n[0],r=1/n[1],o=1/n[2],s=t[0]*i,a=t[1]*r,l=t[2]*o,c=t[4]*i,u=t[5]*r,h=t[6]*o,d=t[8]*i,p=t[9]*r,f=t[10]*o,m=s+u+f,_=0;return m>0?(_=2*Math.sqrt(m+1),e[3]=.25*_,e[0]=(h-p)/_,e[1]=(d-l)/_,e[2]=(a-c)/_):s>u&&s>f?(_=2*Math.sqrt(1+s-u-f),e[3]=(h-p)/_,e[0]=.25*_,e[1]=(a+c)/_,e[2]=(d+l)/_):u>f?(_=2*Math.sqrt(1+u-s-f),e[3]=(d-l)/_,e[0]=(a+c)/_,e[1]=.25*_,e[2]=(h+p)/_):(_=2*Math.sqrt(1+f-s-u),e[3]=(a-c)/_,e[0]=(d+l)/_,e[1]=(h+p)/_,e[2]=.25*_),e},Sc.fromRotationTranslationScale=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3],l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,_=s*u,g=a*l,y=a*c,v=a*u,x=i[0],b=i[1],w=i[2];return e[0]=(1-(f+_))*x,e[1]=(d+v)*x,e[2]=(p-y)*x,e[3]=0,e[4]=(d-v)*b,e[5]=(1-(h+_))*b,e[6]=(m+g)*b,e[7]=0,e[8]=(p+y)*w,e[9]=(m-g)*w,e[10]=(1-(h+f))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},Sc.fromRotationTranslationScaleOrigin=function(e,t,n,i,r){var o=t[0],s=t[1],a=t[2],l=t[3],c=o+o,u=s+s,h=a+a,d=o*c,p=o*u,f=o*h,m=s*u,_=s*h,g=a*h,y=l*c,v=l*u,x=l*h,b=i[0],w=i[1],T=i[2],S=r[0],E=r[1],C=r[2],A=(1-(m+g))*b,I=(p+x)*b,M=(f-v)*b,k=(p-x)*w,P=(1-(d+g))*w,D=(_+y)*w,R=(f+v)*T,z=(_-y)*T,L=(1-(d+m))*T;return e[0]=A,e[1]=I,e[2]=M,e[3]=0,e[4]=k,e[5]=P,e[6]=D,e[7]=0,e[8]=R,e[9]=z,e[10]=L,e[11]=0,e[12]=n[0]+S-(A*S+k*E+R*C),e[13]=n[1]+E-(I*S+P*E+z*C),e[14]=n[2]+C-(M*S+D*E+L*C),e[15]=1,e},Sc.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,p=r*a,f=r*l,m=o*s,_=o*a,g=o*l;return e[0]=1-h-f,e[1]=u+g,e[2]=d-_,e[3]=0,e[4]=u-g,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+_,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Sc.frustum=function(e,t,n,i,r,o,s){var a=1/(n-t),l=1/(r-i),c=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e},Sc.perspectiveNO=Dc,Sc.perspectiveZO=function(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=r*(o=1/(i-r)),e[14]=r*i*o):(e[10]=-1,e[14]=-i),e},Sc.perspectiveFromFieldOfView=function(e,t,n,i){var r=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(r+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-a)*l*.5,e[9]=(r-o)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e},Sc.orthoNO=Rc,Sc.orthoZO=function(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=o*c,e[15]=1,e},Sc.lookAt=function(e,t,n,i){var r,o,s,a,l,c,u,h,d,p,f=t[0],m=t[1],_=t[2],g=i[0],y=i[1],v=i[2],x=n[0],b=n[1],w=n[2];return Math.abs(f-x)<Cc.EPSILON&&Math.abs(m-b)<Cc.EPSILON&&Math.abs(_-w)<Cc.EPSILON?Ic(e):(u=f-x,h=m-b,d=_-w,r=y*(d*=p=1/Math.hypot(u,h,d))-v*(h*=p),o=v*(u*=p)-g*d,s=g*h-y*u,(p=Math.hypot(r,o,s))?(r*=p=1/p,o*=p,s*=p):(r=0,o=0,s=0),a=h*s-d*o,l=d*r-u*s,c=u*o-h*r,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),e[0]=r,e[1]=a,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=c,e[10]=d,e[11]=0,e[12]=-(r*f+o*m+s*_),e[13]=-(a*f+l*m+c*_),e[14]=-(u*f+h*m+d*_),e[15]=1,e)},Sc.targetTo=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=i[0],l=i[1],c=i[2],u=r-n[0],h=o-n[1],d=s-n[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,m=c*u-a*d,_=a*h-l*u;return(p=f*f+m*m+_*_)>0&&(f*=p=1/Math.sqrt(p),m*=p,_*=p),e[0]=f,e[1]=m,e[2]=_,e[3]=0,e[4]=h*_-d*m,e[5]=d*f-u*_,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=r,e[13]=o,e[14]=s,e[15]=1,e},Sc.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},Sc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Sc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},Sc.subtract=zc,Sc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},Sc.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e},Sc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},Sc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],_=e[14],g=e[15],y=t[0],v=t[1],x=t[2],b=t[3],w=t[4],T=t[5],S=t[6],E=t[7],C=t[8],A=t[9],I=t[10],M=t[11],k=t[12],P=t[13],D=t[14],R=t[15];return Math.abs(n-y)<=Cc.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-v)<=Cc.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-x)<=Cc.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(o-b)<=Cc.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-w)<=Cc.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-T)<=Cc.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(l-S)<=Cc.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-E)<=Cc.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-C)<=Cc.EPSILON*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(h-A)<=Cc.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-I)<=Cc.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-M)<=Cc.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(f-k)<=Cc.EPSILON*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(m-P)<=Cc.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(_-D)<=Cc.EPSILON*Math.max(1,Math.abs(_),Math.abs(D))&&Math.abs(g-R)<=Cc.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))},Sc.sub=Sc.mul=Sc.ortho=Sc.perspective=void 0;var Cc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Ec(e)&&"function"!=typeof e)return{default:e};var n=Ac(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(tc);function Ac(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ac=function(e){return e?n:t})(e)}function Ic(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Mc(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],_=t[13],g=t[14],y=t[15],v=n[0],x=n[1],b=n[2],w=n[3];return e[0]=v*i+x*a+b*h+w*m,e[1]=v*r+x*l+b*d+w*_,e[2]=v*o+x*c+b*p+w*g,e[3]=v*s+x*u+b*f+w*y,e[4]=(v=n[4])*i+(x=n[5])*a+(b=n[6])*h+(w=n[7])*m,e[5]=v*r+x*l+b*d+w*_,e[6]=v*o+x*c+b*p+w*g,e[7]=v*s+x*u+b*f+w*y,e[8]=(v=n[8])*i+(x=n[9])*a+(b=n[10])*h+(w=n[11])*m,e[9]=v*r+x*l+b*d+w*_,e[10]=v*o+x*c+b*p+w*g,e[11]=v*s+x*u+b*f+w*y,e[12]=(v=n[12])*i+(x=n[13])*a+(b=n[14])*h+(w=n[15])*m,e[13]=v*r+x*l+b*d+w*_,e[14]=v*o+x*c+b*p+w*g,e[15]=v*s+x*u+b*f+w*y,e}function kc(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=i+i,l=r+r,c=o+o,u=i*a,h=i*l,d=i*c,p=r*l,f=r*c,m=o*c,_=s*a,g=s*l,y=s*c;return e[0]=1-(p+m),e[1]=h+y,e[2]=d-g,e[3]=0,e[4]=h-y,e[5]=1-(u+m),e[6]=f+_,e[7]=0,e[8]=d+g,e[9]=f-_,e[10]=1-(u+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Pc(e,t){var n=t[4],i=t[5],r=t[6],o=t[8],s=t[9],a=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(n,i,r),e[2]=Math.hypot(o,s,a),e}function Dc(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(o=1/(i-r)),e[14]=2*r*i*o):(e[10]=-1,e[14]=-2*i),e}function Rc(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1,e}function zc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}Sc.perspective=Dc,Sc.ortho=Rc,Sc.mul=Mc,Sc.sub=zc;var Lc={},Oc={};function Fc(e){return Fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fc(e)}Object.defineProperty(Oc,"__esModule",{value:!0}),Oc.create=jc,Oc.clone=function(e){var t=new Bc.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Oc.length=Uc,Oc.fromValues=function(e,t,n){var i=new Bc.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=n,i},Oc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Oc.set=function(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e},Oc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},Oc.subtract=Vc,Oc.multiply=Gc,Oc.divide=qc,Oc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Oc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Oc.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},Oc.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},Oc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Oc.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},Oc.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e},Oc.distance=Hc,Oc.squaredDistance=Wc,Oc.squaredLength=Zc,Oc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Oc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Oc.normalize=function(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},Oc.dot=Xc,Oc.cross=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s,e},Oc.lerp=function(e,t,n,i){var r=t[0],o=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e},Oc.hermite=function(e,t,n,i,r,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return e[0]=t[0]*a+n[0]*l+i[0]*c+r[0]*u,e[1]=t[1]*a+n[1]*l+i[1]*c+r[1]*u,e[2]=t[2]*a+n[2]*l+i[2]*c+r[2]*u,e},Oc.bezier=function(e,t,n,i,r,o){var s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,h=3*l*s,d=l*o;return e[0]=t[0]*c+n[0]*u+i[0]*h+r[0]*d,e[1]=t[1]*c+n[1]*u+i[1]*h+r[1]*d,e[2]=t[2]*c+n[2]*u+i[2]*h+r[2]*d,e},Oc.random=function(e,t){t=t||1;var n=2*Bc.RANDOM()*Math.PI,i=2*Bc.RANDOM()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e},Oc.transformMat4=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(s=s||1),e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e},Oc.transformMat3=function(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8],e},Oc.transformQuat=function(e,t,n){var i=n[0],r=n[1],o=n[2],s=t[0],a=t[1],l=t[2],c=r*l-o*a,u=o*s-i*l,h=i*a-r*s,d=r*h-o*u,p=o*c-i*h,f=i*u-r*c,m=2*n[3];return u*=m,h*=m,p*=2,f*=2,e[0]=s+(c*=m)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e},Oc.rotateX=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},Oc.rotateY=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},Oc.rotateZ=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},Oc.angle=function(e,t){var n=e[0],i=e[1],r=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(o*o+s*s+a*a),c=l&&Xc(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},Oc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Oc.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Oc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Oc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(n-o)<=Bc.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=Bc.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=Bc.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))},Oc.forEach=Oc.sqrLen=Oc.len=Oc.sqrDist=Oc.dist=Oc.div=Oc.mul=Oc.sub=void 0;var Bc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Fc(e)&&"function"!=typeof e)return{default:e};var n=Nc(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(tc);function Nc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Nc=function(e){return e?n:t})(e)}function jc(){var e=new Bc.ARRAY_TYPE(3);return Bc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Uc(e){return Math.hypot(e[0],e[1],e[2])}function Vc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Gc(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function qc(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Hc(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function Wc(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function Zc(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function Xc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Oc.sub=Vc,Oc.mul=Gc,Oc.div=qc,Oc.dist=Hc,Oc.sqrDist=Wc,Oc.len=Uc,Oc.sqrLen=Zc;var Yc,Kc=(Yc=jc(),function(e,t,n,i,r,o){var s,a;for(t||(t=3),n||(n=0),a=i?Math.min(i*t+n,e.length):e.length,s=n;s<a;s+=t)Yc[0]=e[s],Yc[1]=e[s+1],Yc[2]=e[s+2],r(Yc,Yc,o),e[s]=Yc[0],e[s+1]=Yc[1],e[s+2]=Yc[2];return e});Oc.forEach=Kc;var Qc={};function Jc(e){return Jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jc(e)}Object.defineProperty(Qc,"__esModule",{value:!0}),Qc.create=tu,Qc.clone=function(e){var t=new $c.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qc.fromValues=function(e,t,n,i){var r=new $c.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},Qc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Qc.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},Qc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Qc.subtract=nu,Qc.multiply=iu,Qc.divide=ru,Qc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Qc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Qc.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},Qc.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},Qc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Qc.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},Qc.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},Qc.distance=ou,Qc.squaredDistance=su,Qc.length=au,Qc.squaredLength=lu,Qc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Qc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Qc.normalize=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=o*s,e},Qc.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Qc.cross=function(e,t,n,i){var r=n[0]*i[1]-n[1]*i[0],o=n[0]*i[2]-n[2]*i[0],s=n[0]*i[3]-n[3]*i[0],a=n[1]*i[2]-n[2]*i[1],l=n[1]*i[3]-n[3]*i[1],c=n[2]*i[3]-n[3]*i[2],u=t[0],h=t[1],d=t[2],p=t[3];return e[0]=h*c-d*l+p*a,e[1]=-u*c+d*s-p*o,e[2]=u*l-h*s+p*r,e[3]=-u*a+h*o-d*r,e},Qc.lerp=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e[3]=a+i*(n[3]-a),e},Qc.random=function(e,t){var n,i,r,o,s,a;t=t||1;do{s=(n=2*$c.RANDOM()-1)*n+(i=2*$c.RANDOM()-1)*i}while(s>=1);do{a=(r=2*$c.RANDOM()-1)*r+(o=2*$c.RANDOM()-1)*o}while(a>=1);var l=Math.sqrt((1-s)/a);return e[0]=t*n,e[1]=t*i,e[2]=t*r*l,e[3]=t*o*l,e},Qc.transformMat4=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e},Qc.transformQuat=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*o-l*r,h=c*r+l*i-s*o,d=c*o+s*r-a*i,p=-s*i-a*r-l*o;return e[0]=u*c+p*-s+h*-l-d*-a,e[1]=h*c+p*-a+d*-s-u*-l,e[2]=d*c+p*-l+u*-a-h*-s,e[3]=t[3],e},Qc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Qc.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Qc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Qc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(n-s)<=$c.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=$c.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=$c.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=$c.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},Qc.forEach=Qc.sqrLen=Qc.len=Qc.sqrDist=Qc.dist=Qc.div=Qc.mul=Qc.sub=void 0;var $c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Jc(e)&&"function"!=typeof e)return{default:e};var n=eu(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(tc);function eu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(eu=function(e){return e?n:t})(e)}function tu(){var e=new $c.ARRAY_TYPE(4);return $c.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function nu(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function iu(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function ru(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function ou(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function su(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],o=t[3]-e[3];return n*n+i*i+r*r+o*o}function au(e){return Math.hypot(e[0],e[1],e[2],e[3])}function lu(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r}Qc.sub=nu,Qc.mul=iu,Qc.div=ru,Qc.dist=ou,Qc.sqrDist=su,Qc.len=au,Qc.sqrLen=lu;var cu=function(){var e=tu();return function(t,n,i,r,o,s){var a,l;for(n||(n=4),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,a=i;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function uu(e){return uu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uu(e)}Qc.forEach=cu,Object.defineProperty(Lc,"__esModule",{value:!0}),Lc.create=gu,Lc.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Lc.setAxisAngle=yu,Lc.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>hu.EPSILON?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},Lc.getAngle=function(e,t){var n=Eu(e,t);return Math.acos(2*n*n-1)},Lc.multiply=vu,Lc.rotateX=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+s*a,e[1]=r*l+o*a,e[2]=o*l-r*a,e[3]=s*l-i*a,e},Lc.rotateY=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l-o*a,e[1]=r*l+s*a,e[2]=o*l+i*a,e[3]=s*l-r*a,e},Lc.rotateZ=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},Lc.calculateW=function(e,t){var n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e},Lc.exp=xu,Lc.ln=bu,Lc.pow=function(e,t,n){return bu(e,t),Su(e,e,n),xu(e,e),e},Lc.slerp=wu,Lc.random=function(e){var t=hu.RANDOM(),n=hu.RANDOM(),i=hu.RANDOM(),r=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*n),e[1]=r*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*i),e[3]=o*Math.cos(2*Math.PI*i),e},Lc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o,a=s?1/s:0;return e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=o*a,e},Lc.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Lc.fromMat3=Tu,Lc.fromEuler=function(e,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=o*l*u-s*a*c,e[1]=s*a*u+o*l*c,e[2]=s*l*c-o*a*u,e[3]=s*l*u+o*a*c,e},Lc.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Lc.setAxes=Lc.sqlerp=Lc.rotationTo=Lc.equals=Lc.exactEquals=Lc.normalize=Lc.sqrLen=Lc.squaredLength=Lc.len=Lc.length=Lc.lerp=Lc.dot=Lc.scale=Lc.mul=Lc.add=Lc.set=Lc.copy=Lc.fromValues=Lc.clone=void 0;var hu=_u(tc),du=_u(yc),pu=_u(Oc),fu=_u(Qc);function mu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(mu=function(e){return e?n:t})(e)}function _u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==uu(e)&&"function"!=typeof e)return{default:e};var n=mu(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function gu(){var e=new hu.ARRAY_TYPE(4);return hu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function yu(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function vu(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+s*a+r*c-o*l,e[1]=r*u+s*l+o*a-i*c,e[2]=o*u+s*c+i*l-r*a,e[3]=s*u-i*a-r*l-o*c,e}function xu(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=Math.sqrt(n*n+i*i+r*r),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return e[0]=n*l,e[1]=i*l,e[2]=r*l,e[3]=a*Math.cos(s),e}function bu(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=Math.sqrt(n*n+i*i+r*r),a=s>0?Math.atan2(s,o)/s:0;return e[0]=n*a,e[1]=i*a,e[2]=r*a,e[3]=.5*Math.log(n*n+i*i+r*r+o*o),e}function wu(e,t,n,i){var r,o,s,a,l,c=t[0],u=t[1],h=t[2],d=t[3],p=n[0],f=n[1],m=n[2],_=n[3];return(o=c*p+u*f+h*m+d*_)<0&&(o=-o,p=-p,f=-f,m=-m,_=-_),1-o>hu.EPSILON?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-i)*r)/s,l=Math.sin(i*r)/s):(a=1-i,l=i),e[0]=a*c+l*p,e[1]=a*u+l*f,e[2]=a*h+l*m,e[3]=a*d+l*_,e}function Tu(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,e[0]=(t[5]-t[7])*(n=.5/n),e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*s+s]+1),e[r]=.5*n,e[3]=(t[3*o+s]-t[3*s+o])*(n=.5/n),e[o]=(t[3*o+r]+t[3*r+o])*n,e[s]=(t[3*s+r]+t[3*r+s])*n}return e}Lc.clone=fu.clone,Lc.fromValues=fu.fromValues,Lc.copy=fu.copy,Lc.set=fu.set,Lc.add=fu.add,Lc.mul=vu;var Su=fu.scale;Lc.scale=Su;var Eu=fu.dot;Lc.dot=Eu,Lc.lerp=fu.lerp;var Cu=fu.length;Lc.length=Cu,Lc.len=Cu;var Au=fu.squaredLength;Lc.squaredLength=Au,Lc.sqrLen=Au;var Iu=fu.normalize;Lc.normalize=Iu,Lc.exactEquals=fu.exactEquals,Lc.equals=fu.equals;var Mu,ku,Pu,Du=(Mu=pu.create(),ku=pu.fromValues(1,0,0),Pu=pu.fromValues(0,1,0),function(e,t,n){var i=pu.dot(t,n);return i<-.999999?(pu.cross(Mu,ku,t),pu.len(Mu)<1e-6&&pu.cross(Mu,Pu,t),pu.normalize(Mu,Mu),yu(e,Mu,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(pu.cross(Mu,t,n),e[0]=Mu[0],e[1]=Mu[1],e[2]=Mu[2],e[3]=1+i,Iu(e,e))});Lc.rotationTo=Du;var Ru,zu,Lu=(Ru=gu(),zu=gu(),function(e,t,n,i,r,o){return wu(Ru,t,r,o),wu(zu,n,i,o),wu(e,Ru,zu,2*o*(1-o)),e});Lc.sqlerp=Lu;var Ou,Fu=(Ou=du.create(),function(e,t,n,i){return Ou[0]=n[0],Ou[3]=n[1],Ou[6]=n[2],Ou[1]=i[0],Ou[4]=i[1],Ou[7]=i[2],Ou[2]=-t[0],Ou[5]=-t[1],Ou[8]=-t[2],Iu(e,Tu(e,Ou))});Lc.setAxes=Fu;var Bu={};function Nu(e){return Nu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nu(e)}Object.defineProperty(Bu,"__esModule",{value:!0}),Bu.create=function(){var e=new ju.ARRAY_TYPE(8);return ju.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Bu.clone=function(e){var t=new ju.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Bu.fromValues=function(e,t,n,i,r,o,s,a){var l=new ju.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=n,l[3]=i,l[4]=r,l[5]=o,l[6]=s,l[7]=a,l},Bu.fromRotationTranslationValues=function(e,t,n,i,r,o,s){var a=new ju.ARRAY_TYPE(8);a[0]=e,a[1]=t,a[2]=n,a[3]=i;var l=.5*r,c=.5*o,u=.5*s;return a[4]=l*i+c*n-u*t,a[5]=c*i+u*e-l*n,a[6]=u*i+l*t-c*e,a[7]=-l*e-c*t-u*n,a},Bu.fromRotationTranslation=Hu,Bu.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Bu.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Bu.fromMat4=function(e,t){var n=Uu.create();Vu.getRotation(n,t);var i=new ju.ARRAY_TYPE(3);return Vu.getTranslation(i,t),Hu(e,n,i),e},Bu.copy=Wu,Bu.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Bu.set=function(e,t,n,i,r,o,s,a,l){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e},Bu.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Bu.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Bu.getTranslation=function(e,t){var n=t[4],i=t[5],r=t[6],o=t[7],s=-t[0],a=-t[1],l=-t[2],c=t[3];return e[0]=2*(n*c+o*s+i*l-r*a),e[1]=2*(i*c+o*a+r*s-n*l),e[2]=2*(r*c+o*l+n*a-i*s),e},Bu.translate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=.5*n[0],l=.5*n[1],c=.5*n[2],u=t[4],h=t[5],d=t[6],p=t[7];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=s*a+r*c-o*l+u,e[5]=s*l+o*a-i*c+h,e[6]=s*c+i*l-r*a+d,e[7]=-i*a-r*l-o*c+p,e},Bu.rotateX=function(e,t,n){var i=-t[0],r=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*i+l*o-c*r,d=l*s+u*r+c*i-a*o,p=c*s+u*o+a*r-l*i,f=u*s-a*i-l*r-c*o;return Uu.rotateX(e,t,n),e[4]=h*(s=e[3])+f*(i=e[0])+d*(o=e[2])-p*(r=e[1]),e[5]=d*s+f*r+p*i-h*o,e[6]=p*s+f*o+h*r-d*i,e[7]=f*s-h*i-d*r-p*o,e},Bu.rotateY=function(e,t,n){var i=-t[0],r=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*i+l*o-c*r,d=l*s+u*r+c*i-a*o,p=c*s+u*o+a*r-l*i,f=u*s-a*i-l*r-c*o;return Uu.rotateY(e,t,n),e[4]=h*(s=e[3])+f*(i=e[0])+d*(o=e[2])-p*(r=e[1]),e[5]=d*s+f*r+p*i-h*o,e[6]=p*s+f*o+h*r-d*i,e[7]=f*s-h*i-d*r-p*o,e},Bu.rotateZ=function(e,t,n){var i=-t[0],r=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*i+l*o-c*r,d=l*s+u*r+c*i-a*o,p=c*s+u*o+a*r-l*i,f=u*s-a*i-l*r-c*o;return Uu.rotateZ(e,t,n),e[4]=h*(s=e[3])+f*(i=e[0])+d*(o=e[2])-p*(r=e[1]),e[5]=d*s+f*r+p*i-h*o,e[6]=p*s+f*o+h*r-d*i,e[7]=f*s-h*i-d*r-p*o,e},Bu.rotateByQuatAppend=function(e,t,n){var i=n[0],r=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2],u=t[3];return e[0]=a*s+u*i+l*o-c*r,e[1]=l*s+u*r+c*i-a*o,e[2]=c*s+u*o+a*r-l*i,e[3]=u*s-a*i-l*r-c*o,e[4]=(a=t[4])*s+(u=t[7])*i+(l=t[5])*o-(c=t[6])*r,e[5]=l*s+u*r+c*i-a*o,e[6]=c*s+u*o+a*r-l*i,e[7]=u*s-a*i-l*r-c*o,e},Bu.rotateByQuatPrepend=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+s*a+r*c-o*l,e[1]=r*u+s*l+o*a-i*c,e[2]=o*u+s*c+i*l-r*a,e[3]=s*u-i*a-r*l-o*c,e[4]=i*(u=n[7])+s*(a=n[4])+r*(c=n[6])-o*(l=n[5]),e[5]=r*u+s*l+o*a-i*c,e[6]=o*u+s*c+i*l-r*a,e[7]=s*u-i*a-r*l-o*c,e},Bu.rotateAroundAxis=function(e,t,n,i){if(Math.abs(i)<ju.EPSILON)return Wu(e,t);var r=Math.hypot(n[0],n[1],n[2]);i*=.5;var o=Math.sin(i),s=o*n[0]/r,a=o*n[1]/r,l=o*n[2]/r,c=Math.cos(i),u=t[0],h=t[1],d=t[2],p=t[3];e[0]=u*c+p*s+h*l-d*a,e[1]=h*c+p*a+d*s-u*l,e[2]=d*c+p*l+u*a-h*s,e[3]=p*c-u*s-h*a-d*l;var f=t[4],m=t[5],_=t[6],g=t[7];return e[4]=f*c+g*s+m*l-_*a,e[5]=m*c+g*a+_*s-f*l,e[6]=_*c+g*l+f*a-m*s,e[7]=g*c-f*s-m*a-_*l,e},Bu.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e},Bu.multiply=Zu,Bu.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e},Bu.lerp=function(e,t,n,i){var r=1-i;return Xu(t,n)<0&&(i=-i),e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i,e[3]=t[3]*r+n[3]*i,e[4]=t[4]*r+n[4]*i,e[5]=t[5]*r+n[5]*i,e[6]=t[6]*r+n[6]*i,e[7]=t[7]*r+n[7]*i,e},Bu.invert=function(e,t){var n=Ku(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e},Bu.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Bu.normalize=function(e,t){var n=Ku(t);if(n>0){n=Math.sqrt(n);var i=t[0]/n,r=t[1]/n,o=t[2]/n,s=t[3]/n,a=t[4],l=t[5],c=t[6],u=t[7],h=i*a+r*l+o*c+s*u;e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=(a-i*h)/n,e[5]=(l-r*h)/n,e[6]=(c-o*h)/n,e[7]=(u-s*h)/n}return e},Bu.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Bu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Bu.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=t[0],h=t[1],d=t[2],p=t[3],f=t[4],m=t[5],_=t[6],g=t[7];return Math.abs(n-u)<=ju.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-h)<=ju.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-d)<=ju.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-p)<=ju.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-f)<=ju.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-m)<=ju.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-_)<=ju.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-g)<=ju.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))},Bu.sqrLen=Bu.squaredLength=Bu.len=Bu.length=Bu.dot=Bu.mul=Bu.setReal=Bu.getReal=void 0;var ju=qu(tc),Uu=qu(Lc),Vu=qu(Sc);function Gu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Gu=function(e){return e?n:t})(e)}function qu(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Nu(e)&&"function"!=typeof e)return{default:e};var n=Gu(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function Hu(e,t,n){var i=.5*n[0],r=.5*n[1],o=.5*n[2],s=t[0],a=t[1],l=t[2],c=t[3];return e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=i*c+r*l-o*a,e[5]=r*c+o*s-i*l,e[6]=o*c+i*a-r*s,e[7]=-i*s-r*a-o*l,e}function Wu(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Zu(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[4],l=n[5],c=n[6],u=n[7],h=t[4],d=t[5],p=t[6],f=t[7],m=n[0],_=n[1],g=n[2],y=n[3];return e[0]=i*y+s*m+r*g-o*_,e[1]=r*y+s*_+o*m-i*g,e[2]=o*y+s*g+i*_-r*m,e[3]=s*y-i*m-r*_-o*g,e[4]=i*u+s*a+r*c-o*l+h*y+f*m+d*g-p*_,e[5]=r*u+s*l+o*a-i*c+d*y+f*_+p*m-h*g,e[6]=o*u+s*c+i*l-r*a+p*y+f*g+h*_-d*m,e[7]=s*u-i*a-r*l-o*c+f*y-h*m-d*_-p*g,e}Bu.getReal=Uu.copy,Bu.setReal=Uu.copy,Bu.mul=Zu;var Xu=Uu.dot;Bu.dot=Xu;var Yu=Uu.length;Bu.length=Yu,Bu.len=Yu;var Ku=Uu.squaredLength;Bu.squaredLength=Ku,Bu.sqrLen=Ku;var Qu={};function Ju(e){return Ju="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ju(e)}Object.defineProperty(Qu,"__esModule",{value:!0}),Qu.create=th,Qu.clone=function(e){var t=new $u.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},Qu.fromValues=function(e,t){var n=new $u.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},Qu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},Qu.set=function(e,t,n){return e[0]=t,e[1]=n,e},Qu.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},Qu.subtract=nh,Qu.multiply=ih,Qu.divide=rh,Qu.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},Qu.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},Qu.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},Qu.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},Qu.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},Qu.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},Qu.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e},Qu.distance=oh,Qu.squaredDistance=sh,Qu.length=ah,Qu.squaredLength=lh,Qu.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},Qu.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},Qu.normalize=function(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e},Qu.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},Qu.cross=function(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e},Qu.lerp=function(e,t,n,i){var r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e},Qu.random=function(e,t){t=t||1;var n=2*$u.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},Qu.transformMat2=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e},Qu.transformMat2d=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e},Qu.transformMat3=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e},Qu.transformMat4=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e},Qu.rotate=function(e,t,n,i){var r=t[0]-n[0],o=t[1]-n[1],s=Math.sin(i),a=Math.cos(i);return e[0]=r*a-o*s+n[0],e[1]=r*s+o*a+n[1],e},Qu.angle=function(e,t){var n=e[0],i=e[1],r=t[0],o=t[1],s=Math.sqrt(n*n+i*i)*Math.sqrt(r*r+o*o);return Math.acos(Math.min(Math.max(s&&(n*r+i*o)/s,-1),1))},Qu.zero=function(e){return e[0]=0,e[1]=0,e},Qu.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},Qu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Qu.equals=function(e,t){var n=e[0],i=e[1],r=t[0],o=t[1];return Math.abs(n-r)<=$u.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-o)<=$u.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))},Qu.forEach=Qu.sqrLen=Qu.sqrDist=Qu.dist=Qu.div=Qu.mul=Qu.sub=Qu.len=void 0;var $u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Ju(e)&&"function"!=typeof e)return{default:e};var n=eh(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(tc);function eh(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(eh=function(e){return e?n:t})(e)}function th(){var e=new $u.ARRAY_TYPE(2);return $u.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function nh(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function ih(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function rh(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function oh(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function sh(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function ah(e){return Math.hypot(e[0],e[1])}function lh(e){var t=e[0],n=e[1];return t*t+n*n}Qu.len=ah,Qu.sub=nh,Qu.mul=ih,Qu.div=rh,Qu.dist=oh,Qu.sqrDist=sh,Qu.sqrLen=lh;var ch=function(){var e=th();return function(t,n,i,r,o,s){var a,l;for(n||(n=2),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,a=i;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}();function uh(e){return uh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uh(e)}Qu.forEach=ch,Object.defineProperty(ec,"__esModule",{value:!0});var hh=ec.vec4=Eh=ec.vec3=ec.vec2=ec.quat2=bh=ec.quat=vh=ec.mat4=gh=ec.mat3=ec.mat2d=fh=ec.mat2=ec.glMatrix=void 0,dh=Ih(tc);ec.glMatrix=dh;var ph=Ih(sc),fh=ec.mat2=ph,mh=Ih(dc);ec.mat2d=mh;var _h=Ih(yc),gh=ec.mat3=_h,yh=Ih(Sc),vh=ec.mat4=yh,xh=Ih(Lc),bh=ec.quat=xh,wh=Ih(Bu);ec.quat2=wh;var Th=Ih(Qu);ec.vec2=Th;var Sh=Ih(Oc),Eh=ec.vec3=Sh,Ch=Ih(Qc);function Ah(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ah=function(e){return e?n:t})(e)}function Ih(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==uh(e)&&"function"!=typeof e)return{default:e};var n=Ah(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}hh=ec.vec4=Ch;const Mh=ba([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:kh}=Mh,Ph=ba([{name:"a_pos_3",components:3,type:"Int16"}]);var Dh=ba([{name:"a_pos",type:"Int16",components:2}]),Rh={};!function(e,t){!function(e){function t(e,t,i){var r=n(256*e,256*(t=Math.pow(2,i)-t-1),i),o=n(256*(e+1),256*(t+1),i);return r[0]+","+r[1]+","+o[0]+","+o[1]}function n(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}e.getURL=function(e,n,i,r,o,s){return s=s||{},e+"?"+["bbox="+t(i,r,o),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+n].join("&")},e.getTileBBox=t,e.getMercCoords=n,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,Rh);var zh=Rh;class Lh{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=Bh(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=zh.getTileBBox(this.x,this.y,this.z),i=function(e,t,n){let i,r="";for(let o=e;o>0;o--)i=1<<o-1,r+=(t&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",n)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class Oh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Bh(e,t.z,t.z,t.x,t.y)}}class Fh{constructor(e,t,n,i,r){this.overscaledZ=e,this.wrap=t,this.canonical=new Lh(n,+i,+r),this.key=0===t&&e===n?this.canonical.key:Bh(t,e,n,i,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Fh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Bh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Bh(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Fh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Fh(t,this.wrap,t,n,i),new Fh(t,this.wrap,t,n+1,i),new Fh(t,this.wrap,t,n,i+1),new Fh(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Fh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Fh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oh(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function Bh(e,t,n,i,r){const o=1<<Math.min(n,22);let s=o*(r%o)+i%o;return e&&n<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*s+n)+(t-n)}const Nh=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new Fh(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new Fh(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new Fh(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new Fh(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Is(Lh,"CanonicalTileID"),Is(Fh,"OverscaledTileID",{omit:["projMatrix"]});class jh{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const i=Eh.dot(t,this.dir);if(Math.abs(i)<1e-6)return!1;const r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/i;return n[0]=this.pos[0]+this.dir[0]*r,n[1]=this.pos[1]+this.dir[1]*r,n[2]=this.pos[2]+this.dir[2]*r,!0}closestPointOnSphere(e,t,n){if(Eh.equals(this.pos,e)||0===t)return n[0]=n[1]=n[2]=0,!1;const[i,r,o]=this.dir,s=this.pos[0]-e[0],a=this.pos[1]-e[1],l=this.pos[2]-e[2],c=i*i+r*r+o*o,u=2*(s*i+a*r+l*o),h=u*u-4*c*(s*s+a*a+l*l-t*t);if(h<0){const e=Math.max(-u/2,0),c=s+i*e,h=a+r*e,d=l+o*e,p=Math.hypot(c,h,d);return n[0]=c*t/p,n[1]=h*t/p,n[2]=d*t/p,!1}{const e=(-u-Math.sqrt(h))/(2*c);if(e<0){const e=Math.hypot(s,a,l);return n[0]=s*t/e,n[1]=a*t/e,n[2]=l*t/e,!1}return n[0]=s+i*e,n[1]=a+r*e,n[2]=l+o*e,!0}}}class Uh{constructor(e,t,n,i,r){this.TL=e,this.TR=t,this.BR=n,this.BL=i,this.horizon=r}static fromInvProjectionMatrix(e,t,n){const i=[-1,1,1],r=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=Eh.transformMat4(i,i,e),l=Eh.transformMat4(r,r,e),c=Eh.transformMat4(o,o,e),u=Eh.transformMat4(s,s,e);return new Uh(a,l,c,u,t/n)}}function Vh(e,t,n){let i=1/0,r=-1/0;const o=[];for(const s of e){Eh.sub(o,s,t);const e=Eh.dot(o,n);i=Math.min(i,e),r=Math.max(r,e)}return[i,r]}function Gh(e,t){let n=!0;for(let i=0;i<e.planes.length;i++){const r=e.planes[i];let o=0;for(let e=0;e<t.length;e++)o+=Eh.dot(r,t[e])+r[3]>=0;if(0===o)return 0;o!==t.length&&(n=!1)}return n?2:1}function qh(e,t){for(const n of e.projections){const i=Vh(t,e.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function Hh(e,t){let n=0;const i=[0,0,0,0];for(let r=0;r<e.length;r++)i[0]=e[r][0],i[1]=e[r][1],i[2]=e[r][2],i[3]=1,hh.dot(i,t)>=0&&n++;return n}class Wh{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=Zh.fromPoints(this.points),this.projections=[],this.frustumEdges=[Eh.sub([],this.points[2],this.points[3]),Eh.sub([],this.points[0],this.points[3]),Eh.sub([],this.points[4],this.points[0]),Eh.sub([],this.points[5],this.points[1]),Eh.sub([],this.points[6],this.points[2]),Eh.sub([],this.points[7],this.points[3])];for(const n of this.frustumEdges){const e=[0,-n[2],n[1]],t=[n[2],0,-n[0]];this.projections.push({axis:e,projection:Vh(this.points,this.points[0],e)}),this.projections.push({axis:t,projection:Vh(this.points,this.points[0],t)})}}static fromInvProjectionMatrix(e,t,n,i){const r=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((n=>{const o=hh.transformMat4([],n,e),s=1/o[3]/t*r;return hh.mul(o,o,[s,s,i?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=Eh.sub([],o[e[0]],o[e[1]]),n=Eh.sub([],o[e[2]],o[e[1]]),i=Eh.normalize([],Eh.cross([],t,n)),r=-Eh.dot(i,o[e[1]]);return i.concat(r)})),a=[];for(let l=0;l<o.length;l++)a.push([o[l][0],o[l][1],o[l][2]]);return new Wh(a,s)}intersectsPrecise(e,t,n){for(let i=0;i<t.length;i++)if(!Hh(e,t[i]))return 0;for(let i=0;i<this.planes.length;i++)if(!Hh(e,this.planes[i]))return 0;for(const i of n)for(const t of this.frustumEdges){const n=Eh.cross([],i,t),r=Eh.length(n);if(0===r)continue;Eh.scale(n,n,1/r);const o=Vh(this.points,this.points[0],n),s=Vh(e,this.points[0],n);if(o[0]>s[1]||s[0]>o[1])return 0}return 1}}class Zh{static fromPoints(e){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const i of e)Eh.min(t,t,i),Eh.max(n,n,i);return new Zh(t,n)}static fromTileIdAndHeight(e,t,n){const i=1<<e.canonical.z,r=e.canonical.x,o=e.canonical.y;return new Zh([r/i,o/i,t],[(r+1)/i,(o+1)/i,n])}static applyTransform(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)Eh.transformMat4(n[i],n[i],t);return Zh.fromPoints(n)}static projectAabbCorners(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)Eh.transformMat4(n[i],n[i],t);return n}constructor(e,t){this.min=e,this.max=t,this.center=Eh.scale([],Eh.add([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=Eh.clone(this.min),i=Eh.clone(this.max);for(let r=0;r<t.length;r++)n[r]=t[r]?this.min[r]:this.center[r],i[r]=t[r]?this.center[r]:this.max[r];return i[2]=this.max[2],new Zh(n,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Gh(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Gh(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?qh(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?qh(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Is(Zh,"Aabb");const Xh=5,Yh=6,Kh=ai/Math.PI/2,Qh=16383,Jh=64,$h=[Jh,32,16],ed=-Kh,td=Kh,nd=[new Zh([ed,ed,ed],[td,td,td]),new Zh([ed,ed,ed],[0,0,td]),new Zh([0,ed,ed],[td,0,td]),new Zh([ed,0,ed],[0,td,td]),new Zh([0,0,ed],[td,td,td])];function id(e){return e*Kh/Od}function rd(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=Eh.scale([],e._camera.position,e.worldSize),o=[t,n,1,1];hh.transformMat4(o,o,e.pixelMatrixInverse),hh.scale(o,o,1/o[3]);const s=Eh.sub([],o,r),a=Eh.normalize([],s),l=e.globeMatrix,c=[l[12],l[13],l[14]],u=Eh.sub([],c,r),h=Eh.length(u),d=Eh.normalize([],u),p=e.worldSize/(2*Math.PI),f=Eh.dot(d,a),m=Math.asin(p/h);if(m<Math.acos(f)){if(!i)return null;const e=[],t=[];Eh.scale(e,a,h/f),Eh.normalize(t,Eh.sub(t,e,u)),Eh.normalize(a,Eh.add(a,u,Eh.scale(a,t,Math.tan(m)*h)))}const _=[];new jh(r,a).closestPointOnSphere(c,p,_);const g=Eh.normalize([],re(l,0)),y=Eh.normalize([],re(l,1)),v=Eh.normalize([],re(l,2)),x=Eh.dot(g,_),b=Eh.dot(y,_),w=Eh.dot(v,_),S=T(Math.asin(-b/p));let E=T(Math.atan2(x,w));E=e.center.lng+function(e,t){const n=(t-e+180)%360-180;return n<-180?n+360:n}(e.center.lng,E);const C=Gd(E),A=k(qd(S),0,1);return new ep(C,A)}class od{constructor(e,t,n){this.a=Eh.sub([],e,n),this.b=Eh.sub([],t,n),this.center=n;const i=Eh.normalize([],this.a),r=Eh.normalize([],this.b);this.angle=Math.acos(Eh.dot(i,r))}}function sd(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(e,t,n,i){const r=Math.sin(n);return e*(Math.sin((1-i)*n)/r)+t*(Math.sin(i*n)/r)}(e.a[t],e.b[t],e.angle,k(n,0,1))+e.center[t]}function ad(e){if(e.z<=1)return nd[e.z+2*e.y+e.x];const t=pd(dd(e));return Zh.fromPoints(t)}function ld(e,t,n){return Eh.scale(e,e,1-n),Eh.scaleAndAdd(e,e,t,n)}function cd(e,t){const n=Sd(t.zoom);if(0===n)return ad(e);const i=dd(e),r=pd(i),o=Gd(i.getWest())*t.worldSize,s=Gd(i.getEast())*t.worldSize,a=qd(i.getNorth())*t.worldSize,l=qd(i.getSouth())*t.worldSize,c=[o,a,0],u=[s,a,0],h=[o,l,0],d=[s,l,0],p=vh.invert([],t.globeMatrix);return Eh.transformMat4(c,c,p),Eh.transformMat4(u,u,p),Eh.transformMat4(h,h,p),Eh.transformMat4(d,d,p),r[0]=ld(r[0],h,n),r[1]=ld(r[1],d,n),r[2]=ld(r[2],u,n),r[3]=ld(r[3],c,n),Zh.fromPoints(r)}function ud(e,t,n){for(const i of e)Eh.transformMat4(i,i,t),Eh.scale(i,i,n)}function hd(e,t,n,i){const r=t/e.worldSize,o=e.globeMatrix;if(n.z<=1){const e=ad(n).getCorners();return ud(e,o,r),Zh.fromPoints(e)}const s=dd(n,i),a=pd(s);ud(a,o,r);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(s.contains(e.center)){for(const e of a)Eh.min(u,u,e),Eh.max(c,c,e);c[2]=0;const t=e.point,n=[t.x*r,t.y*r,0];return Eh.min(u,u,n),Eh.max(c,c,n),new Zh(u,c)}const h=[o[12]*r,o[13]*r,o[14]*r],d=s.getCenter(),p=k(e.center.lat,-Yd,Yd),f=k(d.lat,-Yd,Yd),m=Gd(e.center.lng),_=qd(p);let g=m-Gd(d.lng);const y=_-qd(f);g>.5?g-=1:g<-.5&&(g+=1);let v=0;if(Math.abs(g)>Math.abs(y))v=g>=0?1:3;else{v=y>=0?0:2;const e=[o[4]*r,o[5]*r,o[6]*r],t=-Math.sin(w(y>=0?s.getSouth():s.getNorth()))*Kh;Eh.scaleAndAdd(h,h,e,t)}const x=a[v],b=a[(v+1)%4],T=new od(x,b,h),S=[sd(T,0)||x[0],sd(T,1)||x[1],sd(T,2)||x[2]],E=Sd(e.zoom);if(E>0){const i=function(e,t,n,i,r){let{x:o,y:s,z:a}=e;const l=1/(1<<a);let c=o*l,u=c+l,h=s*l,d=h+l,p=0;const f=(c+u)/2-i;return f>.5?p=-1:f<-.5&&(p=1),c=((c+p)*t-(i*=t))*n+i,u=((u+p)*t-i)*n+i,h=(h*t-(r*=t))*n+r,d=(d*t-r)*n+r,[[c,d,0],[u,d,0],[u,h,0],[c,h,0]]}(n,t,e._pixelsPerMercatorPixel,m,_);for(let e=0;e<a.length;e++)ld(a[e],i[e],E);const r=Eh.add([],i[v],i[(v+1)%4]);Eh.scale(r,r,.5),ld(S,r,E)}for(const w of a)Eh.min(u,u,w),Eh.max(c,c,w);return u[2]=Math.min(x[2],b[2]),Eh.min(u,u,S),Eh.max(c,c,S),new Zh(u,c)}function dd(e){let{x:t,y:n,z:i}=e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=1/(1<<i),s=new Nd(Wd(t*o),n===(1<<i)-1&&r?-90:Zd((n+1)*o)),a=new Nd(Wd((t+1)*o),0===n&&r?90:Zd(n*o));return new $l(s,a)}function pd(e){const t=w(e.getNorth()),n=w(e.getSouth()),i=Math.cos(t),r=Math.cos(n),o=Math.sin(t),s=Math.sin(n),a=e.getWest(),l=e.getEast();return[fd(r,s,a),fd(r,s,l),fd(i,o,l),fd(i,o,a)]}function fd(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Kh;return n=w(n),[e*Math.sin(n)*i,-t*i,e*Math.cos(n)*i]}function md(e,t,n){return fd(Math.cos(w(e)),Math.sin(w(e)),t,n)}function _d(e,t,n,i){const r=1<<n.z,o=(e/ai+n.x)/r;return md(Zd((t/ai+n.y)/r),Wd(o),i)}function gd(e){let{min:t,max:n}=e;return Qh/Math.max(n[0]-t[0],n[1]-t[1],n[2]-t[2])}const yd=new Float64Array(16);function vd(e){const t=gd(e),n=vh.fromScaling(yd,[t,t,t]);return vh.translate(n,n,Eh.negate([],e.min))}function xd(e){const t=vh.fromTranslation(yd,e.min),n=1/gd(e);return vh.scale(t,t,[n,n,n])}function bd(e){const t=ai/(2*Math.PI);return e/(2*Math.PI)/t}function wd(e,t){return ai/(512*Math.pow(2,e))*gd(ad(t))}function Td(e,t,n,i,r){const o=bd(n),s=[e,t,-n/(2*Math.PI)],a=vh.identity(new Float64Array(16));return vh.translate(a,a,s),vh.scale(a,a,[o,o,o]),vh.rotateX(a,a,w(-r)),vh.rotateY(a,a,w(-i)),a}function Sd(e){return P(Xh,Yh,e)}function Ed(e,t,n){const i=vh.identity(new Float64Array(16)),r=(t/(1<<e)-.5)*Math.PI*2;return vh.rotateY(i,n.globeMatrix,r),Float32Array.from(i)}function Cd(e,t,n){const i=Sd(n.zoom),r=e.style.map._antialias,o=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===i&&!r&&!o}function Ad(e,t,n,i){const r=t.getNorth(),o=t.getSouth(),s=t.getWest(),a=t.getEast(),l=1<<e.z,c=a-s,u=r-o,h=c/Jh,d=-u/$h[n],p=[0,h,0,d,0,0,r,s,0];if(e.z>0){const e=180/i;gh.multiply(p,p,[e/c+1,0,0,0,e/u+1,0,-.5*e/h,.5*e/d,1])}return p[2]=l,p[5]=e.x,p[8]=e.y,p}function Id(e){const t=Yd-5;e=k(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(w(e))),3);return Math.round(n*($h.length-1))}function Md(e){const t=[0,0,0],n=vh.identity(new Float64Array(16));return vh.multiply(n,e.pixelMatrix,e.globeMatrix),Eh.transformMat4(t,t,n),new y(t[0],t[1])}function kd(e,t){const n=md(t.lat,t.lng),i=function(e){const t=md(e._center.lat,e._center.lng),n=Eh.fromValues(0,1,0);let i=Eh.cross([],n,t);const r=vh.fromRotation([],-e.angle,t);i=Eh.transformMat4(i,i,r),vh.fromRotation(r,-e._pitch,i);const o=Eh.normalize([],t);return Eh.scale(o,o,id(e.cameraToCenterDistance/e.pixelsPerMeter)),Eh.transformMat4(o,o,r),Eh.add([],t,o)}(e),r=Eh.subtract([],i,n);return Eh.angle(r,n)}function Pd(e,t){return kd(e,t)>Math.PI/2*1.01}const Dd=w(85),Rd=Math.cos(Dd),zd=Math.sin(Dd);class Ld{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const n=new Ta,i=new Ua,r=[],o=e+1+2,s=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,n)=>{let i=e===o-1?e-2:0===e?e:e-1;return i+=n?24575:0,[i,t]};for(let c=0;c<o;++c)n.emplaceBack(...l(c,0,!0));for(let c=0;c<s;++c)for(let e=0;e<o;++e)n.emplaceBack(...l(e,c,(0===e||e===o-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<o;++t)n.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=i.length,s=t[c]+1+2,l=new Ua;for(let n=0;n<s-1;n++){const e=n===s-2,r=e?o*(a-t.length+c-n):o;for(let t=0;t<o-1;t++){const s=n*o+t;0===n||e||0===t||t===o-2?(l.emplaceBack(s+1,s,s+r),l.emplaceBack(s+r,s+r+1,s+1)):(i.emplaceBack(s+1,s,s+r),i.emplaceBack(s+r,s+r+1,s+1))}}const u=dl.simpleSegment(0,e,n.length,i.length-e);for(let t=0;t<l.uint16.length;t+=3)i.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const h=dl.simpleSegment(0,e,n.length,i.length-e);r.push({withoutSkirts:u,withSkirts:h})}return{vertices:n,indices:i,segments:r}}_createGrid(e){const t=this._fillGridMeshWithLods(Jh,$h);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Dh.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Ua;for(let s=0;s<=Jh;s++)t.emplaceBack(0,s+1,s+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const n=new Ha,i=new Ha,r=new Ha,o=new Ha;this._poleSegments=[];for(let s=0,a=0;s<Xh;s++){const e=360/(1<<s);n.emplaceBack(0,-Kh,0,.5,0),i.emplaceBack(0,-Kh,0,.5,1),r.emplaceBack(0,-Kh,0,.5,.5),o.emplaceBack(0,-Kh,0,.5,.5);for(let t=0;t<=Jh;t++){let s=t/Jh,a=0;const l=Yi(0,e,s),[c,u,h]=fd(Rd,zd,l,Kh);n.emplaceBack(c,u,h,s,a),i.emplaceBack(c,u,h,s,1-a);const d=w(l);s=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),r.emplaceBack(c,u,h,s,a),o.emplaceBack(c,u,h,s,1-a)}this._poleSegments.push(dl.simpleSegment(a,0,66,64)),a+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(n,kh,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(i,kh,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(r,kh,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,kh,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}const Od=6371008.8,Fd=2*Math.PI*Od;class Bd{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(t,")"));if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Bd(D(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Od*Math.acos(Math.min(r,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new $l(new Bd(this.lng-t,this.lat-e),new Bd(this.lng+t,this.lat+e))}toEcef(e){const t=id(e);return md(this.lat,this.lng,Kh+t)}static convert(e){if(e instanceof Bd)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Bd(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Bd(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Nd=Bd;const jd=0,Ud=25.5;function Vd(e){return Fd*Math.cos(e*Math.PI/180)}function Gd(e){return(180+e)/360}function qd(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Hd(e,t){return e/Vd(t)}function Wd(e){return 360*e-180}function Zd(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Xd(e,t){return e*Vd(Zd(t))}const Yd=85.051129;function Kd(e){return Math.cos(w(k(e,-Yd,Yd)))}function Qd(e,t){const n=k(t,jd,Ud),i=Math.pow(2,n);return Kd(e)*Fd/(512*i)}function Jd(e){return 1/Math.cos(e*Math.PI/180)}function $d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Math.exp(Math.PI*(1-(e.y+t/ai)/(1<<e.z)*2));return 80150034*n/(n*n+1)/ai/(1<<e.z)}class ep{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Nd.convert(e);return new ep(Gd(n.lng),qd(n.lat),Hd(t,n.lat))}toLngLat(){return new Nd(Wd(this.x),Zd(this.y))}toAltitude(){return Xd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Fd*Jd(Zd(this.y))}}function tp(e,t,n,i,r,o,s,a,l){const c=(t+i)/2,u=(n+r)/2,h=new y(c,u);a(h),function(e,t,n,i,r,o){const s=n-r,a=i-o;return Math.abs((i-t)*s-(n-e)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(tp(e,t,n,c,u,o,h,a,l),tp(e,c,u,i,r,h,s,a,l)):e.push(s)}function np(e,t,n){let i=e[0],r=i.x,o=i.y;t(i);const s=[i];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),tp(s,r,o,c,u,i,l,t,n),r=c,o=u,i=l}return s}function ip(e,t,n,i){if(i(t,n)){const r=t.add(n)._mult(.5);ip(e,t,r,i),ip(e,r,n,i)}else e.push(n)}function rp(e,t){let n=e[0];const i=[n];for(let r=1;r<e.length;r++){const o=e[r];ip(i,n,o,t),n=o}return i}const op=Math.pow(2,14)-1,sp=-op-1;function ap(e,t){const n=Math.round(e.x*t),i=Math.round(e.y*t);return e.x=k(n,sp,op),e.y=k(i,sp,op),(n<e.x||n>e.x+1||i<e.y||i>e.y+1)&&X("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function lp(e,t,n){const i=e.loadGeometry(),r=e.extent,o=ai/r;if(t&&n&&n.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=n,u=e=>{const n=Wd((t.x+e.x/r)/o),i=Zd((t.y+e.y/r)/o),u=c.project(n,i);e.x=(u.x*s-a)*r,e.y=(u.y*s-l)*r};for(let t=0;t<i.length;t++)if(1!==e.type)i[t]=np(i[t],u,1);else{const e=[];for(const n of i[t])n.x<0||n.x>=r||n.y<0||n.y>=r||(u(n),e.push(n));i[t]=e}}for(const s of i)for(const e of s)ap(e,o);return i}function cp(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?lp(e):[]}}function up(e,t,n,i,r){e.emplaceBack(2*t+(i+1)/2,2*n+(r+1)/2)}function hp(e,t,n){const i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}class dp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ta,this.indexArray=new Ua,this.segments=new dl,this.programConfigurations=new Zl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n,i){const r=this.layers[0],o=[];let s=null;"circle"===r.type&&(s=r.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:u,sourceLayerIndex:h}of e){const e=this.layers[0]._featureFilter.needGeometry,t=cp(l,e);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),t,n))continue;const r=s?s.evaluate(t,{},n):void 0,a={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:e?t.geometry:lp(l,n,i),patterns:{},sortKey:r};o.push(a)}s&&o.sort(((e,t)=>e.sortKey-t.sortKey));let a=null;"globe"===i.projection.name&&(this.globeExtVertexArray=new Pa,a=i.projection);for(const l of o){const{geometry:i,index:r,sourceLayerIndex:o}=l,s=e[r].feature;this.addFeature(l,i,r,t.availableImages,n,a,t.brightness),t.featureIndex.insert(s,i,r,o,this.index)}}update(e,t,n,i,r){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ul.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hl.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,n,i,r,o,s){for(const a of t)for(const t of a){const n=t.x,i=t.y;if(n<0||n>=ai||i<0||i>=ai)continue;if(o){const e=o.projectTilePoint(n,i,r),t=o.upVector(r,n,i),s=this.globeExtVertexArray;hp(s,e,t),hp(s,e,t),hp(s,e,t),hp(s,e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;up(this.layoutVertexArray,n,i,-1,-1),up(this.layoutVertexArray,n,i,1,-1),up(this.layoutVertexArray,n,i,1,1),up(this.layoutVertexArray,n,i,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i,r,s)}}function pp(e,t){for(let n=0;n<e.length;n++)if(wp(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(wp(e,t[n]))return!0;return!!gp(e,t)}function fp(e,t,n){return!!wp(e,t)||!!vp(t,e,n)}function mp(e,t){if(1===e.length)return bp(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)if(wp(e,i[t]))return!0}for(let n=0;n<e.length;n++)if(bp(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(gp(e,t[n]))return!0;return!1}function _p(e,t,n){if(e.length>1){if(gp(e,t))return!0;for(let i=0;i<t.length;i++)if(vp(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(vp(e[i],t,n))return!0;return!1}function gp(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)if(yp(i,r,t[e],t[e+1]))return!0}return!1}function yp(e,t,n,i){return Y(e,n,i)!==Y(t,n,i)&&Y(e,t,n)!==Y(e,t,i)}function vp(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let r=1;r<t.length;r++)if(xp(e,t[r-1],t[r])<i)return!0;return!1}function xp(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function bp(e,t){let n,i,r,o=!1;for(let s=0;s<e.length;s++){n=e[s];for(let e=0,s=n.length-1;e<n.length;s=e++)i=n[e],r=n[s],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(o=!o)}return o}function wp(e,t){let n=!1;for(let i=0,r=e.length-1;i<e.length;r=i++){const o=e[i],s=e[r];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function Tp(e,t,n,i,r){for(const s of e)if(t<=s.x&&n<=s.y&&i>=s.x&&r>=s.y)return!0;const o=[new y(t,n),new y(t,r),new y(i,r),new y(i,n)];if(e.length>2)for(const s of o)if(wp(e,s))return!0;for(let s=0;s<e.length-1;s++)if(Sp(e[s],e[s+1],o))return!0;return!1}function Sp(e,t,n){const i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;const o=Y(e,t,n[0]);return o!==Y(e,t,n[1])||o!==Y(e,t,n[2])||o!==Y(e,t,n[3])}function Ep(e,t,n,i,r,o){let s=t.y-e.y,a=e.x-t.x;if(o=o||0){const e=s*s+a*a;if(0===e)return!0;const t=Math.sqrt(e);s/=t,a/=t}return!((n.x-e.x)*s+(n.y-e.y)*a-o<0||(i.x-e.x)*s+(i.y-e.y)*a-o<0||(r.x-e.x)*s+(r.y-e.y)*a-o<0)}function Cp(e,t,n,i,r,o,s){return!(Ep(e,t,i,r,o,s)||Ep(t,n,i,r,o,s)||Ep(n,e,i,r,o,s)||Ep(i,r,e,t,n,s)||Ep(r,o,e,t,n,s)||Ep(o,i,e,t,n,s))}function Ap(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Ip(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Mp(e,t,n,i,r){if(!t[0]&&!t[1])return e;const o=y.convert(t)._mult(r);"viewport"===n&&o._rotate(-i);const s=[];for(let a=0;a<e.length;a++)s.push(e[a].sub(o));return s}function kp(e,t,n,i){const r=y.convert(e)._mult(i);return"viewport"===t&&r._rotate(-n),r}Is(dp,"CircleBucket",{omit:["layers"]});const Pp=new da({"circle-sort-key":new ua(Mt.layout_circle["circle-sort-key"]),visibility:new ca(Mt.layout_circle.visibility)});var Dp={paint:new da({"circle-radius":new ua(Mt.paint_circle["circle-radius"]),"circle-color":new ua(Mt.paint_circle["circle-color"]),"circle-blur":new ua(Mt.paint_circle["circle-blur"]),"circle-opacity":new ua(Mt.paint_circle["circle-opacity"]),"circle-translate":new ca(Mt.paint_circle["circle-translate"]),"circle-translate-anchor":new ca(Mt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ca(Mt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ca(Mt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ua(Mt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ua(Mt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ua(Mt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ca(Mt.paint_circle["circle-emissive-strength"])}),layout:Pp};const Rp=vh.create(),zp=(e,t,n,i,r,o)=>{const s=e.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const e=wd(s.zoom,t.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=s.calculatePixelsToTileUnitsMatrix(n);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(s.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ut.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Rp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=i,c.u_merc_center=r,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Sd(s.zoom);const e=r[0]*ai,n=r[1]*ai;c.u_up_dir=s.projection.upVector(new Lh(0,0,0),e,n)}return c},Lp=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Op(e,t,n,i,r,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=n.projection.upVectorScale(c,n.center.lat,n.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),d=r&&n.elevation?n.elevation.exaggeration()*r.getElevationAt(h.x,h.y,!0):0,p=n.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=n.projection.upVector(c,h.x,h.y);p.x+=e[0]*u*d,p.y+=e[1]*u*d,p.z+=e[2]*u*d}const f=o?h:Fp(p.x,p.y,p.z,i),m=o?e.tilespaceRays.map((e=>jp(e,d))):e.queryGeometry.screenGeometry,_=hh.transformMat4([],[p.x,p.y,p.z,1],i);if(!s&&o?l*=_[3]/n.cameraToCenterDistance:s&&!o&&(l*=n.cameraToCenterDistance/_[3]),o){const e=Zd((t.y/ai+c.y)/(1<<c.z));l/=n.projection.pixelsPerMeter(e,1)/Hd(1,e)}if(fp(m,f,l))return!0}return!1}function Fp(e,t,n,i){const r=hh.transformMat4([],[e,t,n,1],i);return new y(r[0]/r[3],r[1]/r[3])}const Bp=Eh.fromValues(0,0,0),Np=Eh.fromValues(0,0,1);function jp(e,t){const n=Eh.create();return Bp[2]=t,e.intersectsPlane(Bp,Np,n),new y(n[0],n[1])}class Up extends dp{}function Vp(e,t,n,i){let{width:r,height:o}=t;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*o*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*o*n);return e.width=r,e.height=o,e.data=i,e}function Gp(e,t,n){const{width:i,height:r}=t;i===e.width&&r===e.height||(qp(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,i),height:Math.min(e.height,r)},n),e.width=i,e.height=r,e.data=t.data)}function qp(e,t,n,i,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let l=0;l<r.height;l++){const c=((n.y+l)*e.width+n.x)*o,u=((i.y+l)*t.width+i.x)*o;for(let e=0;e<r.width*o;e++)a[u+e]=s[c+e]}return t}Is(Up,"HeatmapBucket",{omit:["layers"]});class Hp{constructor(e,t){Vp(this,e,1,t)}resize(e){Gp(this,new Hp(e),1)}clone(){return new Hp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){qp(e,t,n,i,r,1)}}class Wp{constructor(e,t){Vp(this,e,4,t)}resize(e){Gp(this,new Wp(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Wp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){qp(e,t,n,i,r,4)}}class Zp{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}Is(Hp,"AlphaImage"),Is(Wp,"RGBAImage");const Xp=new da({visibility:new ca(Mt.layout_heatmap.visibility)});var Yp={paint:new da({"heatmap-radius":new ua(Mt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ua(Mt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ca(Mt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ha(Mt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ca(Mt.paint_heatmap["heatmap-opacity"])}),layout:Xp};function Kp(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new Wp({width:n,height:i}),o=(n,i,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);s&&(r.data[n+i+0]=Math.floor(255*s.r/s.a),r.data[n+i+1]=Math.floor(255*s.g/s.a),r.data[n+i+2]=Math.floor(255*s.b/s.a),r.data[n+i+3]=Math.floor(255*s.a))};if(e.clips)for(let s=0,a=0;s<i;++s,a+=4*n)for(let t=0,i=0;t<n;t++,i+=4){const r=t/(n-1),{start:l,end:c}=e.clips[s];o(a,i,l*(1-r)+c*r)}else for(let s=0,a=0;s<n;s++,a+=4)o(0,a,s/(n-1));return r}const Qp=new da({visibility:new ca(Mt.layout_hillshade.visibility)});var Jp={paint:new da({"hillshade-illumination-direction":new ca(Mt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ca(Mt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ca(Mt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ca(Mt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ca(Mt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ca(Mt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ca(Mt.paint_hillshade["hillshade-emissive-strength"])}),layout:Qp};const $p=ba([{name:"a_pos",components:2,type:"Int16"}],4),{members:ef}=$p;var tf={exports:{}};function nf(e,t,n){n=n||2;var i,r,o,s,a,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=rf(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,n,i){var r,o,s,a=[];for(r=0,o=t.length;r<o;r++)(s=rf(e,t[r]*i,r<o-1?t[r+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),a.push(mf(s));for(a.sort(hf),r=0;r<a.length;r++)n=df(a[r],n);return n}(e,t,d,n)),e.length>80*n){i=o=e[0],r=s=e[1];for(var f=n;f<h;f+=n)(a=e[f])<i&&(i=a),(l=e[f+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-i,s-r))?32767/c:0}return sf(d,p,n,i,r,c,0),p}function rf(e,t,n,i,r){var o,s;if(r===If(e,t,n,i)>0)for(o=t;o<n;o+=i)s=Ef(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=Ef(o,e[o],e[o+1],s);return s&&vf(s,s.next)&&(Cf(s),s=s.next),s}function of(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!vf(i,i.next)&&0!==yf(i.prev,i,i.next))i=i.next;else{if(Cf(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function sf(e,t,n,i,r,o,s){if(e){!s&&o&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=ff(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?lf(e,i,r,o):af(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Cf(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?sf(e=cf(of(e),t,n),t,n,i,r,o,2):2===s&&uf(e,t,n,i,r,o):sf(of(e),t,n,i,r,o,1);break}}}function af(e){var t=e.prev,n=e,i=e.next;if(yf(t,n,i)>=0)return!1;for(var r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=i.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&_f(r,a,o,l,s,c,f.x,f.y)&&yf(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function lf(e,t,n,i){var r=e.prev,o=e,s=e.next;if(yf(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,_=u>h?u>d?u:d:h>d?h:d,g=ff(p,f,t,n,i),y=ff(m,_,t,n,i),v=e.prevZ,x=e.nextZ;v&&v.z>=g&&x&&x.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==r&&v!==s&&_f(a,u,l,h,c,d,v.x,v.y)&&yf(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==r&&x!==s&&_f(a,u,l,h,c,d,x.x,x.y)&&yf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=g;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==r&&v!==s&&_f(a,u,l,h,c,d,v.x,v.y)&&yf(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==r&&x!==s&&_f(a,u,l,h,c,d,x.x,x.y)&&yf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function cf(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!vf(r,o)&&xf(r,i,i.next,o)&&Tf(r,o)&&Tf(o,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),Cf(i),Cf(i.next),i=e=o),i=i.next}while(i!==e);return of(i)}function uf(e,t,n,i,r,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&gf(s,a)){var l=Sf(s,a);return s=of(s,s.next),l=of(l,l.next),sf(s,t,n,i,r,o,0),void sf(l,t,n,i,r,o,0)}a=a.next}s=s.next}while(s!==e)}function hf(e,t){return e.x-t.x}function df(e,t){var n=function(e,t){var n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s&&(s=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==t);if(!n)return null;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&_f(o<h?r:s,o,u,h,o<h?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),Tf(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&pf(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(e,t);if(!n)return t;var i=Sf(n,e);return of(i,i.next),of(n,n.next)}function pf(e,t){return yf(e.prev,e,t.prev)<0&&yf(t.next,e,e.next)<0}function ff(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function mf(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function _f(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function gf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&xf(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Tf(e,t)&&Tf(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(yf(e.prev,e,t.prev)||yf(e,t.prev,t))||vf(e,t)&&yf(e.prev,e,e.next)>0&&yf(t.prev,t,t.next)>0)}function yf(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function vf(e,t){return e.x===t.x&&e.y===t.y}function xf(e,t,n,i){var r=wf(yf(e,t,n)),o=wf(yf(e,t,i)),s=wf(yf(n,i,e)),a=wf(yf(n,i,t));return r!==o&&s!==a||!(0!==r||!bf(e,n,t))||!(0!==o||!bf(e,i,t))||!(0!==s||!bf(n,e,i))||!(0!==a||!bf(n,t,i))}function bf(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function wf(e){return e>0?1:e<0?-1:0}function Tf(e,t){return yf(e.prev,e,e.next)<0?yf(e,t,e.next)>=0&&yf(e,e.prev,t)>=0:yf(e,t,e.prev)<0||yf(e,e.next,t)<0}function Sf(e,t){var n=new Af(e.i,e.x,e.y),i=new Af(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Ef(e,t,n,i){var r=new Af(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Cf(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Af(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function If(e,t,n,i){for(var r=0,o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}tf.exports=nf,tf.exports.default=nf,nf.deviation=function(e,t,n,i){var r=t&&t.length,o=Math.abs(If(e,0,r?t[0]*n:e.length,n));if(r)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(If(e,t[s]*n,s<a-1?t[s+1]*n:e.length,n));var l=0;for(s=0;s<i.length;s+=3){var c=i[s]*n,u=i[s+1]*n,h=i[s+2]*n;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},nf.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[r][o][s]);r>0&&n.holes.push(i+=e[r-1].length)}return n};var Mf=d(tf.exports);function kf(e,t){const n=e.length;if(n<=1)return[e];const i=[];let r,o;for(let s=0;s<n;s++){const t=K(e[s]);0!==t&&(e[s].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(r&&i.push(r),r=[e[s]]):r.push(e[s]))}if(r&&i.push(r),t>1)for(let s=0;s<i.length;s++)i[s].length<=t||(On(i[s],t,1,i[s].length-1,Pf),i[s]=i[s].slice(0,t));return i}function Pf(e,t){return t.area-e.area}function Df(e,t,n){const i=n.patternDependencies;let r=!1;for(const o of t){const t=o.paint.get("".concat(e,"-pattern"));t.isConstant()||(r=!0);const n=t.constantOr(null);n&&(r=!0,i[n]=!0)}return r}function Rf(e,t,n,i,r){const o=r.patternDependencies;for(const s of t){const t=s.paint.get("".concat(e,"-pattern")).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i},n,{},r.availableImages);e=e&&e.name?e.name:e,o[e]=!0,n.patterns[s.id]=e}}return n}class zf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ta,this.indexArray=new Ua,this.indexArray2=new La,this.programConfigurations=new Zl(e.layers,e.zoom),this.segments=new dl,this.segments2=new dl,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,n,i){this.hasPattern=Df("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=cp(s,e);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),u,n))continue;const h=r?r.evaluate(u,{},n,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:lp(s,n,i),patterns:{},sortKey:h};o.push(d)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const s of o){const{geometry:i,index:r,sourceLayerIndex:o}=s;if(this.hasPattern){const e=Rf("fill",this.layers,s,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(s,i,r,n,{},t.availableImages,t.brightness);t.featureIndex.insert(e[r].feature,i,r,o,this.index)}}update(e,t,n,i,r){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,i,r)}addFeatures(e,t,n,i,r,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,n,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ef),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=arguments.length>6?arguments[6]:void 0;for(const a of kf(t,500)){let e=0;for(const s of a)e+=s.length;const t=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=t.vertexLength,i=[],r=[];for(const s of a){if(0===s.length)continue;s!==a[0]&&r.push(i.length/2);const e=this.segments2.prepareSegment(s.length,this.layoutVertexArray,this.indexArray2),t=e.vertexLength;this.layoutVertexArray.emplaceBack(s[0].x,s[0].y),this.indexArray2.emplaceBack(t+s.length-1,t),i.push(s[0].x),i.push(s[0].y);for(let n=1;n<s.length;n++)this.layoutVertexArray.emplaceBack(s[n].x,s[n].y),this.indexArray2.emplaceBack(t+n-1,t+n),i.push(s[n].x),i.push(s[n].y);e.vertexLength+=s.length,e.primitiveLength+=s.length}const o=Mf(i,r);for(let s=0;s<o.length;s+=3)this.indexArray.emplaceBack(n+o[s],n+o[s+1],n+o[s+2]);t.vertexLength+=e,t.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,s)}}Is(zf,"FillBucket",{omit:["layers","patternFeatures"]});const Lf=new da({"fill-sort-key":new ua(Mt.layout_fill["fill-sort-key"]),visibility:new ca(Mt.layout_fill.visibility)});var Of={paint:new da({"fill-antialias":new ca(Mt.paint_fill["fill-antialias"]),"fill-opacity":new ua(Mt.paint_fill["fill-opacity"]),"fill-color":new ua(Mt.paint_fill["fill-color"]),"fill-outline-color":new ua(Mt.paint_fill["fill-outline-color"]),"fill-translate":new ca(Mt.paint_fill["fill-translate"]),"fill-translate-anchor":new ca(Mt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ua(Mt.paint_fill["fill-pattern"]),"fill-emissive-strength":new ca(Mt.paint_fill["fill-emissive-strength"])}),layout:Lf};const Ff=ba([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Bf=ba([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Nf=ba([{name:"a_centroid_pos",components:2,type:"Uint16"}]),jf=ba([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Uf=ba([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Vf}=Ff;var Gf={},qf=_,Hf=Wf;function Wf(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(Zf,this,t)}function Zf(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var i=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[i]=r}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function Xf(e){for(var t,n,i=0,r=0,o=e.length,s=o-1;r<o;s=r++)i+=((n=e[s]).x-(t=e[r]).x)*(t.y+n.y);return i}Wf.types=["Unknown","Point","LineString","Polygon"],Wf.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,r=0,o=0,s=0,a=[];e.pos<n;){if(r<=0){var l=e.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)o+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&a.push(t),t=[]),t.push(new qf(o,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&a.push(t),a},Wf.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,i=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(i<=0){var u=e.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)(r+=e.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[s,l,a,c]},Wf.prototype.toGeoJSON=function(e,t,n){var i,r,o=this.extent*Math.pow(2,n),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=Wf.types[this.type];function u(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var n,i,r=[],o=0;o<t;o++){var s=Xf(e[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)u(l[i][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Yf=Hf,Kf=Qf;function Qf(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Jf,this,t),this.length=this._features.length}function Jf(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(n))}Qf.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Yf(this._pbf,t,this.extent,this._keys,this._values)};var $f=Kf;function em(e,t,n){if(3===e){var i=new $f(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}var tm=Gf.VectorTile=function(e,t){this.layers=e.readFields(em,{},t)},nm=Gf.VectorTileFeature=Hf;function im(e,t,n,i){const r=[],o=0===i?(e,t,n,i,r,o)=>{e.push(new y(o,n+(o-t)/(i-t)*(r-n)))}:(e,t,n,i,r,o)=>{e.push(new y(t+(o-n)/(r-n)*(i-t),o))};for(const s of e){const e=[];for(const r of s){if(r.length<=2)continue;const s=[];for(let e=0;e<r.length-1;e++){const a=r[e].x,l=r[e].y,c=r[e+1].x,u=r[e+1].y,h=0===i?a:l,d=0===i?c:u;h<t?d>t&&o(s,a,l,c,u,t):h>n?d<n&&o(s,a,l,c,u,n):s.push(r[e]),d<t&&h>=t&&o(s,a,l,c,u,t),d>n&&h<=n&&o(s,a,l,c,u,n)}let a=r[r.length-1];const l=0===i?a.x:a.y;l>=t&&l<=n&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),e.push(s))}e.length&&r.push(e)}return r}Gf.VectorTileLayer=Kf;class rm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var om={read:function(e,t,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},write:function(e,t,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[n+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*m}},sm=lm,am=om;function lm(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}lm.Varint=0,lm.Fixed64=1,lm.Bytes=2,lm.Fixed32=5;var cm=4294967296,um=1/cm,hm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function dm(e){return e.type===lm.Bytes?e.readVarint()+e.pos:e.pos+1}function pm(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function fm(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function mm(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function _m(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function gm(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function ym(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function vm(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function xm(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function bm(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function wm(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function Tm(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Sm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Em(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Cm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}lm.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,e(r,t,this),this.pos===o&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Sm(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Cm(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Sm(this.buf,this.pos)+Sm(this.buf,this.pos+4)*cm;return this.pos+=8,e},readSFixed64:function(){var e=Sm(this.buf,this.pos)+Cm(this.buf,this.pos+4)*cm;return this.pos+=8,e},readFloat:function(){var e=am.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=am.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(e,t,n){var i,r,o=n.buf;if(i=(112&(r=o[n.pos++]))>>4,r<128)return pm(e,i,t);if(i|=(127&(r=o[n.pos++]))<<3,r<128)return pm(e,i,t);if(i|=(127&(r=o[n.pos++]))<<10,r<128)return pm(e,i,t);if(i|=(127&(r=o[n.pos++]))<<17,r<128)return pm(e,i,t);if(i|=(127&(r=o[n.pos++]))<<24,r<128)return pm(e,i,t);if(i|=(1&(r=o[n.pos++]))<<31,r<128)return pm(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&hm?function(e,t,n){return hm.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var i="",r=t;r<n;){var o,s,a,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[r+2],128==(192&(o=e[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[r+2],a=e[r+3],128==(192&(o=e[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=u}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==lm.Bytes)return e.push(this.readVarint(t));var n=dm(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==lm.Bytes)return e.push(this.readSVarint());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==lm.Bytes)return e.push(this.readBoolean());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==lm.Bytes)return e.push(this.readFloat());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==lm.Bytes)return e.push(this.readDouble());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==lm.Bytes)return e.push(this.readFixed32());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==lm.Bytes)return e.push(this.readSFixed32());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==lm.Bytes)return e.push(this.readFixed64());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==lm.Bytes)return e.push(this.readSFixed64());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===lm.Varint)for(;this.buf[this.pos++]>127;);else if(t===lm.Bytes)this.pos=this.readVarint()+this.pos;else if(t===lm.Fixed32)this.pos+=4;else{if(t!==lm.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Em(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Em(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Em(this.buf,-1&e,this.pos),Em(this.buf,Math.floor(e*um),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Em(this.buf,-1&e,this.pos),Em(this.buf,Math.floor(e*um),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var i,r,o=0;o<t.length;o++){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&fm(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),am.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),am.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&fm(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,lm.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,mm,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,_m,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,vm,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,gm,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ym,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,xm,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,bm,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,wm,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Tm,t)},writeBytesField:function(e,t){this.writeTag(e,lm.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,lm.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,lm.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,lm.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,lm.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,lm.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,lm.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,lm.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,lm.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,lm.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Am=d(sm);const Im=["tile","layer","source","sourceLayer","state"];class Mm{constructor(e,t,n,i,r){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=i,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Im)void 0!==this[t]&&(e[t]=this[t]);return e}}class km{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const i=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},L(this.stateChanges[e][i],n),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==i&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][i]){this.deletedStates[e][i]={};for(const t in this.state[e][i])n[t]||(this.deletedStates[e][i][t]=null)}else for(const r in n)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][r]&&delete this.deletedStates[e][i][r]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),i=L({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const n=this.deletedStates[e][t];if(null===n)return{};for(const e in n)delete i[e]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const e={};for(const t in this.stateChanges[i])this.state[i][t]||(this.state[i][t]={}),L(this.state[i][t],this.stateChanges[i][t]),e[t]=this.state[i][t];n[i]=e}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const e={};if(null===this.deletedStates[i])for(const t in this.state[i])e[t]={},this.state[i][t]={};else for(const t in this.deletedStates[i]){if(null===this.deletedStates[i][t])this.state[i][t]={};else if(this.state[i][t])for(const e of Object.keys(this.deletedStates[i][t]))delete this.state[i][t][e];e[t]=this.state[i][t]}n[i]=n[i]||{},L(n[i],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const i in e)e[i].setFeatureState(n,t)}}class Pm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Dm(e,t,n,i){let r=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(i[s])<1e-15){if(n[s]<e[s]||n[s]>t[s])return null}else{const a=1/i[s];let l=(e[s]-n[s])*a,c=(t[s]-n[s])*a;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function Rm(e,t,n,i,r,o,s,a,l,c,u){const h=i-e,d=r-t,p=o-n,f=s-e,m=a-t,_=l-n,g=u[1]*_-u[2]*m,y=u[2]*f-u[0]*_,v=u[0]*m-u[1]*f,x=h*g+d*y+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,T=c[1]-t,S=c[2]-n,E=(w*g+T*y+S*v)*b;if(E<0||E>1)return null;const C=T*p-S*d,A=S*h-w*p,I=w*d-T*h,M=(u[0]*C+u[1]*A+u[2]*I)*b;return M<0||E+M>1?null:(f*C+m*A+_*I)*b}function zm(e,t,n){return(e-t)/(n-t)}function Lm(e,t,n,i,r,o,s,a,l){const c=1<<n,u=o-i,h=s-r,d=(e+1)/c*u+i,p=(t+0)/c*h+r,f=(t+1)/c*h+r;a[0]=(e+0)/c*u+i,a[1]=p,l[0]=d,l[1]=f}class Om{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),n=[];let i=Math.ceil(Math.pow(2,t));const r=1/i,o=(e,t,n,i,r)=>{const o=i?1:0,s=(e+1)*n-o,a=t*n,l=(t+1)*n-o;r[0]=e*n,r[1]=a,r[2]=s,r[3]=l};let s=new Pm(i);const a=[];for(let l=0;l<i*i;l++){o(l%i,Math.floor(l/i),r,!1,a);const t=Bm(a[0],a[1],e),n=Bm(a[2],a[1],e),c=Bm(a[2],a[3],e),u=Bm(a[0],a[3],e);s.minimums.push(Math.min(t,n,c,u)),s.maximums.push(Math.max(t,n,c,u)),s.leaves.push(1)}for(n.push(s),i/=2;i>=1;i/=2){const e=n[n.length-1];s=new Pm(i);for(let t=0;t<i*i;t++){o(t%i,Math.floor(t/i),2,!0,a);const n=e.getElevation(a[0],a[1]),r=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),f=Math.min(n.min,r.min,l.min,c.min),m=Math.max(n.max,r.max,l.max,c.max),_=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&_?1:0)}n.push(s)}return n}(this.dem),n=t.length-1,i=t[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Dm([e,t,-100],[n,i,this.maximums[0]*s],r,o)}raycast(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,n,i,r,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:_}=d.pop();if(this.leaves[a]){Lm(f,m,_,e,t,n,i,u,h);const a=1<<_,l=(f+0)/a,c=(f+1)/a,d=(m+0)/a,g=(m+1)/a,y=Bm(l,d,this.dem)*s,v=Bm(c,d,this.dem)*s,x=Bm(c,g,this.dem)*s,b=Bm(l,g,this.dem)*s,w=Rm(u[0],u[1],y,h[0],u[1],v,h[0],h[1],x,r,o),T=Rm(h[0],h[1],x,u[0],h[1],b,u[0],u[1],y,r,o),S=Math.min(null!==w?w:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const e=Eh.scaleAndAdd([],r,o,p);if(Fm(y,v,b,x,zm(e[0],u[0],h[0]),zm(e[1],u[1],h[1]))>=e[2])return p}continue}let g=0;for(let d=0;d<this._siblingOffset.length;d++){Lm((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],_+1,e,t,n,i,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=Dm(u,h,r,o);if(null!=p){const e=p;l[d]=e;let t=!1;for(let n=0;n<g&&!t;n++)e>=l[c[n]]&&(c.splice(n,0,d),t=!0);t||(c[g]=d),g++}}for(let e=0;e<g;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:_+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,i,r){if(1===e[i].isLeaf(t,n))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=i-1,s=e[o];let a=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],i=2*n+this._siblingOffset[c][1],r=s.getElevation(e,i),o=s.isLeaf(e,i),u=this._addNode(r.min,r.max,o);o&&(a|=1<<c),l||(l=u)}for(let c=0;c<this._siblingOffset.length;c++)a&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],o,l+c)}}function Fm(e,t,n,i,r,o){return Yi(Yi(e,n,o),Yi(t,i,o),r)}function Bm(e,t,n){const i=n.dim,r=k(e*i-.5,0,i-1),o=k(t*i-.5,0,i-1),s=Math.floor(r),a=Math.floor(o),l=Math.min(s+1,i-1),c=Math.min(a+1,i-1);return Fm(n.get(s,a),n.get(l,a),n.get(s,c),n.get(l,c),r-s,o-a)}const Nm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768],float:[1,1,1,1]};function jm(e,t,n){return(256*e*256+256*t+n)/10-1e4}function Um(e,t,n){return 256*e+t+n/256-32768}class Vm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return X('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=t.height;const o=this.dim=t.height-2,s=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=n||"mapbox",this.borderReady=r,this._modifiedForSources={},!r){for(let e=0;e<o;e++)s[this._idx(-1,e)]=s[this._idx(0,e)],s[this._idx(o,e)]=s[this._idx(o-1,e)],s[this._idx(e,-1)]=s[this._idx(e,0)],s[this._idx(e,o)]=s[this._idx(e,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)]}if(i){const e=new Float32Array(t.data.buffer),n="terrarium"===this.encoding?Um:jm;for(let t=0;t<s.length;++t){const i=4*t;e[t]=n(this.pixels[i],this.pixels[i+1],this.pixels[i+2])}this.encoding="float"}this._timestamp=ut.now()}_buildQuadTree(){this._tree=new Om(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=k(e,-1,this.dim),t=k(t,-1,this.dim));const n=this._idx(e,t);if("float"===this.encoding)return this.floatView||(this.floatView=new Float32Array(this.pixels.buffer)),this.floatView[n];const i=4*n;return("terrarium"===this.encoding?Um:jm)(this.pixels[i],this.pixels[i+1],this.pixels[i+2])}set(e,t,n){const i=this._idx(e,t);if("float"===this.encoding){this.floatView||(this.floatView=new Float32Array(this.pixels.buffer));const e=this.floatView[i];return this.floatView[i]=n,n-e}const r=4*i,o=("terrarium"===this.encoding?Um:jm)(this.pixels[r],this.pixels[r+1],this.pixels[r+2]),s=Vm.pack(n,"terrarium"===this.encoding?"terrarium":"mapbox");return this.pixels[r]=s[0],this.pixels[r+1]=s[1],this.pixels[r+2]=s[2],n-o}static getUnpackVector(e){return Nm[e]}get unpackVector(){return Nm[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const n=[0,0,0,0],i=Vm.getUnpackVector(t);let r=Math.floor((e+i[3])/i[2]);return n[2]=r%256,r=Math.floor(r/256),n[1]=r%256,r=Math.floor(r/256),n[0]=r,n}getPixels(){return"float"===this.encoding?new Zp({width:this.stride,height:this.stride},this.pixels):new Wp({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,r=t*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-n*this.dim;for(let c=o;c<s;c++)for(let t=i;t<r;t++){const n=4*this._idx(t,c),i=4*this._idx(t+a,c+l);this.pixels[n+0]=e.pixels[i+0],this.pixels[n+1]=e.pixels[i+1],this.pixels[n+2]=e.pixels[i+2],this.pixels[n+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Is(Vm,"DEMData"),Is(Om,"DemMinMaxQuadTree",{omit:["dem"]});class Gm{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const n=t.getSource().maxzoom,i=1<<n,r=Math.floor(e.x),o=Math.floor((e.x-r)*i),s=Math.floor(e.y*i),a=this.findDEMTileFor(new Fh(n,r,n,o,s));return!(!a||!a.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;const r=i.getSource().maxzoom,o=1<<r,s=Math.floor(e.x),a=e.x-s,l=new Fh(r,s,r,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(n?this.exaggeration():1)*Yi(Yi(u.get(f,m),u.get(f,m+1),p-m),Yi(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,n){const i=1<<e.canonical.z;return this.getAtPointOrZero(new ep(e.wrap+(e.canonical.x+t/ai)/i,(e.canonical.y+n/ai)/i))}getAtTileOffsetFunc(e,t,n,i){return r=>{const o=this.getAtTileOffset(e,r.x,r.y),s=i.upVector(e.canonical,r.x,r.y),a=i.upVectorScale(e.canonical,t,n).metersToTile;return Eh.scale(s,s,o*a),s}}getForTilePoints(e,t,n,i){if(this.isUsingMockSource())return!1;const r=qm.create(this,e,i);return!!r&&(t.forEach((e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],n)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,i=t.tileID,r=1<<e.canonical.z-i.canonical.z;let o=e.canonical.x/r-i.canonical.x,s=e.canonical.y/r-i.canonical.y,a=0;for(let l=0;l<e.canonical.z-i.canonical.z&&!n.leaves[a];l++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=n.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*n.minimums[a],max:this.exaggeration()*n.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}}class qm{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const i=n||e.findDEMTileFor(t);if(!i||!i.dem)return;const r=i.dem,o=i.tileID,s=1<<t.canonical.z-o.canonical.z;return new qm(i,r.dim/ai/s,[(t.canonical.x/s-o.canonical.x)*r.dim,(t.canonical.y/s-o.canonical.y)*r.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],i=Math.floor(e*this._scale+this._offset[0]),r=Math.floor(n);return new y(i,r)}getElevationAt(e,t,n,i){const r=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(o),l=this._dem;return i=!!i,n?Yi(Yi(l.get(s,a,i),l.get(s,a+1,i),o-a),Yi(l.get(s+1,a,i),l.get(s+1,a+1,i),o-a),r-s):l.get(s,a,i)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Hd(1,e)*this._dem.stride}}class Hm{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Cs(ai,16,0),this.featureIndexArray=new ll,this.promoteId=t}insert(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r,o);const a=this.grid;for(let l=0;l<t.length;l++){const e=t[l],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const i=e[t];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}n[0]<ai&&n[1]<ai&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new tm(new Am(this.rawTileData)).layers,this.sourceLayerCoder=new rm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,n,i){var r=this;this.loadVTLayers();const o=e.params||{},s=Ro(o.filter),a=e.tileResult,l=e.transform,c=a.bufferedTilespaceBounds,u=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,((e,t,n,i)=>Tp(a.bufferedTilespaceGeometry,e,t,n,i)));u.sort(Zm);let h=null;l.elevation&&u.length>0&&(h=qm.create(l.elevation,this.tileID));const d={};let p;for(let f=0;f<u.length;f++){const l=u[f];if(l===p)continue;p=l;const c=this.featureIndexArray.get(l);let m=null;this.loadMatchingFeature(d,c,s,o.layers,o.availableImages,t,n,i,(function(t,n,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return m||(m=lp(t,r.tileID.canonical,e.tileTransform)),n.queryIntersectsFeature(a,t,i,m,r.z,e.transform,e.pixelPosMatrix,h,o)}))}return d}loadMatchingFeature(e,t,n,i,r,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(i&&!function(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(i,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(n.needGeometry){const e=cp(m,!0);if(!n.filter(new ea(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!n.filter(new ea(this.tileID.overscaledZ),m))return;const _=this.getId(m,f);for(let g=0;g<p.length;g++){const t=p[g];if(i&&i.indexOf(t)<0)continue;const n=o[t];if(!n)continue;let u={};void 0!==_&&a&&(u=a.getState(n.sourceLayer||"_geojsonTileLayer",_));const h=L({},s[t]);h.paint=Wm(h.paint,n.paint,m,u,r),h.layout=Wm(h.layout,n.layout,m,u,r);const f=!l||l(m,n,u,d);if(!f)continue;const y=new Mm(m,this.z,this.x,this.y,_);y.layer=h;let v=e[t];void 0===v&&(v=e[t]=[]),v.push({featureIndex:c,feature:y,intersectionZ:f})}}lookupSymbolFeatures(e,t,n,i,r,o,s,a){const l={};this.loadVTLayers();const c=Ro(r);for(const u of e)this.loadMatchingFeature(l,{bucketIndex:n,sourceLayerIndex:i,featureIndex:u,layoutVertexArrayOffset:0},c,o,s,a,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const i=this.sourceLayerCoder.decode(n),r=this.vtFeatures[i];if(r[t])return r[t];const o=this.vtLayers[i].feature(t);return r[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;if(this.promoteId){const i="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=i&&(n=e.properties[i]),"boolean"==typeof n&&(n=Number(n))}return n}}function Wm(e,t,n,i,r){return q(e,((e,o)=>{const s=t instanceof la?t.get(o):null;return s&&s.evaluate?s.evaluate(n,i,r):s}))}function Zm(e,t){return t-e}Is(Hm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Xm=ba([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ym=ba([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Km=ba([{name:"a_projected_pos",components:4,type:"Float32"}],4);ba([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Qm=ba([{name:"a_z_offset",components:1,type:"Float32"}],4),Jm=ba([{name:"a_texb",components:2,type:"Uint16"}]),$m=ba([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),e_=ba([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ba([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const t_=ba([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),n_=ba([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ba([{name:"triangle",components:3,type:"Uint16"}]),ba([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ba([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ba([{type:"Float32",name:"offsetX"}]),ba([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var i_=24;const r_=128;function o_(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new ea(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=n;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[r],a=t[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:a,minSize:n.evaluate(new ea(s)),maxSize:n.evaluate(new ea(a)),interpolationType:i}}}function s_(e,t,n){let{uSize:i,uSizeT:r}=t,{lowerSize:o,upperSize:s}=n;return"source"===e.kind?o/r_:"composite"===e.kind?Yi(o/r_,s/r_,r):i}function a_(e,t){let n=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=e,a=r?k(yr.interpolationFactor(r,t,o,s),0,1):0;"camera"===e.kind?i=Yi(e.minSize,e.maxSize,a):n=a}return{uSizeT:n,uSize:i}}var l_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:r_,evaluateSizeForFeature:s_,evaluateSizeForZoom:a_,getSizeData:o_});function c_(e,t,n){return e.sections.forEach((e=>{e.text=function(e,t,n){const i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),$s.applyArabicShaping&&(e=$s.applyArabicShaping(e)),e}(e.text,t,n)})),e}const u_={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function h_(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function d_(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const p_=3;function f_(e,t,n){t.glyphs=[],1===e&&n.readMessage(m_,t)}function m_(e,t,n){if(3===e){const{id:e,bitmap:i,width:r,height:o,left:s,top:a,advance:l}=n.readMessage(__,{});t.glyphs.push({id:e,bitmap:new Hp({width:r+2*p_,height:o+2*p_},i),metrics:{width:r,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function __(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const g_=p_;function y_(e){let t=0,n=0;for(const s of e)t+=s.w*s.h,n=Math.max(n,s.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let r=0,o=0;for(const s of e)for(let e=i.length-1;e>=0;e--){const t=i[e];if(!(s.w>t.w||s.h>t.h)){if(s.x=t.x,s.y=t.y,o=Math.max(o,s.y+s.h),r=Math.max(r,s.x+s.w),s.w===t.w&&s.h===t.h){const t=i.pop();e<i.length&&(i[e]=t)}else s.h===t.h?(t.x+=s.w,t.w-=s.w):s.w===t.w?(t.y+=s.h,t.h-=s.h):(i.push({x:t.x+s.w,y:t.y,w:t.w-s.w,h:s.h}),t.y+=s.h,t.h-=s.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}const v_=1;class x_{constructor(e,t){let{pixelRatio:n,version:i,stretchX:r,stretchY:o,content:s}=t;this.paddedRect=e,this.pixelRatio=n,this.stretchX=r,this.stretchY=o,this.content=s,this.version=i}get tl(){return[this.paddedRect.x+v_,this.paddedRect.y+v_]}get br(){return[this.paddedRect.x+this.paddedRect.w-v_,this.paddedRect.y+this.paddedRect.h-v_]}get displaySize(){return[(this.paddedRect.w-2*v_)/this.pixelRatio,(this.paddedRect.h-2*v_)/this.pixelRatio]}}class b_{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,n,r),this.addImages(t,i,r);const{w:o,h:s}=y_(r),a=new Wp({width:o||1,height:s||1});for(const l in e){const t=e[l],i=n[l].paddedRect;Wp.copy(t.data,a,{x:0,y:0},{x:i.x+v_,y:i.y+v_},t.data)}for(const l in t){const e=t[l],n=i[l].paddedRect,r=n.x+v_,o=n.y+v_,s=e.data.width,c=e.data.height;Wp.copy(e.data,a,{x:0,y:0},{x:r,y:o},e.data),Wp.copy(e.data,a,{x:0,y:c-1},{x:r,y:o-1},{width:s,height:1}),Wp.copy(e.data,a,{x:0,y:0},{x:r,y:o+c},{width:s,height:1}),Wp.copy(e.data,a,{x:s-1,y:0},{x:r-1,y:o},{width:1,height:c}),Wp.copy(e.data,a,{x:0,y:0},{x:r+s,y:o},{width:1,height:c})}this.image=a,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const r=e[i],o={x:0,y:0,w:r.data.width+2*v_,h:r.data.height+2*v_};n.push(o),t[i]=new x_(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,n))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const i in e.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[i],e.getImage(i,n),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i,n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,r]=e.tl;n.update(t.data,void 0,{x:i,y:r})}}Is(x_,"ImagePosition"),Is(b_,"ImageAtlas");const w_={horizontal:1,vertical:2,horizontalOnly:3},T_=-17;class S_{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new S_;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new S_;return t.imageName=e,t}}class E_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new E_;for(let i=0;i<e.sections.length;i++){const r=e.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let n="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,o=e.charCodeAt(i-1)||null;n+=!t&&(r&&Bs(r)&&!u_[e[i+1]]||o&&Bs(o)&&!u_[e[i-1]])||!u_[e[i]]?e[i]:u_[e[i]]}return n}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&A_[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&A_[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new E_;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(S_.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void X("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(S_.forImage(t)),this.sectionIndex.push(this.sections.length-1)):X("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function C_(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){const m=E_.fromFeature(e,r);h===w_.vertical&&m.verticalizePunctuation(d);let _=[];const g=function(e,t,n,i,r,o){if(!e)return[];const s=[],a=function(e,t,n,i,r,o){let s=0;for(let a=0;a<e.length();a++){const n=e.getSection(a);s+=M_(e.getCodePoint(a),n,i,r,t,o)}return s/Math.max(1,Math.ceil(s/n))}(e,t,n,i,r,o),l=e.text.indexOf("\u200b")>=0;let c=0;for(let h=0;h<e.length();h++){const n=e.getSection(h),d=e.getCodePoint(h);if(A_[d]||(c+=M_(d,n,i,r,t,o)),h<e.length()-1){const t=!((u=d)<11904||!(Rs["Bopomofo Extended"](u)||Rs.Bopomofo(u)||Rs["CJK Compatibility Forms"](u)||Rs["CJK Compatibility Ideographs"](u)||Rs["CJK Compatibility"](u)||Rs["CJK Radicals Supplement"](u)||Rs["CJK Strokes"](u)||Rs["CJK Symbols and Punctuation"](u)||Rs["CJK Unified Ideographs Extension A"](u)||Rs["CJK Unified Ideographs"](u)||Rs["Enclosed CJK Letters and Months"](u)||Rs["Halfwidth and Fullwidth Forms"](u)||Rs.Hiragana(u)||Rs["Ideographic Description Characters"](u)||Rs["Kangxi Radicals"](u)||Rs["Katakana Phonetic Extensions"](u)||Rs.Katakana(u)||Rs["Vertical Forms"](u)||Rs["Yi Radicals"](u)||Rs["Yi Syllables"](u)));(I_[d]||t||n.imageName)&&s.push(D_(h+1,c,a,s,P_(d,e.getCodePoint(h+1),t&&l),!1))}}var u;return R_(D_(e.length(),c,a,s,0,!0))}(m,c,o,t,i,p),{processBidirectionalText:y,processStyledBidirectionalText:v}=$s;if(y&&1===m.sections.length){const e=y(m.toString(),g);for(const t of e){const e=new E_;e.text=t,e.sections=m.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);_.push(e)}}else if(v){const e=v(m.text,m.sectionIndex,g);for(const t of e){const e=new E_;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,_.push(e)}}else _=function(e,t){const n=[],i=e.text;let r=0;for(const o of t)n.push(e.substring(r,o)),r=o;return r<i.length&&n.push(e.substring(r,i.length)),n}(m,g);const x=[],b={positionedLines:x,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,n,i,r,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let _=!1;for(const w of r){const e=w.getSections();for(const n of e){if(n.imageName)continue;const e=t[n.fontStack];if(e&&(_=void 0!==e.ascender&&void 0!==e.descender,!_))break}if(!_)break}let g=0;for(const w of r){w.trim();const r=w.getMaxScale(),s=(r-1)*i_,a={positionedGlyphs:[],lineOffset:0};e.positionedLines[g]=a;const v=a.positionedGlyphs;let x=0;if(!w.length()){p+=o,++g;continue}let b=0,T=0;for(let o=0;o<w.length();o++){const s=w.getSection(o),a=w.getSectionIndex(o),f=w.getCodePoint(o);let m=s.scale,g=null,S=null,E=null,C=i_,A=0;const I=!(l===w_.horizontal||!u&&!Fs(f)||u&&(A_[f]||(y=f,Rs.Arabic(y)||Rs["Arabic Supplement"](y)||Rs["Arabic Extended-A"](y)||Rs["Arabic Presentation Forms-A"](y)||Rs["Arabic Presentation Forms-B"](y))));if(s.imageName){const t=i[s.imageName];if(!t)continue;E=s.imageName,e.iconsInText=e.iconsInText||!0,S=t.paddedRect;const n=t.displaySize;m=m*i_/h,g={width:n[0],height:n[1],left:v_,top:-g_,advance:I?n[1]:n[0],localGlyph:!1},A=_?-g.height*m:T_+r*i_-n[1]*m,C=g.advance;const o=(I?n[0]:n[1])*m-i_*r;o>0&&o>x&&(x=o)}else{const e=n[s.fontStack];if(!e)continue;e[f]&&(S=e[f]);const i=t[s.fontStack];if(!i)continue;const o=i.glyphs[f];if(!o)continue;if(g=o.metrics,C=8203!==f?i_:0,_){const e=void 0!==i.ascender?Math.abs(i.ascender):0,t=void 0!==i.descender?Math.abs(i.descender):0,n=(e+t)*m;b<n&&(b=n,T=(e-t)/2*m),A=-e*m}else A=T_+(r-m)*i_}I?(e.verticalizable=!0,v.push({glyph:f,imageName:E,x:d,y:p+A,vertical:I,scale:m,localGlyph:g.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:g,rect:S}),d+=C*m+c):(v.push({glyph:f,imageName:E,x:d,y:p+A,vertical:I,scale:m,localGlyph:g.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:g,rect:S}),d+=g.advance*m+c)}0!==v.length&&(f=Math.max(d-c,f),_?L_(v,m,x,T,o*r/2):L_(v,m,x,0,o/2)),d=0;const S=o*r+x;a.lineOffset=Math.max(x,s),p+=S,++g}var y;const v=p,{horizontalAlign:x,verticalAlign:b}=z_(s);(function(e,t,n,i,r,o){const s=(t-n)*r,a=-o*i;for(const l of e)for(const e of l.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,m,x,b,f,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*f,e.right=e.left+f,e.hasBaseline=_}(b,t,n,i,_,s,a,l,h,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const A_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},I_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function M_(e,t,n,i,r,o){if(t.imageName){const e=i[t.imageName];return e?e.displaySize[0]*t.scale*i_/o+r:0}{const i=n[t.fontStack],o=i&&i.glyphs[e];return o?o.metrics.advance*t.scale+r:0}}function k_(e,t,n,i){const r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function P_(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function D_(e,t,n,i,r,o){let s=null,a=k_(t,n,r,o);for(const l of i){const e=k_(t-l.x,n,r,o)+l.badness;e<=a&&(s=l,a=e)}return{index:e,x:t,priorBreak:s,badness:a}}function R_(e){return e?R_(e.priorBreak).concat(e.index):[]}function z_(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function L_(e,t,n,i,r){if(!(t||n||i||r))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let l=0;l<=o;l++)e[l].x-=a,e[l].y+=n+i+r}function O_(e,t,n,i){const{horizontalAlign:r,verticalAlign:o}=z_(i),s=n[0]-e.displaySize[0]*r,a=n[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function F_(e,t,n,i,r,o){const s=e.imagePrimary;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class B_ extends y{constructor(e,t,n,i,r){super(e,t),this.angle=i,this.z=n,void 0!==r&&(this.segment=r)}clone(){return new B_(this.x,this.y,this.z,this.angle,this.segment)}}function N_(e,t,n,i,r){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<n/2;){const t=e[s],n=e[s+1];if(!n)return!1;let o=e[s-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=t.dist(n)}return!0}function j_(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function U_(e,t,n){return e?.6*t*n:0}function V_(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function G_(e,t,n,i,r,o){const s=U_(n,r,o),a=V_(n,i)*o;let l=0;const c=j_(e)/2;for(let u=0;u<e.length-1;u++){const n=e[u],i=e[u+1],r=n.dist(i);if(l+r>c){const o=(c-l)/r,h=Yi(n.x,i.x,o),d=Yi(n.y,i.y,o),p=new B_(h,d,0,i.angleTo(n),u);return!s||N_(e,p,a,s,t)?p:void 0}l+=r}}function q_(e,t,n,i,r,o,s,a,l){const c=U_(i,o,s),u=V_(i,r),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),H_(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,n,h,d,!1,l)}function H_(e,t,n,i,r,o,s,a,l){const c=o/2,u=j_(e);let h=0,d=t-n,p=[];for(let f=0;f<e.length-1;f++){const t=e[f],s=e[f+1],a=t.dist(s),m=s.angleTo(t);for(;d+n<h+a;){d+=n;const _=(d-h)/a,g=Yi(t.x,s.x,_),y=Yi(t.y,s.y,_);if(g>=0&&g<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const t=new B_(g,y,0,m,f);i&&!N_(e,t,o,i,r)||p.push(t)}}h+=a}return a||p.length||s||(p=H_(e,h/2,n,i,r,o,s,!0,l)),p}function W_(e,t,n,i,r){const o=[];for(let s=0;s<e.length;s++){const a=e[s];let l;for(let e=0;e<a.length-1;e++){let s=a[e],c=a[e+1];s.x<t&&c.x<t||(s.x<t?s=new y(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<t&&(c=new y(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<n&&c.y<n||(s.y<n?s=new y(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round():c.y<n&&(c=new y(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round()),s.x>=i&&c.x>=i||(s.x>=i?s=new y(i,s.y+(i-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=i&&(c=new y(i,s.y+(i-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=r&&c.y>=r||(s.y>=r?s=new y(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round():c.y>=r&&(c=new y(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}Is(B_,"Anchor");const Z_=1e20;function X_(e,t,n,i,r,o,s,a,l){for(let c=t;c<t+i;c++)Y_(e,n*o+c,o,r,s,a,l);for(let c=n;c<n+r;c++)Y_(e,c*o+t,1,i,s,a,l)}function Y_(e,t,n,i,r,o,s){o[0]=0,s[0]=-Z_,s[1]=Z_,r[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){r[a]=e[t+a*n];const i=a*a;do{const e=o[l];c=(r[a]-r[e]+i-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=Z_}for(let a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;const i=o[l],c=a-i;e[t+a*n]=r[i]+c*c}}const K_=2;class Q_{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,n){const i=[],o=this.urls[t]||r.GLYPHS_URL;for(const r in e)for(const t of e[r])i.push({stack:r,id:t});R(i,((e,t)=>{let{stack:n,id:i}=e,r=this.entries[n];r||(r=this.entries[n]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let s=r.glyphs[i];if(void 0!==s)return void t(null,{stack:n,id:i,glyph:s});if(s=this._tinySDF(r,n,i),s)return r.glyphs[i]=s,void t(null,{stack:n,id:i,glyph:s});const a=Math.floor(i/256);if(256*a>65535)return void t(new Error("glyphs > 65535 not supported"));if(r.ranges[a])return void t(null,{stack:n,id:i,glyph:s});let l=r.requests[a];l||(l=r.requests[a]=[],Q_.loadGlyphRange(n,a,o,this.requestManager,((e,t)=>{if(t){r.ascender=t.ascender,r.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(r.glyphs[+e]=t.glyphs[+e]);r.ranges[a]=!0}for(const n of l)n(e,t);delete r.requests[a]}))),l.push(((e,r)=>{e?t(e):r&&t(null,{stack:n,id:i,glyph:r.glyphs[i]||null})}))}),((e,t)=>{if(e)n(e);else if(t){const e={};for(const{stack:n,id:i,glyph:r}of t)void 0===e[n]&&(e[n]={}),void 0===e[n].glyphs&&(e[n].glyphs={}),e[n].glyphs[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[n].ascender=this.entries[n].ascender,e[n].descender=this.entries[n].descender;n(null,e)}}))}_doesCharSupportLocalGlyph(e){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(Rs["CJK Unified Ideographs"](e)||Rs["Hangul Syllables"](e)||Rs.Hiragana(e)||Rs.Katakana(e)||Rs["CJK Symbols and Punctuation"](e)||Rs["CJK Unified Ideographs Extension A"](e)||Rs["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,n){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(n))return;let r=e.tinySDF;if(!r){let n="400";/bold/i.test(t)?n="900":/medium/i.test(t)?n="500":/light/i.test(t)&&(n="200"),r=e.tinySDF=new Q_.TinySDF({fontFamily:i,fontWeight:n,fontSize:24*K_,buffer:3*K_,radius:8*K_}),r.fontWeight=n}if(this.localGlyphs[r.fontWeight][n])return this.localGlyphs[r.fontWeight][n];const o=String.fromCodePoint(n),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=r.draw(o);return this.localGlyphs[r.fontWeight][n]={id:n,bitmap:new Hp({width:a,height:l},s),metrics:{width:c/K_,height:u/K_,left:h/K_,top:d/K_-27,advance:p/K_,localGlyph:!0}}}}Q_.loadGlyphRange=function(e,t,n,i,r){const o=256*t,s=o+255,a=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}","".concat(o,"-").concat(s)),ye.Glyphs);Te(a,((e,t)=>{if(e)r(e);else if(t){const e={},n=function(e){return new Am(e).readFields(f_,{})}(t);for(const t of n.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:n.ascender,descender:n.descender})}}))},Q_.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=i,this.radius=n;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font="".concat(s," ").concat(o," ").concat(e,"px ").concat(r),c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:_,gridOuter:g}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const y=f.getImageData(m,m,a,l);g.fill(Z_,0,h),_.fill(0,0,h);for(let v=0;v<l;v++)for(let e=0;e<a;e++){const t=y.data[4*(v*a+e)+3]/255;if(0===t)continue;const n=(v+m)*c+e+m;if(1===t)g[n]=0,_[n]=Z_;else{const e=.5-t;g[n]=e>0?e*e:0,_[n]=e<0?e*e:0}}X_(g,0,0,c,u,c,this.f,this.v,this.z),X_(_,m,m,a,l,c,this.f,this.v,this.z);for(let v=0;v<h;v++){const e=Math.sqrt(g[v])-Math.sqrt(_[v]);d[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const J_=v_;function $_(e,t,n,i){const r=[],o=e.imagePrimary,s=o.pixelRatio,a=o.paddedRect.w-2*J_,l=o.paddedRect.h-2*J_,c=e.right-e.left,u=e.bottom-e.top,h=o.stretchX||[[0,a]],d=o.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),_=a-f,g=l-m;let v=0,x=f,b=0,w=m,T=0,S=_,E=0,C=g;if(o.content&&i){const e=o.content;v=eg(h,0,e[0]),b=eg(d,0,e[1]),x=eg(h,e[0],e[2]),w=eg(d,e[1],e[3]),T=e[0]-v,E=e[1]-b,S=e[2]-e[0]-x,C=e[3]-e[1]-w}const A=(i,r,a,l)=>{const h=ng(i.stretch-v,x,c,e.left),d=ig(i.fixed-T,S,i.stretch,f),p=ng(r.stretch-b,w,u,e.top),_=ig(r.fixed-E,C,r.stretch,m),g=ng(a.stretch-v,x,c,e.left),A=ig(a.fixed-T,S,a.stretch,f),I=ng(l.stretch-b,w,u,e.top),M=ig(l.fixed-E,C,l.stretch,m),k=new y(h,p),P=new y(g,p),D=new y(g,I),R=new y(h,I),z=new y(d/s,_/s),L=new y(A/s,M/s),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),n=[t,-e,e,t];k._matMult(n),P._matMult(n),R._matMult(n),D._matMult(n)}const F=i.stretch+i.fixed,B=a.stretch+a.fixed,N=r.stretch+r.fixed,j=l.stretch+l.fixed,U=e.imageSecondary;return{tl:k,tr:P,bl:R,br:D,texPrimary:{x:o.paddedRect.x+J_+F,y:o.paddedRect.y+J_+N,w:B-F,h:j-N},texSecondary:U?{x:U.paddedRect.x+J_+F,y:U.paddedRect.y+J_+N,w:B-F,h:j-N}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:z,pixelOffsetBR:L,minFontScaleX:S/s/c,minFontScaleY:C/s/u,isSDF:n}};if(i&&(o.stretchX||o.stretchY)){const e=tg(h,_,f),t=tg(d,g,m);for(let n=0;n<e.length-1;n++){const i=e[n],o=e[n+1];for(let e=0;e<t.length-1;e++)r.push(A(i,t[e],o,t[e+1]))}}else r.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return r}function eg(e,t,n){let i=0;for(const r of e)i+=Math.max(t,Math.min(n,r[1]))-Math.max(t,Math.min(n,r[0]));return i}function tg(e,t,n){const i=[{fixed:-J_,stretch:0}];for(const[r,o]of e){const e=i[i.length-1];i.push({fixed:r-e.stretch,stretch:e.stretch}),i.push({fixed:r-e.stretch,stretch:e.stretch+(o-r)})}return i.push({fixed:t+J_,stretch:n}),i}function ng(e,t,n,i){return e/t*n+i}function ig(e,t,n,i){return e-t*n/i}function rg(e,t,n,i){const r=t+e.positionedLines[i].lineOffset;return 0===i?n+r/2:n+(r+(t+e.positionedLines[i-1].lineOffset))/2}function og(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1/0,r=1/0,o=-1/0,s=-1/0;const a=e[0];for(let p=0;p<a.length;p++){const e=a[p];(!p||e.x<i)&&(i=e.x),(!p||e.y<r)&&(r=e.y),(!p||e.x>o)&&(o=e.x),(!p||e.y>s)&&(s=e.y)}const l=Math.min(o-i,s-r);let c=l/2;const u=new si([],sg);if(0===l)return new y(i,r);for(let p=i;p<o;p+=l)for(let t=r;t<s;t+=l)u.push(new ag(p+c,t+c,c,e));let h=function(e){let t=0,n=0,i=0;const r=e[0];for(let o=0,s=r.length,a=s-1;o<s;a=o++){const e=r[o],s=r[a],l=e.x*s.y-s.x*e.y;n+=(e.x+s.x)*l,i+=(e.y+s.y)*l,t+=3*l}return new ag(n/t,i/t,0,e)}(e),d=u.length;for(;u.length;){const i=u.pop();(i.d>h.d||!h.d)&&(h=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-h.d<=t||(c=i.h/2,u.push(new ag(i.p.x-c,i.p.y-c,c,e)),u.push(new ag(i.p.x+c,i.p.y-c,c,e)),u.push(new ag(i.p.x-c,i.p.y+c,c,e)),u.push(new ag(i.p.x+c,i.p.y+c,c,e)),d+=4)}return n&&(console.log("num probes: ".concat(d)),console.log("best distance: ".concat(h.d))),h.p}function sg(e,t){return t.max-e.max}class ag{constructor(e,t,n,i){this.p=new y(e,t),this.h=n,this.d=function(e,t){let n=!1,i=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,s=r-1;t<r;s=t++){const r=o[t],a=o[s];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,xp(e,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}}const lg=7,cg=Number.POSITIVE_INFINITY,ug=Math.sqrt(2);function hg(e,t){let[n,i]=t,r=0,o=0;if(i===cg){n<0&&(n=0);const t=n/ug;switch(e){case"top-right":case"top-left":o=t-lg;break;case"bottom-right":case"bottom-left":o=-t+lg;break;case"bottom":o=-n+lg;break;case"top":o=n-lg}switch(e){case"top-right":case"bottom-right":r=-t;break;case"top-left":case"bottom-left":r=t;break;case"left":r=n;break;case"right":r=-n}}else{switch(n=Math.abs(n),i=Math.abs(i),e){case"top-right":case"top-left":case"top":o=i-lg;break;case"bottom-right":case"bottom-left":case"bottom":o=-i+lg}switch(e){case"top-right":case"bottom-right":case"right":r=-n;break;case"top-left":case"bottom-left":case"left":r=n}}return[r,o]}function dg(e,t,n,i,r,o,s,a,l,c,u){e.createArrays(),e.tilePixelRatio=ai/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const h=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new ea(t),a),d["text-size"].possiblyEvaluate(new ea(n),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new ea(t),a),d["icon-size"].possiblyEvaluate(new ea(n),a)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new ea(l+1),a),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new ea(l+1),a),p.textMaxSize=d["text-size"].possiblyEvaluate(new ea(18),a);const f="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),m=h.get("text-size");let _=!1;for(const g of e.features)if(g.icon&&g.icon.nameSecondary){_=!0;break}for(const g of e.features){const o=h.get("text-font").evaluate(g,{},a).join(","),l=m.evaluate(g,{},a),d=p.layoutTextSize.evaluate(g,{},a),y=(p.layoutIconSize.evaluate(g,{},a),{horizontal:{},vertical:void 0}),v=g.text;let x,b=[0,0];if(v){const i=v.toString(),s=h.get("text-letter-spacing").evaluate(g,{},a)*i_,c=h.get("text-line-height").evaluate(g,{},a)*i_,u=Ls(i)?s:0,p=h.get("text-anchor").evaluate(g,{},a),m=h.get("text-variable-anchor");if(!m){const e=h.get("text-radial-offset").evaluate(g,{},a);b=e?hg(p,[e*i_,cg]):h.get("text-offset").evaluate(g,{},a).map((e=>e*i_))}let _=f?"center":h.get("text-justify").evaluate(g,{},a);const x="point"===h.get("symbol-placement"),w=x?h.get("text-max-width").evaluate(g,{},a)*i_:1/0,T=s=>{e.allowVerticalPlacement&&zs(i)&&(y.vertical=C_(v,t,n,r,o,w,c,p,s,u,b,w_.vertical,!0,d,l))};if(!f&&m){const e="auto"===_?m.map((e=>pg(e))):[_];let i=!1;for(let s=0;s<e.length;s++){const a=e[s];if(!y.horizontal[a])if(i)y.horizontal[a]=y.horizontal[0];else{const e=C_(v,t,n,r,o,w,c,"center",a,u,b,w_.horizontal,!1,d,l);e&&(y.horizontal[a]=e,i=1===e.positionedLines.length)}}T("left")}else{if("auto"===_&&(_=pg(p)),x||h.get("text-writing-mode").indexOf("horizontal")>=0||!zs(i)){const e=C_(v,t,n,r,o,w,c,p,_,u,b,w_.horizontal,!1,d,l);e&&(y.horizontal[_]=e)}T(x?"left":_)}}let w=!1;if(g.icon&&g.icon.namePrimary){const t=i[g.icon.namePrimary];t&&(x=O_(r[g.icon.namePrimary],g.icon.nameSecondary?r[g.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(g,{},a),h.get("icon-anchor").evaluate(g,{},a)),w=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&X("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const T=yg(y.horizontal)||y.vertical;e.iconsInText||(e.iconsInText=!!T&&T.iconsInText),(T||x)&&fg(e,g,y,x,i,p,d,0,b,w,s,a,c,u,_)}o&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function pg(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fg(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){let m=o.textMaxSize.evaluate(t,{},h);void 0===m&&(m=s);const _=e.layers[0].layout,g=_.get("icon-offset").evaluate(t,{},h),y=yg(n.horizontal)||n.vertical,v="globe"===d.name,x=i_,b=s/x,T=e.tilePixelRatio*m/x,S=(D=e.overscaling,e.zoom>18&&D>2&&(D>>=1),Math.max(ai/(512*D),1)*_.get("symbol-spacing")),E=_.get("text-padding")*e.tilePixelRatio,C=_.get("icon-padding")*e.tilePixelRatio,A=w(_.get("text-max-angle")),I="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement"),M="map"===_.get("icon-rotation-alignment")&&"point"!==_.get("symbol-placement"),k=_.get("symbol-placement"),P=S/2;var D;const R=_.get("icon-text-fit").evaluate(t,{},h),z=_.get("icon-text-fit-padding").evaluate(t,{},h),L="none"!==R;let O;!1===e.hasAnyIconTextFit&&L&&(e.hasAnyIconTextFit=!0),i&&L&&(e.allowVerticalPlacement&&n.vertical&&(O=F_(i,n.vertical,R,z,g,b)),y&&(i=F_(i,y,R,z,g,b)));const F=(s,a,m)=>{if(a.x<0||a.x>=ai||a.y<0||a.y>=ai)return;let _=null;if(v){const{x:e,y:t,z:n}=d.projectTilePoint(a.x,a.y,m);_={anchor:new B_(e,t,n,0,void 0),up:d.upVector(m,a.x,a.y)}}!function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,T,S,E,C){const A=e.addToLineVertexArray(t,i);let I,M,k,P,D,R,z,L=0,O=0,F=0,B=0,N=-1,j=-1;const U={};let V=wl("");const G=n?n.anchor:t,q="none"!==l.layout.get("icon-text-fit").evaluate(x,{},S);let H=0,W=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[H,W]=l.layout.get("text-offset").evaluate(x,{},S).map((e=>e*i_)):(H=l.layout.get("text-radial-offset").evaluate(x,{},S)*i_,W=cg),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(f)R=xg(e),a&&(z=xg(a));else{const n=l.layout.get("text-rotate").evaluate(x,{},S)+90;k=vg(c,G,t,u,h,d,e,p,n,m),a&&(P=vg(c,G,t,u,h,d,a,g,n))}}if(o){const i=l.layout.get("icon-rotate").evaluate(x,{},S),r=$_(o,i,w,q),s=a?$_(a,i,w,q):void 0;M=vg(c,G,t,u,h,d,o,g,i),L=4*r.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[r_*l.layout.get("icon-size").evaluate(x,{},S)],f[0]>_g&&X("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(mg,'. Reduce your "icon-size".'))):"composite"===p.kind&&(f=[r_*b.compositeIconSizes[0].evaluate(x,{},S),r_*b.compositeIconSizes[1].evaluate(x,{},S)],(f[0]>_g||f[1]>_g)&&X("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(mg,'. Reduce your "icon-size".'))),e.addSymbols(e.icon,r,f,v,y,x,!1,n,t,A.lineStartIndex,A.lineLength,-1,T,S,E,C),N=e.icon.placedSymbolArray.length-1,s&&(O=4*s.length,e.addSymbols(e.icon,s,f,v,y,x,w_.vertical,n,t,A.lineStartIndex,A.lineLength,-1,T,S,E,C),j=e.icon.placedSymbolArray.length-1)}for(const X in r.horizontal){const i=r.horizontal[X];I||(V=wl(i.text),f?D=xg(i):I=vg(c,G,t,u,h,d,i,p,l.layout.get("text-rotate").evaluate(x,{},S),m));const o=1===i.positionedLines.length;if(F+=gg(e,n,t,i,s,l,f,x,m,A,r.vertical?w_.horizontal:w_.horizontalOnly,o?Object.keys(r.horizontal):[X],U,N,b,T,S,E),o)break}r.vertical&&(B+=gg(e,n,t,r.vertical,s,l,f,x,m,A,w_.vertical,["vertical"],U,j,b,T,S,E));let Z=-1;const Y=(e,t)=>e?Math.max(e,t):t;Z=Y(D,Z),Z=Y(R,Z),Z=Y(z,Z);const K=Z>-1?1:0;e.glyphOffsetArray.length>=cy.MAX_GLYPHS&&X("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,G.x,G.y,G.z,U.right>=0?U.right:-1,U.center>=0?U.center:-1,U.left>=0?U.left:-1,U.vertical>=0?U.vertical:-1,N,j,V,void 0!==I?I:e.collisionBoxArray.length,void 0!==I?I+1:e.collisionBoxArray.length,void 0!==k?k:e.collisionBoxArray.length,void 0!==k?k+1:e.collisionBoxArray.length,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,P||e.collisionBoxArray.length,P?P+1:e.collisionBoxArray.length,u,F,B,L,O,K,0,H,W,Z,0,q?1:0)}(e,a,_,s,n,i,r,O,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,E,I,l,0,C,M,g,t,o,c,u,h,p,f)};if("line"===k)for(const w of W_(t.geometry,0,0,ai,ai)){const t=q_(w,S,A,n.vertical||y,i,x,T,e.overscaling,ai);for(const n of t)y&&bg(e,y.text,P,n)||F(w,n,h)}else if("line-center"===k){for(const w of t.geometry)if(w.length>1){const e=G_(w,A,n.vertical||y,i,x,T);e&&F(w,e,h)}}else if("Polygon"===t.type)for(const w of kf(t.geometry,0)){const e=og(w,16);F(w[0],new B_(e.x,e.y,0,0,void 0),h)}else if("LineString"===t.type)for(const w of t.geometry)F(w,new B_(w[0].x,w[0].y,0,0,void 0),h);else if("Point"===t.type)for(const w of t.geometry)for(const e of w)F([e],new B_(e.x,e.y,0,0,void 0),h)}const mg=255,_g=mg*r_;function gg(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g){const v=function(e,t,n,i,r,o,s,a){const l=[];if(0===t.positionedLines.length)return l;const c=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],n=e[1],i=t*n;return i>0?[t,-n]:i<0?[-t,n]:0===t?[n,t]:[n,-t]}(n);let h=Math.abs(t.top-t.bottom);for(const m of t.positionedLines)h-=m.lineOffset;const d=t.positionedLines.length,p=h/d;let f=t.top-n[1];for(let m=0;m<d;++m){const e=t.positionedLines[m];f=rg(t,p,f,m);for(const i of e.positionedGlyphs){if(!i.rect)continue;const e=i.rect||{};let o=g_+1,h=!0,d=1,p=0;if(i.imageName){const e=s[i.imageName];if(!e)continue;if(e.sdf){X("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=e.pixelRatio,o=v_/d}const m=(r||a)&&i.vertical,_=i.metrics.advance*i.scale/2,g=i.metrics,v=i.rect;if(null===v)continue;a&&t.verticalizable&&(p=i.imageName?_-i.metrics.width*i.scale/2:0);const x=r?[i.x+_,i.y]:[0,0];let b=[0,0],w=[0,0],T=!1;r||(m?(w=[i.x+_+u[0],i.y+u[1]-p],T=!0):b=[i.x+_+n[0],i.y+n[1]-p]);const S=v.w*i.scale/(d*(i.localGlyph?K_:1)),E=v.h*i.scale/(d*(i.localGlyph?K_:1));let C,A,I,M;if(m){const e=i.y-f,t=new y(-_,_-e),n=-Math.PI/2,r=new y(...w);C=new y(-_+b[0],b[1]),C._rotateAround(n,t)._add(r),C.x+=-e+_,C.y-=(g.left-o)*i.scale;const s=i.imageName?g.advance*i.scale:i_*i.scale,a=String.fromCodePoint(i.glyph);h_(a)?C.x+=(1-o)*i.scale:d_(a)?C.x+=s-g.height*i.scale+(-o-1)*i.scale:C.x+=i.imageName||g.width+2*o===v.w&&g.height+2*o===v.h?(s-E)/2:(s-(g.height+2*o)*i.scale)/2,A=new y(C.x,C.y-S),I=new y(C.x+E,C.y),M=new y(C.x+E,C.y-S)}else{const e=(g.left-o)*i.scale-_+b[0],t=(-g.top-o)*i.scale+b[1],n=e+S,r=t+E;C=new y(e,t),A=new y(n,t),I=new y(e,r),M=new y(n,r)}if(c){let e;e=r?new y(0,0):T?new y(u[0],u[1]):new y(n[0],n[1]),C._rotateAround(c,e),A._rotateAround(c,e),I._rotateAround(c,e),M._rotateAround(c,e)}const k=new y(0,0),P=new y(0,0);l.push({tl:C,tr:A,bl:I,br:M,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:x,sectionIndex:i.sectionIndex,isSDF:h,pixelOffsetTL:k,pixelOffsetBR:P,minFontScaleX:0,minFontScaleY:0})}}return l}(0,i,l,o,s,a,r,e.allowVerticalPlacement),x=e.textSizeData;let b=null;"source"===x.kind?(b=[r_*o.layout.get("text-size").evaluate(a,{},_)],b[0]>_g&&X("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(mg,'. Reduce your "text-size".'))):"composite"===x.kind&&(b=[r_*f.compositeTextSizes[0].evaluate(a,{},_),r_*f.compositeTextSizes[1].evaluate(a,{},_)],(b[0]>_g||b[1]>_g)&&X("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(mg,'. Reduce your "text-size".'))),e.addSymbols(e.text,v,b,l,s,a,u,t,n,c.lineStartIndex,c.lineLength,p,m,_,g,!1);for(const y of h)d[y]=e.text.placedSymbolArray.length-1;return 4*v.length}function yg(e){for(const t in e)return e[t];return null}function vg(e,t,n,i,r,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,p=s.right;const f=s.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const e=new y(d,u),t=new y(p,u),n=new y(d,h),i=new y(p,h),r=w(l);let o=new y(0,0);c&&(o=new y(c[0],c[1])),e._rotateAround(r,o),t._rotateAround(r,o),n._rotateAround(r,o),i._rotateAround(r,o),d=Math.min(e.x,t.x,n.x,i.x),p=Math.max(e.x,t.x,n.x,i.x),u=Math.min(e.y,t.y,n.y,i.y),h=Math.max(e.y,t.y,n.y,i.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,d,u,p,h,a,i,r,o),e.length-1}function xg(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function bg(e,t,n,i){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<n)return!0}else r[t]=[];return r[t].push(i),!1}function wg(e,t){const n=e.fovAboveCenter,i=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-i)/Math.cos(e._pitch),o=Math.sin(n)*r/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),s=Math.sin(e._pitch)*o+r;return Math.min(1.01*s,r*(1/e._horizonShift))}function Tg(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),i=e.x*n,r=(e.x+1)*n,o=e.y*n,s=(e.y+1)*n,a=Wd(i),l=Wd(r),c=Zd(o),u=Zd(s),h=t.project(a,c),d=t.project(l,c),p=t.project(l,u),f=t.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),_=Math.min(h.y,d.y,p.y,f.y),g=Math.max(h.x,d.x,p.x,f.x),y=Math.max(h.y,d.y,p.y,f.y);const v=n/16;function x(e,n,i,r,o,s){const a=(i+o)/2,l=(r+s)/2,c=t.project(Wd(a),Zd(l)),u=Math.max(0,m-c.x,_-c.y,c.x-g,c.y-y);m=Math.min(m,c.x),g=Math.max(g,c.x),_=Math.min(_,c.y),y=Math.max(y,c.y),u>v&&(x(e,c,i,r,a,l),x(c,n,a,l,o,s))}x(h,d,i,o,r,o),x(d,p,r,o,r,s),x(p,f,r,s,i,s),x(f,h,i,s,i,o),m-=v,_-=v,g+=v,y+=v;const b=1/Math.max(g-m,y-_);return{scale:b,x:m*b,y:_*b,x2:g*b,y2:y*b,projection:t}}function Sg(e,t,n,i,r,o,s,a,l){if("globe"===l.name)return hd(e,t,new Lh(n,i,r),!1);const c=Tg({z:n,x:i,y:r},l);return new Zh([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])}function Eg(e,t){let{x:n,y:i}=t;return new y(((n-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*ai,(i*e.scale-e.y)*ai)}function Cg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Eh.fromValues(((t.x-n)*e.scale-e.x)*ai,(t.y*e.scale-e.y)*ai,Xd(t.z,t.y))}const Ag=vh.identity(new Float32Array(16));class Ig{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Nd(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._coordinatePoint(e.locationCoordinate(t),n)}pixelsPerMeter(e,t){return Hd(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return wg(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,i){const r=e.horizonLineFromTop(!1),o=new y(t,Math.max(r,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,i))}pointCoordinate3D(e,t,n){const i=new y(t,n);if(e.elevation)return e.elevation.pointCoordinate(i);{const t=this.pointCoordinate(e,i.x,i.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return Ag}createTileMatrix(e,t,n){let i,r,o;const s=n.canonical,a=vh.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Tg(s,this);i=1,r=l.x+n.wrap*l.scale,o=l.y,vh.scale(a,a,[i/l.scale,i/l.scale,e.pixelsPerMeter/t])}else i=t/e.zoomScale(s.z),r=(s.x+Math.pow(2,s.z)*n.wrap)*i,o=s.y*i;return vh.translate(a,a,[r,o,0]),vh.scale(a,a,[i/ai,i/ai,1]),a}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class Mg extends Ig{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],i=Math.sin(w(t));this.n=(i+Math.sin(w(n)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:n,c:i,r0:r}=this,o=w(e-this.center[0]),s=w(t),a=Math.sqrt(i-2*n*Math.sin(s))/n;return{x:a*Math.sin(o*n),y:a*Math.cos(o*n)-r,z:0}}unproject(e,t){const{n:n,c:i,r0:r}=this,o=r+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*n<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=w(this.center[0])*n;s=D(s,-Math.PI-a,Math.PI-a);const l=k(T(s/n)+this.center[0],-180,180),c=Math.asin(k((i-(e*e+o*o)*n*n)/(2*n),-1,1)),u=k(T(c),-Yd,Yd);return new Nd(l,u)}}const kg=1.340264,Pg=-.081106,Dg=893e-6,Rg=.003796,zg=Math.sqrt(3)/2;class Lg extends Ig{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(zg*Math.sin(t)),i=n*n,r=i*i*i;return{x:.5*(e*Math.cos(n)/(zg*(kg+3*Pg*i+r*(7*Dg+9*Rg*i)))/Math.PI+.5),y:1-.5*(n*(kg+Pg*i+r*(Dg+Rg*i))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=n*n,r=i*i*i;for(let c,u,h,d=0;d<12&&(u=n*(kg+Pg*i+r*(Dg+Rg*i))-t,h=kg+3*Pg*i+r*(7*Dg+9*Rg*i),c=u/h,n=k(n-c,-Math.PI/3,Math.PI/3),i=n*n,r=i*i*i,!(Math.abs(c)<1e-12));++d);const o=zg*e*(kg+3*Pg*i+r*(7*Dg+9*Rg*i))/Math.cos(n),s=Math.asin(Math.sin(n)/zg),a=k(180*o/Math.PI,-180,180),l=k(180*s/Math.PI,-Yd,Yd);return new Nd(a,l)}}class Og extends Ig{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),i=k(360*(.5-t),-Yd,Yd);return new Nd(n,i)}}const Fg=Math.PI/2;function Bg(e){return Math.tan((Fg+e)/2)}class Ng extends Ig{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30];let i=w(t),r=w(n);this.southernCenter=i+r<0,this.southernCenter&&(i=-i,r=-r);const o=Math.cos(i),s=Bg(i);this.n=i===r?Math.sin(i):Math.log(o/Math.cos(r))/Math.log(Bg(r)/s),this.f=o*Math.pow(Bg(i),this.n)/this.n}project(e,t){t=w(t),this.southernCenter&&(t=-t),e=w(e-this.center[0]);const n=1e-6,{n:i,f:r}=this;r>0?t<-Fg+n&&(t=-Fg+n):t>Fg-n&&(t=Fg-n);const o=r/Math.pow(Bg(t),i);let s=o*Math.sin(i*e),a=r-o*Math.cos(i*e);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:n,f:i}=this,r=i-t,o=Math.sign(r),s=Math.sign(n)*Math.sqrt(e*e+r*r);let a=Math.atan2(e,Math.abs(r))*o;r*n<0&&(a-=Math.PI*Math.sign(e)*o);const l=k(T(a/n)+this.center[0],-180,180),c=k(T(2*Math.atan(Math.pow(i/s,1/n))-Fg),-Yd,Yd);return new Nd(l,this.southernCenter?-c:c)}}class jg extends Ig{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Gd(e),y:qd(t),z:0}}unproject(e,t){const n=Wd(e),i=Zd(t);return new Nd(n,i)}}const Ug=w(Yd);class Vg extends Ig{project(e,t){const n=(t=w(t))*t,i=n*n;return{x:.5*((e=w(e))*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=25,r=0,o=n*n;do{o=n*n;const e=o*o;r=(n*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),n=k(n-r,-Ug,Ug)}while(Math.abs(r)>1e-6&&--i>0);o=n*n;const s=k(T(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=T(n);return new Nd(s,a)}}const Gg=w(Yd);class qg extends Ig{project(e,t){t=w(t),e=w(e);const n=Math.cos(t),i=2/Math.PI,r=Math.acos(n*Math.cos(e/2)),o=Math.sin(r)/r,s=.5*(e*i+2*n*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,r=25;const o=1e-6;let s=0,a=0;do{const r=Math.cos(i),o=Math.sin(i),l=2*o*r,c=o*o,u=r*r,h=Math.cos(n/2),d=Math.sin(n/2),p=2*h*d,f=d*d,m=1-u*h*h,_=m?1/m:0,g=m?Math.acos(r*h)*Math.sqrt(1/m):0,y=.5*(2*g*r*d+2*n/Math.PI)-e,v=.5*(g*o+i)-t,x=.5*_*(u*f+g*r*h*c)+1/Math.PI,b=_*(p*l/4-g*o*d),w=.125*_*(l*d-g*o*u*p),T=.5*_*(c*h+g*f*r)+.5,S=b*w-T*x;s=(v*b-y*T)/S,a=(y*w-v*x)/S,n=k(n-s,-Math.PI,Math.PI),i=k(i-a,-Gg,Gg)}while((Math.abs(s)>o||Math.abs(a)>o)&&--r>0);return new Nd(T(n),T(i))}}class Hg extends Ig{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(w(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:i}=this;return{x:w(e)*i*n+.5,y:-Math.sin(w(t))/i*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:i}=this,r=-(t-.5)/n,o=k(T((e-.5)/n)/i,-180,180),s=Math.asin(k(r*i,-1,1)),a=k(T(s),-Yd,Yd);return new Nd(o,a)}}class Wg extends jg{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,n){const i=_d(e,t,n),r=vd(ad(n));return Eh.transformMat4(i,i,r),{x:i[0],y:i[1],z:i[2]}}locationPoint(e,t){const n=md(t.lat,t.lng),i=Eh.normalize([],n),r=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude,o=Hd(1,0)*ai*r;Eh.scaleAndAdd(n,n,i,o);const s=vh.identity(new Float64Array(16));return vh.multiply(s,e.pixelMatrix,e.globeMatrix),Eh.transformMat4(n,n,s),new y(n[0],n[1])}pixelsPerMeter(e,t){return Hd(1,0)*t}pixelSpaceConversion(e,t,n){const i=Hd(1,e)*t,r=Yi(Hd(1,45)*t,i,n);return this.pixelsPerMeter(e,t)/r}createTileMatrix(e,t,n){const i=xd(ad(n.canonical));return vh.multiply(new Float64Array(16),e.globeMatrix,i)}createInversionMatrix(e,t){const{center:n}=e,i=vd(ad(t));return vh.rotateY(i,i,w(n.lng)),vh.rotateX(i,i,w(n.lat)),vh.scale(i,i,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(i)}pointCoordinate(e,t,n,i){return rd(e,t,n,!0)||new ep(0,0)}pointCoordinate3D(e,t,n){const i=this.pointCoordinate(e,t,n,0);return[i.x,i.y,i.z]}isPointAboveHorizon(e,t){return!rd(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const n=e.cameraToCenterDistance,i=e._centerAltitude*t,r=e._camera,o=e._camera.forward(),s=Eh.add([],Eh.scale([],o,-n),[0,0,i]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=Eh.scale([],r.up(),u),d=Eh.scale([],r.right(),u*c),p=Eh.normalize([],Eh.add([],Eh.add([],o,h),d)),f=[];let m;if(new jh(s,p).closestPointOnSphere(l,a,f)){const t=Eh.add([],f,l),n=Eh.sub([],t,s);m=Math.cos(e.fovAboveCenter)*Eh.length(n)}else{const e=Eh.sub([],s,l),t=Eh.sub([],l,s);Eh.normalize(t,t);const n=Eh.length(e)-a;m=Math.sqrt(n*(n+2*a));const i=Math.acos(m/(a+n))-Math.acos(Eh.dot(o,t));m*=Math.cos(i)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Sd(e.zoom);if(n>0){const i=wg(e,Hd(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Yi(t,i+r*(1-Math.cos(o)),Math.pow(n,10))}return t}upVector(e,t,n){return _d(t,n,e,1)}upVectorScale(e){return{metersToTile:id(gd(ad(e)))}}}function Zg(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new jg(e);case"equirectangular":return new Og(e);case"naturalEarth":return new Vg(e);case"equalEarth":return new Lg(e);case"winkelTripel":return new qg(e);case"albers":return n?new Hg(e):new Mg(e);case"lambertConformalConic":return n?new Hg(e):new Ng(e);case"globe":return new Wg(e)}throw new Error("Invalid projection name: ".concat(e.name))}const Xg=new da({"symbol-placement":new ca(Mt.layout_symbol["symbol-placement"]),"symbol-spacing":new ca(Mt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ca(Mt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ua(Mt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ca(Mt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ca(Mt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ca(Mt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ca(Mt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ca(Mt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ca(Mt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ua(Mt.layout_symbol["icon-size"]),"icon-text-fit":new ua(Mt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ua(Mt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ua(Mt.layout_symbol["icon-image"]),"icon-rotate":new ua(Mt.layout_symbol["icon-rotate"]),"icon-padding":new ca(Mt.layout_symbol["icon-padding"]),"icon-keep-upright":new ca(Mt.layout_symbol["icon-keep-upright"]),"icon-offset":new ua(Mt.layout_symbol["icon-offset"]),"icon-anchor":new ua(Mt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ca(Mt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ca(Mt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ca(Mt.layout_symbol["text-rotation-alignment"]),"text-field":new ua(Mt.layout_symbol["text-field"]),"text-font":new ua(Mt.layout_symbol["text-font"]),"text-size":new ua(Mt.layout_symbol["text-size"]),"text-max-width":new ua(Mt.layout_symbol["text-max-width"]),"text-line-height":new ua(Mt.layout_symbol["text-line-height"]),"text-letter-spacing":new ua(Mt.layout_symbol["text-letter-spacing"]),"text-justify":new ua(Mt.layout_symbol["text-justify"]),"text-radial-offset":new ua(Mt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ca(Mt.layout_symbol["text-variable-anchor"]),"text-anchor":new ua(Mt.layout_symbol["text-anchor"]),"text-max-angle":new ca(Mt.layout_symbol["text-max-angle"]),"text-writing-mode":new ca(Mt.layout_symbol["text-writing-mode"]),"text-rotate":new ua(Mt.layout_symbol["text-rotate"]),"text-padding":new ca(Mt.layout_symbol["text-padding"]),"text-keep-upright":new ca(Mt.layout_symbol["text-keep-upright"]),"text-transform":new ua(Mt.layout_symbol["text-transform"]),"text-offset":new ua(Mt.layout_symbol["text-offset"]),"text-allow-overlap":new ca(Mt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ca(Mt.layout_symbol["text-ignore-placement"]),"text-optional":new ca(Mt.layout_symbol["text-optional"]),visibility:new ca(Mt.layout_symbol.visibility)});var Yg={paint:new da({"icon-opacity":new ua(Mt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new ua(Mt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ua(Mt.paint_symbol["text-emissive-strength"]),"icon-color":new ua(Mt.paint_symbol["icon-color"]),"icon-halo-color":new ua(Mt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ua(Mt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ua(Mt.paint_symbol["icon-halo-blur"]),"icon-translate":new ca(Mt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ca(Mt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ua(Mt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ua(Mt.paint_symbol["text-opacity"]),"text-color":new ua(Mt.paint_symbol["text-color"],{runtimeType:Gt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new ua(Mt.paint_symbol["text-halo-color"]),"text-halo-width":new ua(Mt.paint_symbol["text-halo-width"]),"text-halo-blur":new ua(Mt.paint_symbol["text-halo-blur"]),"text-translate":new ca(Mt.paint_symbol["text-translate"]),"text-translate-anchor":new ca(Mt.paint_symbol["text-translate-anchor"])}),layout:Xg};class Kg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Nt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Is(Kg,"FormatSectionOverride",{omit:["defaultValue"]});class Qg extends _a{constructor(e,t){super(e,Yg,t)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const e=[];for(const t of n)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const r=this.layout.get(e).evaluate(t,{},n,i),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||yo(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,n)=>n in e?String(e[n]):""))}(t.properties,r)}createBucket(e){return new cy(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Yg.paint.overridableProperties){if(!Qg.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new Kg(t),i=new go(n,t.property.specification);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new xo("source",i):new bo("composite",i,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new aa(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&Qg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=Yg.paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof dn)o(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{r||(t instanceof vn&&_n(t.value)===Zt?o(t.value.sections):t instanceof Sn?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),n=[];return e&&n.push("symbolIcon"),t&&n.push("symbolSDF"),n}getDefaultProgramParams(e,t){return{config:new Wl(this,t),overrideFog:!1}}}const Jg=nm.types,$g=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ey(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=a?Math.min(_g,Math.round(a[0])):0,f=a?Math.min(_g,Math.round(a[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*r),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function ty(e,t,n){e.emplaceBack(t,n)}function ny(e,t,n,i,r,o,s){e.emplaceBack(t,n,i,r,o,s)}function iy(e,t,n,i,r){const o=5*t+2;e.float32[o+0]=n,e.float32[o+1]=i,e.float32[o+2]=r}function ry(e,t,n,i,r){e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r)}function oy(e){for(const t of e.sections)if(Us(t.text))return!0;return!1}class sy{constructor(e){this.layoutVertexArray=new Da,this.indexArray=new Ua,this.programConfigurations=e,this.segments=new dl,this.dynamicLayoutVertexArray=new Ia,this.opacityVertexArray=new za,this.placedSymbolArray=new nl,this.iconTransitioningVertexArray=new La,this.globeExtVertexArray=new Ra,this.zOffsetVertexArray=new qa}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,n,i,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Km.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,$g,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Jm.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ym.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||r)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Qm.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Is(sy,"SymbolBuffers");class ay{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new dl,this.collisionVertexArray=new Na,this.collisionVertexArrayExt=new ja}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,$m.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,e_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Is(ay,"CollisionBuffers");class ly{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vh.identity([]),this.placementViewportMatrix=vh.identity([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=o_(this.zoom,t["text-size"]),this.iconSizeData=o_(this.zoom,t["icon-size"]);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map((e=>w_[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new sy(new Zl(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new sy(new Zl(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new ol,this.lineVertexArray=new sl,this.symbolInstances=new rl}calculateGlyphDependencies(e,t,n,i,r){for(let o=0;o<e.length;o++){const n=e.codePointAt(o);if(void 0===n)break;if(t[n]=!0,i&&r&&n<=65535){const n=u_[e.charAt(o)];n&&(t[n.charCodeAt(0)]=!0)}}}populate(e,t,n,i){const r=this.layers[0],o=r.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof dn&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const p=t.iconDependencies,f=t.glyphDependencies,m=t.availableImages,_=new ea(this.zoom);for(const{feature:g,id:y,index:v,sourceLayerIndex:x}of e){const e=r._featureFilter.needGeometry,t=cp(g,e);if(!r._featureFilter.filter(_,t,n))continue;if(e||(t.geometry=lp(g,n,i)),s&&1!==g.type&&n.z<=5){const e=t.geometry,i=.98078528056,r=(e,t)=>{const r=_d(e.x,e.y,n,1),o=_d(t.x,t.y,n,1);return Eh.dot(r,o)<i};for(let t=0;t<e.length;t++)e[t]=rp(e[t],r)}let l,c;if(u){const e=r.getValueAndResolveTokens("text-field",t,n,m),i=dn.factory(e);oy(i)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Qs()||this.hasRTLText&&$s.isParsed())&&(l=c_(i,r,t))}if(h){const e=r.getValueAndResolveTokens("icon-image",t,n,m);c=e instanceof pn?e:pn.fromString(e)}if(!l&&!c)continue;const b=this.sortFeaturesByKey?d.evaluate(t,{},n):void 0;if(this.features.push({id:y,text:l,icon:c,index:v,sourceLayerIndex:x,geometry:t.geometry,properties:g.properties,type:Jg[g.type],sortKey:b}),c&&(p[c.namePrimary]=!0,c.nameSecondary&&(p[c.nameSecondary]=!0)),l){const e=a.evaluate(t,{},n).join(","),i="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w_.vertical)>=0;for(const t of l.sections)if(t.image)p[t.image.namePrimary]=!0;else{const n=zs(l.toString()),r=t.fontStack||e,o=f[r]=f[r]||{};this.calculateGlyphDependencies(t.text,o,i,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},n={},i=[];let r=0;function o(t){i.push(e[t]),r++}function s(e,t,r){const o=n[e];return delete n[e],n[t]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(r[0]),o}function a(e,n,r){const o=t[n];return delete t[n],t[e]=o,i[o].geometry[0].shift(),i[o].geometry[0]=r[0].concat(i[o].geometry[0]),o}function l(e,t,n){const i=n?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(i.x,":").concat(i.y)}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in t&&n[p]!==t[f]){const e=a(p,f,h),r=s(p,f,i[e].geometry);delete t[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[e].geometry=null}else p in n?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=r-1,n[f]=r-1)}return i.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,n,i,r){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,s,n,i,r),this.icon.programConfigurations.updatePaintArrays(e,t,s,n,i,r)}updateZOffset(){const e=(e,t,i)=>{n+=t,n>e.length&&e.resize(n);for(let r=-t;r<0;r++)e.emplace(r+n,i)},t=(e,t,n)=>{i+=t,i>e.length&&e.resize(i);for(let r=-t;r<0;r++)e.emplace(r+i,n)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,i=0;for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:o,numIconVertices:s}=n,a=n.zOffset,l=s>0;if((i>0||o>0)&&(e(this.text.zOffsetVertexArray,i,a),e(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:i}=n;e>=0&&t(this.icon.zOffsetVertexArray,s,a),i>=0&&t(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Zg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:i,y:r}of t)this.lineVertexArray.emplaceBack(i,r);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const _=e.indexArray,g=e.layoutVertexArray,y=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,g,_,this.canOverlap?o.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&s===w_.vertical?Math.PI/2:0,T=o.text&&o.text.sections;for(let E=0;E<t.length;E++){const{tl:i,tr:r,bl:s,br:c,texPrimary:u,texSecondary:h,pixelOffsetTL:x,pixelOffsetBR:b,minFontScaleX:S,minFontScaleY:C,glyphOffset:A,isSDF:I,sectionIndex:M}=t[E],k=v.vertexLength,P=A[1];if(ey(g,l.x,l.y,i.x,P+i.y,u.x,u.y,n,I,x.x,x.y,S,C),ey(g,l.x,l.y,r.x,P+r.y,u.x+u.w,u.y,n,I,b.x,x.y,S,C),ey(g,l.x,l.y,s.x,P+s.y,u.x,u.y+u.h,n,I,x.x,b.y,S,C),ey(g,l.x,l.y,c.x,P+c.y,u.x+u.w,u.y+u.h,n,I,b.x,b.y,S,C),a){const{x:t,y:n,z:i}=a.anchor,[r,o,s]=a.up;ny(y,t,n,i,r,o,s),ny(y,t,n,i,r,o,s),ny(y,t,n,i,r,o,s),ny(y,t,n,i,r,o,s),ry(e.dynamicLayoutVertexArray,t,n,i,w)}else ry(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=h||u;ty(e.iconTransitioningVertexArray,t.x,t.y),ty(e.iconTransitioningVertexArray,t.x+t.w,t.y),ty(e.iconTransitioningVertexArray,t.x,t.y+t.h),ty(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}_.emplaceBack(k,k+1,k+2),_.emplaceBack(k+1,k+2,k+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(A[0]),E!==t.length-1&&M===t[E+1].sectionIndex||e.programConfigurations.populatePaintArrays(g.length,o,o.index,{},d,p,f,T&&T[M])}const S=a?a.anchor:l;e.placedSymbolArray.emplaceBack(S.x,S.y,S.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],s,0,!1,0,h,0)}_commitLayoutVertex(e,t,n,i,r,o,s){e.emplaceBack(t,n,i,r,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,n,i,r,o,s){const a=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let d=0;d<4;d++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new y(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new y(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new y(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new y(e.x1,e.y2)),a.vertexLength+=4;const h=n.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(i,r,this.textCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(i,r,this.iconCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ay(Fa,t_.members,La),this.iconCollisionBox=new ay(Fa,t_.members,La);const n=a_(this.iconSizeData,e),i=a_(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,n,i){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),o=s_(this.textSizeData,e,r)/i_;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,n){const i=this.icon.placedSymbolArray.get(n),r=s_(this.iconSizeData,e,i);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}_updateTextDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,i.padding)}}_updateIconDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceIconSize(e,t,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,i.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=a_(this.iconSizeData,e),i=a_(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,i,r,o,s,a,l){const c={};if(t<n){const{x1:n,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:n,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(i<r){const{x1:t,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(i);c.verticalTextBox={x1:t,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<s){const{x1:t,y1:n,x2:i,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(o);c.iconBox={x1:t,y1:n,x2:i,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:t,y1:n,x2:i,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(a);c.verticalIconBox={x1:t,y1:n,x2:i,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)e.indexArray.emplaceBack(r,r+1,r+2),e.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],r=[],o=[];for(let s=0;s<this.symbolInstances.length;++s){o.push(s);const e=this.symbolInstances.get(s);i.push(0|Math.round(t*e.tileAnchorX+n*e.tileAnchorY)),r.push(e.featureIndex)}return o.sort(((e,t)=>i[e]-i[t]||r[t]-r[e])),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:i,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=t;n>=0&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&r!==n&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Is(ly,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ly.MAX_GLYPHS=65535,ly.addDynamicAttributes=ry;var cy=ly;const uy=ba([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:hy}=uy,dy=ba([{name:"a_packed",components:4,type:"Float32"}]),{members:py}=dy,fy=nm.types,my=Math.cos(Math.PI/180*37.5);class _y{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Aa,this.layoutVertexArray2=new Ia,this.indexArray=new Ua,this.programConfigurations=new Zl(e.layers,e.zoom),this.segments=new dl,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n,i){this.hasPattern=Df("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:c,id:u,index:h,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,t=cp(c,e);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),t,n))continue;const s=r?r.evaluate(t,{},n):void 0,a={id:u,properties:c.properties,type:c.type,sourceLayerIndex:d,index:h,geometry:e?t.geometry:lp(c,n,i),patterns:{},sortKey:s};o.push(a)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:s,featureIndex:a}=t,l=this.addConstantDashes(s);for(const c of o){const{geometry:i,index:r,sourceLayerIndex:o}=c;if(l&&this.addFeatureDashes(c,s),this.hasPattern){const e=Rf("line",this.layers,c,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(c,i,r,n,s.positions,t.availableImages,t.brightness);a.insert(e[r].feature,i,r,o,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==r.kind)t=!0;else{const t=r.value,n=i.value;if(!n)continue;e.addDash(n,t)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let s,a;if("constant"===r.kind){if(s=r.value,!s)continue}else s=r.evaluate({zoom:n},e);a="constant"===o.kind?o.value:o.evaluate({zoom:n},e),t.addDash(s,a),e.patterns[i.id]=t.getKey(s,a)}}update(e,t,n,i,r){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,i,r)}addFeatures(e,t,n,i,r,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,n,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,py)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hy),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,r,o,s){const a=this.layers[0].layout,l=a.get("line-join").evaluate(e,{}),c=a.get("line-cap").evaluate(e,{}),u=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const d of t)this.addLine(d,e,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,s)}addLine(e,t,n,i,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===fy[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(s?3:2))return;"bevel"===n&&(r=1.05);const c=this.overscaling<=16?15*ai/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=e[a-2],m=e[l].sub(h)._unit()._perp());for(let _=l;_<a;_++){if(p=_===a-1?s?e[l+1]:void 0:e[_+1],p&&e[_].equals(p))continue;m&&(f=m),h&&(d=h),h=e[_],m=p?p.sub(h)._unit()._perp():f,f=f||m;let t=f.add(m);0===t.x&&0===t.y||t._unit();const g=f.x*m.x+f.y*m.y,y=t.x*m.x+t.y*m.y,v=0!==y?1/y:1/0,x=2*Math.sqrt(2-2*y),b=y<my&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&_>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const T=d&&p;let S=T?n:s?"butt":i;if(T&&"round"===S&&(v<o?S="miter":v<=2&&(S="fakeround")),"miter"===S&&v>r&&(S="bevel"),"bevel"===S&&(v>2&&(S="flipbevel"),v<r&&(S="miter")),d&&this.updateDistance(d,h),"miter"===S)t._mult(v),this.addCurrentVertex(h,t,0,0,u);else if("flipbevel"===S){if(v>100)t=m.mult(-1);else{const e=v*f.add(m).mag()/f.sub(m).mag();t._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,t,0,0,u),this.addCurrentVertex(h,t.mult(-1),0,0,u)}else if("bevel"===S||"fakeround"===S){const e=-Math.sqrt(v*v-1),t=w?e:0,n=w?0:e;if(d&&this.addCurrentVertex(h,f,t,n,u),"fakeround"===S){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)))}const i=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,i.x,i.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-n,u)}else if("butt"===S)this.addCurrentVertex(h,t,0,0,u);else if("square"===S){const e=d?1:-1;d||this.addCurrentVertex(h,t,e,e,u),this.addCurrentVertex(h,t,0,0,u),d&&this.addCurrentVertex(h,t,e,e,u)}else"round"===S&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&_<a-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=t.y*i-t.x,a=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,r),this.addHalfVertex(e,s,a,o,!0,-i,r)}addHalfVertex(e,t,n,i,r,o,s){let{x:a,y:l}=e;this.layoutVertexArray.emplaceBack((a<<1)+(i?1:0),(l<<1)+(r?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const c=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),s.primitiveLength++),r?this.e2=c:this.e1=c}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Is(_y,"LineBucket",{omit:["layers","patternFeatures"]});class gy{constructor(e,t,n,i){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,n,i){const{width:r,height:o}=e,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=t;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!n||!1!==n.premultiply)),i||this.size&&this.size[0]===r&&this.size[1]===o){const{x:t,y:n}=i||{x:0,y:0};if(e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d)a.texSubImage2D(a.TEXTURE_2D,0,t,n,a.RGBA,a.UNSIGNED_BYTE,e);else{let i=this.format,s=a.UNSIGNED_BYTE;this.format===a.R32F&&(i=a.RED,s=a.FLOAT),a.texSubImage2D(a.TEXTURE_2D,0,t,n,r,o,i,s,e.data)}}else if(this.size=[r,o],e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d){let t=this.format;this.format===a.R8&&(t=a.RED),a.texImage2D(a.TEXTURE_2D,0,this.format,t,a.UNSIGNED_BYTE,e)}else{let t=this.format,n=this.format,i=a.UNSIGNED_BYTE;this.format===a.DEPTH_COMPONENT&&(t=a.DEPTH_COMPONENT16,i=a.UNSIGNED_SHORT),this.format===a.R32F&&(i=a.FLOAT,n=a.RED),a.texImage2D(a.TEXTURE_2D,0,t,r,o,0,n,i,e.data)}this.useMipmap=Boolean(n&&n.useMipmap),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap?e===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,n,i){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?e===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),n!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,n),this.wrapS=n),i!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapT=i)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class yy{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}}const vy=32,xy=33,by=new Uint16Array(8184);for(let uI=0;uI<2046;uI++){let e=uI+2,t=0,n=0,i=0,r=0,o=0,s=0;for(1&e?i=r=o=vy:t=n=s=vy;(e>>=1)>1;){const a=t+i>>1,l=n+r>>1;1&e?(i=t,r=n,t=o,n=s):(t=i,n=r,i=o,r=s),o=a,s=l}const a=4*uI;by[a+0]=t,by[a+1]=n,by[a+2]=i,by[a+3]=r}const wy=new Uint16Array(2178),Ty=new Uint8Array(1089),Sy=new Uint16Array(1089);function Ey(e){return 0===e?-.03125:32===e?.03125:0}var Cy=ba([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ay={type:2,extent:ai,loadGeometry:()=>[[new y(0,0),new y(ai+1,0),new y(ai+1,ai+1),new y(0,ai+1),new y(0,0)]]};class Iy{constructor(e,t,n,i,r){this.tileID=e,this.uid=B(),this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=r,i&&i.style&&(this._lastUpdatedBrightness=i.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<ut.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Tg(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const i of e){const e=i.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)n[t.fqid]=i}}return n}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof cy){if(this.hasSymbolBuckets=!0,!n)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof cy&&t.hasRTLText){this.hasRTLText=!0,$s.isLoading()||$s.isLoaded()||"deferred"!==Qs()||Js();break}}this.queryPadding=0;for(const e in this.buckets){const n=this.buckets[e],i=t.style.getOwnLayer(e);if(!i)continue;const r=i.queryRadius(n);this.queryPadding=Math.max(this.queryPadding,r)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new el}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const n in this.buckets){const t=this.buckets[n];t.uploadPending()&&t.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gy(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gy(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new gy(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,t,n){if(this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,n),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const i=t.style.getBrightness();(this._lastUpdatedBrightness||i)&&(this._lastUpdatedBrightness&&i&&Math.abs(this._lastUpdatedBrightness-i)<.001||(this._lastUpdatedBrightness=i,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,n,i,r,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:s,transform:o,params:r,tileTransform:this.tileTransform},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),r=t?t.sourceLayer:"",o=i._geojsonTileLayer||i[r];if(!o)return;const s=Ro(t&&t.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let h=0;h<o.length;h++){const t=o.feature(h);if(s.needGeometry){const e=cp(t,!0);if(!s.filter(new ea(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!s.filter(new ea(this.tileID.overscaledZ),t))continue;const i=n.getId(t,r),d=new Mm(t,a,l,c,i);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=ee(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let n=!1;if(this.expirationTime>e)n=!1;else if(t)if(this.expirationTime<t)n=!0;else{const i=this.expirationTime-t;i?this.expirationTime=e+Math.max(i,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(e,t){if(!this.latestFeatureIndex)return;const n=this.latestFeatureIndex.loadVTLayers(),i=t.style.listImages(),r=t.style.getBrightness();for(const o in this.buckets){if(!t.style.hasLayer(o))continue;const s=this.buckets[o],a=s.layers[0].sourceLayer||"_geojsonTileLayer",l=n[a];let c={};if(e&&(c=e[a],!l||!c||0===Object.keys(c).length))continue;if(s.update(c,l,i,this.imageAtlas&&this.imageAtlas.patternPositions||{},r),s instanceof _y||s instanceof zf){const e=t.style.getOwnSourceCache(s.layers[0].source);t._terrain&&t._terrain.enabled&&e&&s.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const u=t&&t.style&&t.style.getOwnLayer(o);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(s)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ut.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ut.now()+e}setTexture(e,t){const n=t.context,i=n.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new gy(n,e,i.RGBA,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}setDependencies(e,t){const n={};for(const i of t)n[i]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const n=lp(Ay,this.tileID.canonical,this.tileTransform)[0],i=new Ta,r=new Xa;for(let o=0;o<n.length;o++){const{x:e,y:t}=n[o];i.emplaceBack(e,t),r.emplaceBack(o)}r.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(r),this._tileDebugBuffer=e.createVertexBuffer(i,Dh.members),this._tileDebugSegments=dl.simpleSegment(0,0,i.length,r.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const n=lp(Ay,this.tileID.canonical,this.tileTransform)[0];let i,r;if(this.isRaster){const e=function(e,t){const n=Tg(e,t),i=Math.pow(2,e.z);for(let c=0;c<xy;c++)for(let r=0;r<xy;r++){const o=Wd((e.x+(r+Ey(r))/vy)/i),s=Zd((e.y+(c+Ey(c))/vy)/i),a=t.project(o,s),l=c*xy+r;wy[2*l+0]=Math.round((a.x*n.scale-n.x)*ai),wy[2*l+1]=Math.round((a.y*n.scale-n.y)*ai)}Ty.fill(0),Sy.fill(0);for(let c=2045;c>=0;c--){const e=4*c,t=by[e+0],n=by[e+1],i=by[e+2],r=by[e+3],o=t+i>>1,s=n+r>>1,a=o+s-n,l=s+t-o,u=n*xy+t,h=r*xy+i,d=s*xy+o,p=Math.hypot((wy[2*u+0]+wy[2*h+0])/2-wy[2*d+0],(wy[2*u+1]+wy[2*h+1])/2-wy[2*d+1])>=16;Ty[d]=Ty[d]||(p?1:0),c<1022&&(Ty[d]=Ty[d]||Ty[(n+l>>1)*xy+(t+a>>1)]||Ty[(r+l>>1)*xy+(i+a>>1)])}const r=new Ea,o=new Ua;let s=0;function a(e,t){const n=t*xy+e;return 0===Sy[n]&&(r.emplaceBack(wy[2*n+0],wy[2*n+1],e*ai/vy,t*ai/vy),Sy[n]=++s),Sy[n]-1}function l(e,t,n,i,r,s){const c=e+n>>1,u=t+i>>1;if(Math.abs(e-r)+Math.abs(t-s)>1&&Ty[u*xy+c])l(r,s,e,t,c,u),l(n,i,r,s,c,u);else{const l=a(e,t),c=a(n,i),u=a(r,s);o.emplaceBack(l,c,u)}}return l(0,0,vy,vy,vy,0),l(vy,vy,0,0,0,vy),{vertices:r,indices:o}}(this.tileID.canonical,t);i=e.vertices,r=e.indices}else{i=new Ea,r=new Ua;for(const{x:t,y:r}of n)i.emplaceBack(t,r,0,0);const e=Mf(i.int16,void 0,4);for(let t=0;t<e.length;t+=3)r.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(i,Cy.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(r),this._tileBoundsSegments=dl.simpleSegment(0,0,i.length,r.length)}_makeGlobeTileDebugBuffers(e,t){const n=t.projection;if(!n||"globe"!==n.name||t.freezeTileCoverage)return;const i=this.tileID.canonical,r=vd(cd(i,t)),o=Sd(t.zoom);let s;o>0&&(s=vh.invert(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,i,t,r,s,o),this._makeGlobeTileDebugTextBuffer(e,i,t,r,s,o)}_globePoint(e,t,n,i,r,o,s){let a=_d(e,t,n);if(o){const r=1<<n.z,l=Gd(i.center.lng),c=qd(i.center.lat),u=(n.x+.5)/r-l;let h=0;u>.5?h=-1:u<-.5&&(h=1);let d=(e/ai+n.x)/r+h,p=(t/ai+n.y)/r;d=(d-l)*i._pixelsPerMercatorPixel+l,p=(p-c)*i._pixelsPerMercatorPixel+c;const f=[d*i.worldSize,p*i.worldSize,0];Eh.transformMat4(f,f,o),a=ld(a,f,s)}return Eh.transformMat4(a,a,r)}_makeGlobeTileDebugBorderBuffer(e,t,n,i,r,o){const s=new Ta,a=new Xa,l=new Sa,c=(e,c,u,h,d)=>{const p=(u-e)/(d-1),f=(h-c)/(d-1),m=s.length;for(let _=0;_<d;_++){const u=e+_*p,h=c+_*f;s.emplaceBack(u,h);const d=this._globePoint(u,h,t,n,i,r,o);l.emplaceBack(d[0],d[1],d[2]),a.emplaceBack(m+_)}},u=ai;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(a),this._tileDebugBuffer=e.createVertexBuffer(s,Dh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(l,Ph.members),this._tileDebugSegments=dl.simpleSegment(0,0,s.length,a.length)}_makeGlobeTileDebugTextBuffer(e,t,n,i,r,o){const s=ai/4,a=new Ta,l=new Ua,c=new Sa,u=25;l.reserve(32),a.reserve(u),c.reserve(u);const h=(e,t)=>u*e+t;for(let d=0;d<u;d++){const e=d*s;for(let l=0;l<u;l++){const u=l*s;a.emplaceBack(u,e);const h=this._globePoint(u,e,t,n,i,r,o);c.emplaceBack(h[0],h[1],h[2])}}for(let d=0;d<4;d++)for(let e=0;e<4;e++){const t=h(d,e),n=h(d,e+1),i=h(d+1,e),r=h(d+1,e+1);l.emplaceBack(t,n,i),l.emplaceBack(i,n,r)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(a,Dh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(c,Ph.members),this._tileDebugTextSegments=dl.simpleSegment(0,0,u,32)}}class My{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:t,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const n of t)this.remove(n.value.tileID,n)}}class ky{constructor(e,t,n,i){this.id=ky.uniqueIdxCounter,ky.uniqueIdxCounter++,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=ky.uniqueIdxCounter,ky.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ky.uniqueIdxCounter=0;const Py={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dy{constructor(e,t,n,i,r,o){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.instanceCount=o,this.context=e;const s=e.gl;this.buffer=s.createBuffer(),e.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[Py[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}setVertexAttribDivisor(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(r,n)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ry{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zy extends Ry{getDefault(){return cn.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ly extends Ry{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Oy extends Ry{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Fy extends Ry{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class By extends Ry{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ny extends Ry{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class jy extends Ry{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Uy extends Ry{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Vy extends Ry{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Gy extends Ry{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class qy extends Ry{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class Hy extends Ry{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Wy extends Ry{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class Zy extends Ry{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Xy extends Ry{getDefault(){return cn.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Yy extends Ry{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class Ky extends Ry{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class Qy extends Ry{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Jy extends Ry{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let $y=class extends Ry{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class ev extends Ry{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class tv extends Ry{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class nv extends Ry{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class iv extends Ry{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class rv extends Ry{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ov extends Ry{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class sv extends Ry{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class av extends Ry{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class lv extends Ry{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class cv extends Ry{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class uv extends Ry{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class hv extends Ry{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class dv extends hv{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class pv extends hv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fv extends hv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class mv extends pv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class _v{constructor(e,t,n,i,r){this.context=e,this.width=t,this.height=n;const o=this.framebuffer=e.gl.createFramebuffer();i&&(this.colorAttachment=new dv(e,o)),r&&(this.depthAttachmentType=r,this.depthAttachment="renderbuffer"===r?new pv(e,o):new fv(e,o))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class gv{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}gv.ReadOnly=!1,gv.ReadWrite=!0,gv.disabled=new gv(519,gv.ReadOnly,[0,1]);const yv=7680;class vv{constructor(e,t,n,i,r,o){this.test=e,this.ref=t,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o}}vv.disabled=new vv({func:519,mask:0},0,0,yv,yv,yv);const xv=771;class bv{constructor(e,t,n,i){this.blendFunction=e,this.blendColor=t,this.mask=n,this.blendEquation=i}}bv.Replace=[1,0,1,0],bv.disabled=new bv(bv.Replace,cn.transparent,[!1,!1,!1,!1]),bv.unblended=new bv(bv.Replace,cn.transparent,[!0,!0,!0,!0]),bv.alphaBlended=new bv([1,xv,1,xv],cn.transparent,[!0,!0,!0,!0]),bv.multiply=new bv([774,0,774,0],cn.transparent,[!0,!0,!0,!0]);const wv=1029,Tv=2305;class Sv{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}Sv.disabled=new Sv(!1,wv,Tv),Sv.backCCW=new Sv(!0,wv,Tv),Sv.backCW=new Sv(!0,wv,2304),Sv.frontCW=new Sv(!0,1028,2304),Sv.frontCCW=new Sv(!0,1028,Tv);class Ev{constructor(e){this.gl=e,this.clearColor=new zy(this),this.clearDepth=new Ly(this),this.clearStencil=new Oy(this),this.colorMask=new Fy(this),this.depthMask=new By(this),this.stencilMask=new Ny(this),this.stencilFunc=new jy(this),this.stencilOp=new Uy(this),this.stencilTest=new Vy(this),this.depthRange=new Gy(this),this.depthTest=new qy(this),this.depthFunc=new Hy(this),this.blend=new Wy(this),this.blendFunc=new Zy(this),this.blendColor=new Xy(this),this.blendEquation=new Yy(this),this.cullFace=new Ky(this),this.cullFaceSide=new Qy(this),this.frontFace=new Jy(this),this.program=new $y(this),this.activeTexture=new ev(this),this.viewport=new tv(this),this.bindFramebuffer=new nv(this),this.bindRenderbuffer=new iv(this),this.bindTexture=new rv(this),this.bindVertexBuffer=new ov(this),this.bindElementBuffer=new sv(this),this.bindVertexArrayOES=new av(this),this.pixelStoreUnpack=new lv(this),this.pixelStoreUnpackPremultiplyAlpha=new cv(this),this.pixelStoreUnpackFlipY=new uv(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,n){return new ky(this,e,t,n)}createVertexBuffer(e,t,n,i,r){return new Dy(this,e,t,n,i,r)}createRenderbuffer(e,t,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,n,i){return new _v(this,e,t,n,i)}clear(e){let{color:t,depth:n,stencil:i,colorMask:r}=e;const o=this.gl;let s=0;t&&(s|=o.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==n&&(s|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(s|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),o.clear(s)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){v(e.blendFunction,bv.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Cv extends It{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new My(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new km,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("errored"!==t.state&&("loaded"!==t.state||!t.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return z(this._tiles).map((e=>e.tileID)).sort(Av).map((e=>e.key))}getRenderableIds(e,t){const n=[];for(const i in this._tiles)this._isIdRenderable(+i,e,t)&&n.push(this._tiles[i]);return e?n.sort(((e,t)=>{const n=e.tileID,i=t.tileID,r=new y(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),o=new y(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||o.y-r.y||o.x-r.x})).map((e=>e.tileID.key)):n.map((e=>e.tileID)).sort(Av).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(n||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,i){if(i)if(e.state="errored",404!==i.status)this._source.fire(new At(i,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=ut.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ct("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);n(e,t),n(t,e)}}function n(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const r in this._tiles){let o=this._tiles[r];if(i[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){i[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),i=this._getLoadedTile(t);if(i)return i}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,r=Math.floor(n*i*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(e,t,n,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let r;if(this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Fh(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(r=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(r=r.filter((e=>this._source.hasTile(e))))):r=[],r.length>0&&this.castsShadows&&i&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Iv(this._source.type)){const o=e.coveringZoomLevel({tileSize:t||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),s=Math.min(o,this._source.maxzoom),a=e.extendTileCoverForShadows(r,i,s);for(const e of a)this._shadowCasterTiles[e.key]=!0,r.push(e)}const o=this._updateRetainedTiles(r);if(Iv(this._source.type)&&0!==r.length){const e={},t={},n=Object.keys(o);for(const r of n){const n=o[r],i=this._tiles[r];if(!i||i.fadeEndTime&&i.fadeEndTime<=ut.now())continue;const s=this.findLoadedParent(n,Math.max(n.overscaledZ-Cv.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),e[s.tileID.key]=s.tileID),t[r]=n}const i=r[r.length-1].overscaledZ;for(const r in this._tiles){const e=this._tiles[r];if(o[r]||!e.hasData())continue;let n=e.tileID;for(;n.overscaledZ>i;){n=n.scaledTo(n.overscaledZ-1);const i=this._tiles[n.key];if(i&&i.hasData()&&t[n.key]){o[r]=e.tileID;break}}}for(const r in e)o[r]||(this._coveredTiles[r]=!0,o[r]=e[r])}for(const a in o)this._tiles[a].clearFadeHold();const s=function(e,t){const n=[];for(const i in e)i in t||n.push(i);return n}(this._tiles,o);for(const a of s){const e=this._tiles[a];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+a)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},i=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),r=e[0].overscaledZ,o=Math.max(r-Cv.maxOverzooming,this._source.minzoom),s=Math.max(r+Cv.maxUnderzooming,this._source.minzoom),a={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||i<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,i,s,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let r=l.overscaledZ-1;r>=o;--r){const o=l.scaledTo(r);if(n[o.key])break;if(n[o.key]=!0,e=this.getTile(o),!e&&i&&(e=this._addTile(o)),e&&(t[o.key]=o,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;i=e}for(const e of t)this._loadedParentTiles[e]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return!0!==t.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);if(!n){const n=this.map?this.map.painter:null;t=new Iy(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,n,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new Ct("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,n){const i=[],r=this.transform;if(!r)return i;const o="globe"===r.projection.name,s=Gd(r.center.lng);for(const a in this._tiles){const l=this._tiles[a];if(n&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(k(s,...Mv(e,-1))-s),Math.abs(k(s,...Mv(e,1))-s)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(k(s,...Mv(e,-1))-s),Math.abs(k(s,...Mv(e,0))-s),Math.abs(k(s,...Mv(e,1))-s)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const n of c){const o=e.containsTile(l,r,t,n);o&&i.push(o)}}return i}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const n=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID));for(const i of n)i.projMatrix=this.transform.calculateProjMatrix(i.toUnwrapped());return n}sortCoordinatesByDistance(e){const t=e.slice(),n=this.transform._camera.position,i=this.transform._camera.forward(),r={};for(const o of t){const e=1/(1<<o.canonical.z);r[o.key]=((o.canonical.x+.5)*e+o.wrap-n[0])*i[0]+((o.canonical.y+.5)*e-n[1])*i[1]-n[2]*i[2]}return t.sort(((e,t)=>r[e.key]-r[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(Iv(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=ut.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter((n=>!n.hasDependency(e,t)))}_preloadTiles(e,t){if(!this._sourceLoaded){const n=()=>{this._sourceLoaded&&(this._source.off("data",n),this._preloadTiles(e,t))};return void this._source.on("data",n)}const n=new Map,i=Array.isArray(e)?e:[e],r=this.map.painter.terrain,o=this.usedForTerrain&&r?r.getScaledDemTileSize():this._source.tileSize;for(const s of i){const e=s.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)n.set(t.key,t);this.usedForTerrain&&s.updateElevation(!1)}R(Array.from(n.values()),((e,t)=>{const n=new Iy(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(n,(e=>{"raster-dem"===this._source.type&&n.dem&&this._backfillDEM(n),t(e,n)}))}),t)}}function Av(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Iv(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Mv(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}Cv.maxOverzooming=10,Cv.maxUnderzooming=3;const kv=ba([{name:"a_pos_3f",components:3,type:"Float32"}]),Pv=ba([{name:"a_color_3f",components:3,type:"Float32"}]),Dv=ba([{name:"a_color_4f",components:4,type:"Float32"}]),Rv=ba([{name:"a_uv_2f",components:2,type:"Float32"}]),zv=ba([{name:"a_normal_3f",components:3,type:"Float32"}]),Lv=ba([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Ov=ba([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Fv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=i}interpolate(e,t,n){return null!=t.top&&null!=e.top&&(this.top=Yi(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=Yi(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=Yi(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=Yi(e.right,t.right,n)),this}getCenter(e,t){const n=k((this.left+e-this.right)/2,0,e),i=k((this.top+t-this.bottom)/2,0,t);return new y(n,i)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Fv(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Bv(e,t){const n=re(e,3);vh.fromQuat(e,t),oe(e,3,n)}function Nv(e,t){const n=bh.identity([]);return bh.rotateZ(n,n,-t),bh.rotateX(n,n,-e),n}function jv(e,t){const n=[e[0],e[1],0],i=[t[0],t[1],0];if(Eh.length(n)>=1e-15){const e=Eh.normalize([],n);Eh.scale(i,e,Eh.dot(i,e)),t[0]=i[0],t[1]=i[1]}const r=Eh.cross([],t,e);if(Eh.len(r)<1e-15)return null;const o=Math.atan2(-r[1],r[0]);return Nv(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),o)}class Uv{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(e){if(e){const t=e instanceof ep?e:new ep(e[0],e[1],e[2]);this._renderWorldCopies&&(t.x=D(t.x,0,1)),this._position=t}else this._position=null}lookAtPoint(e,t){if(this.orientation=null,!this.position)return;const n=this.position,i=this._elevation?this._elevation.getAtPointOrZero(ep.fromLngLat(e)):0,r=ep.fromLngLat(e,i),o=[r.x-n.x,r.y-n.y,r.z-n.z];t||(t=[0,0,1]),t[2]=Math.abs(t[2]),this.orientation=jv(o,t)}setPitchBearing(e,t){this.orientation=Nv(w(e),w(-t))}}class Vv{constructor(e,t){this._transform=vh.identity([]),this.orientation=t,this.position=e}get mercatorPosition(){const e=this.position;return new ep(e[0],e[1],e[2])}get position(){const e=re(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var t;e&&oe(this._transform,3,[(t=e)[0],t[1],t[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||bh.identity([]),e&&Bv(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Nv(e,t),Bv(this._transform,this._orientation)}forward(){const e=re(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=re(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=re(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,t){const n=new Float64Array(16);return vh.invert(n,this.getWorldToCamera(e,t)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,t,n){const i=this.position;Eh.scale(i,i,-e);const r=new Float64Array(16);return vh.fromScaling(r,[n,n,n]),vh.translate(r,r,i),r[10]*=t,r}getWorldToCamera(e,t){const n=new Float64Array(16),i=new Float64Array(4),r=this.position;return bh.conjugate(i,this._orientation),Eh.scale(r,r,-e),vh.fromQuat(n,i),vh.translate(n,n,r),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=t,n[9]*=t,n[10]*=t,n[11]*=t,n}getCameraToClipPerspective(e,t,n,i){const r=new Float64Array(16);return vh.perspective(r,e,t,n,i),r}getCameraToClipOrthographic(e,t,n,i,r,o){const s=new Float64Array(16);return vh.ortho(s,e,t,n,i,r,o),s}getDistanceToElevation(e){const t=0===e?0:Hd(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]?Zd(this.position[1]):this.position[1]),n=this.forward();return(t-this.position[2])/n[2]}clone(){return new Vv([...this.position],[...this.orientation])}}function Gv(e,t){const n=Hv(e.projection,e.zoom,e.width,e.height),i=function(e,t,n,i,r){const o=new Nd(n.lng-180*Wv,n.lat),s=new Nd(n.lng+180*Wv,n.lat),a=e.project(o.lng,o.lat),l=e.project(s.lng,s.lat),c=-Math.atan2(l.y-a.y,l.x-a.x),u=ep.fromLngLat(n);u.y=k(u.y,-1+Wv,1-Wv);const h=u.toLngLat(),d=e.project(h.lng,h.lat),p=ep.fromLngLat(h);p.x+=Wv;const f=p.toLngLat(),m=e.project(f.lng,f.lat),_=Xv(m.x-d.x,m.y-d.y,c),g=ep.fromLngLat(h);g.y+=Wv;const y=g.toLngLat(),v=e.project(y.lng,y.lat),x=Xv(v.x-d.x,v.y-d.y,c),b=Math.abs(_.x)/Math.abs(x.y),w=vh.identity([]);vh.rotateZ(w,w,-c*(1-(r?0:i)));const T=vh.identity([]);return vh.scale(T,T,[1,1-(1-b)*i,1]),T[4]=-x.x/x.y*i,vh.rotateZ(T,T,c),vh.multiply(T,w,T),T}(e.projection,0,e.center,n,t),r=qv(e);return vh.scale(i,i,[r,r,1]),i}function qv(e){const t=e.projection,n=Hv(e.projection,e.zoom,e.width,e.height),i=Zv(t,e.center),r=Zv(t,Nd.convert(t.center));return Math.pow(2,i*n+(1-n)*r)}function Hv(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=e.range;if(!o)return 0;const s=Math.min(r,Math.max(n,i)),a=Math.log(s/1024)/Math.LN2;return P(o[0]+a,o[1]+a,t)}const Wv=1/4e4;function Zv(e,t){const n=k(t.lat,-Yd,Yd),i=new Nd(t.lng-180*Wv,n),r=new Nd(t.lng+180*Wv,n),o=e.project(i.lng,n),s=e.project(r.lng,n),a=ep.fromLngLat(i),l=ep.fromLngLat(r),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,d=l.y-a.y,p=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(p)/Math.LN2}function Xv(e,t,n){const i=Math.cos(n),r=Math.sin(n);return{x:e*i-t*r,y:e*r+t*i}}function Yv(e,t,n){return t*(ai/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}const Kv={unknown:0,flipRequired:1,flipNotRequired:2},Qv=Math.tan(85*Math.PI/180);function Jv(e,t,n,i,r,o,s){const a=vh.create();if(n)if("globe"===o.name){const e=function(e,t){const{x:n,y:i}=e.point,r=Td(n,i,e.worldSize/e._pixelsPerMercatorPixel,0,0);return vh.multiply(r,r,xd(ad(t)))}(r,t);vh.multiply(a,a,e)}else{const e=fh.invert([],s);a[0]=e[0],a[1]=e[1],a[4]=e[2],a[5]=e[3],i||vh.rotateZ(a,a,r.angle)}else vh.multiply(a,r.labelPlaneMatrix,e);return a}function $v(e,t,n,i,r,o,s){const a=Jv(e,t,n,i,r,o,s);return"globe"===o.name&&n||(a[2]=a[6]=a[10]=a[14]=0),a}function ex(e,t,n,i,r,o,s){if(n){if("globe"===o.name){const a=Jv(e,t,n,i,r,o,s);return vh.invert(a,a),vh.multiply(a,e,a),a}{const t=vh.clone(e),n=vh.identity([]);return n[0]=s[0],n[1]=s[1],n[4]=s[2],n[5]=s[3],vh.multiply(t,t,n),i||vh.rotateZ(t,t,-r.angle),t}}return r.glCoordMatrix}function tx(e,t,n,i){const r=[e,t,n,1];n?hh.transformMat4(r,r,i):dx(r,r,i);const o=r[3];return r[0]/=o,r[1]/=o,r[2]/=o,r}function nx(e,t){return Math.min(.5+e/t*.5,1.5)}function ix(e,t){const n=e[0]/e[3],i=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&i>=-t[1]&&i<=t[1]}function rx(e,t,n,i,r,o,s,a,l,c){const u=n.transform,h=i?e.textSizeData:e.iconSizeData,d=a_(h,n.transform.zoom),p="globe"===u.projection.name,f=[256/n.width*2+1,256/n.height*2+1],m=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;m.clear();let _=null;p&&(_=i?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const g=e.lineVertexArray,v=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let b,w=!1;for(let T=0;T<v.length;T++){const i=v.get(T),{numGlyphs:p,writingMode:S}=i;if(S!==w_.vertical||w||b===w_.horizontal||(w=!0),b=S,(i.hidden||S===w_.vertical)&&!w){hx(p,m);continue}w=!1;const E=new y(i.tileAnchorX,i.tileAnchorY);let{x:C,y:A,z:I}=u.projection.projectTilePoint(E.x,E.y,c.canonical);if(l){const[e,t,n]=l(E);C+=e,A+=t,I+=n}const M=[C,A,I,1];if(hh.transformMat4(M,M,t),!ix(M,f)){hx(p,m);continue}const k=M[3],P=nx(n.transform.getCameraToCenterDistance(u.projection),k),D=s_(h,d,i),R=s?D/P:D*P,z=tx(C,A,I,r);if(z[3]<=0){hx(p,m);continue}let L={};const O=s?null:l,F=ax(i,R,!1,a,t,r,o,e.glyphOffsetArray,g,m,_,z,E,L,x,O,u.projection,c,s);w=F.useVertical,O&&F.needsFlipping&&(L={}),(F.notEnoughRoom||w||F.needsFlipping&&ax(i,R,!0,a,t,r,o,e.glyphOffsetArray,g,m,_,z,E,L,x,O,u.projection,c,s).notEnoughRoom)&&hx(p,m)}i?(e.text.dynamicLayoutVertexBuffer.updateData(m),_&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(_)):(e.icon.dynamicLayoutVertexBuffer.updateData(m),_&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(_))}function ox(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const{lineStartIndex:_,glyphStartIndex:g,segment:y}=a,v=g+a.numGlyphs,x=_+a.lineLength,b=t.getoffsetX(g),w=t.getoffsetX(v-1),T=ux(e*b,n,i,r,o,s,y,_,x,l,c,u,h,d,!0,p,f,m);if(!T)return null;const S=ux(e*w,n,i,r,o,s,y,_,x,l,c,u,h,d,!0,p,f,m);return S?{first:T,last:S}:null}function sx(e,t,n,i){return e===w_.horizontal&&Math.abs(i)>Math.abs(n)?{useVertical:!0}:e===w_.vertical?i>0?{needsFlipping:!0}:null:t!==Kv.unknown&&function(e,t){return 0===e||Math.abs(t/e)>Qv}(n,i)?t===Kv.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function ax(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g,v){const x=t/24,b=e.lineOffsetX*x,w=e.lineOffsetY*x,{lineStartIndex:T,glyphStartIndex:S,numGlyphs:E,segment:C,writingMode:A,flipState:I}=e,M=T+e.lineLength,k=e=>{if(u){const[t,n,i]=e.up,r=c.length;iy(u,r+0,t,n,i),iy(u,r+1,t,n,i),iy(u,r+2,t,n,i),iy(u,r+3,t,n,i)}const[t,n,i]=e.point;ry(c,t,n,i,e.angle)};if(E>1){const t=ox(x,a,b,w,n,h,d,e,l,o,p,m,!1,_,g,v);if(!t)return{notEnoughRoom:!0};if(i&&!n){let[n,i,r]=t.first.point,[o,a,l]=t.last.point;[n,i]=tx(n,i,r,s),[o,a]=tx(o,a,l,s);const c=sx(A,I,(o-n)*f,a-i);if(e.flipState=c&&c.needsFlipping?Kv.flipRequired:Kv.flipNotRequired,c)return c}k(t.first);for(let e=S+1;e<S+E-1;e++){const t=ux(x*a.getoffsetX(e),b,w,n,h,d,C,T,M,l,o,p,m,!1,!1,_,g,v);if(!t)return c.length-=4*(e-S),{notEnoughRoom:!0};k(t)}k(t.last)}else{if(i&&!n){const t=tx(d.x,d.y,0,r),n=T+C+1,i=new y(l.getx(n),l.gety(n)),o=tx(i.x,i.y,0,r),s=o[3]>0?o:cx(d,i,t,1,r,void 0,_,g.canonical),a=sx(A,I,(s[0]-t[0])*f,s[1]-t[1]);if(e.flipState=a&&a.needsFlipping?Kv.flipRequired:Kv.flipNotRequired,a)return a}const t=ux(x*a.getoffsetX(S),b,w,n,h,d,C,T,M,l,o,p,m,!1,!1,_,g,v);if(!t)return{notEnoughRoom:!0};k(t)}return{}}function lx(e,t,n,i,r){const{x:o,y:s,z:a}=i.projectTilePoint(e.x,e.y,t);if(!r)return tx(o,s,a,n);const[l,c,u]=r(e);return tx(o+l,s+c,a+u,n)}function cx(e,t,n,i,r,o,s,a){const l=lx(e.sub(t)._unit()._add(e),a,r,s,o);return Eh.sub(l,n,l),Eh.normalize(l,l),Eh.scaleAndAdd(l,n,l,i)}function ux(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g){const v=i?e-t:e+t;let x=v>0?1:-1,b=0;i&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=a+s+(x>0?0:1)|0,T=r,S=r,E=0,C=0;const A=Math.abs(v),I=[],M=[];let k=o,P=k;const D=()=>cx(P,k,S,A-E+1,u,d,m,_.canonical);for(;E+C<=A;){if(w+=x,w<a||w>=l)return null;if(S=T,P=k,I.push(S),p&&M.push(P),k=new y(c.getx(w),c.gety(w)),T=h[w],!T){const e=lx(k,_.canonical,u,m,d);T=e[3]>0?h[w]=e:D()}E+=C,C=Eh.distance(S,T)}f&&d&&(h[w]&&(T=D(),C=Eh.distance(S,T)),h[w]=T);const R=(A-E)/C,z=k.sub(P)._mult(R)._add(P),L=Eh.sub([],T,S),O=Eh.scaleAndAdd([],S,L,R);let F=[0,0,1],B=L[0],N=L[1];if(g&&(F=m.upVector(_.canonical,z.x,z.y),0!==F[0]||0!==F[1]||1!==F[2])){const e=[F[2],0,-F[0]],t=Eh.cross([],F,e);Eh.normalize(e,e),Eh.normalize(t,t),B=Eh.dot(L,e),N=Eh.dot(L,t)}if(n){const e=Eh.cross([],F,L);Eh.normalize(e,e),Eh.scaleAndAdd(O,O,e,n*x)}const j=b+Math.atan2(N,B);return I.push(O),p&&M.push(z),{point:O,angle:j,path:I,tilePath:M,up:F}}function hx(e,t){const n=t.length,i=n+4*e;t.resize(i),t.float32.fill(-1/0,4*n,4*i)}function dx(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15],e}const px=(e,t,n)=>(1-n)*e+n*t,fx=e=>e*e*e*e*e;class mx{constructor(e,t,n,i,r,o,s){this.tileSize=512,this._renderWorldCopies=void 0===r||r,this._minZoom=e||0,this._maxZoom=t||22,this._minPitch=null==n?0:n,this._maxPitch=null==i?60:i,this.setProjection(o),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new Nd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Fv,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Vv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new mx(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||n)&&this._updateCameraOnTerrain(),(e||n)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return O(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const t=this.projection?this.getProjection():void 0;this.projection=Zg(this.projectionOptions);const n=!v(t,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Zg({name:"mercator"});const t=e!==this.projection.name;return t&&this._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Hd(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new y(this.width,this.height)}get bearing(){return D(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const t=-e*Math.PI/180;this.angle!==t&&(this._unmodified=!1,this.angle=t,this._calcMatrices(),this.rotationMatrix=fh.create(),fh.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const t=k(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==t&&(this._unmodified=!1,this._pitch=t,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=w(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&n.exaggeration()&&this._centerAltitudeValidForExaggeration!==n.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*n.exaggeration(),this._centerAltitudeValidForExaggeration=n.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=n.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,t=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let i=0,r=0;for(let o=0;o<t.length;o++){const s=new y(t[o][0]*this.width,n+t[o][1]*(this.height-n)),a=e.pointCoordinate(s);if(!a)continue;const l=1/Math.hypot(a[0]-this._camera.position[0],a[1]-this._camera.position[1]);i+=a[3]*l,r+=l}return 0===r?NaN:i/r}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*t,i=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),o=Math.max(i-n,r);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){const t=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let n;n=e.z<this._camera.position[2]?[t.x,t.y,t.z]:[e.x,e.y,e.z];const i=Eh.length(Eh.sub([],this._camera.position,n));return k(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let t=!1;if(e.orientation&&!bh.exactEquals(e.orientation,this._camera.orientation)&&(t=this._setCameraOrientation(e.orientation)),e.position){const n=[e.position.x,e.position.y,e.position.z];Eh.exactEquals(n,this._camera.position)||(this._setCameraPosition(n),t=!0)}t&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,t=new Uv;return t.position=new ep(e[0],e[1],e[2]),t.orientation=this._camera.orientation,t._elevation=this.elevation,t._renderWorldCopies=this.renderWorldCopies,t}_setCameraOrientation(e){if(!bh.length(e))return!1;bh.normalize(e,e);const t=Eh.transformQuat([],[0,0,-1],e),n=Eh.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;const i=jv(t,n);return!!i&&(this._camera.orientation=i,!0)}_setCameraPosition(e){const t=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;e[2]=k(e[2],i/n,i/t),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(e){const t=[new Oh(0,e)];if(this.renderWorldCopies){const n=this.pointCoordinate(new y(0,0)),i=this.pointCoordinate(new y(this.width,0)),r=this.pointCoordinate(new y(this.width,this.height)),o=this.pointCoordinate(new y(0,this.height)),s=Math.floor(Math.min(n.x,i.x,r.x,o.x)),a=Math.floor(Math.max(n.x,i.x,r.x,o.x)),l=1;for(let c=s-l;c<=a+l;c++)0!==c&&t.push(new Oh(c,e))}return t}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,t,n){let i=[];if(0===t[0]&&0===t[1])return i;for(const o of e){const e=o.canonical,n=o.overscaledZ,r=o.wrap,s=1<<e.z,a=e.x+1<s,l=e.x>0,c=e.y+1<s,u=e.y>0,h=o.wrap-(l?0:1),d=o.wrap+(a?0:1),p=l?e.x-1:s-1,f=a?e.x+1:0;t[0]<0?(i.push(new Fh(n,d,e.z,f,e.y)),t[1]<0&&c&&(i.push(new Fh(n,r,e.z,e.x,e.y+1)),i.push(new Fh(n,d,e.z,f,e.y+1))),t[1]>0&&u&&(i.push(new Fh(n,r,e.z,e.x,e.y-1)),i.push(new Fh(n,d,e.z,f,e.y-1)))):t[0]>0?(i.push(new Fh(n,h,e.z,p,e.y)),t[1]<0&&c&&(i.push(new Fh(n,r,e.z,e.x,e.y+1)),i.push(new Fh(n,h,e.z,p,e.y+1))),t[1]>0&&u&&(i.push(new Fh(n,r,e.z,e.x,e.y-1)),i.push(new Fh(n,h,e.z,p,e.y-1)))):t[1]<0&&c?i.push(new Fh(n,r,e.z,e.x,e.y+1)):u&&i.push(new Fh(n,r,e.z,e.x,e.y-1))}if(i.length>1){i.sort(((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y));let e=0,t=0;for(;t<i.length;)i[t].equals(i[e])?++t:i[++e]=i[t++];i.length=e+1}const r=[];for(const o of i)i.some((e=>o.isChildOf(e)))||r.push(o);return i=r.filter((t=>!e.some((e=>!!(t.overscaledZ<n&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e))))),i}coveringTiles(e){let t=this.coveringZoomLevel(e);const n=t,i=this.elevation&&this.elevation.exaggeration(),r=i&&!e.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==e.minzoom&&t<e.minzoom)return[];void 0!==e.maxzoom&&t>e.maxzoom&&(t=e.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,l=1<<t,c=[l*s.x,l*s.y,0],u="globe"===this.projection.name,h=!u,d=Wh.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*Hd(1,this.center.lat),m=this._camera.position[2]/Hd(1,this.center.lat),_=[l*p.x,l*p.y,m*(h?1:f)],g=u||i,y=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),v=this.isLODDisabled(!0)?t:0,x=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,b=e.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,w=this.projection.isReprojectedInTileSpace?qv(this):1,T=e=>{const t=1/4e4,n=new ep(e.x+t,e.y,e.z),i=new ep(e.x,e.y+t,e.z),r=e.toLngLat(),o=n.toLngLat(),s=i.toLngLat(),a=this.locationCoordinate(r),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=Math.hypot(l.x-a.x,l.y-a.y),h=Math.hypot(c.x-a.x,c.y-a.y);return Math.sqrt(u*h)*w/t},E=e=>{const t=x,n=b;return{aabb:Sg(this,l,0,0,0,e,n,t,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:t,wrap:e,fullyVisible:!1}},C=[];let A=[];const I=t,M=e.reparseOverscaled?n:t,k=e=>e*e,P=k((m-this._centerAltitude)*f),D=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),n=e.aabb;t?(n.min[2]=t.min,n.max[2]=t.max,n.center[2]=(n.min[2]+n.max[2])/2):(e.shouldSplit=R(e),e.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},R=e=>{if(e.zoom<v)return!0;if(e.zoom===I)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const t=e.aabb.distanceX(_),i=e.aabb.distanceY(_);let o=P,s=1;if(u){o=k(e.aabb.distanceZ(_));const t=Math.pow(2,e.zoom),n=Zd((e.y+1)/t),i=Zd(e.y/t),r=Math.min(Math.max(a,n),i),l=Vd(r)/Vd(a);if(s=r===a?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,l/this._mercatorScaleRatio),this.zoom<=Xh&&e.zoom===I-1&&l>=.9)return!0}else if(r&&(o=k(e.aabb.distanceZ(_)*f)),this.projection.isReprojectedInTileSpace&&n<=5){const t=Math.pow(2,e.zoom),n=T(new ep((e.x+.5)/t,(e.y+.5)/t));s=n>.85?1:n}const l=t*t+i*i+o,c=k((1<<I-e.zoom)*y*s*((e,t)=>{if(t*k(.707)<e)return 1;const n=Math.sqrt(t/e);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(o,P),l));return l<c};if(this.renderWorldCopies)for(let S=1;S<=3;S++)C.push(E(-S)),C.push(E(S));for(C.push(E(0));C.length>0;){const n=C.pop(),i=n.x,s=n.y;let a=n.fullyVisible;const h=()=>"globe"===this.projection.name&&(0===n.y||n.y===(1<<n.zoom)-1);if(!a){let e=g?n.aabb.intersects(d):n.aabb.intersectsFlat(d);if(0===e&&h()){const t=new Lh(n.zoom,i,s);e=hd(this,l,t,!0).intersects(d)}if(0===e)continue;a=2===e}if(n.zoom!==I&&R(n))for(let e=0;e<4;e++){const t=(i<<1)+e%2,c=(s<<1)+(e>>1),h={aabb:o?n.aabb.quadrant(e):Sg(this,l,n.zoom+1,t,c,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:t,y:c,wrap:n.wrap,fullyVisible:a,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};r&&!u&&(h.tileID=new Fh(n.zoom+1===I?M:n.zoom+1,n.wrap,n.zoom+1,t,c),D(h)),C.push(h)}else{const r=n.zoom===I?M:n.zoom;if(e.minzoom&&e.minzoom>r)continue;if(!a){let e=g?n.aabb.intersectsPrecise(d):n.aabb.intersectsPreciseFlat(d);if(0===e&&h()){const t=new Lh(n.zoom,i,s);e=hd(this,l,t,!0).intersectsPrecise(d)}if(0===e)continue}const o=c[0]-(.5+i+(n.wrap<<n.zoom))*(1<<t-n.zoom),u=c[1]-.5-s,p=n.tileID?n.tileID:new Fh(r,n.wrap,n.zoom,i,s);A.push({tileID:p,distanceSq:o*o+u*u})}}if(this.fogCullDistSq){const t=this.fogCullDistSq,n=this.horizonLineFromTop();A=A.filter((i=>{const r=[0,0,0,1],o=[ai,ai,0,1],s=this.calculateFogTileMatrix(i.tileID.toUnwrapped());hh.transformMat4(r,r,s),hh.transformMat4(o,o,s);const a=function(e,t,n){let i=0;for(let r=0;r<2;++r){const n=0;e[r]>n&&(i+=(e[r]-n)*(e[r]-n)),t[r]<n&&(i+=(n-t[r])*(n-t[r]))}return i}(hh.min([],r,o),hh.max([],r,o));if(0===a)return!0;let l=!1;const c=this._elevation;if(c&&a>t&&0!==n){const t=this.calculateProjMatrix(i.tileID.toUnwrapped());let r;e.isTerrainDEM||(r=c.getMinMaxForTile(i.tileID)),r||(r={min:b,max:x});const o=function(e){const t=Math.round((e+45+360)%360/90)%4;return S[t]}(this.rotation),s=[o[0]*ai,o[1]*ai,r.max];Eh.transformMat4(s,s,t),l=(1-s[1])*this.height*.5<n}return a<t||l}))}return A.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const t=k(e.lat,-Yd,Yd),n=this.projection.project(e.lng,t);return new y(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Hd(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,t){let n,i;const r=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;n=(t.x-r.x)/e,i=(t.y-r.y)/e}else{const e=this.pointCoordinate(t),o=this.pointCoordinate(r);n=e.x-o.x,i=e.y-o.y}const o=this.locationCoordinate(e);this.setLocation(new ep(o.x-n,o.y-i))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,t){const n=t?Hd(t,e.lat):void 0,i=this.projection.project(e.lng,e.lat);return new ep(i.x,i.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,t){const n=null!=t?t:this._centerAltitude,i=[e.x,e.y,0,1],r=[e.x,e.y,1,1];hh.transformMat4(i,i,this.pixelMatrixInverse),hh.transformMat4(r,r,this.pixelMatrixInverse);const o=r[3];hh.scale(i,i,1/i[3]),hh.scale(r,r,1/o);const s=i[2],a=r[2];return{p0:i,p1:r,t:s===a?0:(n-s)/(a-s)}}screenPointToMercatorRay(e){const t=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return hh.transformMat4(t,t,this.pixelMatrixInverse),hh.transformMat4(n,n,this.pixelMatrixInverse),hh.scale(t,t,1/t[3]),hh.scale(n,n,1/n[3]),t[2]=Hd(t[2],this._center.lat)*this.worldSize,n[2]=Hd(n[2],this._center.lat)*this.worldSize,hh.scale(t,t,1/this.worldSize),hh.scale(n,n,1/this.worldSize),new jh([t[0],t[1],t[2]],Eh.normalize([],Eh.sub([],n,t)))}rayIntersectionCoordinate(e){const{p0:t,p1:n,t:i}=e,r=Hd(t[2],this._center.lat),o=Hd(n[2],this._center.lat);return new ep(Yi(t[0],n[0],i)/this.worldSize,Yi(t[1],n[1],i)/this.worldSize,Yi(r,o,i))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let t=this.projection.pointCoordinate3D(this,e.x,e.y);if(t)return new ep(t[0],t[1],t[2]);let n=0,i=this.horizonLineFromTop();if(e.y>i)return this.pointCoordinate(e);const r=.02*i,o=e.clone();for(let s=0;s<10&&i-n>r;s++){o.y=Yi(n,i,.66);const e=this.projection.pointCoordinate3D(this,o.x,o.y);e?(i=o.y,t=e):n=o.y}return t?new ep(t[0],t[1],t[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=Yh)return!this.isPointAboveHorizon(e);const t=this.pointCoordinate(e);return t.y>=0&&t.y<=1}_coordinatePoint(e,t){const n=t&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,i=[e.x*this.worldSize,e.y*this.worldSize,n+e.toAltitude(),1];return hh.transformMat4(i,i,this.pixelMatrix),i[3]>0?new y(i[0]/i[3],i[1]/i[3]):new y(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:t}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,i=this.width-this._edgeInsets.right,r=this.pointLocation3D(new y(t,e)),o=this.pointLocation3D(new y(i,e)),s=this.pointLocation3D(new y(i,n)),a=this.pointLocation3D(new y(t,n));let l=Math.min(r.lng,o.lng,s.lng,a.lng),c=Math.max(r.lng,o.lng,s.lng,a.lng),u=Math.min(r.lat,o.lat,s.lat,a.lat),h=Math.max(r.lat,o.lat,s.lat,a.lat);const d=Math.pow(2,-this.zoom)/16*270,p="globe"===this.projection.name?1:4,f=(e,t,n,i,r)=>{const o=(e+n)/2,s=(t+i)/2,a=new y(o,s),{lng:m,lat:_}=this.pointLocation3D(a),g=Math.max(0,l-m,u-_,m-c,_-h);l=Math.min(l,m),c=Math.max(c,m),u=Math.min(u,_),h=Math.max(h,_),(r<p||g>d)&&(f(e,t,o,s,r+1),f(o,s,n,i,r+1))};if(f(t,e,i,e,1),f(i,e,i,n,1),f(i,n,t,n,1),f(t,n,t,e,1),"globe"===this.projection.name){const[e,t]=function(e){const t=vh.identity(new Float64Array(16));vh.multiply(t,e.pixelMatrix,e.globeMatrix);const n=[0,ed,0],i=[0,td,0];return Eh.transformMat4(n,n,t),Eh.transformMat4(i,i,t),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!Pd(e,new Nd(e.center.lat,90)),i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!Pd(e,new Nd(e.center.lat,-90))]}(this);e?(h=90,c=180,l=-180):t&&(u=-90,c=180,l=-180)}return new $l(new Nd(l,u),new Nd(c,h))}_getBoundsRectangular(e,t){const{top:n,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,s=new y(i,n),a=new y(o,n),l=new y(o,r),c=new y(i,r);let u=this.pointCoordinate(s,e),h=this.pointCoordinate(a,e);const d=this.pointCoordinate(l,t),p=this.pointCoordinate(c,t),f=(e,t)=>(t.y-e.y)/(t.x-e.x);return u.y>1&&h.y>=0?u=new ep((1-p.y)/f(p,u)+p.x,1):u.y<0&&h.y<=1&&(u=new ep(-p.y/f(p,u)+p.x,0)),h.y>1&&u.y>=0?h=new ep((1-d.y)/f(d,h)+d.x,1):h.y<0&&u.y<=1&&(h=new ep(-d.y/f(d,h)+d.x,0)),(new $l).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(d))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,n=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,n):n}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-Yd,this.maxLat=Yd,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Gd(this.minLng)*this.tileSize,this.worldMaxX=Gd(this.maxLng)*this.tileSize,this.worldMinY=qd(this.maxLat)*this.tileSize,this.worldMaxY=qd(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(e){const t=e.key,n=this._distanceTileDataCache;if(n[t])return n[t];const i=e.canonical,r=1/this.height,o=this.cameraWorldSize,s=o/this.zoomScale(i.z),a=(i.x+Math.pow(2,i.z)*e.wrap)*s,l=i.y*s,c=this.point;c.x*=o/this.worldSize,c.y*=o/this.worldSize;const u=this.angle,h=Math.sin(-u),d=-Math.cos(-u);return n[t]={bearing:[h,d],center:[(c.x-a)*r,(c.y-l)*r],scale:s/ai*r},n[t]}calculateFogTileMatrix(e){const t=e.key,n=this._fogTileMatrixCache;if(n[t])return n[t];const i=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return vh.multiply(i,this.worldToFogMatrix,i),n[t]=new Float32Array(i),n[t]}calculateProjMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.key,i=t?this._alignedProjMatrixCache:this._projMatrixCache;if(i[n])return i[n];const r=this.calculatePosMatrix(e,this.worldSize);return vh.multiply(r,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:t?this.alignedProjMatrix:this.projMatrix,r),i[n]=new Float32Array(r),i[n]}calculatePixelsToTileUnitsMatrix(e){const t=e.tileID.key,n=this._pixelsToTileUnitsCache;if(n[t])return n[t];const i=function(e,t){const{scale:n}=e.tileTransform,i=n*ai/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return fh.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[i,i])}(e,this);return n[t]=i,n[t]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,t=vh.fromScaling([],[e,e,e]);return vh.multiply(t,t,this.globeMatrix),t}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const t=Hd(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(t),i=this._camera.forward(),r=Hd(1,this._center.lat);n[2]/=r,i[2]/=r,Eh.normalize(i,i);const o=e.raycast(n,i,e.exaggeration());if(o){const e=Eh.scaleAndAdd([],n,i,o),t=new ep(e[0],e[1],Hd(e[2],Zd(e[1]))),s=(t.z+Eh.length([t.x-n[0],t.y-n[1],t.z-n[2]*r]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=t.toAltitude(),this._center=this.coordinateLocation(t),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const t=this._elevation,n=Hd(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),r=t.getAtPointOrZero(new ep(...i)),o=this.pixelsPerMeter/this.worldSize*r,s=this._minimumHeightOverTerrain(),a=i[2]-o;if(a<=s)if(a<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),t=[i[0],i[1],e.z-i[2]],n=Eh.length(t);t[2]-=(s-a)/this._pixelsPerMercatorPixel;const r=Eh.length(t);if(0===r)return;Eh.scale(t,t,n/r*this._pixelsPerMercatorPixel),this._camera.position=[i[0],i[1],e.z*this._pixelsPerMercatorPixel-t[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const t=this.center;return t.lat=k(t.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(t.lng=k(t.lng,this.minLng,this.maxLng)),this.center=t,void(this._constraining=!1)}const t=this._unmodified,{x:n,y:i}=this.point;let r=0,o=n,s=i;const a=this.width/2,l=this.height/2,c=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(i-l<c&&(s=c+l),i+l>u&&(s=u-l),u-c<this.height&&(r=Math.max(r,this.height/(u-c)),s=(u+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,i=this.worldSize/2-(e+t)/2;o=(n+i+this.worldSize)%this.worldSize-i,o-a<e&&(o=e+a),o+a>t&&(o=t-a),t-e<this.width&&(r=Math.max(r,this.width/(t-e)),o=(t+e)/2)}o===n&&s===i||(this.center=this.unproject(new y(o,s))),r&&(this.zoom+=this.scaleZoom(r)),this._constrainCamera(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,t="globe"===this.projection.name,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=Hd(1,this.center.lat)/Hd(1,45));const i=Hv(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,i),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const r="meters"===this.projection.zAxisUnit?n:1,o=this._camera.getWorldToCamera(this.worldSize,r);let s;const a=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(a[8]=2*-e.x/this.width,a[9]=2*e.y/this.height,this.isOrthographic){let t=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),n=t*this.aspect,i=-n,r=-t;n-=e.x,i-=e.x,t+=e.y,r+=e.y,s=this._camera.getCameraToClipOrthographic(i,n,r,t,this._nearZ,this._farZ),((e,t,n,i)=>{for(let r=0;r<16;r++)e[r]=px(t[r],n[r],i)})(s,s,a,fx(this.pitch>=15?1:this.pitch/15))}else s=a;const l=vh.mul([],a,o);let c=vh.mul([],s,o);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),t=vh.identity([]);vh.translate(t,t,[e.x*this.worldSize,e.y*this.worldSize,0]),vh.multiply(t,t,Gv(this)),vh.translate(t,t,[-e.x*this.worldSize,-e.y*this.worldSize,0]),vh.multiply(c,c,t),vh.multiply(l,l,t),this.inverseAdjustmentMatrix=function(e){const t=Gv(e,!0);return fh.invert([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=vh.scale([],c,[this.worldSize,this.worldSize,this.worldSize/r,1]),this.projMatrix=c,this.invProjMatrix=vh.invert(new Float64Array(16),this.projMatrix);const u=vh.invert([],s);this.frustumCorners=Uh.fromInvProjectionMatrix(u,this.horizonLineFromTop(),this.height),this.cameraFrustum=Wh.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!t);const h=new Float32Array(16);vh.identity(h),vh.scale(h,h,[1,-1,1]),vh.rotateX(h,h,this._pitch),vh.rotateZ(h,h,this.angle);const d=vh.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=vh.clone(d);const p=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;d[8]=2*-e.x/this.width,d[9]=2*(e.y+p)/this.height,this.skyboxMatrix=vh.multiply(h,d,h);const f=this.point,m=f.x,_=f.y,g=this.width%2/2,y=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),b=m-Math.round(m)+v*g+x*y,w=_-Math.round(_)+v*y+x*g,T=new Float64Array(c);if(vh.translate(T,T,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=T,c=vh.create(),vh.scale(c,c,[this.width/2,-this.height/2,1]),vh.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=vh.create(),vh.scale(c,c,[1,-1,1]),vh.translate(c,c,[-1,-1,0]),vh.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=vh.multiply(new Float64Array(16),this.labelPlaneMatrix,l),this._calcFogMatrices(),this._distanceTileDataCache={},c=vh.invert(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=c,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(e){const{x:t,y:n}=e.point,{lng:i,lat:r}=e._center;return Td(t,n,e.worldSize,i,r)}(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=Eh.transformMat4(e,e,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=c;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,t=this.cameraPixelsPerMeter,n=this._camera.position,i=1/this.height/this._pixelsPerMercatorPixel,r=[e,e,t];Eh.scale(r,r,i),Eh.scale(n,n,-1),Eh.multiply(n,n,r);const o=vh.create();vh.translate(o,o,n),vh.scale(o,o,r),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,t,i)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),i=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[i.x/this.worldSize-n[0]*r,i.y/this.worldSize-n[1]*r,e/this.worldSize*this._centerAltitude-n[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const t=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],i=e[2];let r=1;this.projection.wrap&&(this.center=this.center.wrap()),i>0&&(r=Math.min((t-n)/i,1)),this._camera.position=Eh.scaleAndAdd([],this._camera.position,e,r),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,t=this._camera.forward(),{pitch:n,bearing:i}=this._camera.getPitchBearing(),r=Hd(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(w(this._maxPitch)),s=Math.max((e[2]-r)/Math.cos(n),o),a=this._zoomFromMercatorZ(s);Eh.scaleAndAdd(e,e,t,s),this._pitch=k(n,w(this.minPitch),w(this.maxPitch)),this.angle=D(i,-Math.PI,Math.PI),this._setZoom(k(a,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new ep(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let t=0,n=Yh,i=0,r=1/0;for(;n-t>1e-6&&n>t;){const o=t+.5*(n-t),s=this.tileSize*Math.pow(2,o),a=this.getCameraToCenterDistance(this.projection,o,s),l=this.scaleZoom(a/(e*this.tileSize)),c=Math.abs(o-l);c<r&&(r=c,i=o),o<l?t=o:n=o}return i}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,t){const n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),r=Math.min(e.y,t.y),o=Math.max(e.y,t.y);if(r<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new y(n,r),new y(i,o),new y(n,o),new y(i,r)],a=this.renderWorldCopies?-3:0,l=this.renderWorldCopies?4:1;for(const c of s){const e=this.pointRayIntersection(c);if(e.t<0)return!0;const t=this.rayIntersectionCoordinate(e);if(t.x<a||t.y<0||t.x>l||t.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+T(this.fovAboveCenter)>88||this.anyCornerOffEdge(new y(0,0),new y(this.width,this.height))}zoomDeltaToMovement(e,t){const n=Eh.length(Eh.sub([],this._camera.position,e)),i=this._zoomFromMercatorZ(n)+t;return n-this._mercatorZfromZoom(i)}getCameraPoint(){if("globe"===this.projection.name){const e=function(e,t){let[n,i,r]=e;const o=[n,i,r,1];hh.transformMat4(o,o,t);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new y(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y(0,e))}}getCameraToCenterDistance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const i=Hv(e,t,this.width,this.height,1024),r=e.pixelSpaceConversion(this.center.lat,n,i);let o=.5/Math.tan(.5*this._fov)*this.height*r;return this.isOrthographic&&(o=px(1,o,fx(this.pitch>=15?1:this.pitch/15))),o}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&vh.multiply(e,e,this.globeMatrix),e}getFrustum(e){return Wh.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}function _x(e,t,n){vh.identity(e),vh.rotateZ(e,e,w(t[2])),vh.rotateX(e,e,w(t[0])),vh.rotateY(e,e,w(t[1])),vh.scale(e,e,n),vh.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function gx(e,t,n,i,r,o,s,a){const l=[n[0]-t[0],n[1]-t[1],0],c=[i[0]-t[0],i[1]-t[1],0];if(Eh.length(l)<1e-12||Eh.length(c)<1e-12)return bh.identity(e);const u=Eh.cross([],l,c);Eh.normalize(u,u),Eh.subtract(c,i,t),l[2]=(o-r)*a,c[2]=(s-r)*a;const h=l;return Eh.cross(h,l,c),Eh.normalize(h,h),bh.rotationTo(e,u,h)}function yx(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Sd(t.zoom),r=function(e,t,n){const i=t.worldSize,r=[e[12],e[13],e[14]],o=Zd(r[1]/i),s=Wd(r[0]/i),a=vh.identity([]),l=Hd(1,o)*i,c=Hd(1,0)*i*Qd(o,t.zoom),u=1/bd(i);let h=c*u;if(n){const e=Hv(t.projection,t.zoom,t.width,t.height,1024);h=u*t.projection.pixelSpaceConversion(t.center.lat,i,e)}const d=md(o,s);Eh.add(d,d,Eh.scale([],Eh.normalize([],d),l*h*r[2]));const p=function(e){const t=[e[0],e[1],e[2]];let n=[0,1,0];const i=Eh.cross([],n,t);return Eh.cross(n,t,i),0===Eh.squaredLength(n)&&(n=[0,1,0],Eh.cross(i,t,n)),Eh.normalize(i,i),Eh.normalize(n,n),Eh.normalize(t,t),[i[0],i[1],i[2],0,n[0],n[1],n[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(d);vh.scale(a,a,[h,h,h*l]),vh.translate(a,a,[-r[0],-r[1],-r[2]]);const f=vh.multiply([],t.globeMatrix,p);return vh.multiply(f,f,a),vh.multiply(f,f,e),f}(e,t,n);if(i>0){const n=function(e,t){const n=t.worldSize,i=Hd(1,0)*n*Qd(t.center.lat,t.zoom)/bd(n),r=Hd(1,t.center.lat)*n,o=vh.identity([]);return vh.rotateY(o,o,w(t.center.lng)),vh.rotateX(o,o,w(t.center.lat)),vh.translate(o,o,[0,0,Kh]),vh.scale(o,o,[i,i,i*r]),vh.translate(o,o,[t.point.x-.5*n,t.point.y-.5*n,0]),vh.multiply(o,o,e),vh.multiply(o,t.globeMatrix,o)}(e,t);return function(e,t,n){const i=(e,t,n)=>{const i=Eh.length(e),r=Eh.length(t),o=ld(e,t,n);return Eh.scale(o,o,1/Eh.length(o)*Yi(i,r,n))},r=i([e[0],e[1],e[2]],[t[0],t[1],t[2]],n),o=i([e[4],e[5],e[6]],[t[4],t[5],t[6]],n),s=i([e[8],e[9],e[10]],[t[8],t[9],t[10]],n),a=ld([e[12],e[13],e[14]],[t[12],t[13],t[14]],n);return[r[0],r[1],r[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],1]}(r,n,i)}return r}const vx=64,xx=[1,1,1];class bx{constructor(e,t,n,i){this.id=e,this.position=null!=t?new Nd(t[0],t[1]):new Nd(0,0),this.orientation=null!=n?n:[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new Zh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(vh.multiply(e.matrix,t,e.matrix),e.meshes)for(const n of e.meshes){const t=Zh.applyTransform(n.aabb,e.matrix);this.aabb.encapsulate(t)}if(e.children)for(const n of e.children)this._applyTransformations(n,e.matrix)}computeBoundsAndApplyParent(){const e=vh.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}_positionModelOnTerrain(e,t){const n=e.elevation;if(!n)return 0;const i=Zh.projectAabbCorners(this.aabb,this.matrix),r=Hd(1,this.position.lat)*e.worldSize,o=function(e,t){const n=[0,0,1],i=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const r of i){const i=e[r.corners[0]],o=e[r.corners[1]],s=e[r.corners[2]],a=[o[0]-i[0],o[1]-i[1],t*(o[2]-i[2])],l=Eh.cross(a,a,[s[0]-i[0],s[1]-i[1],t*(s[2]-i[2])]);Eh.normalize(l,l),r.dotProductWithUp=Eh.dot(l,n)}return i.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),i[0].corners}(i,r),s=i[o[0]],a=i[o[1]],l=i[o[2]],c=i[o[3]],u=n.getAtPointOrZero(new ep(s[0]/e.worldSize,s[1]/e.worldSize),0),h=n.getAtPointOrZero(new ep(a[0]/e.worldSize,a[1]/e.worldSize),0),d=n.getAtPointOrZero(new ep(l[0]/e.worldSize,l[1]/e.worldSize),0),p=n.getAtPointOrZero(new ep(c[0]/e.worldSize,c[1]/e.worldSize),0),f=(u+p)/2,m=(h+d)/2;return f>m?h<d?gx(t,a,c,s,h,p,u,r):gx(t,l,s,c,d,u,p,r):u<p?gx(t,s,a,l,u,h,d,r):gx(t,c,l,a,p,d,h,r),Math.max(f,m)}computeModelMatrix(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const a=e.transform,l=a.zoom,c=a.project(this.position),u=Qd(this.position.lat,l),h=1/u;vh.identity(this.matrix),vh.translate(this.matrix,this.matrix,[c.x+i[0]*h,c.y+i[1]*h,i[2]]);let d=1,p=1;const f=a.worldSize;if(s){if("mercator"===a.projection.name){let e=0;a.elevation&&(e=a.elevation.getAtPointOrZero(new ep(c.x/f,c.y/f),0));const t=hh.transformMat4([],[c.x,c.y,e,1],a.projMatrix)[3]/a.cameraToCenterDistance;d=t,p=t*Qd(a.center.lat,l)}else if("globe"===a.projection.name){const e=yx(this.matrix,a),t=vh.multiply([],a.projMatrix,e),n=[0,0,0,1];hh.transformMat4(n,n,t);const i=n[3]/a.cameraToCenterDistance,r=Sd(l),o=a.projection.pixelsPerMeter(this.position.lat,f)*Qd(this.position.lat,l),s=a.projection.pixelsPerMeter(a.center.lat,f)*Qd(a.center.lat,l);d=i/Yi(o,Kd(a.center.lat),r),p=i*u/o,d*=s,p*=s}}else d=h;vh.scale(this.matrix,this.matrix,[d,d,p]);const m=[...this.matrix],_=this.orientation,g=[];if(_x(g,[_[0]+t[0],_[1]+t[1],_[2]+t[2]],n),vh.multiply(this.matrix,m,g),r&&a.elevation){let e=0;const t=[];if(o&&a.elevation){e=this._positionModelOnTerrain(a,t);const n=vh.fromQuat([],t),i=vh.multiply([],n,g);vh.multiply(this.matrix,m,i)}else e=a.elevation.getAtPointOrZero(new ep(c.x/f,c.y/f),0);0!==e&&(this.matrix[14]+=e)}}upload(e){if(!this.uploaded){for(const t of this.nodes)Sx(t,e);for(const e of this.nodes)Ex(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Cx(e)}}function wx(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new gy(t,e.image,n?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function Tx(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,kv.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,zv.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,Rv.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?Pv:Dv).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,Ov.members,!0)),e.segments=dl.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const i=e.material;i.pbrMetallicRoughness.baseColorTexture&&wx(i.pbrMetallicRoughness.baseColorTexture,t),i.pbrMetallicRoughness.metallicRoughnessTexture&&wx(i.pbrMetallicRoughness.metallicRoughnessTexture,t),i.normalTexture&&wx(i.normalTexture,t),i.occlusionTexture&&wx(i.occlusionTexture,t,n),i.emissionTexture&&wx(i.emissionTexture,t)}function Sx(e,t,n){if(e.meshes)for(const i of e.meshes)Tx(i,t,n);if(e.children)for(const i of e.children)Sx(i,t,n)}function Ex(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Ex(t)}function Cx(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const n of e.children)Cx(n)}class Ax{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Ix{constructor(){this.instancedDataArray=new Ka,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Mx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,t,n,i){this.tileToMeter=$d(n);const r=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=cp(o,r);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),e,n))continue;const c={id:s,sourceLayerIndex:l,index:a,geometry:r?e.geometry:lp(o,n,i),properties:o.properties,type:o.type,patterns:{}},u=this.addFeature(c,c.geometry,e);u&&t.featureIndex.insert(o,c.geometry,a,l,this.index,this.instancesPerModel[u].instancedDataArray.length)}this.lookup=null}update(e,t,n,i){for(const r in this.instancesPerModel){const t=this.instancesPerModel[r];for(const n in e)t.idToFeaturesIndex.hasOwnProperty(n)&&this.evaluate(t.features[t.idToFeaturesIndex[n]],e[n],t,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];for(const t of n.features){const i=this.layers[0],r=t.feature,o=this.canonical,s=i.paint.get("model-rotation").evaluate(r,{},o),a=i.paint.get("model-scale").evaluate(r,{},o),l=i.paint.get("model-translation").evaluate(r,{},o);Eh.exactEquals(t.rotation,s)&&Eh.exactEquals(t.scale,a)&&Eh.exactEquals(t.translation,l)||(this.evaluate(t,t.featureStates,n,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];n.instancedDataArray.length<0||0===n.instancedDataArray.length||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,Lv.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const t=this.instancesPerModel[e];0!==t.instancedDataArray.length&&t.instancedDataBuffer&&t.instancedDataBuffer.destroy()}}addFeature(e,t,n){const i=this.layers[0],r=i.layout.get("model-id").evaluate(n,{},this.canonical);if(!r)return X("modelId is not evaluated for layer ".concat(i.id," and it is not going to get rendered.")),r;this.instancesPerModel[r]||(this.instancesPerModel[r]=new Ix);const o=this.instancesPerModel[r],s=o.instancedDataArray,a=new Ax(n,s.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=ai||e.y<0||e.y>=ai)continue;const t=(this.lookupDim-1)/ai,n=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[n])continue;this.lookup[n]=1}this.instanceCount++;const i=s.length;s.resize(i+1),o.instancesEvaluatedElevation.push(0),s.float32[16*i]=e.x,s.float32[16*i+1]=e.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),r}evaluate(e,t,n,i){const r=this.layers[0],o=e.feature,s=this.canonical,a=e.rotation=r.paint.get("model-rotation").evaluate(o,t,s),l=e.scale=r.paint.get("model-scale").evaluate(o,t,s),c=e.translation=r.paint.get("model-translation").evaluate(o,t,s),u=r.paint.get("model-color").evaluate(o,t,s);u.a=r.paint.get("model-color-mix-intensity").evaluate(o,t,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),_x(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let p=0;p<e.instancedDataCount;++p){const t=e.instancedDataOffset+p,r=16*t,o=n.instancedDataArray.float32;let a=0;i&&(a=o[r+6]-n.instancesEvaluatedElevation[t]);const l=0|o[r+1];o[r]=(0|o[r])+u.r/1.05,o[r+1]=l+u.g/1.05,o[r+2]=d,o[r+3]=1/(s.z>10?this.tileToMeter:$d(s,l)),o[r+4]=c[0],o[r+5]=c[1],o[r+6]=c[2]+a,o[r+7]=h[0],o[r+8]=h[1],o[r+9]=h[2],o[r+10]=h[4],o[r+11]=h[5],o[r+12]=h[6],o[r+13]=h[8],o[r+14]=h[9],o[r+15]=h[10],n.instancesEvaluatedElevation[t]=c[2]}}}Is(Mx,"ModelBucket",{omit:["layers"]}),Is(Ix,"PerModelAttributes"),Is(Ax,"ModelFeature");const kx=new da({visibility:new ca(Mt.layout_model.visibility),"model-id":new ua(Mt.layout_model["model-id"])});var Px={paint:new da({"model-opacity":new ca(Mt.paint_model["model-opacity"]),"model-rotation":new ua(Mt.paint_model["model-rotation"]),"model-scale":new ua(Mt.paint_model["model-scale"]),"model-translation":new ua(Mt.paint_model["model-translation"]),"model-color":new ua(Mt.paint_model["model-color"]),"model-color-mix-intensity":new ua(Mt.paint_model["model-color-mix-intensity"]),"model-type":new ca(Mt.paint_model["model-type"]),"model-cast-shadows":new ca(Mt.paint_model["model-cast-shadows"]),"model-receive-shadows":new ca(Mt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ca(Mt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ua(Mt.paint_model["model-emissive-strength"]),"model-roughness":new ua(Mt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ua(Mt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ca(Mt.paint_model["model-cutoff-fade-range"])}),layout:kx};const Dx=new Float32Array(262144),Rx=new Uint8Array(262144);function zx(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,zx(n));return t}const Lx=["","wall","door","roof","window","lamp","logo"];class Ox{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:zx(e)}}}}class Fx{constructor(e,t,n,i){this.nodes=e,this.id=t,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=i,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const n of t){const t=n.node;this.uploaded?this.updatePbrBuffer(t):Sx(t,e,!0)}for(const n of t)Ex(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),t=!0);return t}needsReEvaluation(e,t,n){const i=e.transform.projectionOptions,r=e.style.getBrightness(),o=this.brightness!==r;return!!(!this.uploaded||this.dirty||i.name!==this.projection.name||Bx(n.paint.get("model-color").value,o)||Bx(n.paint.get("model-color-mix-intensity").value,o)||Bx(n.paint.get("model-roughness").value,o)||Bx(n.paint.get("model-emissive-strength").value,o)||Bx(n.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=i,this.brightness=r,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),i=this.id.canonical;for(const r of n){const e=r.feature;r.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},i)}}evaluate(e){const t=this.getNodesInfo();for(const n of t){if(!n.node.meshes)continue;const t=n.feature,i=n.node.meshes&&n.node.meshes[0].featureData,r=n.evaluatedColor[2],o=n.evaluatedRMEA[2],s=this.id.canonical;if(n.hasTranslucentParts=!1,i){for(let i=0;i<Lx.length;i++){const r=Lx[i];r.length&&(t.properties.part=r);const o=e.paint.get("model-color").evaluate(t,{},s),a=e.paint.get("model-color-mix-intensity").evaluate(t,{},s);n.evaluatedColor[i]=[o.r,o.g,o.b,a],n.evaluatedRMEA[i][0]=e.paint.get("model-roughness").evaluate(t,{},s),n.evaluatedRMEA[i][2]=e.paint.get("model-emissive-strength").evaluate(t,{},s),n.evaluatedRMEA[i][3]=o.a,n.emissionHeightBasedParams[i]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},s),!n.hasTranslucentParts&&o.a<1&&(n.hasTranslucentParts=!0)}delete t.properties.part,jx(n,r!==n.evaluatedColor[2]||o!==n.evaluatedRMEA[2])}n.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},s),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,n,i){const r=e.findDEMTileFor(n);if(r&&(r.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(r.dem&&r.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=r.tileID.overscaledZ;const t=qm.create(e,n,r);if(!t)return;4&this.modelTraits&&this.updateDEM(e,t,n,i);for(const e of this.getNodesInfo()){const n=e.node;if(!n.footprint||!n.footprint.vertices||!n.footprint.vertices.length)continue;const i=n.footprint.vertices;let r=t.getElevationAt(i[0].x,i[0].y,!0,!0);for(let e=1;e<i.length;e++)r=Math.min(r,t.getElevationAt(i[e].x,i[e].y,!0,!0));n.elevation=r}}this.terrainTile=r.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,n,i){let r=t._dem._modifiedForSources[i];if(void 0===r&&(t._dem._modifiedForSources[i]=[],r=t._dem._modifiedForSources[i]),r.includes(n.canonical))return;const o=t._dem.dim;r.push(n.canonical);let s=!1;for(const a of this.getNodesInfo()){const e=a.node;if(!e.footprint||!e.footprint.grid)continue;const n=e.footprint.grid,i=t.tileCoordToPixel(n.min.x,n.min.y),r=t.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(o-r.y,i.x),Math.min(i.y,o-r.x));if(l<0)continue;const c=k(l,2,5);let u=Math.max(0,i.x-c),h=Math.max(0,i.y-c),d=Math.min(r.x+c,o-1),p=Math.min(r.y+c,o-1);for(let t=h;t<=p;++t)for(let e=u;e<=d;++e)Rx[t*o+e]=255;let f=0,m=0;for(let s=0;s<n.cellsY;++s)for(let e=0;e<n.cellsX;++e){if(!n.cells[s*n.cellsX+e])continue;const i=t.tileCoordToPixel(n.min.x+e/n.xScale,n.min.y+s/n.yScale),r=t.tileCoordToPixel(n.min.x+(e+1)/n.xScale,n.min.y+(s+1)/n.yScale);for(let e=i.y;e<=Math.min(r.y+1,o-1);++e)for(let n=i.x;n<=Math.min(r.x+1,o-1);++n)255===Rx[e*o+n]&&(Rx[e*o+n]=0,f+=t.getElevationAtPixel(n,e),m++)}const _=f/m;u=Math.max(1,i.x-c),h=Math.max(1,i.y-c),d=Math.min(r.x+c,o-2),p=Math.min(r.y+c,o-2),s=!0;for(let s=h;s<=p;++s)for(let e=u;e<=d;++e)0===Rx[s*o+e]&&(Dx[s*o+e]=t._dem.set(e,s,_));for(let s=1;s<c;++s){u=Math.max(1,i.x-s),h=Math.max(1,i.y-s),d=Math.min(r.x+s,o-2),p=Math.min(r.y+s,o-2);for(let e=h;e<=p;++e)for(let n=u;n<=d;++n){const i=e*o+n;if(255===Rx[i]){let r=0,a=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let i=-1;i<=1;++i){const c=(e+t)*o+n+i;if(Rx[c]>=s)continue;const h=Dx[c],d=Math.abs(h);d>a&&(r=h,a=d,l=i,u=t)}if(a>.1){const o=1-(s+.5*Math.abs(l*u))/c;let a=t._dem.get(n,e)+r*o;const h=t._dem.get(n+l,e+u),d=t._dem.get(n-l,e-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),Dx[i]=t._dem.set(n,e,a),Rx[i]=s}}}}}s&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=ut.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new Ox(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Cx(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const t of e)Ex(t.node),Cx(t.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped()),i=this.getNodesInfo();for(let r=0;r<this.nodesInfo.length;r++){const e=i[r].node;i[r].hiddenByReplacement=!!e.footprint&&!n.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(e,t){const n=this.getNodesInfo(),i=[];for(let r=0;r<this.nodesInfo.length;r++){const o=n[r],s=o.node.meshes[0];if(e<s.aabb.min[0]||t<s.aabb.min[1]||e>s.aabb.max[0]||t>s.aabb.max[1])continue;const a=(e-s.aabb.min[0])/(s.aabb.max[0]-s.aabb.min[0])*vx|0,l=Math.min(63,(t-s.aabb.min[1])/(s.aabb.max[1]-s.aabb.min[1])*vx|0)*vx+Math.min(63,a);if(!(s.heightmap[l]<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:s.heightmap[l],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new y(e,t),new y(e,t),i),i.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function Bx(e,t){return!e.isLightConstant&&t}function Nx(e,t,n,i,r,o,s,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;n[3]>0&&(l=Yi(l,255*n[0],n[3]),c=Yi(c,255*n[1],n[3]),u=Yi(u,255*n[2],n[3]));const h=l<<8|c,d=u<<8|Math.floor(255*i[3]),p=function(e){const t=k(e,0,2);return Math.min(Math.round(.5*t*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],f=k(r[0],0,1),m=k(r[1],0,1),_=k(r[2],0,1),g=k(r[3],0,1);let y,v,x,b;if(f!==m&&s!==o&&m!==f){const e=s-o;v=1/(e*(m-f)),x=-(o+e*f)/(e*(m-f));const t=k(r[4],-1,1);b=Math.pow(10,t),y=255*_<<8|255*g}else y=65535,v=0,x=1,b=1;if(e.emplaceBack(h,d,p,y,v,x,b),a){const e=a.length;a.clear();for(let t=0;t<e;t++)a.emplaceBack(h,d,p,y,v,x,b)}}function jx(e,t){const n=e.node;let i=0;for(const r of n.meshes){if(n.lights&&n.lightMeshIndex===i)continue;if(!r.featureData)continue;r.featureArray=new Qa,r.featureArray.reserve(r.featureData.length);let o=t;for(const t of r.featureData){let i;const s=65535&t,a=(15&s)<8?15&s:0,l=t>>16&65535,c=e.evaluatedRMEA[a],u=e.evaluatedColor[a],h=e.emissionHeightBasedParams[a];if(o&&2===a&&n.lights&&(i=new Qa,i.resize(10*n.lights.length)),Nx(r.featureArray,l,u,c,h,r.aabb.min[2],r.aabb.max[2],i),i&&o){o=!1;const e=n.meshes[n.lightMeshIndex];e.featureArray=i,e.featureArray._trim()}}r.featureArray._trim(),i++}}Is(Fx,"Tiled3dModelBucket",{omit:["layers"]}),Is(Ox,"Tiled3dModelFeature");class Ux{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=Hx(new y(0,0),new y(ai,ai),e),n=[];for(const i of this._activeRegions){if(i.hiddenByOverlap)continue;if(!qx(t,i))continue;const r=Wx(i.min,i.max,e);n.push({min:r.min,max:r.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId})}return n}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const n of e.cache.getVisibleCoordinates()){const i=e.cache.getTile(n).buckets[e.layer];if(i)for(const e of i.getNodesInfo()){const i=e.node;i.footprint&&t.push({footprint:i.footprint,id:n.toUnwrapped()})}}return t}}))))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t){if(!e.footprint)continue;const t=Hx(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||Vx(e.min,t.min)||Vx(e.max,t.max)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,n=0;for(;!e&&t!==this._activeRegions.length;){const i=this._activeRegions[t],r=this._prevRegions[n];e=i.priority!==r.priority||!Gx(i,r),++t,++n}}if(e){++this._updateTime;const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const n=t[e].priority;for(;e<t.length&&t[e].priority===n;)++e;return e};if(this._sourceIds.length>1){let t=0,n=e(t);for(;t!==n;){let i=t;const r=t;for(;i!==n;){const e=this._activeRegions[i];e.hiddenByOverlap=!1;for(let t=0;t<r;t++){const n=this._activeRegions[t];if(!n.hiddenByOverlap&&qx(e,n)&&(e.hiddenByOverlap=Xx(e.footprint,e.tileId,n.footprint,n.tileId),e.hiddenByOverlap))break}++i}t=n,n=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}}function Vx(e,t){return e.x-t.x||e.y-t.y}function Gx(e,t){return 0===Vx(e.min,t.min)&&0===Vx(e.max,t.max)}function qx(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Hx(e,t,n){const i=1/ai,r=1/(1<<n.canonical.z),o=(t.x*i+n.canonical.x)*r+n.wrap,s=(t.y*i+n.canonical.y)*r;return{min:new y((e.x*i+n.canonical.x)*r+n.wrap,(e.y*i+n.canonical.y)*r),max:new y(o,s)}}function Wx(e,t,n){const i=1<<n.canonical.z,r=((t.x-n.wrap)*i-n.canonical.x)*ai,o=(t.y*i-n.canonical.y)*ai;return{min:new y(((e.x-n.wrap)*i-n.canonical.x)*ai,(e.y*i-n.canonical.y)*ai),max:new y(r,o)}}function Zx(e,t,n,i,r,o,s){const a=e.indices,l=e.vertices,c=[];for(let u=i;u<i+r;u+=3){const i=t[n[u+0]+o],r=t[n[u+1]+o],h=t[n[u+2]+o],d=Math.min(i.x,r.x,h.x),p=Math.max(i.x,r.x,h.x),f=Math.min(i.y,r.y,h.y),m=Math.max(i.y,r.y,h.y);c.length=0,e.grid.query(new y(d,f),new y(p,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(Cp(l[a[3*t+0]],l[a[3*t+1]],l[a[3*t+2]],i,r,h,s))return!0}}return!1}function Xx(e,t,n,i){if(!e||!n)return!1;let r=e.vertices;if(!t.canonical.equals(i.canonical)||t.wrap!==i.wrap){if(n.vertices.length<e.vertices.length)return Xx(n,i,e,t);const o=t.canonical,s=i.canonical,a=Math.pow(2,s.z-o.z);r=e.vertices.map((e=>new y(e.x*o.x*ai*a-s.x*ai,e.y*o.y*ai*a-s.y*ai)))}return Zx(n,r,e.indices,0,e.indices.length,0,0)}const Yx=nm.types,Kx=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Qx=["fill-extrusion-flood-light-ground-radius"],Jx=Math.pow(2,13),$x=Math.pow(2,15)-1,eb=new y(0,1),tb=2147483648;function nb(e,t,n,i,r,o,s,a){e.emplaceBack((t<<1)+s,(n<<1)+o,(Math.floor(i*Jx)<<1)+r,Math.round(a))}function ib(e,t,n,i,r,o){e.emplaceBack(t.x,t.y,(n.x<<1)+i,(n.y<<1)+r,o)}function rb(e,t,n){const i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}class ob{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sb{constructor(){this.centroidXY=new y(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.min=new y(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new y(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new y(this.max.x-this.min.x,this.max.y-this.min.y)}}class ab{constructor(){this.acc=new y(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,n){this.accCount++,this.acc._add(t);let i=!!this.borders;t.x<e.min.x?(e.min.x=t.x,i=!0):t.x>e.max.x&&(e.max.x=t.x,i=!0),t.y<e.min.y?(e.min.y=t.y,i=!0):t.y>e.max.y&&(e.max.y=t.y,i=!0),((0===t.x||t.x===ai)&&t.x===n.x)!=((0===t.y||t.y===ai)&&t.y===n.y)&&this.processBorderOverlap(t,n),i&&this.checkBorderIntersection(t,n)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,Yi(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ai!=e.x>ai&&this.addBorderIntersection(1,Yi(t.y,e.y,(ai-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Yi(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ai!=e.y>ai&&this.addBorderIntersection(3,Yi(t.x,e.x,(ai-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){return 0===this.accCount?new y(0,0):new y(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function lb(e,t){const n=e.add(t)._unit(),i=k(e.x*n.x+e.y*n.y,-1,1);var r,o,s;return r=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(r)))/4*$x*((o=e).x*(s=t).y-o.y*s.x<0?-1:1)}const cb=[e=>e.x<0,e=>e.x>ai,e=>e.y<0,e=>e.y>ai];function ub(e,t,n,i){const r=[4];if(0===i)return r;n._mult(i);const o=e.sub(n),s=t.sub(n),a=[e,t,o,s];for(let l=0;l<4;l++)for(const e of a)if(cb[l](e)){r.push(l);break}return r}class hb{constructor(e){this.vertexArray=new Ca,this.indexArray=new Ua,this.programConfigurations=new Zl(e.layers,e.zoom,(e=>Qx.includes(e))),this._segments=new dl,this.hiddenByLandmarkVertexArray=new Ja,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new dl}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e.length;if(r>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*r,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const t=e[0],n=e[1];a=lb(t.sub(e[r-1])._perp()._unit(),n.sub(t)._perp()._unit())}for(let l=0;l<r;l++){const c=l===r-1?0:l+1,u=e[l],h=e[c],d=e[c===r-1?0:c+1],p=h.sub(u)._perp()._unit(),f=lb(p,d.sub(h)._perp()._unit()),m=a,_=f;if(_b(u,h,t)||i&&gb(u,t)&&gb(h,t)){a=f;continue}const g=s.vertexLength;ib(this.vertexArray,u,h,1,1,m),ib(this.vertexArray,u,h,1,0,m),ib(this.vertexArray,u,h,0,1,_),ib(this.vertexArray,u,h,0,0,_),s.vertexLength+=4;const y=ub(u,h,p,n);for(const e of y)this._segmentToGroundQuads[o].push({id:g,region:e}),this._segmentToRegionTriCounts[o][e]+=2,s.primitiveLength+=2;a=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let n=0;n<t;n++)this._segmentToGroundQuads[n].sort(((e,t)=>e.region-t.region));for(let n=0;n<t;n++){const t=this._segmentToGroundQuads[n],i=e[n],r=this._segmentToRegionTriCounts[n];r.reduce(((e,t)=>e+t),0);let o=0;for(let e=0;e<=4;e++){const t=r[e];if(0!==t){let n=this.regionSegments[e];n||(n=this.regionSegments[e]=new dl);const r={vertexOffset:i.vertexOffset,primitiveOffset:i.primitiveOffset+o,vertexLength:i.vertexLength,primitiveLength:t};n.get().push(r)}o+=t}for(let e=0;e<t.length;e++){const n=t[e].id;this.indexArray.emplaceBack(n,n+1,n+3),this.indexArray.emplaceBack(n,n+3,n+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,n,i,r,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,n,i,r,o)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Bf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,n,i,r,o){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,n,i,r,o)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const n=e.flags&tb?1:0;for(let i=e.groundVertexArrayOffset;i<t;++i)this.hiddenByLandmarkVertexArray.emplace(i,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,jf.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class db{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ua,this.footprintVertices=new Ta,this.footprintSegments=[],this.layoutVertexArray=new Ea,this.centroidVertexArray=new cl,this.indexArray=new Ua,this.programConfigurations=new Zl(e.layers,e.zoom,(e=>Kx.includes(e))),this.segments=new dl,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new hb(e),this.maxHeight=0,this.partLookup={}}populate(e,t,n,i){this.features=[],this.hasPattern=Df("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=$d(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:r,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=cp(r,e);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),l,n))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:lp(r,n,i),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Rf("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,s,n,{},t.availableImages,i,t.brightness),t.featureIndex.insert(r,c.geometry,s,a,this.index,u)}this.sortBorders(),this.groundEffect.prepareBorderSegments()}addFeatures(e,t,n,i,r,o){for(const s of this.features){const{geometry:e}=s;this.addFeature(s,e,s.index,t,n,i,r,o)}this.sortBorders()}update(e,t,n,i,r){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,s,n,i,r),this.groundEffect.update(e,t,s,n,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Uf.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Nf.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,r,o,s,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new y(0,0),new y(ai,ai)],u=s.projection,h="globe"===u.name,d="Polygon"===Yx[e.type],p=new ab;p.centroidDataIndex=this.centroidData.length;const f=new sb,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},i)<=0,_=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},i);f.height=_,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Pa);const g=kf(t,500);for(let y=g.length-1;y>=0;y--){const e=g[y];(0===e.length||(v=e[0]).every((e=>e.x<=0))||v.every((e=>e.x>=ai))||v.every((e=>e.y<=0))||v.every((e=>e.y>=ai)))&&g.splice(y,1)}var v;let x;if(h)x=bb(g,c,i);else{x=[];for(const e of g)x.push({polygon:e,bounds:c})}const b=d?this.edgeRadius:0,w=b>0&&this.zoom<17,T=(e,t)=>{if(0===e.length)return!1;const n=e[e.length-1];return t.x===n.x&&t.y===n.y};for(const{polygon:y,bounds:S}of x){let e=0,t=0;for(const i of y)d&&!i[0].equals(i[i.length-1])&&i.push(i[0]),t+=d?i.length-1:i.length;const n=this.segments.prepareSegment((d?5:4)*t,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length);const r=new ob;if(r.vertexOffset=this.footprintVertices.length,r.indexOffset=3*this.footprintIndices.length,r.ringIndices=[],d){const t=[],o=[];e=n.vertexLength;for(let e=0;e<y.length;e++){const s=y[e];s.length&&0!==e&&o.push(t.length/2);const a=[];let c,d;c=s[1].sub(s[0])._perp()._unit(),r.ringIndices.push(s.length-1);for(let e=1;e<s.length;e++){const r=s[e],o=s[e===s.length-1?1:e+1],l=r.clone();if(b){d=o.sub(r)._perp()._unit();const e=c.add(d)._unit(),t=b*Math.min(4,1/(c.x*e.x+c.y*e.y));l.x+=t*e.x,l.y+=t*e.y,l.x=Math.round(l.x),l.y=Math.round(l.y),c=d}!m||0!==b&&!w||T(a,l)||a.push(l),nb(this.layoutVertexArray,l.x,l.y,0,0,1,1,0),n.vertexLength++,this.footprintVertices.emplaceBack(r.x,r.y),t.push(r.x,r.y),h&&rb(this.layoutVertexExtArray,u.projectTilePoint(l.x,l.y,i),u.upVector(i,l.x,l.y))}m&&(0===b||w)&&(0!==a.length&&T(a,a[0])&&a.pop(),this.groundEffect.addData(a,S,l))}const s=Mf(t,o);for(let i=0;i<s.length;i+=3)this.footprintIndices.emplaceBack(r.vertexOffset+s[i+0],r.vertexOffset+s[i+1],r.vertexOffset+s[i+2]),this.indexArray.emplaceBack(e+s[i],e+s[i+2],e+s[i+1]),n.primitiveLength++;r.indexCount+=s.length,r.vertexCount+=this.footprintVertices.length-r.vertexOffset}for(let o=0;o<y.length;o++){const t=y[o];p.startRing(f,t[0]);let r=t.length>4&&yb(t[t.length-2],t[0],t[1]),s=b?fb(t[t.length-2],t[0],t[1],b):0;const a=[];let c,_,g;_=t[1].sub(t[0])._perp()._unit();let v=!0;for(let o=1,l=0;o<t.length;o++){let d=t[o-1],y=t[o];const x=t[o===t.length-1?1:o+1];if(p.appendEdge(f,y,d),_b(y,d,S)){b&&(_=x.sub(y)._perp()._unit(),v=!v);continue}const w=y.sub(d)._perp(),E=w.x/(Math.abs(w.x)+Math.abs(w.y)),C=w.y>0?1:0,A=d.dist(y);if(l+A>32768&&(l=0),b){g=x.sub(y)._perp()._unit();let e=mb(d,y,x,pb(_,g),b);isNaN(e)&&(e=0);const t=y.sub(d)._unit();d=d.add(t.mult(s))._round(),y=y.add(t.mult(-e))._round(),s=e,_=g,m&&this.zoom>=17&&(T(a,d)||a.push(d),T(a,y)||a.push(y))}const I=n.vertexLength,M=t.length>4&&yb(d,y,x);let k=vb(l,r,v);if(nb(this.layoutVertexArray,d.x,d.y,E,C,0,0,k),nb(this.layoutVertexArray,d.x,d.y,E,C,0,1,k),l+=A,k=vb(l,M,!v),r=M,nb(this.layoutVertexArray,y.x,y.y,E,C,0,0,k),nb(this.layoutVertexArray,y.x,y.y,E,C,0,1,k),n.vertexLength+=4,this.indexArray.emplaceBack(I+0,I+1,I+2),this.indexArray.emplaceBack(I+1,I+3,I+2),n.primitiveLength+=2,b){const i=e+(1===o?t.length-2:o-2),r=1===o?e:i+1;if(this.indexArray.emplaceBack(I+1,i,I+3),this.indexArray.emplaceBack(i,r,I+3),n.primitiveLength+=2,void 0===c&&(c=I),!_b(x,t[o],S)){const e=o===t.length-1?c:n.vertexLength;this.indexArray.emplaceBack(I+2,I+3,e),this.indexArray.emplaceBack(I+3,e+1,e),this.indexArray.emplaceBack(I+3,r,e+1),n.primitiveLength+=3}v=!v}if(h){const e=this.layoutVertexExtArray,t=u.projectTilePoint(d.x,d.y,i),n=u.projectTilePoint(y.x,y.y,i),r=u.upVector(i,d.x,d.y),o=u.upVector(i,y.x,y.y);rb(e,t,r),rb(e,t,r),rb(e,n,o),rb(e,n,o)}}d&&(e+=t.length-1),m&&b&&this.zoom>=17&&(0!==a.length&&T(a,a[0])&&a.pop(),this.groundEffect.addData(a,S,l,b>0))}this.footprintSegments.push(r),++f.footprintSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?eb:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,a),this.groundEffect.addPaintPropertiesData(e,n,r,o,i,a),this.maxHeight=Math.max(this.maxHeight,_)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0]))}encodeCentroid(e,t){const n=e.centroid(),i=t.span(),r=Math.min(7,Math.round(i.x*this.tileToMeter/10)),o=Math.min(7,Math.round(i.y*this.tileToMeter/10));return new y(k(n.x,1,ai-1)<<3|r,k(n.y,1,ai-1)<<3|o)}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=tb,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,i=e.flags&tb?eb:e.centroidXY,r=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==i.y||r!==i.x){for(let e=t;e<n;++e)this.centroidVertexArray.emplace(e,i.x,i.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());if(function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n].sourceId!==t[n].sourceId||!Gx(e[n],t[n]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const r of this.centroidData)r.flags&=2147483647;const i=[];for(const r of this.activeReplacements){const t=Math.pow(2,r.footprintTileId.canonical.z-e.canonical.z);for(const n of this.centroidData)if(!(n.flags&tb||r.min.x>n.max.x||n.min.x>r.max.x||r.min.y>n.max.y||n.min.y>r.max.y))for(let o=0;o<n.footprintSegLen;o++){const s=this.footprintSegments[n.footprintSegIdx+o];if(i.length=0,wb(this.footprintVertices,s.vertexOffset,s.vertexCount,r.footprintTileId.canonical,e.canonical,i),Zx(r.footprint,i,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-t)){n.flags|=tb;break}}}for(const r of this.centroidData)this.writeCentroidToBuffer(r);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,n){let i=!1;for(let r=0;r<n.footprintSegLen;r++){const o=this.footprintSegments[n.footprintSegIdx+r];let s=0;for(const n of o.ringIndices){for(let r=s,a=n+s-1;r<n+s;a=r++){const n=this.footprintVertices.int16[2*(r+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(r+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>t!=l>t&&e<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-n)*(t-s)/(l-s)+n&&(i=!i)}s=n}}return i}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,i=!0;const r=4*(e+ai)*ai+(t+ai);if(this.partLookup.hasOwnProperty(r)){const e=this.partLookup[r];return e?{height:e.height,hidden:!!(e.flags&tb)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||this.footprintContainsPoint(e,t,o)&&o&&o.height>n&&(n=o.height,this.partLookup[r]=o,i=!!(o.flags&tb));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:i};this.partLookup[r]=void 0}}function pb(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function fb(e,t,n,i){const r=t.sub(e)._perp()._unit(),o=n.sub(t)._perp()._unit();return mb(e,t,n,pb(r,o),i)}function mb(e,t,n,i,r){const o=Math.sqrt(1-i*i);return Math.min(e.dist(t)/3,t.dist(n)/3,r*o/i)}function _b(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function gb(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function yb(e,t,n){if(e.x<0||e.x>=ai||t.x<0||t.x>=ai||n.x<0||n.x>=ai)return!1;const i=n.sub(t),r=i.perp(),o=e.sub(t);return(i.x*o.x+i.y*o.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(o.x*o.x+o.y*o.y))>-.866&&r.x*o.x+r.y*o.y<0}function vb(e,t,n){const i=t?2|e:-3&e;return n?1|i:-2&i}function xb(){const e=Math.PI/32,t=Math.tan(e),n=Od;return n*Math.sqrt(1+2*t*t)-n}function bb(e,t,n){const i=1<<n.z,r=Wd(n.x/i),o=Wd((n.x+1)/i),s=Zd(n.y/i),a=Zd((n.y+1)/i);return function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;const s=[];if(!e.length||!n||!i)return s;const a=(e,t)=>{for(const n of e)s.push({polygon:n,bounds:t})},l=Math.ceil(Math.log2(n)),c=Math.ceil(Math.log2(i)),u=l-c,h=[];for(let f=0;f<Math.abs(u);f++)h.push(u>0?0:1);for(let f=0;f<Math.min(l,c);f++)h.push(0),h.push(1);let d=e;if(d=im(d,t[0].y-r,t[1].y+r,1),d=im(d,t[0].x-r,t[1].x+r,0),!d.length)return s;const p=[];for(h.length?p.push({polygons:d,bounds:t,depth:0}):a(d,t);p.length;){const e=p.pop(),t=e.depth,n=h[t],i=e.bounds[0],s=e.bounds[1],l=0===n?i.x:i.y,c=0===n?s.x:s.y,u=o?o(n,l,c):.5*(l+c),d=im(e.polygons,l-r,u+r,n),f=im(e.polygons,u-r,c+r,n);if(d.length){const e=[i,new y(0===n?u:s.x,1===n?u:s.y)];h.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):a(d,e)}if(f.length){const e=[new y(0===n?u:i.x,1===n?u:i.y),s];h.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):a(f,e)}}return s}(e,t,Math.ceil((o-r)/11.25),Math.ceil((s-a)/11.25),1,((e,t,r)=>{if(0===e)return.5*(t+r);{const e=Zd((n.y+t/ai)/i);return(qd(.5*(Zd((n.y+r/ai)/i)+e))*i-n.y)*ai}}))}function wb(e,t,n,i,r,o){const s=Math.pow(2,i.z-r.z);for(let a=0;a<n;a++){let n=e.int16[2*(a+t)+0],l=e.int16[2*(a+t)+1];n=(n+r.x*ai)*s-i.x*ai,l=(l+r.y*ai)*s-i.y*ai,o.push(new y(n,l))}}Is(db,"FillExtrusionBucket",{omit:["layers","features"]}),Is(sb,"PartData"),Is(ob,"FootprintSegment"),Is(ab,"BorderCentroidData"),Is(hb,"GroundEffect");const Tb=new da({visibility:new ca(Mt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ca(Mt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Sb={paint:new da({"fill-extrusion-opacity":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ua(Mt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ua(Mt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ua(Mt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ua(Mt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ua(Mt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ua(Mt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ca(Mt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"])}),layout:Tb};class Eb extends y{constructor(e,t,n){super(e,t),this.z=n}}function Cb(e,t){return e.x*t.x+e.y*t.y}function Ab(e,t){if(1===e.length){let n=0;const i=t[n++];let r;for(;!r||i.equals(r);)if(r=t[n++],!r)return 1/0;for(;n<t.length;n++){const o=t[n],s=e[0],a=r.sub(i),l=o.sub(i),c=s.sub(i),u=Cb(a,a),h=Cb(a,l),d=Cb(l,l),p=Cb(c,a),f=Cb(c,l),m=u*d-h*h,_=(d*p-h*f)/m,g=(u*f-h*p)/m,y=i.z*(1-_-g)+r.z*_+o.z*g;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}function Ib(e,t,n,i,r,o,s,a){const l=s*r.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,n){const i=Math.floor(t[0]/8),r=Math.floor(t[1]/8),o=10*(t[0]-8*i),s=10*(t[1]-8*r),a=e.getElevationAt(i,r,!0,!0),l=e.getMeterToDEM(n),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(i,r),d=2*c+1,p=2*u+1,f=function(e,t,n,i,r){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+r,n,!0),e.getElevationAtPixel(t,n+r,!0),e.getElevationAtPixel(t+i,n+r,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),_=Math.abs(f[2]-f[3]),g=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+_)/d),v=Math.min(.25,.5*l*g/p);return a+Math.max(y*o,v*s)}(r,o,a):l;return{base:l+(0===n)?-1:n,top:c?Math.max(u+i,l+n+2):l+i}}const Mb=new da({"line-cap":new ua(Mt.layout_line["line-cap"]),"line-join":new ua(Mt.layout_line["line-join"]),"line-miter-limit":new ca(Mt.layout_line["line-miter-limit"]),"line-round-limit":new ca(Mt.layout_line["line-round-limit"]),"line-sort-key":new ua(Mt.layout_line["line-sort-key"]),visibility:new ca(Mt.layout_line.visibility)});var kb={paint:new da({"line-opacity":new ua(Mt.paint_line["line-opacity"]),"line-color":new ua(Mt.paint_line["line-color"]),"line-translate":new ca(Mt.paint_line["line-translate"]),"line-translate-anchor":new ca(Mt.paint_line["line-translate-anchor"]),"line-width":new ua(Mt.paint_line["line-width"]),"line-gap-width":new ua(Mt.paint_line["line-gap-width"]),"line-offset":new ua(Mt.paint_line["line-offset"]),"line-blur":new ua(Mt.paint_line["line-blur"]),"line-dasharray":new ua(Mt.paint_line["line-dasharray"]),"line-pattern":new ua(Mt.paint_line["line-pattern"]),"line-gradient":new ha(Mt.paint_line["line-gradient"]),"line-trim-offset":new ca(Mt.paint_line["line-trim-offset"]),"line-emissive-strength":new ca(Mt.paint_line["line-emissive-strength"]),"line-border-width":new ua(Mt.paint_line["line-border-width"]),"line-border-color":new ua(Mt.paint_line["line-border-color"])}),layout:Mb};const Pb=(e,t,n,i,r,o,s)=>{const a=e.transform,l=a.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:zb(e,t,n,i),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:Ob(n)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Rb(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:s,u_emissive_strength:n.paint.get("line-emissive-strength")}},Db=(e,t,n,i,r)=>{const o=e.transform;return{u_matrix:zb(e,t,n,i),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:Rb(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Rb(e,t){return 1/Yv(e,1,t.tileZoom)}function zb(e,t,n,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Lb=e=>{const t=[];Ob(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function Ob(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Fb=new class extends ua{possiblyEvaluate(e,t){return t=new ea(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=L({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}(kb.paint.properties["line-width"].specification);function Bb(e,t){return t>0?t+2*e:e}Fb.useIntegerZoom=!0;const Nb=new da({visibility:new ca(Mt.layout_background.visibility)});var jb={paint:new da({"background-color":new ca(Mt.paint_background["background-color"]),"background-pattern":new ca(Mt.paint_background["background-pattern"]),"background-opacity":new ca(Mt.paint_background["background-opacity"]),"background-emissive-strength":new ca(Mt.paint_background["background-emissive-strength"])}),layout:Nb};const Ub=new da({visibility:new ca(Mt.layout_raster.visibility)});var Vb={paint:new da({"raster-opacity":new ca(Mt.paint_raster["raster-opacity"]),"raster-color":new ha(Mt.paint_raster["raster-color"]),"raster-color-mix":new ca(Mt.paint_raster["raster-color-mix"]),"raster-color-range":new ca(Mt.paint_raster["raster-color-range"]),"raster-hue-rotate":new ca(Mt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ca(Mt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ca(Mt.paint_raster["raster-brightness-max"]),"raster-saturation":new ca(Mt.paint_raster["raster-saturation"]),"raster-contrast":new ca(Mt.paint_raster["raster-contrast"]),"raster-resampling":new ca(Mt.paint_raster["raster-resampling"]),"raster-fade-duration":new ca(Mt.paint_raster["raster-fade-duration"])}),layout:Ub};function Gb(e,t,n,i,r,o,s,a){const l=[e,n,r,t,i,o,1,1,1],c=[s,a,1],u=gh.adjoint([],l),[h,d,p]=Eh.transformMat3(c,c,gh.transpose(u,u));return gh.multiply(l,[h,0,0,0,d,0,0,0,p],l)}class qb extends It{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(i),this.options=t,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Ct("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ie(this.map._requestManager.transformRequest(this.url,ye.Image),((n,i)=>{if(this._imageRequest=null,this._loaded=!0,n)this.fire(new At(n));else if(i){const{HTMLImageElement:n}=t;this.image=i instanceof n?ut.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new yy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ct("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof yy||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],n=e[0][1];for(const r of e)r[1]>n&&(n=r[1]),r[1]<t&&(t=r[1]);const i=(n+t)/2;if(i>Yd?this.onNorthPole=!0:i<-Yd&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(ep.fromLngLat);this.tileID=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const l of e)t=Math.min(t,l.x),n=Math.min(n,l.y),i=Math.max(i,l.x),r=Math.max(r,l.y);const o=Math.max(i-t,r-n),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);return new Lh(s,Math.floor((t+i)/2*a),Math.floor((n+r)/2*a))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ct("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const a in this.tiles){const e=this.tiles[a];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray)return;const t=Tg(this.tileID,this.map.transform.projection),[n,i,r,o]=this.coordinates.map((e=>{const n=t.projection.project(e[0],e[1]);return Eg(t,n)._round()}));this.perspectiveTransform=function(e,t,n,i,r,o,s,a,l,c){const u=Gb(0,0,e,0,0,t,e,t),h=Gb(n,i,r,o,s,a,l,c);return gh.multiply(h,gh.adjoint(u,u),h),[h[6]/h[8]*e/ai,h[7]/h[8]*t/ai]}(this.width,this.height,n.x,n.y,i.x,i.y,o.x,o.y,r.x,r.y);const s=this._boundsArray=new Ea;s.emplaceBack(n.x,n.y,0,0),s.emplaceBack(i.x,i.y,ai,0),s.emplaceBack(o.x,o.y,0,ai),s.emplaceBack(r.x,r.y,ai,ai),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(s,Cy.members),this.boundsSegments=dl.simpleSegment(0,0,4,2)}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,n=t.gl;!this._dirty||this.texture instanceof yy||(this.texture?this.texture.update(this.image):(this.texture=new gy(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Hb extends _a{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const Wb=new da({visibility:new ca(Mt.layout_sky.visibility)});var Zb={paint:new da({"sky-type":new ca(Mt.paint_sky["sky-type"]),"sky-atmosphere-sun":new ca(Mt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ca(Mt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ca(Mt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ca(Mt.paint_sky["sky-gradient-radius"]),"sky-gradient":new ha(Mt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ca(Mt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ca(Mt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ca(Mt.paint_sky["sky-opacity"])}),layout:Wb};function Xb(e,t,n){const i=[0,0,1],r=bh.identity([]);return bh.rotateY(r,r,n?-w(e)+Math.PI:w(e)),bh.rotateX(r,r,-w(t)),Eh.transformQuat(i,i,r),Eh.normalize(i,i)}var Yb={paint:new da({})};const Kb={circle:class extends _a{constructor(e,t){super(e,Dp,t)}createBucket(e){return new dp(e)}queryRadius(e){const t=e;return Ap("circle-radius",this,t)+Ap("circle-stroke-width",this,t)+Ip(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,r,o,s,a){const l=kp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Op(e,i,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const n=Lp(this);return{config:new Wl(this,t),defines:n,overrideFog:!1}}},heatmap:class extends _a{createBucket(e){return new Up(e)}constructor(e,t){super(e,Yp,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Kp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Ap("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,i,r,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(t,n);return Op(e,i,o,s,a,!0,!0,new y(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new Wl(this,t),overrideFog:!1}:{}}},hillshade:class extends _a{constructor(e,t){super(e,Jp,t)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends _a{constructor(e,t){super(e,Of,t)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t){return{config:new Wl(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new zf(e)}queryRadius(){return Ip(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,r,o){return!e.queryGeometry.isAboveHorizon&&mp(Mp(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends _a{constructor(e,t){super(e,Sb,t)}createBucket(e){return new db(e)}queryRadius(){return Ip(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,n,i,r,o,s,a,l){const c=kp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),d=[0,0],p=a&&o.elevation,f=o.elevation?o.elevation.exaggeration():1,m=e.tile.getBucket(this);if(p&&m instanceof db){const e=m.centroidVertexArray,t=l+1;t<e.length&&(d[0]=e.geta_centroid_pos0(t),d[1]=e.geta_centroid_pos1(t))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(i=bb([i],[new y(0,0),new y(ai,ai)],e.tileID.canonical).map((e=>e.polygon)).flat());const _=p?a:null,[g,v]=function(e,t,n,i,r,o,s,a,l,c,u){return"globe"===e.projection.name?function(e,t,n,i,r,o,s,a,l,c,u){const h=[],d=[],p=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],_=(e,t,n,i)=>{e[0]=t,e[1]=n,e[2]=i,e[3]=1},g=xb();n>0&&(n+=g),i+=g;for(const y of t){const t=[],g=[];for(const h of y){const d=h.x+r.x,y=h.y+r.y,v=e.projection.projectTilePoint(d,y,u),x=e.projection.upVector(u,h.x,h.y);let b=n,w=i;if(s){const e=Ib(d,y,n,i,s,a,l,c);b+=e.base,w+=e.top}0!==n?_(f,v.x+x[0]*p*b,v.y+x[1]*p*b,v.z+x[2]*p*b):_(f,v.x,v.y,v.z),_(m,v.x+x[0]*p*w,v.y+x[1]*p*w,v.z+x[2]*p*w),Eh.transformMat4(f,f,o),Eh.transformMat4(m,m,o),t.push(new Eb(f[0],f[1],f[2])),g.push(new Eb(m[0],m[1],m[2]))}h.push(t),d.push(g)}return[h,d]}(e,t,n,i,r,o,s,a,l,c,u):s?function(e,t,n,i,r,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],p=[];for(const c of d){const u=c.x+i.x,d=c.y+i.y,f=Ib(u,d,t,n,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,hh.transformMat4(h,h,r),h[3]=Math.max(h[3],1e-5);const m=new Eb(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,hh.transformMat4(h,h,r),h[3]=Math.max(h[3],1e-5);const _=new Eb(h[0]/h[3],h[1]/h[3],h[2]/h[3]);e.push(m),p.push(_)}c.push(e),u.push(p)}return[c,u]}(t,n,i,r,o,s,a,l,c):function(e,t,n,i,r){const o=[],s=[],a=r[8]*t,l=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*n,d=r[9]*n,p=r[10]*n,f=r[11]*n;for(const m of e){const e=[],t=[];for(const n of m){const o=n.x+i.x,s=n.y+i.y,m=r[0]*o+r[4]*s+r[12],_=r[1]*o+r[5]*s+r[13],g=r[2]*o+r[6]*s+r[14],y=r[3]*o+r[7]*s+r[15],v=m+a,x=_+l,b=g+c,w=Math.max(y+u,1e-5),T=m+h,S=_+d,E=g+p,C=Math.max(y+f,1e-5);e.push(new Eb(v/w,x/w,b/w)),t.push(new Eb(T/C,S/C,E/C))}o.push(e),s.push(t)}return[o,s]}(t,n,i,r,o)}(o,i,h,u,c,s,_,d,f,o.center.lat,e.tileID.canonical),x=e.queryGeometry;return function(e,t,n){let i=1/0;mp(n,t)&&(i=Ab(n,t[0]));for(let r=0;r<t.length;r++){const o=t[r],s=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],s[e+1],s[e],t];pp(n,r)&&(i=Math.min(i,Ab(n,r)))}}return i!==1/0&&i}(g,v,x.isPointQuery()?x.screenBounds:x.screenGeometry)}},line:class extends _a{constructor(e,t){super(e,kb,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Xi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Fb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new _y(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const n=Lb(this);return{config:new Wl(this,t),defines:n,overrideFog:!1}}queryRadius(e){const t=e,n=Bb(Ap("line-width",this,t),Ap("line-gap-width",this,t)),i=Ap("line-offset",this,t);return n/2+Math.abs(i)+Ip(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,r,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=Mp(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Bb(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),l=this.paint.get("line-offset").evaluate(t,n);return l&&(i=function(e,t){const n=[],i=new y(0,0);for(let r=0;r<e.length;r++){const o=e[r],s=[];for(let e=0;e<o.length;e++){const n=o[e],r=o[e+1],a=0===e?i:n.sub(o[e-1])._unit()._perp(),l=e===o.length-1?i:r.sub(n)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(t)._add(n))}n.push(s)}return n}(i,l*e.pixelToTileUnitsFactor)),function(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];if(e.length>=3)for(let t=0;t<r.length;t++)if(wp(e,r[t]))return!0;if(_p(e,r,n))return!0}return!1}(s,i,a)}isTileClipped(){return!0}},symbol:Qg,background:class extends _a{constructor(e,t){super(e,jb,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends _a{constructor(e,t){super(e,Vb,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof qb&&(e._source.onNorthPole||e._source.onSouthPole))}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Kp({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends _a{constructor(e,t){super(e,Zb,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Kp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const n=this.paint.get("sky-atmosphere-sun"),i=!n,r=e.style.light,o=r.properties.get("position");return i&&"viewport"===r.properties.get("anchor")&&X("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?Xb(o.azimuthal,90-o.polar,t):Xb(n[0],90-n[1],t)}const n=this.paint.get("sky-gradient-center");return Xb(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends _a{constructor(e,t){super(e,Yb)}},model:class extends _a{constructor(e,t){super(e,Px,t)}createBucket(e){return new Mx(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof bo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function Qb(e,t){return"custom"===e.type?new Hb(e):new Kb[e.type](e,t)}function Jb(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class $b extends It{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new Wp({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:n}of this.requestors)this._notify(e,t,n);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,n){this._validate(e,n)&&(this.images[t][e]=n)}_validate(e,t){let n=!0;return this._validateStretch(t.stretchX,t.data&&t.data.width)||(this.fire(new At(new Error('Image "'.concat(e,'" has invalid "stretchX" value')))),n=!1),this._validateStretch(t.stretchY,t.data&&t.data.height)||(this.fire(new At(new Error('Image "'.concat(e,'" has invalid "stretchY" value')))),n=!1),this._validateContent(t.content,t)||(this.fire(new At(new Error('Image "'.concat(e,'" has invalid "content" value')))),n=!1),n}_validateStretch(e,t){if(!e)return!0;let n=0;for(const i of e){if(i[0]<n||i[1]<i[0]||t<i[1])return!1;n=i[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,n){n.version=this.images[t][e].version+1,this.images[t][e]=n,this.updatedImages[t][e]=!0}removeImage(e,t){const n=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,n){let i=!0;const r=!!this.loaded[t];if(!r)for(const o of e)this.images[t][o]||(i=!1);r||i?this._notify(e,t,n):this.requestors.push({ids:e,scope:t,callback:n})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,t,n){const i={};for(const r of e){this.images[t][r]||this.fire(new Ct("styleimagemissing",{id:r}));const e=this.images[t][r];e?i[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:X('Image "'.concat(r,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}n(null,i)}getPixelSize(e){const{width:t,height:n}=this.atlasImage[e];return{width:t,height:n}}getPattern(e,t){const n=this.patterns[t][e],i=this.getImage(e,t);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new x_(n,i);this.patterns[t][e]={bin:n,position:r}}return this._updatePatternAtlas(t),this.patterns[t][e].position}bind(e,t){const n=e.gl;let i=this.atlasTexture[t];i?this.dirty&&(i.update(this.atlasImage[t]),this.dirty=!1):(i=new gy(e,this.atlasImage[t],n.RGBA),this.atlasTexture[t]=i),i.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const t=[];for(const o in this.patterns[e])t.push(this.patterns[e][o].bin);const{w:n,h:i}=y_(t),r=this.atlasImage[e];r.resize({width:n||1,height:i||1});for(const o in this.patterns[e]){const{bin:t}=this.patterns[e][o],n=t.x+1,i=t.y+1,s=this.images[e][o].data,a=s.width,l=s.height;Wp.copy(s,r,{x:0,y:0},{x:n,y:i},{width:a,height:l}),Wp.copy(s,r,{x:0,y:l-1},{x:n,y:i-1},{width:a,height:1}),Wp.copy(s,r,{x:0,y:0},{x:n,y:i+l},{width:a,height:1}),Wp.copy(s,r,{x:a-1,y:0},{x:n-1,y:i},{width:1,height:l}),Wp.copy(s,r,{x:0,y:0},{x:n+a,y:i},{width:1,height:l})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const n of e){if(this.callbackDispatchedThisFrame[t][n])continue;this.callbackDispatchedThisFrame[t][n]=!0;const e=this.images[t][n];Jb(e)&&this.updateImage(n,t,e)}}}const ew=new da({anchor:new ca(Mt.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return Q(e.expression.evaluate(t))}interpolate(e,t,n){return{x:Yi(e.x,t.x,n),y:Yi(e.y,t.y,n),z:Yi(e.z,t.z,n),azimuthal:Yi(e.azimuthal,t.azimuthal,n),polar:Yi(e.polar,t.polar,n)}}}(Mt.light.position),color:new ca(Mt.light.color),intensity:new ca(Mt.light.intensity)});class tw extends It{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new ia(ew),this.setLight(e,t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(ds,e,n)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,n){return(!n||!1!==n.validate)&&ws(this,e.call(us,L({value:t,style:{glyphs:!0,sprite:!0},styleSpec:Mt})))}}const nw=new da({source:new ca(Mt.terrain.source),exaggeration:new ca(Mt.terrain.exaggeration)});let iw=class extends It{constructor(e,t){super(),this._transitionable=new ia(nw),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}setScope(e){this.scope=e}get(){return this._transitionable.serialize()}set(e){this._transitionable.setTransitionOrValue(e)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new ea(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof bo}};const rw=45,ow=65,sw=.05;function aw(e,t,n,i){const r=P(rw,ow,n),[o,s]=lw(e,i);let a=1-Math.min(1,Math.exp((t-o)/(s-o)*-6));return a*=a*a,a=Math.min(1,1.00747*a),a*r*e.alpha}function lw(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function cw(e,t,n,i,r){const o=Eh.transformMat4([],[t,n,i],r.mercatorFogMatrix);return aw(e,Eh.length(o),r.pitch,r._fov)}function uw(e,t,n,i,r,o,s){const a=[[n,i,0],[r,i,0],[r,o,0],[n,o,0]];let l=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(const u of a){const e=Eh.transformMat4([],u,t),n=Eh.length(e);l=Math.min(l,n),c=Math.max(c,n)}return[aw(e,l,s.pitch,s._fov),aw(e,c,s.pitch,s._fov)]}const hw=new da({range:new ca(Mt.fog.range),color:new ca(Mt.fog.color),"high-color":new ca(Mt.fog["high-color"]),"space-color":new ca(Mt.fog["space-color"]),"horizon-blend":new ca(Mt.fog["horizon-blend"]),"star-intensity":new ca(Mt.fog["star-intensity"]),"vertical-range":new ca(Mt.fog["vertical-range"])});class dw extends It{constructor(e,t){super(),this._transitionable=new ia(hw),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=t}get state(){const e=this._transform,t="globe"===e.projection.name,n=Sd(e.zoom),i=this.properties.get("range"),r=[.5,3];return{range:t?[Yi(r[0],i[0],n),Yi(r[1],i[1],n)]:i,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._validate(ms,e,t))return;const n=L({},e);for(const i of Object.keys(Mt.fog))void 0===n[i]&&(n[i]=Mt.fog[i].default);this._transitionable.setTransitionOrValue(n)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const t=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:P(rw,ow,e))*t.a}getOpacityAtLatLng(e,t){return this._transform.projection.supportsFog?function(e,t,n){const i=ep.fromLngLat(t),r=n.elevation?n.elevation.getAtPointOrZero(i):0;return cw(e,i.x,i.y,r,n)}(this.state,e,t):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const t=this._transform.calculateFogTileMatrix(e.toUnwrapped());return uw(this.state,t,0,0,ai,ai,this._transform)}getOpacityForBounds(e,t,n,i,r){return this._transform.projection.supportsFog?uw(this.state,e,t,n,i,r,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?lw(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const t=[4,5,6,7];for(const n of t){const t=e.points[n];let i;if(t[2]>=0)i=t;else{const r=e.points[n-4];i=Ki(r,t,r[2]/(r[2]-t[2]))}if(cw(this.state,i[0],i[1],0,this._transform)>=sw)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,n){return(!n||!1!==n.validate)&&ws(this,e.call(us,L({value:t,style:{glyphs:!0,sprite:!0},styleSpec:Mt})))}}class pw{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fw{constructor(){this.tasks={},this.taskQueue=[],V(["process"],this),this.invoker=new pw(this.process),this.nextId=0}add(e,t){const n=this.nextId++,i=function(e){let{type:t,isSymbolTile:n,zoom:i}=e;return i=i||0,"message"===t?0:"maybePrepare"!==t||n?"parseTile"!==t||n?"parseTile"===t&&n?300-i:"maybePrepare"===t&&n?400-i:500:200-i:100-i}(t);if(0===i){$();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){$();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class mw{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},V(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new fw}send(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);const a=new Set;return this.target.postMessage({id:s,type:e,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:Ps(t,a)},a),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e.cancel()}else if(t.mustQueue||$()){const e=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add((()=>this.processTask(n,t)),e&&e.metadata||{type:"message"})}else this.processTask(n,t)}processTask(e,t){if("<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(Ds(t.error)):n(null,Ds(t.data)))}else{const n=new Set,i=t.hasCallback?(t,i)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Ps(t):null,data:Ps(i,n)},n)}:e=>{},r=Ds(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,i);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],r.source,r.scope)[e[1]](r,i)}else i(new Error("Could not find function ".concat(t.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class _w{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=B();const n=this.workerPool.acquire(this.id);for(let i=0;i<n.length;i++){const e=new _w.Actor(n[i],t,this.id);e.name="Worker ".concat(i),this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,n){R(this.actors,((n,i)=>{n.send(e,t,i)}),n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}_w.Actor=mw;class gw extends It{constructor(e,t,n,i){super(),this.scope=n,this._options=e,this.properties=new la(t),this._transitionable=new ia(t,new Map(i)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const yw=new da({color:new ca(Mt.properties_light_ambient.color),intensity:new ca(Mt.properties_light_ambient.intensity)}),vw=new da({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,n]=e;const i=Q([1,t,n]);return{x:i.x,y:i.y,z:i.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:Yi(e.x,t.x,n),y:Yi(e.y,t.y,n),z:Yi(e.z,t.z,n)}}}(Mt.properties_light_directional.direction),color:new ca(Mt.properties_light_directional.color),intensity:new ca(Mt.properties_light_directional.intensity),"cast-shadows":new ca(Mt.properties_light_directional["cast-shadows"]),"shadow-intensity":new ca(Mt.properties_light_directional["shadow-intensity"])});class xw{constructor(e,t,n,i){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,i)}static createFromScreenPoints(e,t){let n,i;if(e instanceof y||"number"==typeof e[0]){const r=y.convert(e);n=[r],i=t.isPointAboveHorizon(r)}else{const r=y.convert(e[0]),o=y.convert(e[1]);n=[r,o],i=A(r,o).every((e=>t.isPointAboveHorizon(e)))}return new xw(n,t.getCameraPoint(),i,t)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return A(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const t=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new y(1,1)):this.screenBounds[1],i=A(t,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>t.x&&this.cameraPoint.x<n.x?i.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?i[2]=this.cameraPoint:this.cameraPoint.x<=t.x&&(i[3]=this.cameraPoint)),function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=D(i-1,-1,e.length-1),o=D(i+1,-1,e.length-1),s=e[i],a=e[o],l=e[r].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));n.push(s.add(h))}return n}(i,e)}bufferedCameraGeometryGlobe(e){const t=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new y(1,1)):this.screenBounds[1],i=A(t,n,e),r=this.cameraPoint.clone();switch(3*((r.y>t.y)+(r.y>n.y))+((r.x>t.x)+(r.x>n.x))){case 0:i[0]=r,i[4]=r.clone();break;case 1:i.splice(1,0,r);break;case 2:i[1]=r;break;case 3:i.splice(4,0,r);break;case 5:i.splice(2,0,r);break;case 6:i[3]=r;break;case 7:i.splice(3,0,r);break;case 8:i[2]=r}return i}containsTile(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=e.queryPadding/t._pixelsPerMercatorPixel+1,o=n?this._bufferedCameraMercator(r,t):this._bufferedScreenMercator(r,t);let s=e.tileID.wrap+(o.unwrapped?i:0);const a=o.polygon.map((t=>Eg(e.tileTransform,t,s)));if(!Tp(a,0,0,ai,ai))return;s=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?i:0);const l=this.screenGeometryMercator.polygon.map((t=>Cg(e.tileTransform,t,s))),c=l.map((e=>new y(e[0],e[1]))),u=t.getFreeCameraOptions().position||new ep(0,0,0),h=Cg(e.tileTransform,u,s),d=l.map((e=>{const t=Eh.sub(e,e,h);return Eh.normalize(t,t),new jh(h,t)})),p=Yv(e,1,t.zoom)*t._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:c,tilespaceRays:d,bufferedTilespaceGeometry:a,bufferedTilespaceBounds:(f=C(a),f.min.x=k(f.min.x,0,ai),f.min.y=k(f.min.y,0,ai),f.max.x=k(f.max.x,0,ai),f.max.y=k(f.max.y,0,ai),f),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:p};var f}_bufferedScreenMercator(e,t){const n=Tw(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[n]=i,i}}_bufferedCameraMercator(e,t){const n=Tw(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[n]=i,i}}_projectAndResample(e,t){const n=function(e,t){const n=vh.multiply([],t.pixelMatrix,t.globeMatrix),i=[0,-Kh,0,1],r=[0,Kh,0,1],o=[0,0,0,1];hh.transformMat4(i,i,n),hh.transformMat4(r,r,n),hh.transformMat4(o,o,n);const s=new y(i[0]/i[3],i[1]/i[3]),a=new y(r[0]/r[3],r[1]/r[3]),l=wp(e,s)&&i[3]<o[3],c=wp(e,a)&&r[3]<o[3];if(!l&&!c)return null;const u=function(e,t,n){for(let i=1;i<e.length;i++){const r=ww(t.pointCoordinate3D(e[i-1]).x),o=ww(t.pointCoordinate3D(e[i]).x);if(n<0){if(r<o)return{idx:i,t:-r/(o-1-r)}}else if(o<r)return{idx:i,t:(1-r)/(o+1-r)}}return null}(e,t,l?-1:1);if(!u)return null;const{idx:h,t:d}=u;let p=h>1?bw(e.slice(0,h),t):[],f=h<e.length?bw(e.slice(h),t):[];p=p.map((e=>new y(ww(e.x),e.y))),f=f.map((e=>new y(ww(e.x),e.y)));const m=[...p];0===m.length&&m.push(f[f.length-1]);const _=Yi(m[m.length-1].y,(0===f.length?p[0]:f[0]).y,d);let g;return g=l?[new y(0,_),new y(0,0),new y(1,0),new y(1,_)]:[new y(1,_),new y(1,1),new y(0,1),new y(0,_)],m.push(...g),0===f.length?m.push(p[0]):m.push(...f),{polygon:m.map((e=>new ep(e.x,e.y))),unwrapped:!1}}(e,t);if(n)return n;const i=function(e,t){let n=!1,i=-1/0,r=0;for(let s=0;s<e.length-1;s++)e[s].x>i&&(i=e[s].x,r=s);for(let s=0;s<e.length-1;s++){const t=(r+s)%(e.length-1),i=e[t],o=e[t+1];Math.abs(i.x-o.x)>.5&&(i.x<o.x?(i.x+=1,0===t&&(e[e.length-1].x+=1)):(o.x+=1,t+1===e.length-1&&(e[0].x+=1)),n=!0)}const o=Gd(t.center.lng);return n&&o<Math.abs(o-1)&&e.forEach((e=>{e.x-=1})),{polygon:e,unwrapped:n}}(bw(e,t).map((e=>new y(ww(e.x),e.y))),t);return{polygon:i.polygon.map((e=>new ep(e.x,e.y))),unwrapped:i.unwrapped}}}function bw(e,t){return np(e,(e=>{const n=t.pointCoordinate3D(e);e.x=n.x,e.y=n.y}),1/256)}function ww(e){return e<0?1+e%1:e%1}function Tw(e){return 100*e|0}function Sw(e,t,n,i,r){const o=function(n,i){if(n)return r(n);if(i){e.url&&i.tiles&&e.tiles&&delete e.tiles;const n=O(L(i,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);i.vector_layers&&(n.vectorLayers=i.vector_layers,n.vectorLayerIds=n.vectorLayers.map((e=>e.id))),n.tiles=t.canonicalizeTileset(n,e.url),r(null,n)}};return e.url?we(t.transformRequest(t.normalizeSourceURL(e.url,null,n,i),ye.Source),o):ut.frame((()=>o(null,e)))}class Ew{constructor(e,t,n){this.bounds=$l.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const t=Math.pow(2,e.z),n=Math.floor(Gd(this.bounds.getWest())*t),i=Math.floor(qd(this.bounds.getNorth())*t),r=Math.ceil(Gd(this.bounds.getEast())*t),o=Math.ceil(qd(this.bounds.getSouth())*t);return e.x>=n&&e.x<r&&e.y>=i&&e.y<o}}class Cw{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Hp({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=j(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const i=[];let r=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,s=!0;i.push({left:r,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let l=1;l<e.length;l++){s=!s;const t=e[l];r=a*n,a+=t,o=a*n,i.push({left:r,right:o,isDash:s,zeroLength:0===t})}return i}addRoundDash(e,t,n){const i=t/2;for(let r=-n;r<=n;r++){const t=this.width*(this.nextRow+n+r);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=r/n*(i+1);if(s.isDash){const e=i-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=i-Math.sqrt(u*u+d*d);this.image.data[t+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let a=e.length-1;a>=0;--a){const t=e[a],n=e[a+1];t.zeroLength?e.splice(a,1):n&&n.isDash===t.isDash&&(n.left=t.left,e.splice(a,1))}const n=e[0],i=e[e.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const r=this.width*this.nextRow;let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const n=Math.abs(a-s.left),i=Math.abs(a-s.right),l=Math.min(n,i);this.image.data[r+a]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const i="round"===t,r=i?7:0,o=2*r+1;if(this.nextRow+o>this.height)return X("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let c=0;c<e.length;c++)e[c]<0&&(X("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),s+=e[c];if(0!==s){const n=this.width/s,o=this.getDashRanges(e,this.width,n);i?this.addRoundDash(o,n,r):this.addRegularDash(o,"square"===t?.5*n:0)}const a=this.nextRow+r;this.nextRow+=o;const l={tl:[a,r],br:[s,0]};return this.positions[n]=l,l}}Is(Cw,"LineAtlas");const Aw=1*K_;class Iw{constructor(e){const t={},n=[];for(const s in e){const i=e[s],r=t[s]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const o=t.metrics.localGlyph?Aw:1,s={x:0,y:0,w:t.bitmap.width+2*o,h:t.bitmap.height+2*o};n.push(s),r[e]=s}}const{w:i,h:r}=y_(n),o=new Hp({width:i||1,height:r||1});for(const s in e){const n=e[s];for(const e in n.glyphs){const i=n.glyphs[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const r=t[s][e],a=i.metrics.localGlyph?Aw:1;Hp.copy(i.bitmap,o,{x:0,y:0},{x:r.x+a,y:r.y+a},i.bitmap)}}this.image=o,this.positions=t}}Is(Iw,"GlyphAtlas");class Mw{constructor(e){this.tileID=new Fh(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Tg(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,t,n,i,r){this.status="parsing",this.data=e,this.collisionBoxArray=new el;const o=new rm(Object.keys(e.layers).sort()),s=new Hm(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new Cw(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:n,brightness:this.brightness},u=t.familiesBySource[this.source];for(const g in u){const t=e.layers[g];if(!t)continue;let i=!1,r=!1,l=!1;for(const e of u[g])"symbol"===e[0].type?i=!0:r=!0,e[0].is3D()&&"model"!==e[0].type&&(l=!0);if(this.extraShadowCaster&&!l)continue;if(!0===this.isSymbolTile&&!i)continue;if(!1===this.isSymbolTile&&!r)continue;1===t.version&&X('Vector tile source "'.concat(this.source,'" layer "').concat(g,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const h=o.encode(g),d=[];for(let e=0;e<t.length;e++){const n=t.feature(e),i=s.getId(n,g);d.push({feature:n,id:i,index:e,sourceLayerIndex:h})}for(const e of u[g]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(kw(e,this.zoom,c.brightness,n),(a[t.id]=t.createBucket({index:s.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,projection:this.projection.spec})).populate(d,c,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(e.map((e=>e.id)))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_=()=>{if(h)return r(h);if(this.extraShadowCaster)this.status="done",r(null,{buckets:z(a).filter((e=>!e.isEmpty())),featureIndex:s,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:c.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(d&&p&&f){const e=new Iw(d),t=new b_(p,f);for(const i in a){const r=a[i];r instanceof cy?(kw(r.layers,this.zoom,c.brightness,n),dg(r,d,e.positions,p,t.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):r.hasPattern&&(r instanceof _y||r instanceof zf||r instanceof db)&&(kw(r.layers,this.zoom,c.brightness,n),r.addFeatures(c,this.tileID.canonical,t.patternPositions,n,this.tileTransform,this.brightness))}this.status="done",r(null,{buckets:z(a).filter((e=>!e.isEmpty())),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,brightness:c.brightness})}};if(!this.extraShadowCaster){const e=q(c.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(e).length?i.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},((e,t)=>{h||(h=e,d=t,_())}),void 0,!1,m):d={};const t=Object.keys(c.iconDependencies);t.length?i.send("getImages",{icons:t,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,p=t,_())}),void 0,!1,m):p={};const n=Object.keys(c.patternDependencies);n.length?i.send("getImages",{icons:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,f=t,_())}),void 0,!1,m):f={}}_()}}function kw(e,t,n,i){const r=new ea(t,{brightness:n});for(const o of e)o.recalculate(r,i)}class Pw{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,i){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,n]=r.result;return this.scheduler?this.scheduler.add((()=>{i(e,n)}),t):i(e,n),()=>{}}return r.callbacks.push(i),r.cancel||(r.cancel=n(((n,i)=>{r.result=[n,i];for(const e of r.callbacks)this.scheduler?this.scheduler.add((()=>{e(n,i)}),t):e(n,i);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((e=>e!==i)),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}}function Dw(e,t,n){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const i=Te(e.request,((e,i,r,o)=>{e?t(e):i&&t(null,{vectorTile:n?void 0:new tm(new Am(i)),rawData:i,cacheControl:r,expires:o})}));return()=>{i.cancel(),t()}}),t)}class Rw extends It{constructor(e,t,n,i){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,L(this,O(t,["url","scheme","tileSize","promoteId"])),this._options=L({type:"vector"},t),this._collectResourceTiming=!!t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new Pw}load(e){this._loaded=!1,this.fire(new Ct("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Sw(this._options,this.map._requestManager,t,n,((i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?(t&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(t)),n&&2!==n.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(n)),this.fire(new At(i))):r&&(L(this,r),r.bounds&&(this.tileBounds=new Ew(r.bounds,this.minzoom,this.maxzoom)),Ge(r.tiles,this.map._requestManager._customAccessToken),this.fire(new Ct("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ct("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=pa(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return L({},this._options)}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,ye.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:ut.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=t:e.request=e.actor.send("reloadTile",i,r.bind(this));else if(e.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",i,r.bind(this),void 0,!0);else{const t=Dw.call({deduped:this._deduped},i,((t,n)=>{t||!n?r.call(this,t):(i.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},e.actor&&e.actor.send("loadTile",i,r.bind(this),void 0,!0))}),!0);e.request={cancel:t}}function r(n,i){return delete e.request,e.aborted?t(null):n&&404!==n.status?t(n):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),ge(this.dispatcher),t(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class zw extends It{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=L({type:"raster"},t),L(this,O(t,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new Ct("dataloading",{dataType:"source"})),this._tileJSONRequest=Sw(this._options,this.map._requestManager,null,null,((t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new At(t)):n&&(L(this,n),n.bounds&&(this.tileBounds=new Ew(n.bounds,this.minzoom,this.maxzoom)),Ge(n.tiles),this.fire(new Ct("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ct("data",{dataType:"source",sourceDataType:"content"}))),e&&e(t)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=pa(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return L({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const n=ut.devicePixelRatio>=2,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);e.request=Ie(this.map._requestManager.transformRequest(i,ye.Tile),((n,i,r,o)=>(delete e.request,e.aborted?(e.state="unloaded",t(null)):n?(e.state="errored",t(n)):i?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:r,expires:o}),e.setTexture(i,this.map.painter),e.state="loaded",ge(this.dispatcher),void t(null)):t(null))))}static loadTileData(e,t,n){e.setTexture(t,n)}static unloadTileData(e,t){e.texture&&t.saveTileTexture(e.texture)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Lw;function Ow(){return null!=cI.workerClass?new cI.workerClass:new t.Worker(cI.workerUrl)}const Fw="mapboxgl_preloaded_worker_pool";class Bw{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Bw.workerCount;)this.workers.push(new Ow);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Fw]}numActive(){return Object.keys(this.active).length}}let Nw;function jw(){return Nw||(Nw=new Bw),Nw}Bw.workerCount=2;let Uw,Vw,Gw,qw=null;function Hw(){return $()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Vw||r.DRACO_URL}const Ww=5123,Zw=5126,Xw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[Ww]:Uint16Array,5125:Uint32Array,[Zw]:Float32Array},Yw={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[Ww]:"DT_UINT16",5125:"DT_UINT32",[Zw]:"DT_FLOAT32"},Kw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Qw(e,t,n){const i=n.json.bufferViews.length,r=n.buffers.length;t.bufferView=i,n.json.bufferViews[i]={buffer:r,byteLength:e.byteLength},n.buffers[r]=e}const Jw="KHR_draco_mesh_compression";function $w(e,t){const n=e.extensions&&e.extensions[Jw];if(!n)return;const i=new Gw.Decoder,r=rT(t,n.bufferView),o=new Gw.Mesh;if(!i.DecodeArrayToMesh(r,r.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=t.json.accessors[e.indices],a=Xw[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=Gw._malloc(l);a===Uint16Array?i.GetTrianglesUInt16Array(o,l,c):i.GetTrianglesUInt32Array(o,l,c),Qw(Gw.memory.buffer.slice(c,c+l),s,t),Gw._free(c);for(const u of Object.keys(n.attributes)){const r=i.GetAttributeByUniqueId(o,n.attributes[u]),s=t.json.accessors[e.attributes[u]],a=Yw[s.componentType],l=s.count*Kw[s.type]*Xw[s.componentType].BYTES_PER_ELEMENT,c=Gw._malloc(l);i.GetAttributeDataArrayForAllPoints(o,r,Gw[a],l,c),Qw(Gw.memory.buffer.slice(c,c+l),s,t),Gw._free(c)}i.destroy(),o.destroy(),delete e.extensions[Jw]}const eT=1179937895,tT=new TextDecoder("utf8");function nT(e,t){return new URL(e,t).href}function iT(e,t,n,i){return fetch(nT(e.uri,i)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[n]=e}))}function rT(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function oT(e,n,i,r){if(e.uri){const o=nT(e.uri,r);return fetch(o).then((e=>e.blob())).then((e=>t.createImageBitmap(e))).then((e=>{n.images[i]=e}))}if(void 0!==e.bufferView){const r=rT(n,e.bufferView),o=new t.Blob([r],{type:e.mimeType});return t.createImageBitmap(o).then((e=>{n.images[i]=e}))}}function sT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===eT){const n=new Uint32Array(e,t);let r=2;const o=(n[r++]>>2)-3,s=n[r++]>>2;if(r++,i.json=JSON.parse(tT.decode(n.subarray(r,r+s))),r+=s,r<o){const o=n[r++];r++;const s=t+(r<<2);i.buffers[0]=e.slice(s,s+o)}}else i.json=JSON.parse(tT.decode(new Uint8Array(e,t)));const{buffers:r,images:o,meshes:s,extensionsUsed:a}=i.json;let l=Promise.resolve();if(r){const e=[];for(let t=0;t<r.length;t++){const o=r[t];o.uri?e.push(iT(o,i,t,n)):i.buffers[t]||(i.buffers[t]=null)}l=Promise.all(e)}return l.then((()=>{const e=[],t=a&&a.includes(Jw);if(t&&e.push(function(){if(!Gw)return Uw||(Uw=function(e){let t,n=null;function i(){t=new Uint8Array(n.buffer)}function r(){throw new Error("Unexpected Draco error.")}const o={a:{a:r,d:function(e,n,i){return t.copyWithin(e,n,n+i)},c:function(e){const r=t.length,o=Math.max(e>>>0,Math.ceil(1.2*r)),s=Math.ceil((o-r)/65536);try{return n.grow(s),i(),!0}catch(e){return!1}},b:r}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,o):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,o)))).then((e=>{const{Rb:r,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:p,eb:f,jb:m,f:_,e:g,yb:y,zb:v,Ab:x,Bb:b,Db:w,Gb:T}=e.instance.exports;n=g;const S=(()=>{let e=0,n=0,i=0,s=0;return a=>{i&&(r(s),r(e),n+=i,i=e=0),e||(n+=128,e=o(n));const l=a.length+7&-8;let c=e;l>=n&&(i=l,c=s=o(l));for(let e=0;e<a.length;e++)t[c+e]=a[e];return c}})();return i(),_(),{memory:g,_free:r,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,n){const i=S(e),r=u(this.ptr,i,t,n.ptr);return!!l(r)}GetAttributeByUniqueId(e,t){return{ptr:h(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,n){d(this.ptr,e.ptr,t,n)}GetTrianglesUInt32Array(e,t,n){p(this.ptr,e.ptr,t,n)}GetAttributeDataArrayForAllPoints(e,t,n,i,r){f(this.ptr,e.ptr,t.ptr,n,i,r)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:T()}}))}(fetch(Hw())),Uw.then((e=>{Gw=e,Uw=void 0})))}()),o)for(let r=0;r<o.length;r++)e.push(oT(o[r],i,r,n));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&s)for(const{primitives:e}of s)for(const t of e)$w(t,i);return i}))}))}function aT(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>sT(t,0,e)))}class lT{constructor(e,t,n){if(this.triangleCount=t.length/3,this.min=new y(0,0),this.max=new y(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===n)return;const i=e.map((e=>e.x)),r=e.map((e=>e.y));this.min=new y(Math.min(...i),Math.min(...r)),this.max=new y(Math.max(...i),Math.max(...r));const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const s=Math.max(o.x,o.y)/n;this.cellsX=Math.max(1,Math.ceil(o.x/s)),this.cellsY=Math.max(1,Math.ceil(o.y/s)),this.xScale=1/s,this.yScale=1/s;const a=[];for(let c=0;c<this.triangleCount;c++){const n=e[t[3*c+0]].sub(this.min),i=e[t[3*c+1]].sub(this.min),r=e[t[3*c+2]].sub(this.min),o=cT(Math.floor(Math.min(n.x,i.x,r.x)),this.xScale,this.cellsX),l=cT(Math.floor(Math.max(n.x,i.x,r.x)),this.xScale,this.cellsX),u=cT(Math.floor(Math.min(n.y,i.y,r.y)),this.yScale,this.cellsY),h=cT(Math.floor(Math.max(n.y,i.y,r.y)),this.yScale,this.cellsY),d=new y(0,0),p=new y(0,0),f=new y(0,0),m=new y(0,0);for(let e=u;e<=h;++e){d.y=p.y=e*s,f.y=m.y=(e+1)*s;for(let t=o;t<=l;++t)d.x=f.x=t*s,p.x=m.x=(t+1)*s,(Cp(n,i,r,d,p,m)||Cp(n,i,r,d,m,f))&&a.push({cellIdx:e*this.cellsX+t,triIdx:c})}}if(0===a.length)return;a.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let l=0;for(;l<a.length;){const e=a[l].cellIdx,t={start:this.payload.length,len:0};for(;l<a.length&&a[l].cellIdx===e;)++t.len,this.payload.push(a[l++].triIdx);this.cells[e]=t}}query(e,t,n){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let a=0;a<this.lookup.length;a++)this.lookup[a]=0;const i=cT(e.x-this.min.x,this.xScale,this.cellsX),r=cT(t.x-this.min.x,this.xScale,this.cellsX),o=cT(e.y-this.min.y,this.yScale,this.cellsY),s=cT(t.y-this.min.y,this.yScale,this.cellsY);for(let a=o;a<=s;a++)for(let e=i;e<=r;e++){const t=this.cells[a*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const i=this.payload[t.start+e],r=Math.floor(i/8),o=1<<i%8;if(!(this.lookup[r]&o)&&(this.lookup[r]|=o,n.push(i),n.length===this.triangleCount))return}}}}function cT(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}function uT(e,t){const n=e.json.bufferViews[t.bufferView];return new(0,Xw[t.componentType])(e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*Kw[t.type])}function hT(e,t,n){const i=e.indices,r=e.attributes,o={};o.indexArray=new Ua;const s=t.json.accessors[i],a=s.count/3;o.indexArray.reserve(a);const l=uT(t,s);for(let d=0;d<a;d++)o.indexArray.emplaceBack(l[3*d],l[3*d+1],l[3*d+2]);o.indexArray._trim(),o.vertexArray=new ja;const c=t.json.accessors[r.POSITION];o.vertexArray.reserve(c.count);const u=uT(t,c);for(let d=0;d<c.count;d++)o.vertexArray.emplaceBack(u[3*d],u[3*d+1],u[3*d+2]);if(o.vertexArray._trim(),o.aabb=new Zh(c.min,c.max),o.centroid=function(e,t){const n=[0,0,0],i=e.length;if(i>0){for(let r=0;r<i;r++){const i=3*e[r];n[0]+=t[i],n[1]+=t[i+1],n[2]+=t[i+2]}n[0]/=i,n[1]/=i,n[2]/=i}return n}(l,u),void 0!==r.COLOR_0){const e=t.json.accessors[r.COLOR_0],n=Kw[e.type];if(e.componentType===Zw){o.colorArray=3===n?new ja:new Ia,o.colorArray.reserve(e.count);const i=uT(t,e);if(3===n)for(let t=0;t<e.count;t++)o.colorArray.emplaceBack(i[3*t],i[3*t+1],i[3*t+2]);else for(let t=0;t<e.count;t++)o.colorArray.emplaceBack(i[4*t],i[4*t+1],i[4*t+2],i[4*t+3]);o.colorArray._trim()}else if(e.componentType===Ww&&4===n){o.colorArray=new Ia,o.colorArray.resize(e.count);const n=uT(t,e),i=1/65535,r=o.colorArray.float32;for(let e=0;e<4*n.length;++e)r[e]=n[e]*i}else X("glTF color buffer parsing for accessor ".concat(JSON.stringify(e)," is not supported"))}if(void 0!==r.NORMAL){o.normalArray=new ja;const e=t.json.accessors[r.NORMAL];o.normalArray.reserve(e.count);const n=uT(t,e);for(let t=0;t<e.count;t++)o.normalArray.emplaceBack(n[3*t],n[3*t+1],n[3*t+2]);o.normalArray._trim()}if(void 0!==r.TEXCOORD_0&&n.length>0){o.texcoordArray=new Ya;const e=t.json.accessors[r.TEXCOORD_0];o.texcoordArray.reserve(e.count);const n=uT(t,e);for(let t=0;t<e.count;t++)o.texcoordArray.emplaceBack(n[2*t],n[2*t+1]);o.texcoordArray._trim()}const h=e.material;return o.material=function(e,t){const{emissiveFactor:n=[0,0,0],alphaMode:i="OPAQUE",alphaCutoff:r=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new cn(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:n,alphaMode:i,alphaCutoff:r,normalTexture:o?t[o.index]:void 0,occlusionTexture:s?t[s.index]:void 0,emissionTexture:a?t[a.index]:void 0,defined:void 0===e.defined}}(void 0!==h?t.json.materials[h]:{defined:!1},n),void 0!==r._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(uT(t,t.json.accessors[r._FEATURE_RGBA4444]).buffer)),o}function dT(e,t,n){const{matrix:i,rotation:r,translation:o,scale:s,mesh:a,extras:l,children:c}=e,u={};if(u.matrix=i||vh.fromRotationTranslationScale([],r||[0,0,0,1],o||[0,0,0],s||[1,1,1]),void 0!==a){u.meshes=n[a];const e=u.anchor=[0,0];for(const t of u.meshes){const{min:n,max:i}=t.aabb;e[0]+=n[0]+i[0],e[1]+=n[1]+i[1]}e[0]=Math.floor(e[0]/u.meshes.length/2),e[1]=Math.floor(e[1]/u.meshes.length/2)}if(l&&(l.id&&(u.id=l.id),l.lights&&(u.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.codePointAt(i);return n}(e),n=[],i=t.length/24,r=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let s=0;s<i;s++){const e=r[2*s*6]/30,t=r[2*s*6+1]/30,i=r[2*s*6+10]/100,a=o[6*s+1],l=o[6*s+2],c=o[6*s+3],u=o[6*s+4],h=c-a,d=u-l,p=Math.hypot(h,d);n.push({pos:[a+.5*h,l+.5*d,t],normal:[d/p,-h/p,0],width:p,height:e,depth:i,points:[a,l,c,u]})}return n}(l.lights))),c){const e=[];for(const i of c)e.push(dT(t.json.nodes[i],t,n));u.children=e}return u}function pT(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,n]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let s=1;s<e.vertices.length;++s){const i=e.vertices[s];t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),n.x=Math.max(n.x,i.x),n.y=Math.max(n.y,i.y)}const i=Math.ceil(Math.max(n.x-t.x,n.y-t.y)/256),r=Math.max(8,i),o=new lT(e.vertices,e.indices,r);return{vertices:e.vertices,indices:e.indices,grid:o,min:t,max:n}}function fT(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const n=t[0];if(!n||!Array.isArray(n)||0===n.length)return null;const i=[];for(const s of n){if(!Array.isArray(s)||2!==s.length)continue;const e=s[0],t=s[1];"number"==typeof e&&"number"==typeof t&&i.push(new y(e,t))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let r=0;for(let s=0;s<i.length;s++){const e=i[s],t=i[(s+1)%i.length],n=i[(s+2)%i.length];r+=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}r>0&&i.reverse();const o=Mf(i.flatMap((e=>[e.x,e.y])),[]);return 0===o.length?null:{vertices:i,indices:o}}function mT(e){const t=[],n=[];let i=0;for(const r of e){i=t.length;const e=r.vertexArray.float32,o=r.indexArray.uint16;for(let n=0;n<r.vertexArray.length;n++)t.push(new y(e[3*n+0],e[3*n+1]));for(let t=0;t<3*r.indexArray.length;t++)n.push(o[t]+i)}if(n.length%3!=0)return null;for(let r=0;r<n.length;r+=3){const e=t[n[r+0]],i=t[n[r+1]],o=t[n[r+2]];(e.x-i.x)*(o.y-i.y)-(o.x-i.x)*(e.y-i.y)>0&&([n[r+1],n[r+2]]=[n[r+2],n[r+1]])}return{vertices:t,indices:n}}function _T(e){const n=function(e,n){const i=[],r=t.WebGL2RenderingContext;if(e.json.textures)for(const t of e.json.textures){const o={magFilter:r.LINEAR,minFilter:r.NEAREST,wrapS:r.REPEAT,wrapT:r.REPEAT};void 0!==t.sampler&&Object.assign(o,e.json.samplers[t.sampler]),i.push({image:n[t.source],sampler:o,uploaded:!1})}return i}(e,e.images),i=function(e,t){const n=[];for(const i of e.json.meshes){const r=[];for(const n of i.primitives)r.push(hT(n,e,t));n.push(r)}return n}(e,n),{scenes:r,scene:o,nodes:s}=e.json,a=r?r[o||0].nodes:s,l=[];for(const t of a)l.push(dT(s[t],e,i));return function(e,t,n){const i={},r=new Set;for(let o=0;o<e.length;o++){const e=n[t[o]];if(!e.extras)continue;const s=e.extras["mapbox:footprint:version"],a=e.extras["mapbox:footprint:id"];(s||a)&&r.add(o),"1.0.0"===s&&a&&(i[a]=o)}for(let o=0;o<e.length;o++){if(r.has(o))continue;const s=e[o],a=n[t[o]];if(!a.extras)continue;let l=null;s.id in i&&(l=mT(e[i[s.id]].meshes)),l||(l=fT(a)),l&&(s.footprint=pT(l))}if(r.size>0){const t=Array.from(r.values()).sort(((e,t)=>e-t));for(let n=t.length-1;n>=0;n--)e.splice(t[n],1)}}(l,a,e.json.nodes),l}function gT(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,i=e.aabb.min[1]-1,r=vx/(e.aabb.max[0]-n+2),o=vx/(e.aabb.max[1]-i+2);for(let s=0;s<t.length;s+=3){const a=t[s+2],l=(t[s+0]-n)*r|0,c=(t[s+1]-i)*o|0;a>e.heightmap[c*vx+l]&&(e.heightmap[c*vx+l]=a)}}function yT(e,t){const n={};n.indexArray=new Ua,n.indexArray.reserve(4*e.length),n.vertexArray=new ja,n.vertexArray.reserve(10*e.length),n.colorArray=new Ia,n.vertexArray.reserve(10*e.length);let i=0;for(const s of e){const e=Math.min(10,Math.max(4,1.3*s.height))*t,r=[-s.normal[1],s.normal[0],0],o=Math.min(.29,.1*s.width/s.depth),a=s.width-2*s.depth*t*(o+.01),l=Eh.scaleAndAdd([],s.pos,r,a/2),c=Eh.scaleAndAdd([],s.pos,r,-a/2),u=[l[0],l[1],l[2]+s.height],h=[c[0],c[1],c[2]+s.height],d=Eh.scaleAndAdd([],s.normal,r,o);Eh.scale(d,d,e);const p=Eh.scaleAndAdd([],s.normal,r,-o);Eh.scale(p,p,e),Eh.add(d,l,d),Eh.add(p,c,p),l[2]+=.1,c[2]+=.1,n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]),n.vertexArray.emplaceBack(l[0],l[1],l[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(u[0],u[1],u[2]),n.vertexArray.emplaceBack(h[0],h[1],h[2]),n.vertexArray.emplaceBack(l[0],l[1],l[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]);const f=a/e/2;n.colorArray.emplaceBack(-f-o,-1,f,.8),n.colorArray.emplaceBack(f+o,-1,f,.8),n.colorArray.emplaceBack(-f,0,f,1.3),n.colorArray.emplaceBack(f,0,f,1.3),n.colorArray.emplaceBack(f+o,-.8,f,.7),n.colorArray.emplaceBack(f+o,-.8,f,.7),n.colorArray.emplaceBack(0,0,f,1.3),n.colorArray.emplaceBack(0,0,f,1.3),n.colorArray.emplaceBack(f+o,-1.2,f,.8),n.colorArray.emplaceBack(f+o,-1.2,f,.8),n.indexArray.emplaceBack(6+i,4+i,8+i),n.indexArray.emplaceBack(7+i,9+i,5+i),n.indexArray.emplaceBack(0+i,1+i,2+i),n.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}const r={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=cn.white,r.pbrMetallicRoughness=o,n.material=r,n.aabb=new Zh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}Is(lT,"TriangleGridIndex");const vT={vector:Rw,raster:zw,"raster-dem":class extends zw{constructor(e,t,n,i){super(e,t,n,i),this.type="raster-dem",this.maxzoom=22,this._options=L({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,n){var i;const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);e.request=Ie(this.map._requestManager.transformRequest(r,ye.Tile),function(i,r,a,l){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(r){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:a,expires:l});const n=t.ImageBitmap&&r instanceof t.ImageBitmap&&(null==Lw&&(Lw=t.OffscreenCanvas&&new t.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.createImageBitmap),Lw),i=1-(r.width-((c=r.width)<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))))/2;i<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const u=n?r:ut.getImageData(r,i),h={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:u,encoding:this.encoding,padding:i,convertToFloat:o};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",h,s.bind(this),void 0,!0))}var c}.bind(this));const o=null===(i=this.map)||void 0===i||null===(i=i.painter)||void 0===i?void 0:i.terrainUseFloatDEM();function s(t,i){t&&(e.state="errored",n(t)),i&&(e.dem=i,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",n(null))}}_getNeighboringTiles(e){const t=e.canonical,n=Math.pow(2,t.z),i=(t.x-1+n)%n,r=0===t.x?e.wrap-1:e.wrap,o=(t.x+1+n)%n,s=t.x+1===n?e.wrap+1:e.wrap,a={};return a[new Fh(e.overscaledZ,r,t.z,i,t.y).key]={backfilled:!1},a[new Fh(e.overscaledZ,s,t.z,o,t.y).key]={backfilled:!1},t.y>0&&(a[new Fh(e.overscaledZ,r,t.z,i,t.y-1).key]={backfilled:!1},a[new Fh(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},a[new Fh(e.overscaledZ,s,t.z,o,t.y-1).key]={backfilled:!1}),t.y+1<n&&(a[new Fh(e.overscaledZ,r,t.z,i,t.y+1).key]={backfilled:!1},a[new Fh(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},a[new Fh(e.overscaledZ,s,t.z,o,t.y+1).key]={backfilled:!1}),a}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.hillshadeFBO&&(e.hillshadeFBO.destroy(),delete e.hillshadeFBO),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends It{constructor(e,t,n,i){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=t.data,this._options=L({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const r=ai/this.tileSize;this.workerOptions=L({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*r,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*r,extent:ai,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:ai,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*r,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Ct("dataloading",{dataType:"source"})),this._loaded=!1;const e=L({},this.workerOptions);e.scope=this.scope;const t=this._data;"string"==typeof t?(e.request=this.map._requestManager.transformRequest(ut.resolveURL(t),ye.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),e,((e,t)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new At(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&t&&t.resourceTiming&&t.resourceTiming[this.id]&&(e.resourceTiming=t.resourceTiming[this.id]),this.fire(new Ct("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(e,t){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const i={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:ut.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(n,i,((i,r)=>(delete e.request,e.unloadVectorData(),e.aborted?t(null):i?t(i):(e.loadVectorData(r,this.map.painter,"reloadTile"===n),t(null)))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return L({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends qb{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,ye.Source).url);!function(e,n){const i=t.document.createElement("video");i.muted=!0,i.onloadstart=function(){n(null,i)};for(let r=0;r<e.length;r++){const n=t.document.createElement("source");Se(e[r])||(i.crossOrigin="Anonymous"),n.src=e[r],i.appendChild(n)}}(this.urls,((e,t)=>{this._loaded=!0,e?this.fire(new At(e)):t&&(this.video=t,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new At(new kt("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(t.start(0)," and ").concat(t.end(0),"-second mark.")))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new gy(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:qb,model:class extends It{constructor(e,t,n,i){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const e=[];for(const t in this._options.models){const n=this._options.models[t],i=aT(this.map._requestManager.transformRequest(n.uri,ye.Model).url).then((e=>{if(!e)return;const i=_T(e),r=new bx(t,n.position,n.orientation,i);r.computeBoundsAndApplyParent(),this.models.push(r)})).catch((e=>{this.fire(new At(new Error("Could not load model ".concat(t," from ").concat(n.uri,": ").concat(e.message))))}));e.push(i)}return Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new Ct("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((e=>{this.fire(new At(new Error("Could not load models: ".concat(e.message))))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends It{constructor(e,t,n,i){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new Ct("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Sw(this._options,this.map._requestManager,t,n,((i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?(t&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(t)),n&&2!==n.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(n)),this.fire(new At(i))):r&&(L(this,r),r.bounds&&(this.tileBounds=new Ew(r.bounds,this.minzoom,this.maxzoom)),Ge(r.tiles,this.map._requestManager._customAccessToken),this.fire(new Ct("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ct("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,ye.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=t;else{if(e.buckets){const t=Object.values(e.buckets);for(const e of t)e.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",i,r.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,r.bind(this),void 0,!0);function r(n,i){return e.aborted?t(null):n&&404!==n.status?t(n):(i&&(i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(i),e.buckets={...e.buckets,...i.buckets}),e.state="loaded",void t(null))}}serialize(){return L({},this._options)}},canvas:class extends qb{constructor(e,n,i,r){super(e,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new At(new kt("sources.".concat(e),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new At(new kt("sources.".concat(e),null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new At(new kt("sources.".concat(e),null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.HTMLCanvasElement||this.fire(new At(new kt("sources.".concat(e),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new At(new kt("sources.".concat(e),null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.HTMLCanvasElement?this.options.canvas:t.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new At(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof yy||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new gy(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends It{constructor(e,t,n,i){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new At(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new At(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new Ew(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),L(this,O(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return O(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Ct("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ct("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Ct("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:i}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,n){const{x:i,y:r,z:o}=e.tileID.canonical,s=new t.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:r,z:o},{signal:s.signal})).then(function(i){return delete e.request,e.aborted?(e.state="unloaded",n(null)):void 0===i?(e.state="errored",n(null)):null===i?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",n(null)):function(e){return e instanceof t.ImageData||e instanceof t.HTMLCanvasElement||e instanceof t.ImageBitmap||e instanceof t.HTMLImageElement}(i)?(this.loadTileData(e,i),e.state="loaded",void n(null)):(e.state="errored",n(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}.bind(this)).catch((t=>{20!==t.code&&(e.state="errored",n(t))})),e.request.cancel=()=>s.abort()}loadTileData(e,t){zw.loadTileData(e,t,this._map.painter)}unloadTileData(e){zw.unloadTileData(e,this._map.painter)}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:t,y:n,z:i}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:n,z:i})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const e=pa(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Ct("data",{dataType:"source",sourceDataType:"content"}))}}},xT=function(e,t,n,i){const r=new vT[t.type](e,t,n,i);if(r.id!==e)throw new Error("Expected Source id to be ".concat(e," instead of ").concat(r.id));return V(["load","abort","unload","serialize","prepare"],r),r};function bT(e,t){const n=vh.identity([]);return vh.scale(n,n,[.5*e.width,.5*-e.height,1]),vh.translate(n,n,[1,-1,0]),vh.multiply(n,n,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(n)}function wT(e,t,n,i,r,o,s){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=e.tilesIn(i,s,a);l.sort(ST);const c=[];for(const h of l)c.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(t,n,e._state,h,r,o,bT(e.transform,h.tile.tileID),a)});const u=function(e){const t={},n={};for(const i of e){const e=i.queryResults,r=i.wrappedTileID,o=n[r]=n[r]||{};for(const n in e){const i=e[n],r=o[n]=o[n]||{},s=t[n]=t[n]||[];for(const e of i)r[e.featureIndex]||(r[e.featureIndex]=!0,s.push(e))}}return t}(c);for(const h in u)u[h].forEach((t=>{const n=t.feature,i=n.layer;i&&"background"!==i.type&&"sky"!==i.type&&"slot"!==i.type&&(n.source=i.source,i["source-layer"]&&(n.sourceLayer=i["source-layer"]),n.state=void 0!==n.id?e.getFeatureState(i["source-layer"],n.id):{})}));return u}function TT(e,t){const n=e.getRenderableIds().map((t=>e.getTileByID(t))),i=[],r={};for(let o=0;o<n.length;o++){const e=n[o],s=e.tileID.canonical.key;r[s]||(r[s]=!0,e.querySourceFeatures(i,t))}return i}function ST(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}class ET{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const t=this.style._mergedLayers[e];if("fill-extrusion"===t.type)this.layers.push(t);else if("model"===t.type){const e=this.style.getLayerSource(t);e&&"batched-model"===e.type&&this.layers.push(t)}}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(let i=0;i<this.layers.length;++i){const e=this.layers[i],n=this.style.getLayerSourceCache(e);let r=1;"fill-extrusion"===e.type&&(r=e.paint.get("fill-extrusion-opacity")>0?e.paint.get("fill-extrusion-vertical-scale"):0);let o=n?n.getTile(t):null;if(!o&&n&&t.canonical.z>n.getSource().minzoom){let e=t.scaledTo(Math.min(n.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=n.getSource().minzoom&&(o=n.getTile(e),!o&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(e):null,tileID:o?o.tileID:t,verticalScale:r})}e.hasAnyZOffset=!1;let n=!1;for(let i=0;i<e.symbolInstances.length;i++){const r=e.symbolInstances.get(i),o=r.zOffset,s=this._getHeightAtTileOffset(t,r.tileAnchorX,r.tileAnchorY);r.zOffset=-1!==s?s:o,n||o===r.zOffset||(n=!0),e.hasAnyZOffset||0===r.zOffset||(e.hasAnyZOffset=!0)}n&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,t,n,i){let r=t,o=n;if(e.canonical.z!==i.canonical.z){const s=i.canonical,a=1/(1<<e.canonical.z-s.z);r=(t+e.canonical.x*ai)*a-s.x*ai|0,o=(n+e.canonical.y*ai)*a-s.y*ai|0}return{tileX:r,tileY:o}}_getHeightAtTileOffset(e,t,n){let i;for(let r=0;r<this.layers.length;++r){if("fill-extrusion"!==this.layers[r].type)continue;const{bucket:o,tileID:s,verticalScale:a}=this.currentBuildingBuckets[r];if(!o)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,n,s),u=o.getHeightAtTileCoord(l,c);if(u&&void 0!==u.height){if(!u.hidden)return u.height*a;i=u.height}}for(let r=0;r<this.layers.length;++r){if("model"!==this.layers[r].type)continue;const{bucket:o,tileID:s}=this.currentBuildingBuckets[r];if(!o)continue;const{tileX:a,tileY:l}=this._mapCoordToOverlappingTile(e,t,n,s),c=o.getHeightAtTileCoord(a,l);if(c&&!c.hidden)return void 0===c.height&&void 0!==i?Math.min(c.maxHeight,i)*c.verticalScale:(c.height||0)*c.verticalScale}return-1}}var CT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function AT(e,t){const n={};for(const i in e)"ref"!==i&&(n[i]=e[i]);return CT.forEach((e=>{e in t&&(n[e]=t[e])})),n}function IT(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=AT(e[n],t[e[n].ref]));return e}const MT={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function kT(e,t,n){n.push({command:MT.addSource,args:[e,t[e]]})}function PT(e,t,n){t.push({command:MT.removeSource,args:[e]}),n[e]=!0}function DT(e,t,n,i){PT(e,n,i),kT(e,t,n)}function RT(e,t,n){let i;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!v(e[n][i],t[n][i]))return!1;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!v(e[n][i],t[n][i]))return!1;return!0}function zT(e,t,n,i,r,o){let s;for(s in t=t||{},e=e||{})e.hasOwnProperty(s)&&(v(e[s],t[s])||n.push({command:o,args:[i,s,t[s],r]}));for(s in t)t.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(v(e[s],t[s])||n.push({command:o,args:[i,s,t[s],r]}))}function LT(e){return e.id}function OT(e,t){return e[t.id]=t,e}class FT{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=k(e,0,1);let t=1,n=this._distances[t];const i=e*this.paddedLength+this.padding;for(;n<i&&t<this._distances.length;)n=this._distances[++t];const r=t-1,o=this._distances[r],s=n-o,a=s>0?(i-o)/s:0;return this.points[r].mult(1-a).add(this.points[t].mult(a))}}class BT{constructor(e,t,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}_insertBoxCell(e,t,n,i,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,n,i,r,o){this.circleCells[r].push(o)}_query(e,t,n,i,r,o){if(n<0||e>this.width||i<0||t>this.height)return!r&&[];const s=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],i=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-i,y1:n-i,x2:t+i,y2:n+i})}return o?s.filter(o):s}return this._forEachCell(e,t,n,i,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?s.length>0:s}_queryCircle(e,t,n,i,r){const o=e-n,s=e+n,a=t-n,l=t+n;if(s<0||o>this.width||l<0||a>this.height)return!i&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),i?c.length>0:c}query(e,t,n,i,r){return this._query(e,t,n,i,!1,r)}hitTest(e,t,n,i,r){return this._query(e,t,n,i,!0,r)}hitTestCircle(e,t,n,i){return this._queryCircle(e,t,n,!0,i)}_queryCell(e,t,n,i,r,o,s,a){const l=s.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&n>=r[c+0]&&i>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,n,i)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=r[u],t=r[u+1],n=r[u+2];o.push({key:this.circleKeys[c],x1:e-n,y1:t-n,x2:e+n,y2:t+n})}}}}}_queryCellCircle(e,t,n,i,r,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const n=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const n=3*t;if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,n,i,r,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,n,i,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,i,r,o){const s=i-e,a=r-t,l=n+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,n,i,r,o,s){const a=(o-i)/2,l=Math.abs(e-(i+a));if(l>a+n)return!1;const c=(s-r)/2,u=Math.abs(t-(r+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}const NT=100;class jT{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new BT(e.width+200,e.height+200,25),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new BT(e.width+200,e.height+200,25);this.transform=e,this.grid=n,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+NT,this.screenBottomBoundary=e.height+NT,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,n,i,r,o,s,a){let l=n.projectedAnchorX,c=n.projectedAnchorY,u=n.projectedAnchorZ;const h=n.elevation,d=n.tileID,p=e.getProjection();if(h&&d){const[e,t,i]=p.upVector(d.canonical,n.tileAnchorX,n.tileAnchorY),r=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*r,c+=t*h*r,u+=i*h*r}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,n.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=o*f.perspectiveRatio,_=(n.x1*t+i.x-n.padding)*m+f.point.x,g=(n.y1*t+i.y-n.padding)*m+f.point.y,y=(n.x2*t+i.x+n.padding)*m+f.point.x,v=(n.y2*t+i.y+n.padding)*m+f.point.y,x=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(_,g,y,v)||!r&&this.grid.hitTest(_,g,y,v,a)||x?{box:[],offscreen:!1,occluded:f.occluded}:{box:[_,g,y,v],offscreen:this.isOffscreen(_,g,y,v),occluded:!1}}placeCollisionCircles(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){const m=[],_=this.transform.elevation,g=e.getProjection(),v=_?_.getAtTileOffsetFunc(f,this.transform.center.lat,this.transform.worldSize,g):null,x=new y(n.tileAnchorX,n.tileAnchorY);let{x:b,y:w,z:T}=g.projectTilePoint(x.x,x.y,f.canonical);if(v){const[e,t,n]=v(x);b+=e,w+=t,T+=n}const S="globe"===g.name,E=this.projectAndGetPerspectiveRatio(s,b,w,T,f,S||!!_||this.transform.pitch>0,g),{perspectiveRatio:C}=E,A=(u?o/C:o*C)/i_,I=tx(b,w,T,a),M=E.signedDistanceFromCamera>0?ox(A,r,n.lineOffsetX*A,n.lineOffsetY*A,!1,I,x,n,i,a,{},_&&!u?v:null,u&&!!_,g,f,u):null;let k=!1,P=!1,D=!0;if(M&&!E.occluded){const e=.5*d*C+p,n=new y(-100,-100),i=new y(this.screenRightBoundary,this.screenBottomBoundary),r=new FT,{first:o,last:s}=M,a=o.path.length;let u=[];for(let t=a-1;t>=1;t--)u.push(o.path[t]);for(let t=1;t<s.path.length;t++)u.push(s.path[t]);const f=2.5*e;l&&(u=u.map(((e,t)=>{let[n,i,r]=e;return v&&!S&&(r=v(t<a-1?o.tilePath[a-1-t]:s.tilePath[t-a+2])[2]),tx(n,i,r,l)})),u.some((e=>e[3]<=0))&&(u=[]));let _=[];if(u.length>0){let e=1/0,t=-1/0,r=1/0,o=-1/0;for(const n of u)e=Math.min(e,n[0]),r=Math.min(r,n[1]),t=Math.max(t,n[0]),o=Math.max(o,n[1]);t>=n.x&&e<=i.x&&o>=n.y&&r<=i.y&&(_=[u.map((e=>new y(e[0],e[1])))],(e<n.x||t>i.x||r<n.y||o>i.y)&&(_=W_(_,n.x,n.y,i.x,i.y)))}for(const l of _){r.reset(l,.25*e);let n=0;n=r.length<=.5*e?1:Math.ceil(r.paddedLength/f)+1;for(let i=0;i<n;i++){const o=i/Math.max(n-1,1),s=r.lerp(o),a=s.x+NT,l=s.y+NT;m.push(a,l,e,0);const u=a-e,d=l-e,p=a+e,f=l+e;if(D=D&&this.isOffscreen(u,d,p,f),P=P||this.isInsideGrid(u,d,p,f),!t&&this.grid.hitTestCircle(a,l,e,h)&&(k=!0,!c))return{circles:[],offscreen:!1,collisionDetected:k,occluded:!1}}}}return{circles:!c&&k||!P?[]:m,offscreen:D,collisionDetected:k,occluded:E.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const t=[];let n=1/0,i=1/0,r=-1/0,o=-1/0;for(const c of e){const e=new y(c.x+NT,c.y+NT);n=Math.min(n,e.x),i=Math.min(i,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y),t.push(e)}const s=this.grid.query(n,i,r,o).concat(this.ignoredGrid.query(n,i,r,o)),a={},l={};for(const c of s){const e=c.key;void 0===a[e.bucketInstanceId]&&(a[e.bucketInstanceId]={}),a[e.bucketInstanceId][e.featureIndex]||pp(t,[new y(c.x1,c.y1),new y(c.x2,c.y1),new y(c.x2,c.y2),new y(c.x1,c.y2)])&&(a[e.bucketInstanceId][e.featureIndex]=!0,void 0===l[e.bucketInstanceId]&&(l[e.bucketInstanceId]=[]),l[e.bucketInstanceId].push(e.featureIndex))}return l}insertCollisionBox(e,t,n,i,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,i,r){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};for(let a=0;a<e.length;a+=4)o.insertCircle(s,e[a],e[a+1],e[a+2])}projectAndGetPerspectiveRatio(e,t,n,i,r,o,s){const a=[t,n,i,1];let l=!1;if(i||this.transform.pitch>0){if(hh.transformMat4(a,a,e),this.fogState&&r&&"globe"!==s.name){const e=function(e,t,n,i,r,o){const s=o.calculateFogTileMatrix(r),a=[t,n,i];return Eh.transformMat4(a,a,s),aw(e,Eh.length(a),o.pitch,o._fov)}(this.fogState,t,n,i,r.toUnwrapped(),this.transform);l=e>.9}}else dx(a,a,e);const c=a[3];return{point:new y((a[0]/c+1)/2*this.transform.width+NT,(-a[1]/c+1)/2*this.transform.height+NT),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/c*.5,1.5),signedDistanceFromCamera:c,occluded:o&&a[2]>c||l}}isOffscreen(e,t,n,i){return n<NT||e>=this.screenRightBoundary||i<NT||t>this.screenBottomBoundary}isInsideGrid(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=vh.identity([]);return vh.translate(e,e,[-100,-100,0]),e}}function UT(e,t,n){const i=t.createTileMatrix(e,e.worldSize,n.toUnwrapped());return vh.multiply(new Float32Array(16),e.projMatrix,i)}function VT(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const i=n.clone();return i.setProjection(t.projection),UT(i,t.getProjection(),e)}function GT(e,t,n){return t.name===n.projection.name?e.projMatrix:UT(n,t,e)}class qT{constructor(e,t,n,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class HT{constructor(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new qT(e?e.text:null,t,n,r),this.icon=new qT(e?e.icon:null,t,i,r),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class WT{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=n,this.clipped=i}}class ZT{constructor(){this.invProjMatrix=vh.create(),this.viewportMatrix=vh.create(),this.circles=[]}}class XT{constructor(e,t,n,i,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class YT{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function KT(e,t,n,i,r){const{horizontalAlign:o,verticalAlign:s}=z_(e),a=-(o-.5)*t,l=-(s-.5)*n,c=hg(e,i);return new y(a+c[0]*r,l+c[1]*r)}function QT(e,t,n,i,r){const o=new y(e,t);return n&&o._rotate(i?r:-r),o}class JT{constructor(e,t,n,i,r,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new jT(this.transform,r),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new YT(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,t,n,i){const r=n.getBucket(t),o=n.latestFeatureIndex;if(!r||!o||t.fqid!==r.layerIds[0])return;const s=r.layers[0].layout,a=n.collisionBoxArray,l=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),c=n.tileSize/ai,u=n.tileID.toUnwrapped();this.transform.setProjection(r.projection);const h=(d=n.tileID,p=r.getProjection(),f=this.transform,p.name===this.projection?f.calculateProjMatrix(d.toUnwrapped()):UT(f,p,d));var d,p,f;const m="map"===s.get("text-pitch-alignment"),_="map"===s.get("text-rotation-alignment");t.compileFilter();const g=t.dynamicFilter(),y=t.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(n),x=$v(h,n.tileID.canonical,m,_,this.transform,r.getProjection(),v);let b=null;if(m){const e=ex(h,n.tileID.canonical,m,_,this.transform,r.getProjection(),v);b=vh.multiply([],this.transform.labelPlaneMatrix,e)}let w=null;g&&n.latestFeatureIndex&&(w={unwrappedTileID:u,dynamicFilter:g,dynamicFilterNeedsFeature:y,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[r.bucketInstanceId]=new XT(r.bucketInstanceId,o,r.sourceLayerIndex,r.index,n.tileID);const T={bucket:r,layout:s,posMatrix:h,textLabelPlaneMatrix:x,labelToScreenMatrix:b,clippingData:w,scale:l,textPixelRatio:c,holdingForFade:n.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:a_(r.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a_(r.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(r.sourceID)};if(i)for(const S of r.sortKeyRanges){const{sortKey:t,symbolInstanceStart:n,symbolInstanceEnd:i}=S;e.push({sortKey:t,symbolInstanceStart:n,symbolInstanceEnd:i,parameters:T})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:r.symbolInstances.length,parameters:T})}attemptAnchorPlacement(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g){const{textOffset0:y,textOffset1:v,crossTileID:x}=h,b=[y,v],w=KT(e,n,i,b,r),T=this.collisionIndex.placeCollisionBox(p,r,t,QT(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(g,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,QT(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(T.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(t=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:n,height:i,anchor:e,textScale:r,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[x]=f),{shift:w,placedGlyphBoxes:T}}}placeLayerBucketPart(e,t,n,i){const{bucket:r,layout:o,posMatrix:s,textLabelPlaneMatrix:a,labelToScreenMatrix:l,clippingData:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,partiallyEvaluatedIconSize:f,collisionGroup:m}=e.parameters,_=o.get("text-optional"),g=o.get("icon-optional"),v=o.get("text-allow-overlap"),x=o.get("icon-allow-overlap"),b="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),T="viewport-y"===o.get("symbol-z-order"),S=o.get("symbol-z-elevate");this.transform.setProjection(r.projection);let E=v&&(x||!r.hasIconData()||g),C=x&&(v||!r.hasTextData()||_);!r.collisionArrays&&d&&r.deserializeCollisionBoxes(d),n&&i&&r.updateCollisionDebugBuffers(this.transform.zoom,d);const A=(e,i,d)=>{const{crossTileID:T,numVerticalGlyphVertices:S}=e;if(c){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let i=null;if(c.dynamicFilterNeedsFeature){const t=this.retainedQueryData[r.bucketInstanceId];i=c.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,c.dynamicFilter)(n,i,this.retainedQueryData[r.bucketInstanceId].tileID.canonical,new y(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(c.unwrappedTileID)))return this.placements[T]=new WT(!1,!1,!1,!0),void t.add(T)}if(t.has(T))return;if(h)return void(this.placements[T]=new WT(!1,!1,!1));let A=!1,I=!1,M=!0,k=!1,P=!1,D=null,R={box:null,offscreen:null,occluded:null},z={box:null,offscreen:null,occluded:null},L=null,O=null,F=null,B=0,N=0,j=0;d.textFeatureIndex?B=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(B=e.featureIndex),d.verticalTextFeatureIndex&&(N=d.verticalTextFeatureIndex);const U=t=>{t.tileID=this.retainedQueryData[r.bucketInstanceId].tileID;const n=this.transform.elevation;t.elevation=e.zOffset+(n?n.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0)},V=d.textBox;if(V){U(V);const t=t=>{let n=w_.horizontal;if(r.allowVerticalPlacement&&!t&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[T];t&&(this.placedOrientations[T]=t,n=t,this.markUsedOrientation(r,n,e))}return n},n=(e,t)=>{if(r.allowVerticalPlacement&&S>0&&d.verticalTextBox){for(const n of r.writingModes)if(n===w_.vertical?(R=t(),z=R):R=e(),R&&R.box&&R.box.length)break}else R=e()};if(o.get("text-variable-anchor")){let a=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[T]){const e=this.prevPlacement.variableOffsets[T];a.indexOf(e.anchor)>0&&(a=a.filter((t=>t!==e.anchor)),a.unshift(e.anchor))}const l=(t,n,o)=>{const l=r.getSymbolInstanceTextSize(p,e,this.transform.zoom,i),c=(t.x2-t.x1)*l+2*t.padding,h=(t.y2-t.y1)*l+2*t.padding,d=e.hasIconTextFit&&!x?n:null;d&&U(d);let _={box:[],offscreen:!1,occluded:!1};const g=v?2*a.length:a.length;for(let y=0;y<g;++y){const n=this.attemptAnchorPlacement(a[y%a.length],t,c,h,l,b,w,u,s,m,y>=a.length,e,i,r,o,d,p,f);if(n&&(_=n.placedGlyphBoxes,_&&_.box&&_.box.length)){A=!0,D=n.shift;break}}return _};n((()=>l(V,d.iconBox,w_.horizontal)),(()=>{const e=d.verticalTextBox;return e&&U(e),r.allowVerticalPlacement&&!(R&&R.box&&R.box.length)&&S>0&&e?l(e,d.verticalIconBox,w_.vertical):{box:null,offscreen:null,occluded:null}})),R&&(A=R.box,M=R.offscreen,k=R.occluded);const c=t(!(!R||!R.box));if(!A&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[T];t&&(this.variableOffsets[T]=t,this.markUsedJustification(r,t.anchor,e,c))}}else{const o=(t,n)=>{const o=r.getSymbolInstanceTextSize(p,e,this.transform.zoom,i),a=this.collisionIndex.placeCollisionBox(r,o,t,new y(0,0),v,u,s,m.predicate);return a&&a.box&&a.box.length&&(this.markUsedOrientation(r,n,e),this.placedOrientations[T]=n),a};n((()=>o(V,w_.horizontal)),(()=>{const e=d.verticalTextBox;return r.allowVerticalPlacement&&S>0&&e?(U(e),o(e,w_.vertical)):{box:null,offscreen:null,occluded:null}})),t(!!(R&&R.box&&R.box.length))}}if(L=R,A=L&&L.box&&L.box.length>0,M=L&&L.offscreen,k=L&&L.occluded,e.useRuntimeCollisionCircles){const t=r.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),i=s_(r.textSizeData,p,t),c=o.get("text-padding");O=this.collisionIndex.placeCollisionCircles(r,v,t,r.lineVertexArray,r.glyphOffsetArray,i,s,a,l,n,w,m.predicate,e.collisionCircleDiameter*i/i_,c,this.retainedQueryData[r.bucketInstanceId].tileID),A=v||O.circles.length>0&&!O.collisionDetected,M=M&&O.offscreen,k=O.occluded}if(d.iconFeatureIndex&&(j=d.iconFeatureIndex),d.iconBox){const t=t=>{U(t);const n=e.hasIconTextFit&&D?QT(D.x,D.y,b,w,this.transform.angle):new y(0,0),i=r.getSymbolInstanceIconSize(f,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(r,i,t,n,x,u,s,m.predicate)};z&&z.box&&z.box.length&&d.verticalIconBox?(F=t(d.verticalIconBox),I=F.box.length>0):(F=t(d.iconBox),I=F.box.length>0),M=M&&F.offscreen,P=F.occluded}const G=_||0===e.numHorizontalGlyphVertices&&0===S,q=g||0===e.numIconVertices;if(G||q?q?G||(I=I&&A):A=I&&A:I=A=I&&A,A&&L&&L.box&&this.collisionIndex.insertCollisionBox(L.box,o.get("text-ignore-placement"),r.bucketInstanceId,z&&z.box&&N?N:B,m.ID),I&&F&&this.collisionIndex.insertCollisionBox(F.box,o.get("icon-ignore-placement"),r.bucketInstanceId,j,m.ID),O&&(A&&this.collisionIndex.insertCollisionCircles(O.circles,o.get("text-ignore-placement"),r.bucketInstanceId,B,m.ID),n)){const e=r.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new ZT);for(let n=0;n<O.circles.length;n+=4)t.circles.push(O.circles[n+0]),t.circles.push(O.circles[n+1]),t.circles.push(O.circles[n+2]),t.circles.push(O.collisionDetected?1:0)}const H="globe"!==r.projection.name;E=E&&(H||!k),C=C&&(H||!P),this.placements[T]=new WT(A||E,I||C,M||r.justReloaded),t.add(T)};if(S&&this.buildingIndex&&(this.buildingIndex.updateZOffset(r,this.retainedQueryData[r.bucketInstanceId].tileID),r.updateZOffset()),T){const e=r.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const n=e[t];A(r.symbolInstances.get(n),n,r.collisionArrays[n])}r.hasAnyZOffset&&X("".concat(r.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(r.hasAnyZOffset){const e=r.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const n=e[t];A(r.symbolInstances.get(n),n,r.collisionArrays[n])}}else for(let y=e.symbolInstanceStart;y<e.symbolInstanceEnd;y++)A(r.symbolInstances.get(y),y,r.collisionArrays[y]);if(n&&r.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[r.bucketInstanceId];vh.invert(e.invProjMatrix,s),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}r.justReloaded=!1}markUsedJustification(e,t,n,i){const{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:a,crossTileID:l}=n,c=pg(t),u=i===w_.vertical?a:"left"===c?r:"center"===c?o:"right"===c?s:-1;r>=0&&(e.text.placedSymbolArray.get(r).crossTileID=u>=0&&r!==u?0:l),o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=u>=0&&o!==u?0:l),s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=u>=0&&s!==u?0:l),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=u>=0&&a!==u?0:l)}markUsedOrientation(e,t,n){const i=t===w_.horizontal||t===w_.horizontalOnly?t:0,r=t===w_.vertical?t:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l}=n,c=e.text.placedSymbolArray;o>=0&&(c.get(o).placedOrientation=i),s>=0&&(c.get(s).placedOrientation=i),a>=0&&(c.get(a).placedOrientation=i),l>=0&&(c.get(l).placedOrientation=r)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const a in this.placements){const e=this.placements[a],t=r[a];t?(this.opacities[a]=new HT(t,i,e.text,e.icon,null,e.clipped),n=n||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[a]=new HT(null,i,e.text,e.icon,e.skipFade,e.clipped),n=n||e.text||e.icon)}for(const a in r){const e=r[a];if(!this.opacities[a]){const t=new HT(e,i,!1,!1);t.isHidden()||(this.opacities[a]=t,n=n||e.text.placed||e.icon.placed)}}for(const a in o)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=o[a]);for(const a in s)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=s[a]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n=new Set;for(const i of t){const t=i.getBucket(e);t&&i.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,n,i.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,i.tileID),t.updateZOffset()))}}updateBucketOpacities(e,t,n){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const i=e.layers[0].layout,r=!!e.layers[0].dynamicFilter(),o=new HT(null,0,!1,!1,!0),s=i.get("text-allow-overlap"),a=i.get("icon-allow-overlap"),l=i.get("text-variable-anchor"),c="map"===i.get("text-rotation-alignment"),u="map"===i.get("text-pitch-alignment"),h=new HT(null,0,s&&(a||!e.hasIconData()||i.get("icon-optional")),a&&(s||!e.hasTextData()||i.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const d=(e,t,n)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n)};let p=0;for(let f=0;f<e.symbolInstances.length;f++){const n=e.symbolInstances.get(f),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:s,crossTileID:a,numIconVertices:m}=n,_=t.has(a);let g=this.opacities[a];_?g=o:g||(g=h,this.opacities[a]=g),t.add(a);const v=i>0||s>0,x=m>0,b=this.placedOrientations[a],w=b===w_.vertical,T=b===w_.horizontal||b===w_.horizontalOnly;if(!v&&!x||g.isHidden()||p++,v){const t=aS(g.text);d(e.text,i,w?lS:t),d(e.text,s,T?lS:t);const r=g.text.isHidden(),{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:l,rightJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:u}=n,h=e.text.placedSymbolArray,p=r||w?1:0;o>=0&&(h.get(o).hidden=p),l>=0&&(h.get(l).hidden=p),c>=0&&(h.get(c).hidden=p),u>=0&&(h.get(u).hidden=r||T?1:0);const f=this.variableOffsets[a];f&&this.markUsedJustification(e,f.anchor,n,b);const m=this.placedOrientations[a];m&&(this.markUsedJustification(e,"left",n,m),this.markUsedOrientation(e,m,n))}if(x){const t=aS(g.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:r}=n,o=e.icon.placedSymbolArray,s=g.icon.isHidden()?1:0;i>=0&&(d(e.icon,m,w?lS:t),o.get(i).hidden=s),r>=0&&(d(e.icon,n.numVerticalIconVertices,T?lS:t),o.get(r).hidden=s)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const t=e.collisionArrays[f];if(t){let i=new y(0,0),o=!0;if(t.textBox||t.verticalTextBox){if(l){const e=this.variableOffsets[a];e?(i=KT(e.anchor,e.width,e.height,e.textOffset,e.textScale),c&&i._rotate(u?this.transform.angle:-this.transform.angle)):o=!1}r&&(o=!g.clipped),t.textBox&&$T(e.textCollisionBox.collisionVertexArray,g.text.placed,!o||w,i.x,i.y),t.verticalTextBox&&$T(e.textCollisionBox.collisionVertexArray,g.text.placed,!o||T,i.x,i.y)}const s=o&&Boolean(!T&&t.verticalIconBox);t.iconBox&&$T(e.iconCollisionBox.collisionVertexArray,g.icon.placed,s,n.hasIconTextFit?i.x:0,n.hasIconTextFit?i.y:0),t.verticalIconBox&&$T(e.iconCollisionBox.collisionVertexArray,g.icon.placed,!s,n.hasIconTextFit?i.x:0,n.hasIconTextFit?i.y:0)}}}if(e.fullyClipped=0===p,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function $T(e,t,n,i,r){e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0)}const eS=Math.pow(2,25),tS=Math.pow(2,24),nS=Math.pow(2,17),iS=Math.pow(2,16),rS=Math.pow(2,9),oS=Math.pow(2,8),sS=Math.pow(2,1);function aS(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*eS+t*tS+n*nS+t*iS+n*rS+t*oS+n*sS+t}const lS=0;class cS{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,n,i,r){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,n,0===e.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class uS{constructor(e,t,n,i,r,o,s,a,l){this.placement=new JT(e,r,o,s,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(e,t,n,i){const r=ut.now(),o=()=>{const e=ut.now()-r;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const r=t[e[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===r.type&&(!r.minzoom||r.minzoom<=s)&&(!r.maxzoom||r.maxzoom>s)){const e=r,t=e.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new cS(e),a=pa(r.source,r.scope);if(s.continuePlacement(t?i[a]:n[a],this.placement,this._showCollisionBoxes,r,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const hS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dS{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error("Got v".concat(i," data when expected v1."));const r=hS[15&n];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new dS(s,o,r,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,i=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=hS.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error("Unexpected typed array class: ".concat(n,"."));i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return pS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=n&&c>=t&&c<=i&&l.push(r[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=n&&f>=t&&f<=i&&l.push(r[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?n>=p:i>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:o}=this,s=[0,i.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)gS(r[2*n],r[2*n+1],e,t)<=l&&a.push(i[n]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];gS(p,f,e,t)<=l&&a.push(i[d]),(0===c?e-n<=p:t-n<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function pS(e,t,n,i,r,o){if(r-i<=n)return;const s=i+r>>1;fS(e,t,s,i,r,o),pS(e,t,n,i,s-1,1-o),pS(e,t,n,s+1,r,1-o)}function fS(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const s=r-i+1,a=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);fS(e,t,n,Math.max(i,Math.floor(n-a*c/s+u)),Math.min(r,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=i,l=r;for(mS(e,t,i,n),t[2*r+o]>s&&mS(e,t,i,r);a<l;){for(mS(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*i+o]===s?mS(e,t,i,l):(l++,mS(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function mS(e,t,n,i){_S(e,n,i),_S(t,2*n,2*i),_S(t,2*n+1,2*i+1)}function _S(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function gS(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}const yS=512/ai/2;class vS{constructor(e,t,n){this.tileID=e,this.bucketInstanceId=n,this.index=new dS(t.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const i=e.canonical.x*ai,r=e.canonical.y*ai;for(let o=0;o<t.length;o++){const{key:e,crossTileID:n,tileAnchorX:s,tileAnchorY:a}=t.get(o),l=Math.floor((i+s)*yS),c=Math.floor((r+a)*yS);this.index.add(l,c),this.keys.push(e),this.crossTileIDs.push(n)}this.index.finish()}findMatches(e,t,n){const i=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z),r=yS/Math.pow(2,t.canonical.z-this.tileID.canonical.z),o=t.canonical.x*ai,s=t.canonical.y*ai;for(let a=0;a<e.length;a++){const t=e.get(a);if(t.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=t,h=Math.floor((o+c)*r),d=Math.floor((s+u)*r),p=this.index.range(h-i,d-i,h+i,d+i);for(const e of p){const i=this.crossTileIDs[e];if(this.keys[e]===l&&!n.has(i)){n.add(i),t.crossTileID=i;break}}}}}class xS{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bS{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const n in this.indexes){const e=this.indexes[n],i={};for(const n in e){const r=e[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const i=this.usedCrossTileIDs[e.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>e.overscaledZ)for(const r in n){const o=n[r];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,i)}else{const o=n[e.scaledTo(Number(r)).key];o&&o.findMatches(t.symbolInstances,e,i)}}for(let r=0;r<t.symbolInstances.length;r++){const e=t.symbolInstances.get(r);e.crossTileID||(e.crossTileID=n.generate(),i.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new vS(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.crossTileIDs)this.usedCrossTileIDs[e].delete(n)}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}class wS{constructor(){this.layerIndexes={},this.crossTileIDs=new xS,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n,i){let r=this.layerIndexes[e.fqid];void 0===r&&(r=this.layerIndexes[e.fqid]=new bS);let o=!1;const s={};"globe"!==i.name&&r.handleWrapJump(n);for(const a of t){const t=a.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(a.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const n in this.layerIndexes)t[n]||delete this.layerIndexes[n]}}var TS="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nvec3 linearTosRGB(vec3 color)\n{return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn)\n{return pow(srgbIn,vec3(2.2));}vec3 linearProduct(vec3 srgbIn,vec3 k)\n{return srgbIn*pow(k,vec3(1./2.2));}\n#if __VERSION__ >=300\n#define _HANDLE_WIREFRAME_DEPTH gl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define _HANDLE_WIREFRAME_DEPTH\n#endif\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\ngl_FragColor=vec4(0.7,0.0,0.0,0.7); \\\n_HANDLE_WIREFRAME_DEPTH;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",SS="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ES="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",CS="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",AS="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",IS="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",MS="#ifdef RENDER_SHADOWS\n#if defined(NATIVE) && __VERSION__ >=300\n#define TEXTURE_GATHER\n#endif\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const kS=[];OS(TS,kS);const PS={"_prelude_fog.vertex.glsl":CS,"_prelude_terrain.vertex.glsl":ES,"_prelude_shadow.vertex.glsl":IS,"_prelude_fog.fragment.glsl":AS,"_prelude_shadow.fragment.glsl":MS,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE"},DS={};FS("",ES),FS(AS,CS),FS(MS,IS);const RS=FS("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),zS=TS;var LS={background:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;varying vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:FS("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:FS('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:FS("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:FS("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:FS("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:FS("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#if __VERSION__ >=300\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:FS("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nvarying highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:FS('#include "_prelude_shadow.fragment.glsl"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 u_ground_shadow_factor;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\ngl_FragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;attribute vec2 a_pos;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:FS("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture2D(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\ngl_FragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\ngl_FragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\ngl_FragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nattribute highp vec4 a_pos_end;attribute highp float a_angular_offset_factor;attribute highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:FS("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture(u_image,coord).r/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting_with_emission_ground(gl_FragColor,u_emissive_strength);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec2 u_colorization_scale;uniform highp vec4 u_colorization_mix;highp vec4 colormap (highp float value) {highp float scaled_value=value*u_colorization_scale.y+u_colorization_scale.x;highp vec2 coords=vec2(scaled_value,0.5);return texture2D(u_color_ramp,coords);}\n#endif\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);vec4 color;\n#ifdef RASTER_COLOR\nhighp vec4 fadedColor=mix(color0,color1,u_fade_t);color=colormap(dot(vec4(fadedColor.rgb,1),u_colorization_mix));color.a*=fadedColor.a;if (color.a > 0.0) {color.rgb/=color.a;}\n#else\nif (color0.a > 0.0) {color0.rgb/=color0.a;}if (color1.a > 0.0) {color1.rgb/=color1.a;}color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_ground(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;attribute vec2 a_texture_pos;\n#endif\nvarying vec2 v_pos0;varying vec2 v_pos1;void main() {vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*u_globe_matrix*vec4(a_globe_pos,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),symbolIcon:FS('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nvarying float v_fade_opacity;varying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture2D(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture2D(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture2D(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nattribute vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\nvarying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:FS('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:FS('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture2D(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:FS("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:FS('#include "_prelude_fog.fragment.glsl"\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',SS),skyboxGradient:FS('#include "_prelude_fog.fragment.glsl"\nvarying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',SS),skyboxCapture:FS("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:FS('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\ngl_FragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\ngl_FragColor=vec4(1,1,1,1);\n#else\ngl_FragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);gl_FragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\ngl_FragColor=vec4(c*t,t);\n#endif\n}',"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:FS('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;varying highp vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture2D(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\nconst float M_PI=3.141592653589793;\n#define saturate(_x) clamp(_x,0.,1.)\nfloat calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture2D(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture2D( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture2D(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(M_PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/M_PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/M_PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture2D(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\ncolor=mix(color,mat.baseColor.rgb,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\ngl_FragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nattribute vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\nvarying vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\nvoid main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:FS("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}","attribute vec3 a_pos_3f;uniform mat4 u_matrix;varying highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:FS("varying highp vec2 v_uv;varying mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;gl_FragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nattribute vec3 a_pos_3f;attribute vec2 a_uv;attribute float a_size_scale;attribute float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;varying highp vec2 v_uv;varying mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function OS(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of n)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=i.split(" ");for(const n of e)t.includes(n)||t.push(n)}}function FS(e,t){const n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let r=t.match(/attribute(\S*) (highp |mediump |lowp )?([\w]+) ([\w]+)/g);r&&(r=r.filter(((e,t)=>r.indexOf(e)===t)));const o={},s=[],a=[];e=e.replace(n,((e,t)=>(a.push(t),""))),t=t.replace(n,((e,t)=>(s.push(t),"")));let l=[...kS];OS(e,l),OS(t,l);for(const c of[...s,...a])PS[c]||console.error("Undefined include: ".concat(c)),DS[c]||(DS[c]=[],OS(PS[c],DS[c])),l=[...l,...DS[c]];return{fragmentSource:e=e.replace(i,((e,t,n,i,r)=>(o[r]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nvarying ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"\n#ifdef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    varying ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(i,((e,t,n,i,r)=>{const s="float"===i?"vec2":i,a=r.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\nattribute ").concat(n," ").concat(i," a_").concat(r,";\n#endif\n"):o[r]?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nattribute ").concat(n," ").concat(s," a_").concat(r,";\nvarying ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"vec4"===a?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = unpack_mix_").concat(a,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    attribute ").concat(n," ").concat(i," a_").concat(r,";\n    varying ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#endif\n"):void 0:"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nattribute ").concat(n," ").concat(s," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"define-instanced"===t?"mat4"===a?"\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_".concat(r,"0;\nattribute vec4 a_").concat(r,"1;\nattribute vec4 a_").concat(r,"2;\nattribute vec4 a_").concat(r,"3;\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nattribute ".concat(n," ").concat(s," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize-attribute-custom"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#endif\n"):"vec4"===a?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = unpack_mix_").concat(a,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n")})),staticAttributes:r,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class BS{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,n,i,r,o,s,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==i.length;for(let u=0;!l&&u<i.length;u++)this.boundPaintVertexBuffers[u]!==i[u]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let u=0;!c&&u<s.length;u++)this.boundDynamicVertexBuffers[u]!==s[u]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||l||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==o)this.freshBind(t,n,i,r,o,s,a);else{e.bindVertexArrayOES.set(this.vao);for(const n of s)n&&(n.bind(),a&&n.instanceCount&&n.setVertexAttribDivisor(e.gl,t,a));r&&r.dynamicDraw&&r.bind()}}freshBind(e,t,n,i,r,o,s){const a=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=o,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const u of n)u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,r);for(const u of o)u&&(u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,r),s&&u.instanceCount&&u.setVertexAttribDivisor(c,e,s));i&&i.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function NS(e,t){const n=Math.pow(2,t.canonical.z),i=t.canonical.y;return[new ep(0,i/n).toLngLat().lat,new ep(0,(i+1)/n).toLngLat().lat]}function jS(e,t,n,i,r,o,s){const a=e.context,l=a.gl,c=n.hillshadeFBO;if(!c)return;e.prepareDrawTile();const u=e.isTileAffectedByFog(t),h=e.getOrCreateProgram("hillshade",{overrideFog:u});a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get());const d=((e,t,n,i)=>{const r=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),s=n.paint.get("hillshade-accent-color"),a=n.paint.get("hillshade-emissive-strength");let l=w(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))l-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const t=e.style.directionalLight.properties.get("direction");l=w(J(t.x,t.y,t.z)[1])}const c=!e.options.moving;return{u_matrix:i||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),c),u_image:0,u_latrange:NS(0,t.tileID),u_light:[n.paint.get("hillshade-exaggeration"),l],u_shadow:r,u_highlight:o,u_emissive_strength:a,u_accent:s}})(e,n,i,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(a,h,t.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=e.getTileBoundsBuffers(n);h.draw(e,l.TRIANGLES,r,o,s,Sv.disabled,d,i.id,p,f,m)}function US(e,t,n){if(!t.needsDEMTextureUpload)return;const i=e.context,r=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(n.stride);const o=n.getPixels();t.demTexture?t.demTexture.update(o,{premultiply:!1}):t.demTexture=new gy(i,o,e.terrainUseFloatDEM()?r.R32F:r.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function VS(e,t,n){const i=e.context,r=i.gl;if(!t.dem)return;const o=t.dem;if(i.activeTexture.set(r.TEXTURE1),US(e,t,o),!t.demTexture)return;t.demTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE);const s=o.dim;i.activeTexture.set(r.TEXTURE0);let a=t.hillshadeFBO;if(!a){const e=new gy(i,{width:s,height:s,data:null},r.RGBA);e.bind(r.LINEAR,r.CLAMP_TO_EDGE),a=t.hillshadeFBO=i.createFramebuffer(s,s,!0,"renderbuffer"),a.colorAttachment.set(e.texture)}i.bindFramebuffer.set(a.framebuffer),i.viewport.set([0,0,s,s]);const{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=e.getMercatorTileBoundsBuffers(),h=[];e.terrainUseFloatDEM()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:h}).draw(e,r.TRIANGLES,gv.disabled,vv.disabled,bv.unblended,Sv.disabled,((e,t)=>{const n=t.stride,i=vh.create();return vh.ortho(i,0,ai,-ai,0,0,1),vh.translate(i,i,[0,-ai,0]),{u_matrix:i,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ,u_unpack:t.unpackVector}})(t.tileID,o),n.id,l,c,u),t.needsHillshadePrepare=!1}const GS=e=>({u_matrix:new Ll(e),u_image0:new Il(e),u_skirt_height:new Ml(e),u_ground_shadow_factor:new Pl(e)}),qS=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),HS=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p}),WS=(e,t)=>{if(t>0&&e.terrain&&X("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const n=e.transform,i=Math.max(Math.abs(n._zoom-(e.minCutoffZoom-1)),1),r=n.isLODDisabled(!1)?P(60,45,n.pitch):P(30,15,n.pitch),o=n._farZ-n._nearZ,s=t*n.height,a=((1-(l=r))*(.75*n.cameraToCenterDistance)+l*(n._farZ+s))*i;var l;return{shouldRenderCutoff:r<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(a-n._nearZ)/o,(a-s-n._nearZ)/o]}}};function ZS(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const XS=new class{constructor(){this.operations={}}newMorphing(e,t,n,i,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==n.tileID.key&&(t.queued=n)}else this.operations[e]={startTime:i,phase:0,duration:r,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},YS={0:null,1:"TERRAIN_VERTEX_MORPHING"};function KS(e,t,n){if(0===t)return 0;const i=t<1&&514===n?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*i}function QS(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const JS=e=>({u_matrix:e});function $S(e,t,n,i,r){if(r>0){const o=ut.now(),s=(o-e.timeAdded)/r,a=t?(o-t.timeAdded)/r:-1,l=n.getSource(),c=i.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),u=!t||Math.abs(t.tileID.overscaledZ-c)>Math.abs(e.tileID.overscaledZ-c),h=u&&e.refreshedUponExpiration?1:k(u?s:1-a,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-h}:{opacity:h,mix:0}}return{opacity:1,mix:0}}class eE extends Cv{constructor(e){const t={type:"raster-dem",maxzoom:e.transform.maxZoom},n=new _w(jw(),null),i=xT("mock-dem",t,n,e.style);super("mock-dem",i,!1),i.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class tE extends Cv{constructor(e){const t=xT("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new _w(jw(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,n){if(e.freezeTileCoverage)return;this.transform=e;const i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((t,n)=>{if(t[n.key]="",!this._tiles[n.key]){const t=new Iy(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom);t.state="loaded",this._tiles[n.key]=t}return t}),{});for(const r in this._tiles)r in i||(this.freeFBO(r),this._tiles[r].unloadVectorData(),delete this._tiles[r])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const n=Object.values(t);this.renderCachePool.push(...n),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class nE extends Fh{constructor(e,t,n){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=n}}class iE extends Gm{constructor(e,t){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,i,r]=function(e){const t=new Ta,n=new Ua,i=131;t.reserve(17161),n.reserve(33800);const r=ai/128,o=ai+r/2,s=o+r;for(let l=-r;l<s;l+=r)for(let e=-r;e<s;e+=r){const n=e<0||e>o||l<0||l>o?24575:0,i=k(Math.round(e),0,ai),r=k(Math.round(l),0,ai);t.emplaceBack(i+n,r)}const a=(e,t)=>{const r=t*i+e;n.emplaceBack(r+1,r,r+i),n.emplaceBack(r+i,r+i+1,r+1)};for(let l=1;l<129;l++)for(let e=1;e<129;e++)a(e,l);return[0,129].forEach((e=>{for(let t=0;t<130;t++)a(t,e),a(e,t)})),[t,n,32768]}(),o=e.context;this.gridBuffer=o.createVertexBuffer(n,Dh.members),this.gridIndexBuffer=o.createIndexBuffer(i),this.gridSegments=dl.simpleSegment(0,0,n.length,i.length),this.gridNoSkirtSegments=dl.simpleSegment(0,0,n.length,r),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new tE(t.map),this.orthoMatrix=vh.create(),vh.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,ai,0,ai,0,1);const s=o.gl;this._overlapStencilMode=new vv({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=t,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new eE(t.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(e,t,n){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const i=e.terrain.properties,r=0===e.terrain.drapeRenderMode,o=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=ut.now();const s=e.terrain&&e.terrain.scope,a=i.get("source"),l=r?this._mockSourceCache:e.getSourceCache(a,s);if(!l)return void X("Couldn't find terrain source \"".concat(a,'".'));if(this.sourceCache=l,this._exaggeration=o?this.calculateExaggeration(t):i.get("exaggeration"),!t.projection.requiresDraping&&o&&0===this._exaggeration)return void this._disable();this.enabled=!0;const c=()=>{this.sourceCache.used&&X("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));const e=this.getScaledDemTileSize();this.sourceCache.update(t,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,c(),this._initializing=!0),c(),t.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(t),this._emptyDEMTextureDirty=!0,this._previousZoom=t.zoom}else this._disable()}calculateExaggeration(e){const t=this._previousCameraAltitude,n=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=n;const i=null!=t?n-t:Number.MAX_VALUE;if(Math.abs(i)<2)return this._exaggeration;const r=e.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(r);let s=r-this._previousZoom;const a=this._previousUpdateTimestamp;let l=r;null!=this._evaluationZoom&&(l=this._evaluationZoom,Math.abs(r-l)>.5&&(s=.5*(r-l+s)),s*i<0&&(l+=s)),this._evaluationZoom=l;const c=o.getExaggeration(l),u=c===o.getExaggeration(Math.max(0,l-.1));if(u&&Math.abs(c-this._exaggeration)<.01)return c;let h=Math.min(.1,.00375*(this._updateTimestamp-a));return(u||c<.1||Math.abs(s)<1e-4)&&(h=Math.min(.2,4*h)),Yi(this._exaggeration,c,h)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const t=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(ep.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const i=this.proxyCoords=t.getIds().map((e=>{const i=t.getTileByID(e).tileID;return i.projMatrix=n.calculateProjMatrix(i.toUnwrapped()),i}));!function(e,t){const n=t.transform.pointCoordinate(t.transform.getCameraPoint()),i=new y(n.x,n.y);e.sort(((e,t)=>{if(t.overscaledZ-e.overscaledZ)return t.overscaledZ-e.overscaledZ;const n=new y(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),r=new y(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=i.mult(1<<e.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(n)-o.distSqr(r)}))}(i,this.painter);const r=this.proxyToSource||{};this.proxyToSource={},i.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const o=this._style._mergedSourceCaches;for(const a in o){const t=o[a];if(!t.used)continue;if(t!==this.sourceCache&&this.resetTileLookupCache(t.id),this._setupProxiedCoordsForOrtho(t,e[a],r),t.usedForTerrain)continue;const n=e[a];t.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[t.id]=i.map((e=>new nE(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(i),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(r),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const a of this.proxyCoords){const e=this.terrainTileForTile[a.key];if(!e)continue;const t=e.tileID.key;t in s||(this._visibleDemTiles.push(e),s[t]=t)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){const i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),US(this.painter,i,r))}}_prepareDemTileUniforms(e,t,n,i){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-r.z),s=i||"";return n["u_dem_tl".concat(s)]=[r.x*o%1,r.y*o%1],n["u_dem_scale".concat(s)]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,t=e.gl;if(!this._emptyDepthBufferTexture){const n=new Wp({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new gy(e,n,t.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,n)=>{if(!n.dem)return t;const i=n.dem.tree.minimums[0];return i>0&&e++,t+i}),0);return e?t/e:0}_updateEmptyDEMTexture(){const e=this.painter.context,t=e.gl;e.activeTexture.set(t.TEXTURE2);const n=this._getLoadedAreaMinimum(),[i,r]=(()=>{if(this.painter.terrainUseFloatDEM()){const e=new Zp({width:1,height:1},new Float32Array([n]));return[t.R32F,e]}{const e=new Wp({width:1,height:1},new Uint8Array(Vm.pack(n,this.sourceCache.getSource().encoding)));return[t.RGBA,e]}})();this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new gy(e,r,i,{premultiply:!1}),o}setupElevationDraw(e,t,n){const i=this.painter.context,r=i.gl,o=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:Vm.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var s;o.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(n&&n.morphing&&this._useVertexMorphing){const t=n.morphing.srcDemTile,i=n.morphing.dstDemTile;c=n.morphing.phase,t&&i&&(this._prepareDemTileUniforms(e,t,o,"_prev")&&(l=t),this._prepareDemTileUniforms(e,i,o)&&(a=i))}const u=e=>e&&e.demTexture&&this.painter.terrainUseFloatDEM()?r.LINEAR:r.NEAREST,h=e=>{o.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(l&&a)i.activeTexture.set(r.TEXTURE2),a.demTexture.bind(u(a),r.CLAMP_TO_EDGE),i.activeTexture.set(r.TEXTURE4),l.demTexture.bind(u(l),r.CLAMP_TO_EDGE),a.demTexture&&h(a.demTexture),o.u_dem_lerp=c;else{a=this.terrainTileForTile[e.tileID.key],i.activeTexture.set(r.TEXTURE2);const t=this._prepareDemTileUniforms(e,a,o)?a.demTexture:this.emptyDEMTexture;t.bind(u(a),r.CLAMP_TO_EDGE),h(t)}if(i.activeTexture.set(r.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),this._depthFBO&&(o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),o.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&a){const e=(1<<a.tileID.canonical.z)*Hd(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=e}if(n&&n.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),t.setTerrainUniformValues(i,o),"globe"===this.painter.transform.projection.name){const r=this.globeUniformValues(this.painter.transform,e.tileID.canonical,n&&n.useDenormalizedUpVectorScale);t.setGlobeUniformValues(i,r)}}globeUniformValues(e,t,n){const i=e.projection;return{u_tile_tl_up:i.upVector(t,0,0),u_tile_tr_up:i.upVector(t,ai,0),u_tile_br_up:i.upVector(t,ai,ai),u_tile_bl_up:i.upVector(t,0,ai),u_tile_up_scale:n?id(1):i.upVectorScale(t,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const t=this.painter,n=this.painter.context;0!==e.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height]),t.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,t,n,i,r){if("globe"===e.transform.projection.name)!function(e,t,n,i,r){const o=e.context,s=o.gl;let a,l;const c=e.transform,u=Cd(e,o,c),h=(t,n)=>{if(l===n)return;const i=[YS[n],"PROJECTION_GLOBE_VIEW"];u&&i.push("CUSTOM_ANTIALIASING");const r=e.isTileAffectedByFog(t);a=e.getOrCreateProgram("globeRaster",{defines:i,overrideFog:r}),l=n},d=e.colorModeForRenderPass(),p=new gv(s.LEQUAL,gv.ReadWrite,e.depthRangeFor3D);XS.update(r);const f=function(e){const t=e.pixelsPerMeter,n=t/Hd(1,e.center.lat),i=vh.identity(new Float64Array(16));return vh.translate(i,i,[e.point.x,e.point.y,0]),vh.scale(i,i,[n,n,t]),Float32Array.from(i)}(c),m=[Gd(c.center.lng),qd(c.center.lat)],_=e.globeSharedBuffers,g=[c.width*ut.devicePixelRatio,c.height*ut.devicePixelRatio],y=Float32Array.from(c.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const c=e.transform,u=KS(c.zoom,t.exaggeration(),t.sourceCache._source.tileSize);l=-1;const x=s.TRIANGLES;for(const l of i){const i=n.getTile(l),b=vv.disabled,w=t.prevTerrainTileForTile[l.key],T=t.terrainTileForTile[l.key];ZS(w,T)&&XS.newMorphing(l.key,w,T,r,250),o.activeTexture.set(s.TEXTURE0),i.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const S=XS.getMorphValuesForProxy(l.key),C=S?1:0;S&&Dt(v,{morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:E(S.phase)}});const A=dd(l.canonical),I=Id(A.getCenter().lat),M=Ad(l.canonical,A,I,c.worldSize/c._pixelsPerMercatorPixel),k=vd(ad(l.canonical)),P=HS(c.projMatrix,y,f,k,Sd(c.zoom),m,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,g,u,M);if(h(l,C),a&&(t.setupElevationDraw(i,a,v),e.uploadCommonUniforms(o,a,l.toUnwrapped()),_)){const[t,n,i]=_.getGridBuffers(I,0!==u);a.draw(e,x,p,b,d,Sv.backCCW,P,"globe_raster",t,n,i)}}}if(_&&(e.renderDefaultNorthPole||e.renderDefaultSouthPole)){const r=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];u&&r.push("CUSTOM_ANTIALIASING"),a=e.getOrCreateProgram("globeRaster",{defines:r});for(const l of i){const{x:i,y:r,z:u}=l.canonical,h=0===r,f=r===(1<<u)-1,[y,x,b,w]=_.getPoleBuffers(u,!1);if(w&&(h||f)){const r=n.getTile(l);o.activeTexture.set(s.TEXTURE0),r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let _=Ed(u,i,c);const T=vd(ad(l.canonical)),S=(t,n)=>t.draw(e,s.TRIANGLES,p,vv.disabled,d,Sv.disabled,HS(c.projMatrix,_,_,T,0,m,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,g,0),"globe_pole_raster",n,b,w);t.setupElevationDraw(r,a,v),e.uploadCommonUniforms(o,a,l.toUnwrapped()),h&&e.renderDefaultNorthPole&&S(a,y),f&&e.renderDefaultSouthPole&&(_=vh.scale(vh.create(),_,[1,-1,1]),S(a,x))}}}}(e,t,n,i,r);else{const o=e.context,s=o.gl;let a,l;const c=e.shadowRenderer,u=WS(e,e.longestCutoffRange),h=t=>{if(l===t)return;const n=[];n.push(YS[t]),u.shouldRenderCutoff&&n.push("RENDER_CUTOFF"),a=e.getOrCreateProgram("terrainRaster",{defines:n}),l=t},d=e.colorModeForRenderPass(),p=new gv(s.LEQUAL,gv.ReadWrite,e.depthRangeFor3D);XS.update(r);const f=e.transform,m=KS(f.zoom,t.exaggeration(),t.sourceCache._source.tileSize);let _=[0,0,0];if(c){const t=e.style.directionalLight,n=e.style.ambientLight;t&&n&&(_=FC(t,n))}{l=-1;const g=s.TRIANGLES,[y,v]=[t.gridIndexBuffer,t.gridSegments];for(const l of i){const i=n.getTile(l),x=vv.disabled,b=t.prevTerrainTileForTile[l.key],w=t.terrainTileForTile[l.key];ZS(b,w)&&XS.newMorphing(l.key,b,w,r,250),o.activeTexture.set(s.TEXTURE0),i.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);const T=XS.getMorphValuesForProxy(l.key),S=T?1:0;let C;T&&(C={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:E(T.phase)}});const A=qS(l.projMatrix,QS(l.canonical,f.renderWorldCopies)?m/10:m,_);if(h(S),!a)continue;t.setupElevationDraw(i,a,C);const I=l.toUnwrapped();c&&c.setupShadows(I,a),e.uploadCommonUniforms(o,a,I,null,u),a.draw(e,g,p,x,d,Sv.backCCW,A,"terrain_raster",t.gridBuffer,y,v)}}}}(t,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,t.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const t=this.painter,n=this.painter.context,i=this.proxySourceCache,r=this.proxiedCoords[i.id],o=this._drapedRenderBatches.shift(),s=t.style.order,a=[];let l=0;for(const c of r){const r=i.getTileByID(c.proxyTileKey),u=i.proxyCachedFBO[c.key]?i.proxyCachedFBO[c.key][e]:void 0,h=void 0!==u?i.renderCache[u]:this.pool[l++],d=void 0!==u;if(r.texture=h.tex,d&&!h.dirty){a.push(r.tileID);continue}let p;n.bindFramebuffer.set(h.fb.framebuffer),this.renderedToTile=!1,h.dirty&&(n.clear({color:cn.transparent,stencil:0}),h.dirty=!1);for(let e=o.start;e<=o.end;++e){const i=t.style._mergedLayers[s[e]];if(i.isHidden(t.transform.zoom))continue;const r=t.style.getLayerSourceCache(i),o=r?this.proxyToSource[c.key][r.id]:[c];if(!o)continue;const a=o;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(r?r.id:null)&&(this._setupStencil(h,o,i,r),p=r?r.id:null),t.renderLayer(t,r,i,a)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const i=t.style._mergedLayers[s[e]];if(i.isHidden(t.transform.zoom))continue;const r=t.style.getLayerSourceCache(i),o=r?this.proxyToSource[c.key][r.id]:[c];if(!o)continue;const a=o;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(r?r.id:null)&&(this._setupStencil(h,o,i,r),p=r?r.id:null),t.renderLayer(t,r,i,a)}this.renderedToTile?(h.dirty=!0,a.push(r.tileID)):d||--l,5===l&&(l=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height]),o.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let n=-1,i=t;for(let r=0;r<t;++r)this._style.isLayerDraped(e._mergedLayers[e.order[r]])?n=Math.max(n,r):i=Math.min(i,r);return i>n}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,n){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter((e=>e.dem)).map((i=>{const r=i.tileID,o=1<<r.overscaledZ,{x:s,y:a}=r.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(l,u,c,h,e,t,n),tile:i}}));i.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const r of i){if(null==r.t)return null;const i=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,n);if(null!=i)return i}return null}_createFBO(){const e=this.painter.context,t=e.gl,n=this.drapeBufferSize;e.activeTexture.set(t.TEXTURE0);const i=new gy(e,{width:n[0],height:n[1],data:null},t.RGBA);i.bind(t.LINEAR,t.CLAMP_TO_EDGE);const r=e.createFramebuffer(n[0],n[1],!0,null);return r.colorAttachment.set(i.texture),r.depthAttachment=new mv(e,r.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,r.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):r.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&t.texParameterf(t.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:r,tex:i,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],n=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!n&&t.shouldRedrape():!n&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let e=!1;for(const n of this._style.getSources())if(n instanceof Rw){e=!0;break}if(!e)return;const t={};for(let n=0;n<this._style.order.length;++n){const e=this._style._mergedLayers[this._style.order[n]],i=this._style.getLayerSourceCache(e);if(i&&!t[i.id]&&!e.isHidden(this.painter.transform.zoom)&&"line"===e.type&&e.widthExpression()instanceof bo){t[i.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][i.id];if(t)for(const e of t)this._clearRenderCacheForTile(i.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n]._source instanceof zw){e=!0;break}if(!e)return;const t={};for(let n=0;n<this._style.order.length;++n){const e=this._style._mergedLayers[this._style.order[n]],i=this._style.getLayerSourceCache(e);if(!i||t[i.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const r=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][i.id];if(e)for(const t of e){const e=$S(i.getTile(t),i.findLoadedParent(t,0),i,this.painter.transform,r);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(i.id,t)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const n=[];this._pendingGroundEffectLayers=[];let i,r=0,o=this._style._mergedLayers[e[r]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++r<t;)o=this._style._mergedLayers[e[r]];for(;r<t;++r){const t=this._style._mergedLayers[e[r]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===i&&(i=r):("fill-extrusion"===t.type&&this._pendingGroundEffectLayers.push(r),void 0!==i&&(n.push({start:i,end:r-1}),i=void 0)))}if(void 0!==i&&n.push({start:i,end:r-1}),0!==n.length){const e=n[n.length-1];this._pendingGroundEffectLayers.every((t=>t>e.end))||X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let n=0;n<e.length;++n){const i=Object.values(e[n]);t.renderCachePool.push(...i)}}return}this._clearRasterLayersFromRenderCache();const n=this.proxyCoords,i=this._tilesDirty;for(let o=n.length-1;o>=0;o--){const r=n[o];if(t.getTileByID(r.key),void 0!==t.proxyCachedFBO[r.key]){const n=e[r.key],o=this.proxyToSource[r.key];let s=0;for(const e in o){const t=o[e],r=n[e];if(!r||r.length!==t.length||t.some(((t,n)=>t!==r[n]||i[e]&&i[e].hasOwnProperty(t.key)))){s=-1;break}++s}for(const e in t.proxyCachedFBO[r.key])t.renderCache[t.proxyCachedFBO[r.key][e]].dirty=s<0||s!==Object.values(n).length}}const r=[...this._drapedRenderBatches];r.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const o of r)for(const e of n){if(t.proxyCachedFBO[e.key])continue;let n=t.renderCachePool.pop();void 0===n&&t.renderCache.length<50&&(n=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==n&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][o.start]=n,t.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,n,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(n.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):vv.disabled}_renderTileClippingMasks(e,t){const n=this.painter,i=this.painter.context,r=i.gl;n._tileClippingMaskIDs={},i.setColorMode(bv.disabled),i.setDepthMode(gv.disabled);const o=n.getOrCreateProgram("clippingMask");for(const s of e){const e=n._tileClippingMaskIDs[s.key]=--t;o.draw(n,r.TRIANGLES,gv.disabled,new vv({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),bv.disabled,Sv.disabled,JS(s.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(e){const t=this.painter.transform;if(e.x<0||e.x>t.width||e.y<0||e.y>t.height)return null;const n=[e.x,e.y,1,1];hh.transformMat4(n,n,t.pixelMatrixInverse),hh.scale(n,n,1/n[3]),n[0]/=t.worldSize,n[1]/=t.worldSize;const i=t._camera.position,r=Hd(1,t.center.lat),o=[i[0],i[1],i[2]/r,0],s=Eh.subtract([],n.slice(0,3),o);Eh.normalize(s,s);const a=this.raycast(o,s,this._exaggeration);return null!==a&&a?(Eh.scaleAndAdd(o,o,s,a),o[3]=o[2],o[2]*=r,o):null}drawDepth(){const e=this.painter,t=e.context,n=this.proxySourceCache,i=Math.ceil(e.width),r=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===i&&this._depthFBO.height===r||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=t.gl,n=t.createFramebuffer(i,r,!0,"renderbuffer");t.activeTexture.set(e.TEXTURE0);const o=new gy(t,{width:i,height:r,data:null},e.RGBA);o.bind(e.NEAREST,e.CLAMP_TO_EDGE),n.colorAttachment.set(o.texture);const s=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,i,r);n.depthAttachment.set(s),this._depthFBO=n,this._depthTexture=o}t.bindFramebuffer.set(this._depthFBO.framebuffer),t.viewport.set([0,0,i,r]),function(e,t,n,i){if("globe"===e.transform.projection.name)return;const r=e.context,o=r.gl;r.clear({depth:1});const s=e.getOrCreateProgram("terrainDepth"),a=new gv(o.LESS,gv.ReadWrite,e.depthRangeFor3D);for(const l of i){const i=n.getTile(l),r=qS(l.projMatrix,0,[0,0,0]);t.setupElevationDraw(i,s),s.draw(e,o.TRIANGLES,a,vv.disabled,bv.unblended,Sv.backCCW,r,"terrain_depth",t.gridBuffer,t.gridIndexBuffer,t.gridNoSkirtSegments)}}(e,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,n){if(e.getSource()instanceof qb)return this._setupProxiedCoordsForImageSource(e,t,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const i=this.proxiedCoords[e.id]=[],r=this.proxyCoords;for(let s=0;s<r.length;s++){const t=r[s],o=this._findTileCoveringTileID(t,e);if(o){const r=this._createProxiedId(t,o,n[t.key]&&n[t.key][e.id]);i.push(r),this.proxyToSource[t.key][e.id]=[r]}}let o=!1;for(let s=0;s<t.length;s++){const r=e.getTile(t[s]);if(!r||!r.hasData())continue;const a=this._findTileCoveringTileID(r.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==r.tileID.canonical.z){const t=this.proxyToSource[a.tileID.key][e.id],s=this._createProxiedId(a.tileID,r,n[a.tileID.key]&&n[a.tileID.key][e.id]);t?t.splice(t.length-1,0,s):this.proxyToSource[a.tileID.key][e.id]=[s],i.push(s),o=!0}}this._sourceTilesOverlap[e.id]=o}_setupProxiedCoordsForImageSource(e,t,n){if(!e.getSource().loaded())return;const i=this.proxiedCoords[e.id]=[],r=this.proxyCoords,o=e.getSource(),s=o.tileID;if(!s)return;const a=new y(s.x,s.y)._div(1<<s.z),l=o.coordinates.map(ep.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-a.x),e.min.y=Math.min(e.min.y,t.y-a.y),e.max.x=Math.max(e.max.x,t.x-a.x),e.max.y=Math.max(e.max.y,t.y-a.y),e)),{min:new y(Number.MAX_VALUE,Number.MAX_VALUE),max:new y(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,t)=>{const n=e.wrap+e.canonical.x/(1<<e.canonical.z),i=e.canonical.y/(1<<e.canonical.z),r=ai/(1<<e.canonical.z),o=t.wrap+t.canonical.x/(1<<t.canonical.z),s=t.canonical.y/(1<<t.canonical.z);return n+r<o+l.min.x||n>o+l.max.x||i+r<s+l.min.y||i>s+l.max.y};for(let u=0;u<r.length;u++){const o=r[u];for(let r=0;r<t.length;r++){const s=e.getTile(t[r]);if(!s||!s.hasData())continue;if(c(o,s.tileID))continue;const a=this._createProxiedId(o,s,n[o.key]&&n[o.key][e.id]),l=this.proxyToSource[o.key][e.id];l?l.push(a):this.proxyToSource[o.key][e.id]=[a],i.push(a)}}}_createProxiedId(e,t,n){let i=this.orthoMatrix;if(n){const e=n.find((e=>e.key===t.tileID.key));if(e)return e}if(t.tileID.key!==e.key){const n=e.canonical.z-t.tileID.canonical.z;let r,o,s;i=vh.create();const a=t.tileID.wrap-e.wrap<<e.overscaledZ;n>0?(r=ai>>n,o=r*((t.tileID.canonical.x<<n)-e.canonical.x+a),s=r*((t.tileID.canonical.y<<n)-e.canonical.y)):(r=ai<<-n,o=ai*(t.tileID.canonical.x-(e.canonical.x+a<<-n)),s=ai*(t.tileID.canonical.y-(e.canonical.y<<-n))),vh.ortho(i,0,r,0,r,0,1),vh.translate(i,i,[o,s,0])}return new nE(t.tileID,e.key,i)}_findTileCoveringTileID(e,t){let n=t.getTile(e);if(n&&n.hasData())return n;const i=this._findCoveringTileCache[t.id],r=i[e.key];if(n=r?t.getTileByID(r):null,n&&n.hasData()||null===r)return n;let o=n?n.tileID:e,s=o.overscaledZ;const a=t.getSource().minzoom,l=[];if(!r){const i=t.getSource().maxzoom;if(e.canonical.z>=i){const n=e.canonical.z-i;t.getSource().reparseOverscaled?(s=Math.max(e.canonical.z+2,t.transform.tileZoom),o=new Fh(s,e.wrap,i,e.canonical.x>>n,e.canonical.y>>n)):0!==n&&(s=i,o=new Fh(s,e.wrap,i,e.canonical.x>>n,e.canonical.y>>n))}o.key!==e.key&&(l.push(o.key),n=t.getTile(o))}const c=e=>{l.forEach((t=>{i[t]=e})),l.length=0};for(s-=1;s>=a&&(!n||!n.hasData());s--){n&&c(n.tileID.key);const e=o.calculateScaledKey(s);if(n=t.getTileByID(e),n&&n.hasData())break;const r=i[e];if(null===r)break;void 0===r?l.push(e):n=t.getTileByID(r)}return c(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}}function rE(e,t,n){const i=function(e,t,n){const i=Eh.dot(t,e),r=Eh.dot(n,[.2126,.7152,.0722]),o=(e,t,n)=>(1-n)*e+n*t,s=o(1-.3*Math.min(r,1),1,Math.min(i+1,1));return o(.92,1,Math.asin(k(t[2],-1,1))/Math.PI+.5)*s}(e,[0,0,1],t),r=[0,0,0];Eh.scale(r,n.slice(0,3),i);const o=[0,0,0];Eh.scale(o,t.slice(0,3),e[2]);const s=[0,0,0];return Eh.add(s,r,o),ae(s)}const oE=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],sE=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class aE{static cacheKey(e,t,n,i){let r="".concat(t).concat(i?i.cacheKey:"");for(const o of n)e.usedDefines.includes(o)&&(r+="/".concat(o));return r}constructor(e,t,n,i,r,o){const s=e.gl;this.program=s.createProgram(),this.configuration=i,this.name=t,this.fixedDefines=[...o];const a=function(e){const t=[];for(let n=0;n<e.length;n++){if(null===e[n])continue;const i=e[n].split(" ");t.push(i.pop())}return t}(n.staticAttributes),l=i?i.getBinderAttributes():[],c=a.concat(l);let u=i?i.defines():[];u=u.concat(o.map((e=>"#define ".concat(e))));const h="#version 300 es\n";let d=h+u.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",zS,RS.fragmentSource).join("\n");for(const _ of n.fragmentIncludes)d+="\n".concat(PS[_]);d+="\n".concat(n.fragmentSource);let p=h+u.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",zS,RS.vertexSource).join("\n");for(const _ of n.vertexIncludes)p+="\n".concat(PS[_]);p+="\n".concat(n.vertexSource);const f=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(f,d),s.compileShader(f),s.attachShader(this.program,f);const m=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(m,p),s.compileShader(m),s.attachShader(this.program,m),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:"a_".concat(c[e]);s.bindAttribLocation(this.program,e,t),this.attributes[t]=e}s.linkProgram(this.program),s.deleteShader(m),s.deleteShader(f),this.fixedUniforms=r(e),this.binderUniforms=i?i.getUniforms(e):[],o.includes("TERRAIN")&&(this.terrainUniforms=(e=>({u_dem:new Il(e),u_dem_prev:new Il(e),u_dem_unpack:new Dl(e),u_dem_tl:new kl(e),u_dem_scale:new Ml(e),u_dem_tl_prev:new kl(e),u_dem_scale_prev:new Ml(e),u_dem_size:new Ml(e),u_dem_lerp:new Ml(e),u_exaggeration:new Ml(e),u_depth:new Il(e),u_depth_size_inv:new kl(e),u_meter_to_dem:new Ml(e),u_label_plane_matrix_inv:new Ll(e)}))(e)),o.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new Pl(e),u_tile_tr_up:new Pl(e),u_tile_br_up:new Pl(e),u_tile_bl_up:new Pl(e),u_tile_up_scale:new Ml(e)}))(e)),o.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new Ll(e),u_fog_range:new kl(e),u_fog_color:new Dl(e),u_fog_horizon_blend:new Ml(e),u_fog_vertical_limit:new kl(e),u_fog_temporal_offset:new Ml(e),u_frustum_tl:new Pl(e),u_frustum_tr:new Pl(e),u_frustum_br:new Pl(e),u_frustum_bl:new Pl(e),u_globe_pos:new Pl(e),u_globe_radius:new Ml(e),u_globe_transition:new Ml(e),u_is_globe:new Il(e),u_viewport:new kl(e)}))(e)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(e=>({u_cutoff_params:new Dl(e)}))(e)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(e=>({u_lighting_ambient_color:new Pl(e),u_lighting_directional_dir:new Pl(e),u_lighting_directional_color:new Pl(e),u_ground_radiance:new Pl(e)}))(e)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(e=>({u_light_matrix_0:new Ll(e),u_light_matrix_1:new Ll(e),u_fade_range:new kl(e),u_shadow_normal_offset:new Pl(e),u_shadow_intensity:new Ml(e),u_shadow_texel_size:new Ml(e),u_shadow_map_resolution:new Ml(e),u_shadow_direction:new Pl(e),u_shadow_bias:new Pl(e),u_shadowmap_0:new Il(e),u_shadowmap_1:new Il(e)}))(e))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const n=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const n=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const n=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const n=this.shadowUniforms;e.program.set(this.program);for(const i in t)n[i].set(this.program,i,t[i])}_drawDebugWireframe(e,t,n,i,r,o,s,a,l,c){const u=e.options.wireframe;if(!1===u.terrain&&!1===u.layers2D&&!1===u.layers3D)return;const h=e.context;if(!(()=>!(!u.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!u.layers2D||e._terrain&&e._terrain.renderingToTexture||!oE.includes(this.name))||!(!u.layers3D||!sE.includes(this.name)))())return;const d=h.gl,p=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,r,h);if(!p)return;const f=[...this.fixedDefines];f.push("DEBUG_WIREFRAME");const m=e.getOrCreateProgram(this.name,{config:this.configuration,defines:f});h.program.set(m.program);const _=(e,t,n)=>{if(t[e]&&n[e])for(const i in t[e])n[e][i]&&n[e][i].set(n.program,i,t[e][i].current)};l&&l.setUniforms(m.program,h,m.binderUniforms,s,{zoom:a}),_("fixedUniforms",this,m),_("terrainUniforms",this,m),_("globeUniforms",this,m),_("fogUniforms",this,m),_("lightsUniforms",this,m),_("shadowUniforms",this,m),p.bind(),h.setColorMode(new bv([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE],cn.transparent,[!0,!0,!0,!1])),h.setDepthMode(new gv(t.func===d.LESS?d.LEQUAL:t.func,gv.ReadOnly,t.range)),h.setStencilMode(vv.disabled);const g=3*o.primitiveLength*2,y=3*o.primitiveOffset*2*2;c&&c>1?d.drawElementsInstanced(d.LINES,g,d.UNSIGNED_SHORT,y,c):d.drawElements(d.LINES,g,d.UNSIGNED_SHORT,y),r.bind(),h.program.set(this.program),h.setDepthMode(t),h.setStencilMode(n),h.setColorMode(i)}draw(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const _=e.context,g=_.gl;if(this.failedToCreate)return;_.program.set(this.program),_.setDepthMode(n),_.setStencilMode(i),_.setColorMode(r),_.setCullFace(o);for(const x of Object.keys(this.fixedUniforms))this.fixedUniforms[x].set(this.program,x,s[x]);p&&p.setUniforms(this.program,_,this.binderUniforms,h,{zoom:d});const y={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[t],v=m&&m>0?1:void 0;for(const x of u.get()){const o=x.vaos||(x.vaos={});(o[a]||(o[a]=new BS)).bind(_,this,l,p?p.getPaintVertexBuffers():[],c,x.vertexOffset,f||[],v),m&&m>1?g.drawElementsInstanced(t,x.primitiveLength*y,g.UNSIGNED_SHORT,x.primitiveOffset*y*2,m):g.drawElements(t,x.primitiveLength*y,g.UNSIGNED_SHORT,x.primitiveOffset*y*2),t===g.TRIANGLES&&this._drawDebugWireframe(e,n,i,r,c,x,h,d,p,m)}}}function lE(e,t){const n=Math.pow(2,t.tileID.overscaledZ),i=t.tileSize*Math.pow(2,e.transform.tileZoom)/n,r=i*(t.tileID.canonical.x+t.tileID.wrap*n),o=i*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/Yv(t,1,e.transform.tileZoom),u_pixel_coord_upper:[r>>16,o>>16],u_pixel_coord_lower:[65535&r,65535&o]}}const cE=vh.create(),uE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f)=>{const m=t.style.light,_=m.properties.get("position"),g=[_.x,_.y,_.z],y=gh.create();"viewport"===m.properties.get("anchor")&&(gh.fromRotation(y,-t.transform.angle),Eh.transformMat3(g,g,y));const v=m.properties.get("color"),x=t.transform,b={u_matrix:e,u_lightpos:g,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_vertical_gradient:+n,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:cE,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:r,u_edge_radius:o,u_flood_light_color:h,u_vertical_scale:d,u_flood_light_intensity:p,u_ground_shadow_factor:f};return"globe"===x.projection.name&&(b.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],b.u_zoom_transition=l,b.u_inv_rot_matrix=u,b.u_merc_center=c,b.u_up_dir=x.projection.upVector(new Lh(0,0,0),c[0]*ai,c[1]*ai),b.u_height_lift=a),b},hE=(e,t,n)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:n}),dE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p)=>{const f=uE(e,t,n,i,r,o,s,l,c,u,h,d,p,1,[0,0,0]),m={u_height_factor:-Math.pow(2,s.overscaledZ)/a.tileSize/8};return L(f,lE(t,a),m)},pE=(e,t)=>({u_matrix:e,u_emissive_strength:t}),fE=(e,t,n,i)=>L(pE(e,t),lE(n,i)),mE=(e,t,n)=>({u_matrix:e,u_world:n,u_emissive_strength:t}),_E=(e,t,n,i,r)=>L(fE(e,t,n,i),{u_world:r}),gE=(e,t,n,i)=>{const r=ai/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(i),u_extrude_scale:[t.pixelsToGLUnits[0]/r,t.pixelsToGLUnits[1]/r]}},yE=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},vE=vh.create(),xE=(e,t,n,i,r,o,s)=>{const a=e.transform,l="globe"===a.projection.name,c=l?wd(a.zoom,t.canonical)*a._pixelsPerMercatorPixel:Yv(n,1,o),u={u_matrix:t.projMatrix,u_extrude_scale:c,u_intensity:s,u_inv_rot_matrix:vE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=i,u.u_merc_center=r,u.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],u.u_zoom_transition=Sd(a.zoom);const e=r[0]*ai,n=r[1]*ai;u.u_up_dir=a.projection.upVector(new Lh(0,0,0),e,n)}return u},bE=(e,t,n,i,r,o,s,a,l,c,u)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_tl_parent:i,u_scale_parent:r,u_fade_t:o.mix,u_opacity:o.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(d=s.paint.get("raster-saturation"),d>0?1-1/(1.001-d):-d),u_contrast_factor:(h=s.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:wE(s.paint.get("raster-hue-rotate")),u_perspective_transform:a,u_colorization_mix:c,u_colorization_scale:TE(u),u_color_ramp:l};var h,d};function wE(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}function TE(e){let[t,n]=e;if(t===n)return[t,n];const i=(n+t)/2,r=(n-t)/2*256/255;return[-(t=i-r)/((n=i+r)-t),1/(n-t)]}const SE=vh.create(),EE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_)=>{const g=r.transform,y={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:g.getCameraToCenterDistance(m),u_rotate_symbol:+n,u_aspect_ratio:g.width/g.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+i,u_texsize:c,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:SE,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:SE,u_up_vector:[0,-1,0],u_icon_transition:_||0};return"globe"===m.name&&(y.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],y.u_zoom_transition=h,y.u_inv_rot_matrix=p,y.u_merc_center=d,y.u_camera_forward=g._camera.forward(),y.u_ecef_origin=function(e,t){const n=[0,0,0],i=vd(ad(t.canonical));return Eh.transformMat4(n,n,i),Eh.transformMat4(n,n,e),n}(g.globeMatrix,u.toUnwrapped()),y.u_tile_matrix=Float32Array.from(g.globeMatrix),y.u_up_vector=f),y},CE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_)=>L(EE(e,t,n,i,r,o,s,a,l,c,h,d,p,f,m,_),{u_gamma_scale:i?r.transform.getCameraToCenterDistance(_)*Math.cos(r.terrain?0:r.transform._pitch):1,u_device_pixel_ratio:ut.devicePixelRatio,u_is_halo:+u,undefined:void 0}),AE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m)=>L(CE(e,t,n,i,r,o,s,a,!0,l,!0,u,h,d,p,f,m),{u_texsize_icon:c,u_texture_icon:1}),IE=(e,t,n,i)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:i}),ME=(e,t,n,i,r,o,s)=>L(function(e,t,n,i){const r=n.imageManager.getPattern(e.toString(),t),{width:o,height:s}=n.imageManager.getPixelSize(t),a=Math.pow(2,i.tileID.overscaledZ),l=i.tileSize*Math.pow(2,n.transform.tileZoom)/a,c=l*(i.tileID.canonical.x+i.tileID.wrap*a),u=l*i.tileID.canonical.y;return{u_image:0,u_pattern_tl:r.tl,u_pattern_br:r.br,u_texsize:[o,s],u_pattern_size:r.displaySize,u_tile_units_to_pixels:1/Yv(i,1,n.transform.tileZoom),u_pixel_coord_upper:[c>>16,u>>16],u_pixel_coord_lower:[65535&c,65535&u]}}(r,o,i,s),{u_matrix:e,u_emissive_strength:t,u_opacity:n}),kE={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},PE=function(e,t,n,i,r,o,s,a,l,c,u){let h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:[0,0,0];const d=i.style.light,p=d.properties.get("position"),f=[-p.x,-p.y,p.z],m=gh.create();"viewport"===d.properties.get("anchor")&&(gh.fromRotation(m,-i.transform.angle),Eh.transformMat3(f,f,m));const _="MASK"===c.alphaMode,g=d.properties.get("color"),y=u.paint.get("model-ambient-occlusion-intensity"),v=u.paint.get("model-color").constantOr(cn.white),x=u.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:n,u_lightpos:f,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[g.r,g.g,g.b],u_camera_pos:h,u_opacity:r,u_baseTextureIsAlpha:0,u_alphaMask:+_,u_alphaCutoff:c.alphaCutoff,u_baseColorFactor:[o.r,o.g,o.b,o.a],u_emissiveFactor:[s[0],s[1],s[2],1],u_metallicFactor:a,u_roughnessFactor:l,u_baseColorTexture:kE.BaseColor,u_metallicRoughnessTexture:kE.MetallicRoughness,u_normalTexture:kE.Normal,u_occlusionTexture:kE.Occlusion,u_emissionTexture:kE.Emission,u_color_mix:[v.r,v.g,v.b,x],u_aoIntensity:y}},DE=new Float32Array(16),RE=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:DE,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:DE}},zE={fillExtrusion:e=>({u_matrix:new Ll(e),u_lightpos:new Pl(e),u_lightintensity:new Ml(e),u_lightcolor:new Pl(e),u_vertical_gradient:new Ml(e),u_opacity:new Ml(e),u_edge_radius:new Ml(e),u_ao:new kl(e),u_tile_id:new Pl(e),u_zoom_transition:new Ml(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new kl(e),u_up_dir:new Pl(e),u_height_lift:new Ml(e),u_flood_light_color:new Pl(e),u_vertical_scale:new Ml(e),u_flood_light_intensity:new Ml(e),u_ground_shadow_factor:new Pl(e)}),fillExtrusionDepth:e=>({u_matrix:new Ll(e),u_edge_radius:new Ml(e),u_vertical_scale:new Ml(e)}),fillExtrusionPattern:e=>({u_matrix:new Ll(e),u_lightpos:new Pl(e),u_lightintensity:new Ml(e),u_lightcolor:new Pl(e),u_vertical_gradient:new Ml(e),u_height_factor:new Ml(e),u_edge_radius:new Ml(e),u_ao:new kl(e),u_tile_id:new Pl(e),u_zoom_transition:new Ml(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new kl(e),u_up_dir:new Pl(e),u_height_lift:new Ml(e),u_image:new Il(e),u_texsize:new kl(e),u_pixel_coord_upper:new kl(e),u_pixel_coord_lower:new kl(e),u_tile_units_to_pixels:new Ml(e),u_opacity:new Ml(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new Ll(e),u_opacity:new Ml(e),u_ao_pass:new Ml(e),u_meter_to_tile:new Ml(e),u_ao:new kl(e),u_flood_light_intensity:new Ml(e),u_flood_light_color:new Pl(e),u_attenuation:new Ml(e),u_edge_radius:new Ml(e),u_fb:new Il(e),u_fb_size:new Ml(e)}),fill:e=>({u_matrix:new Ll(e),u_emissive_strength:new Ml(e)}),fillPattern:e=>({u_matrix:new Ll(e),u_emissive_strength:new Ml(e),u_image:new Il(e),u_texsize:new kl(e),u_pixel_coord_upper:new kl(e),u_pixel_coord_lower:new kl(e),u_tile_units_to_pixels:new Ml(e)}),fillOutline:e=>({u_matrix:new Ll(e),u_emissive_strength:new Ml(e),u_world:new kl(e)}),fillOutlinePattern:e=>({u_matrix:new Ll(e),u_emissive_strength:new Ml(e),u_world:new kl(e),u_image:new Il(e),u_texsize:new kl(e),u_pixel_coord_upper:new kl(e),u_pixel_coord_lower:new kl(e),u_tile_units_to_pixels:new Ml(e)}),circle:e=>({u_camera_to_center_distance:new Ml(e),u_extrude_scale:new Nl(e),u_device_pixel_ratio:new Ml(e),u_matrix:new Ll(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new kl(e),u_tile_id:new Pl(e),u_zoom_transition:new Ml(e),u_up_dir:new Pl(e),u_emissive_strength:new Ml(e)}),collisionBox:e=>({u_matrix:new Ll(e),u_camera_to_center_distance:new Ml(e),u_extrude_scale:new kl(e)}),collisionCircle:e=>({u_matrix:new Ll(e),u_inv_matrix:new Ll(e),u_camera_to_center_distance:new Ml(e),u_viewport_size:new kl(e)}),debug:e=>({u_color:new Rl(e),u_matrix:new Ll(e),u_overlay:new Il(e),u_overlay_scale:new Ml(e)}),clippingMask:e=>({u_matrix:new Ll(e)}),heatmap:e=>({u_extrude_scale:new Ml(e),u_intensity:new Ml(e),u_matrix:new Ll(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new kl(e),u_tile_id:new Pl(e),u_zoom_transition:new Ml(e),u_up_dir:new Pl(e)}),heatmapTexture:e=>({u_image:new Il(e),u_color_ramp:new Il(e),u_opacity:new Ml(e)}),hillshade:e=>({u_matrix:new Ll(e),u_image:new Il(e),u_latrange:new kl(e),u_light:new kl(e),u_shadow:new Rl(e),u_highlight:new Rl(e),u_emissive_strength:new Ml(e),u_accent:new Rl(e)}),hillshadePrepare:e=>({u_matrix:new Ll(e),u_image:new Il(e),u_dimension:new kl(e),u_zoom:new Ml(e),u_unpack:new Dl(e)}),line:e=>({u_matrix:new Ll(e),u_pixels_to_tile_units:new Nl(e),u_device_pixel_ratio:new Ml(e),u_units_to_pixels:new kl(e),u_dash_image:new Il(e),u_gradient_image:new Il(e),u_image_height:new Ml(e),u_texsize:new kl(e),u_tile_units_to_pixels:new Ml(e),u_alpha_discard_threshold:new Ml(e),u_trim_offset:new kl(e),u_emissive_strength:new Ml(e)}),linePattern:e=>({u_matrix:new Ll(e),u_texsize:new kl(e),u_pixels_to_tile_units:new Nl(e),u_device_pixel_ratio:new Ml(e),u_image:new Il(e),u_units_to_pixels:new kl(e),u_tile_units_to_pixels:new Ml(e),u_alpha_discard_threshold:new Ml(e)}),raster:e=>({u_matrix:new Ll(e),u_normalize_matrix:new Ll(e),u_globe_matrix:new Ll(e),u_tl_parent:new kl(e),u_scale_parent:new Ml(e),u_fade_t:new Ml(e),u_opacity:new Ml(e),u_image0:new Il(e),u_image1:new Il(e),u_brightness_low:new Ml(e),u_brightness_high:new Ml(e),u_saturation_factor:new Ml(e),u_contrast_factor:new Ml(e),u_spin_weights:new Pl(e),u_perspective_transform:new kl(e),u_colorization_mix:new Dl(e),u_colorization_scale:new kl(e),u_color_ramp:new Il(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Il(e),u_is_size_feature_constant:new Il(e),u_size_t:new Ml(e),u_size:new Ml(e),u_camera_to_center_distance:new Ml(e),u_rotate_symbol:new Il(e),u_aspect_ratio:new Ml(e),u_fade_change:new Ml(e),u_matrix:new Ll(e),u_label_plane_matrix:new Ll(e),u_coord_matrix:new Ll(e),u_is_text:new Il(e),u_pitch_with_map:new Il(e),u_texsize:new kl(e),u_tile_id:new Pl(e),u_zoom_transition:new Ml(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new kl(e),u_camera_forward:new Pl(e),u_tile_matrix:new Ll(e),u_up_vector:new Pl(e),u_ecef_origin:new Pl(e),u_texture:new Il(e),u_icon_transition:new Ml(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Il(e),u_is_size_feature_constant:new Il(e),u_size_t:new Ml(e),u_size:new Ml(e),u_camera_to_center_distance:new Ml(e),u_rotate_symbol:new Il(e),u_aspect_ratio:new Ml(e),u_fade_change:new Ml(e),u_matrix:new Ll(e),u_label_plane_matrix:new Ll(e),u_coord_matrix:new Ll(e),u_is_text:new Il(e),u_pitch_with_map:new Il(e),u_texsize:new kl(e),u_texture:new Il(e),u_gamma_scale:new Ml(e),u_device_pixel_ratio:new Ml(e),u_tile_id:new Pl(e),u_zoom_transition:new Ml(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new kl(e),u_camera_forward:new Pl(e),u_tile_matrix:new Ll(e),u_up_vector:new Pl(e),u_ecef_origin:new Pl(e),u_is_halo:new Il(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Il(e),u_is_size_feature_constant:new Il(e),u_size_t:new Ml(e),u_size:new Ml(e),u_camera_to_center_distance:new Ml(e),u_rotate_symbol:new Il(e),u_aspect_ratio:new Ml(e),u_fade_change:new Ml(e),u_matrix:new Ll(e),u_label_plane_matrix:new Ll(e),u_coord_matrix:new Ll(e),u_is_text:new Il(e),u_pitch_with_map:new Il(e),u_texsize:new kl(e),u_texsize_icon:new kl(e),u_texture:new Il(e),u_texture_icon:new Il(e),u_gamma_scale:new Ml(e),u_device_pixel_ratio:new Ml(e),u_is_halo:new Il(e)}),background:e=>({u_matrix:new Ll(e),u_emissive_strength:new Ml(e),u_opacity:new Ml(e),u_color:new Rl(e)}),backgroundPattern:e=>({u_matrix:new Ll(e),u_emissive_strength:new Ml(e),u_opacity:new Ml(e),u_image:new Il(e),u_pattern_tl:new kl(e),u_pattern_br:new kl(e),u_texsize:new kl(e),u_pattern_size:new kl(e),u_pixel_coord_upper:new kl(e),u_pixel_coord_lower:new kl(e),u_tile_units_to_pixels:new Ml(e)}),terrainRaster:GS,terrainDepth:GS,skybox:e=>({u_matrix:new Ll(e),u_sun_direction:new Pl(e),u_cubemap:new Il(e),u_opacity:new Ml(e),u_temporal_offset:new Ml(e)}),skyboxGradient:e=>({u_matrix:new Ll(e),u_color_ramp:new Il(e),u_center_direction:new Pl(e),u_radius:new Ml(e),u_opacity:new Ml(e),u_temporal_offset:new Ml(e)}),skyboxCapture:e=>({u_matrix_3f:new Fl(e),u_sun_direction:new Pl(e),u_sun_intensity:new Ml(e),u_color_tint_r:new Dl(e),u_color_tint_m:new Dl(e),u_luminance:new Ml(e)}),globeRaster:e=>({u_proj_matrix:new Ll(e),u_globe_matrix:new Ll(e),u_normalize_matrix:new Ll(e),u_merc_matrix:new Ll(e),u_zoom_transition:new Ml(e),u_merc_center:new kl(e),u_image0:new Il(e),u_grid_matrix:new Fl(e),u_skirt_height:new Ml(e),u_frustum_tl:new Pl(e),u_frustum_tr:new Pl(e),u_frustum_br:new Pl(e),u_frustum_bl:new Pl(e),u_globe_pos:new Pl(e),u_globe_radius:new Ml(e),u_viewport:new kl(e)}),globeAtmosphere:e=>({u_frustum_tl:new Pl(e),u_frustum_tr:new Pl(e),u_frustum_br:new Pl(e),u_frustum_bl:new Pl(e),u_horizon:new Ml(e),u_transition:new Ml(e),u_fadeout_range:new Ml(e),u_color:new Dl(e),u_high_color:new Dl(e),u_space_color:new Dl(e),u_temporal_offset:new Ml(e),u_horizon_angle:new Ml(e)}),model:e=>({u_matrix:new Ll(e),u_lighting_matrix:new Ll(e),u_normal_matrix:new Ll(e),u_lightpos:new Pl(e),u_lightintensity:new Ml(e),u_lightcolor:new Pl(e),u_camera_pos:new Pl(e),u_opacity:new Ml(e),u_baseColorFactor:new Dl(e),u_emissiveFactor:new Dl(e),u_metallicFactor:new Ml(e),u_roughnessFactor:new Ml(e),u_baseTextureIsAlpha:new Il(e),u_alphaMask:new Il(e),u_alphaCutoff:new Ml(e),u_baseColorTexture:new Il(e),u_metallicRoughnessTexture:new Il(e),u_normalTexture:new Il(e),u_occlusionTexture:new Il(e),u_emissionTexture:new Il(e),u_color_mix:new Dl(e),u_aoIntensity:new Ml(e)}),modelDepth:e=>({u_matrix:new Ll(e),u_instance:new Ll(e),u_node_matrix:new Ll(e)}),groundShadow:e=>({u_matrix:new Ll(e),u_ground_shadow_factor:new Pl(e)}),stars:e=>({u_matrix:new Ll(e),u_up:new Pl(e),u_right:new Pl(e),u_intensity_multiplier:new Ml(e)})};let LE;function OE(e,t,n,i,r,o,s){const a=e.context,l=a.gl,c=e.transform,u=e.getOrCreateProgram("collisionBox"),h=[];let d=0,p=0;for(let x=0;x<i.length;x++){const a=i[x],f=t.getTile(a),m=f.getBucket(n);if(!m)continue;const _=VT(a,m,c);let g=_;0===r[0]&&0===r[1]||(g=e.translatePosMatrix(_,f,r,o));const y=s?m.textCollisionBox:m.iconCollisionBox,v=m.collisionCircleArray;if(v.length>0){const e=vh.create(),t=g;vh.mul(e,m.placementInvProjMatrix,c.glCoordMatrix),vh.mul(e,e,m.placementViewportMatrix),h.push({circleArray:v,circleOffset:p,transform:t,invTransform:e,projection:m.getProjection()}),d+=v.length/4,p=d}y&&(e.terrain&&e.terrain.setupElevationDraw(f,u),u.draw(e,l.LINES,gv.disabled,vv.disabled,e.colorModeForRenderPass(),Sv.disabled,gE(g,c,f,m.getProjection()),n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,null,c.zoom,null,[y.collisionVertexBuffer,y.collisionVertexBufferExt]))}if(!s||!h.length)return;const f=e.getOrCreateProgram("collisionCircle"),m=new Ba;m.resize(4*d),m._trim();let _=0;for(const x of h)for(let e=0;e<x.circleArray.length/4;e++){const t=4*e,n=x.circleArray[t+0],i=x.circleArray[t+1],r=x.circleArray[t+2],o=x.circleArray[t+3];m.emplace(_++,n,i,r,o,0),m.emplace(_++,n,i,r,o,1),m.emplace(_++,n,i,r,o,2),m.emplace(_++,n,i,r,o,3)}(!LE||LE.length<2*d)&&(LE=function(e){const t=2*e,n=new Ua;n.resize(t),n._trim();for(let i=0;i<t;i++){const e=6*i;n.uint16[e+0]=4*i+0,n.uint16[e+1]=4*i+1,n.uint16[e+2]=4*i+2,n.uint16[e+3]=4*i+2,n.uint16[e+4]=4*i+3,n.uint16[e+5]=4*i+0}return n}(d));const g=a.createIndexBuffer(LE,!0),y=a.createVertexBuffer(m,n_.members,!0);for(const x of h){const t={u_matrix:x.transform,u_inv_matrix:x.invTransform,u_camera_to_center_distance:(v=c).getCameraToCenterDistance(x.projection),u_viewport_size:[v.width,v.height]};f.draw(e,l.TRIANGLES,gv.disabled,vv.disabled,e.colorModeForRenderPass(),Sv.disabled,t,n.id,y,g,dl.simpleSegment(0,2*x.circleOffset,x.circleArray.length,x.circleArray.length/2),null,c.zoom)}var v;y.destroy(),g.destroy()}const FE=vh.create();function BE(e,t){let{width:n,height:i,anchor:r,textOffset:o,textScale:s}=e;const{horizontalAlign:a,verticalAlign:l}=z_(r),c=-(a-.5)*n,u=-(l-.5)*i,h=hg(r,o);return new y((c/s+h[0])*t,(u/s+h[1])*t)}function NE(e,t,n,i,r,o,s,a,l,c,u){const h=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,p=e.icon.dynamicLayoutVertexArray,f={},m=e.getProjection(),_=GT(a,m,o),g=o.elevation,y=m.upVectorScale(a.canonical,o.center.lat,o.worldSize).metersToTile;d.clear();for(let v=0;v<h.length;v++){const p=h.get(v),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=p,T=p.hidden||!p.crossTileID||e.allowVerticalPlacement&&!p.placedOrientation?null:i[p.crossTileID];if(T){let i=0,h=0,v=0;if(g){const e=g?g.getAtTileOffset(a,x,b):0,[t,n,r]=m.upVector(a.canonical,x,b);i=e*t*y,h=e*n*y,v=e*r*y}let[S,E,C,A]=tx(p.projectedAnchorX+i,p.projectedAnchorY+h,p.projectedAnchorZ+v,n?_:s);const I=nx(o.getCameraToCenterDistance(m),A);let M=r.evaluateSizeForFeature(e.textSizeData,c,p)*I/i_;n&&(M*=e.tilePixelRatio/l);const k=BE(T,M);n?(({x:S,y:E,z:C}=m.projectTilePoint(x+k.x,b+k.y,a.canonical)),[S,E,C]=tx(S+i,E+h,C+v,s)):(t&&k._rotate(-o.angle),S+=k.x,E+=k.y,C=0);const P=e.allowVerticalPlacement&&p.placedOrientation===w_.vertical?Math.PI/2:0;for(let e=0;e<w;e++)ry(d,S,E,C,P);u&&p.associatedIconIndex>=0&&(f[p.associatedIconIndex]={x:S,y:E,z:C,angle:P})}else hx(w,d)}if(u){p.clear();const t=e.icon.placedSymbolArray;for(let e=0;e<t.length;e++){const n=t.get(e),{numGlyphs:i}=n,r=f[e];if(n.hidden||!r)hx(i,p);else{const{x:e,y:t,z:n,angle:o}=r;for(let r=0;r<i;r++)ry(p,e,t,n,o)}}e.icon.dynamicLayoutVertexBuffer.updateData(p)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function jE(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function UE(e,t,n,i,r,o,s,a,l,c,u,h){const d=e.context,p=d.gl,f=e.transform,m="map"===a,_="map"===l,g=m&&"point"!==n.layout.get("symbol-placement"),y=m&&!_&&!g,v=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let x=!1;const b=e.depthModeForSublayer(0,gv.ReadOnly),w=[Gd(f.center.lng),qd(f.center.lat)],T=n.layout.get("text-variable-anchor"),S="globe"===f.projection.name,E=[],C=[0,-1,0];let A=C;!S&&!f.mercatorFromTransition||m||(A=function(e){const t=e._camera.getWorldToCamera(e.worldSize,1),n=vh.multiply([],t,e.globeMatrix);vh.invert(n,n);const i=[0,0,0],r=[0,1,0,0];return hh.transformMat4(r,r,n),i[0]=r[0],i[1]=r[1],i[2]=r[2],Eh.normalize(i,i),i}(f));for(const I of i){const i=t.getTile(I),a=i.getBucket(n);if(!a)continue;if("mercator"===a.projection.name&&S)continue;const l=r?a.text:a.icon;if(!l||a.fullyClipped||!l.segments.get().length)continue;const u=l.programConfigurations.get(n.id),h=r||a.sdfIcons,d=r?a.textSizeData:a.iconSizeData,b=_||0!==f.pitch,M=a_(d,f.zoom);let k,P,D,R,z=[0,0],L=null;if(r)P=i.glyphAtlasTexture,D=p.LINEAR,k=i.glyphAtlasTexture.size,a.iconsInText&&(z=i.imageAtlasTexture.size,L=i.imageAtlasTexture,R=b||e.options.rotating||e.options.zooming||"composite"===d.kind||"camera"===d.kind?p.LINEAR:p.NEAREST);else{const t=1!==n.layout.get("icon-size").constantOr(0)||a.iconsNeedLinear;P=i.imageAtlasTexture,D=h||e.options.rotating||e.options.zooming||t||b?p.LINEAR:p.NEAREST,k=i.imageAtlasTexture.size}const O="globe"===a.projection.name,F=O?A:C,B=O?Sd(f.zoom):0,N=GT(I,a.getProjection(),f),j=f.calculatePixelsToTileUnitsMatrix(i),U=Jv(N,i.tileID.canonical,_,m,f,a.getProjection(),j),V=e.terrain&&_&&g?vh.invert(vh.create(),U):FE,G=ex(N,i.tileID.canonical,_,m,f,a.getProjection(),j),q=T&&a.hasTextData(),H=a.hasIconTextFit()&&q&&a.hasIconData();if(g){const t=f.elevation,n=t?t.getAtTileOffsetFunc(I,f.center.lat,f.worldSize,a.getProjection()):null,o=$v(N,i.tileID.canonical,_,m,f,a.getProjection(),j);rx(a,N,e,r,o,G,_,c,n,I)}const W=g||r&&T||H,Z=e.translatePosMatrix(N,i,o,s),X=W?FE:U,Y=e.translatePosMatrix(G,i,o,s,!0),K=a.getProjection().createInversionMatrix(f,I.canonical),Q=n.paint.get("icon-image-cross-fade").constantOr(0),J=[];e.terrainRenderModeElevated()&&_&&J.push("PITCH_WITH_MAP_TERRAIN"),O&&(J.push("PROJECTION_GLOBE_VIEW"),W&&J.push("PROJECTED_POS_ON_VIEWPORT")),Q>0&&J.push("ICON_TRANSITION"),l.zOffsetVertexBuffer&&J.push("Z_OFFSET");const $=h&&0!==n.paint.get(r?"text-halo-width":"icon-halo-width").constantOr(1);let ee;ee=h?a.iconsInText?AE(d.kind,M,y,_,e,Z,X,Y,k,z,I,B,w,K,F,a.getProjection()):CE(d.kind,M,y,_,e,Z,X,Y,r,k,!0,I,B,w,K,F,a.getProjection()):EE(d.kind,M,y,_,e,Z,X,Y,r,k,I,B,w,K,F,a.getProjection(),Q);const te={program:e.getOrCreateProgram(jE(h,r,a),{config:u,defines:J}),buffers:l,uniformValues:ee,atlasTexture:P,atlasTextureIcon:L,atlasInterpolation:D,atlasInterpolationIcon:R,isSDF:h,hasHalo:$,tile:i,labelPlaneMatrixInv:V};if(v&&a.canOverlap){x=!0;const e=l.segments.get();for(const t of e)E.push({segments:new dl([t]),sortKey:t.sortKey,state:te})}else E.push({segments:l.segments,sortKey:0,state:te})}x&&E.sort(((e,t)=>e.sortKey-t.sortKey));for(const I of E){const t=I.state;if(e.terrain&&e.terrain.setupElevationDraw(t.tile,t.program,{useDepthForOcclusion:f.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:t.labelPlaneMatrixInv}),d.activeTexture.set(p.TEXTURE0),t.atlasTexture.bind(t.atlasInterpolation,p.CLAMP_TO_EDGE),t.atlasTextureIcon&&(d.activeTexture.set(p.TEXTURE1),t.atlasTextureIcon&&t.atlasTextureIcon.bind(t.atlasInterpolationIcon,p.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,t.program),t.hasHalo){const i=t.uniformValues;i.u_is_halo=1,VE(t.buffers,I.segments,n,e,t.program,b,u,h,i,2),i.u_is_halo=0}else{if(t.isSDF){const i=t.uniformValues;t.hasHalo&&(i.u_is_halo=1,VE(t.buffers,I.segments,n,e,t.program,b,u,h,i,1)),i.u_is_halo=0}VE(t.buffers,I.segments,n,e,t.program,b,u,h,t.uniformValues,1)}}}function VE(e,t,n,i,r,o,s,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];r.draw(i,i.context.gl.TRIANGLES,o,s,a,Sv.disabled,l,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,i.transform.zoom,e.programConfigurations.get(n.id),u,c)}function GE(e,t,n,i,r,o,s){const a=e.context.gl,l=n.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,h,d,p,f;s?(h=c&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=a.LINES):(h=c?"fillPattern":"fill",u=a.TRIANGLES);for(const m of i){const i=t.getTile(m);if(c&&!i.patternsLoaded())continue;const _=i.getBucket(n);if(!_)continue;e.prepareDrawTile();const g=_.programConfigurations.get(n.id),y=e.isTileAffectedByFog(m),v=e.getOrCreateProgram(h,{config:g,overrideFog:y});c&&(e.context.activeTexture.set(a.TEXTURE0),i.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),g.updatePaintBuffers());const x=l.constantOr(null);if(x&&i.imageAtlas){const e=i.imageAtlas.patternPositions[x.toString()];e&&g.setConstantPatternPositions(e)}const b=e.translatePosMatrix(m.projMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),w=n.paint.get("fill-emissive-strength");if(s){p=_.indexBuffer2,f=_.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];d="fillOutlinePattern"===h&&c?_E(b,w,e,i,t):mE(b,w,t)}else p=_.indexBuffer,f=_.segments,d=c?fE(b,w,e,i):pE(b,w);e.uploadCommonUniforms(e.context,v,m.toUnwrapped()),v.draw(e,u,r,e.stencilModeForClipping(m),o,Sv.disabled,d,n.id,_.layoutVertexBuffer,p,f,n.paint,e.transform.zoom,g,void 0)}}function qE(e,t,n,i,r,o,s,a){const l=e.context,c=l.gl,u=e.transform,h=n.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=n.paint.get("fill-extrusion-opacity"),f=e.style.enable3dLights(),m=n.paint.get(f&&!d?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),m],g=n.layout.get("fill-extrusion-edge-radius"),y=g>0&&!n.paint.get("fill-extrusion-rounded-roof"),v=y?0:g,x="globe"===u.projection.name?xb():0,b="globe"===u.projection.name,w=b?Sd(u.zoom):0,T=[Gd(u.center.lng),qd(u.center.lat)],S=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),E=n.paint.get("fill-extrusion-flood-light-intensity"),C=n.paint.get("fill-extrusion-vertical-scale"),A=WS(e,n.paint.get("fill-extrusion-cutoff-fade-range")),I=[];let M;b&&I.push("PROJECTION_GLOBE_VIEW"),_[0]>0&&I.push("FAUX_AO"),y&&I.push("ZERO_ROOF_RADIUS"),a&&I.push("HAS_CENTROID"),E>0&&I.push("FLOOD_LIGHT"),A.shouldRenderCutoff&&I.push("RENDER_CUTOFF");const k="shadow"===e.renderPass,P=e.shadowRenderer,D=k&&!!P;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let R=[0,0,0];if(P){const t=e.style.directionalLight,n=e.style.ambientLight;t&&n&&(R=FC(t,n)),M=I.concat(["SHADOWS_SINGLE_CASCADE"])}const z=D?"fillExtrusionDepth":d?"fillExtrusionPattern":"fillExtrusion";for(const L of i){const i=t.getTile(L),f=i.getBucket(n);if(!f||f.projection.name!==u.projection.name)continue;let m=!1;P&&(m=0===P.getMaxCascadeForTile(L.toUnwrapped()));const g=e.isTileAffectedByFog(L),y=f.programConfigurations.get(n.id),D=e.getOrCreateProgram(z,{config:y,defines:m?M:I,overrideFog:g});if(e.terrain){const t=e.terrain;e.style.terrainSetForDrapingOnly(),t.setupElevationDraw(i,D,{useMeterToDem:!0})}if(!f.centroidVertexBuffer){const e=D.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}!k&&P&&P.setupShadows(i.tileID.toUnwrapped(),D,"vector-tile",i.tileID.overscaledZ),d&&(e.context.activeTexture.set(c.TEXTURE0),i.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),y.updatePaintBuffers());const O=h.constantOr(null);if(O&&i.imageAtlas){const e=i.imageAtlas.patternPositions[O.toString()];e&&y.setConstantPatternPositions(e)}const F=n.paint.get("fill-extrusion-vertical-gradient");let B;if(k&&P){if(KE(i.tileID,f,e))continue;const t=P.calculateShadowPassMatrixFromTile(i.tileID.toUnwrapped());B=hE(t,v,C)}else{const t=e.translatePosMatrix(L.projMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),r=u.projection.createInversionMatrix(u,L.canonical);B=d?dE(t,e,F,p,_,v,L,i,x,w,T,r,S,C):uE(t,e,F,p,_,v,L,x,w,T,r,S,C,E,R)}e.uploadCommonUniforms(l,D,L.toUnwrapped(),null,A);const N=[];(e.terrain||a)&&N.push(f.centroidVertexBuffer),b&&N.push(f.layoutVertexExtBuffer),D.draw(e,l.gl.TRIANGLES,r,o,s,Sv.backCCW,B,n.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,n.paint,e.transform.zoom,y,N)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function HE(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,_,g,y){const v=e.context,x=v.gl,b=e.transform,w=e.transform.zoom,T=[],S=WS(e,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===c?(T.push("CLEAR_SUBPASS"),y&&(T.push("CLEAR_FROM_TEXTURE"),v.activeTexture.set(x.TEXTURE0),y.bind(x.LINEAR,x.CLAMP_TO_EDGE))):"sdf"===c&&T.push("SDF_SUBPASS"),_&&T.push("HAS_CENTROID"),S.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const E=n.layout.get("fill-extrusion-edge-radius"),C=(t,i,c,g,x)=>{const b=i.programConfigurations.get(n.id),C=e.isTileAffectedByFog(t),A=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:T,overrideFog:C}),I=((e,t,n,i,r,o,s,a,l,c,u)=>({u_matrix:t,u_opacity:n,u_ao_pass:i?1:0,u_meter_to_tile:r,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,g,u,l,x,[h,d*x],p,f,m,w>=17?0:E*x,y?y.size[0]:0),M=[];_&&M.push(i.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(v,A,t.toUnwrapped(),null,S),A.draw(e,v.gl.TRIANGLES,r,o,s,a,I,n.id,i.vertexBuffer,i.indexBuffer,c,n.paint,w,b,M)};for(const A of i){const i=t.getTile(A),r=i.getBucket(n);if(!r||r.projection.name!==b.projection.name||!r.groundEffect||r.groundEffect&&!r.groundEffect.hasData())continue;const o=r.groundEffect,s=1/r.tileToMeter;{const t=e.translatePosMatrix(A.projMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),r=o.getDefaultSegment();C(A,o,r,t,s)}if(g)for(let a=0;a<4;a++){const r=Nh[a](A),o=t.getTile(r);if(!o)continue;const l=o.getBucket(n);if(!l||l.projection.name!==b.projection.name||!l.groundEffect||l.groundEffect&&!l.groundEffect.hasData())continue;const c=l.groundEffect;let u,h;0===a?(u=[-ai,0,0],h=1):1===a?(u=[ai,0,0],h=0):2===a?(u=[0,-ai,0],h=3):(u=[0,ai,0],h=2);const d=c.regionSegments[h];if(!d)continue;const p=new Float32Array(16);vh.translate(p,A.projMatrix,u),C(A,c,d,e.translatePosMatrix(p,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),s)}}}function WE(e,t,n,i,r,o,s){0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const a=o?o.findDEMTileFor(n):null;if(!(a&&a.dem||s))return;const l=e=>{const n=t.getSource().minzoom,i=e=>{const n=t.getTileByID(e);if(n&&n.hasData())return n.getBucket(r)},o=[0,-1,1];for(const t of o){if(e.overscaledZ+t<n)continue;const r=i(e.calculateScaledKey(e.overscaledZ+t));if(r)return r}},c=[0,0,0],u=(e,t)=>(c[0]=Math.min(e.min.y,t.min.y),c[1]=Math.max(e.max.y,t.max.y),c[2]=ai-t.min.x>e.max.x?t.min.x-ai:e.max.x,c),h=(e,t)=>(c[0]=Math.min(e.min.x,t.min.x),c[1]=Math.max(e.max.x,t.max.x),c[2]=ai-t.min.y>e.max.y?t.min.y-ai:e.max.y,c),d=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>h(e,t),(e,t)=>h(t,e)],p=(e,t,i,r,s,l,c)=>{if(!o)return 0;const u=[[l?i:e,l?e:i,0],[l?i:t,l?t:i,0]],h=c<0?ai+c:c,d=[l?h:(e+t)/2,l?(e+t)/2:h,0];return 0===i&&c<0||0!==i&&c>0?o.getForTilePoints(s,[d],!0,r):u.push(d),o.getForTilePoints(n,u,!0,a),Math.max(u[0][2],u[1][2],d[2])/o.exaggeration()};for(let g=0;g<4;g++){const e=i.borderFeatureIndices[g];if(0===e.length)continue;const t=Nh[g](n),r=l(t);if(!(r&&r instanceof db))continue;if(i.borderDoneWithNeighborZ[g]===r.canonical.z)continue;0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const a=o?o.findDEMTileFor(t):null;if(!(a&&a.dem||s))continue;const c=(g<2?1:5)-g,u=r.borderDoneWithNeighborZ[c]!==i.canonical.z,h=r.borderFeatureIndices[c];let v=0;if(i.canonical.z!==r.canonical.z){for(const t of e)i.showCentroid(i.featuresOnBorder[t]);if(u)for(const e of h)r.showCentroid(r.featuresOnBorder[e]);i.borderDoneWithNeighborZ[g]=r.canonical.z,r.borderDoneWithNeighborZ[c]=i.canonical.z}for(const n of e){const e=i.featuresOnBorder[n],o=i.centroidData[e.centroidDataIndex],l=e.borders[g];let u;for(;v<h.length;){u=r.featuresOnBorder[h[v]];const e=u.borders[c];if(e[1]>l[0]+3||e[0]>l[0]-3)break;r.showCentroid(u),v++}if(u&&v<h.length){const n=v;let x=0;for(;!(u.borders[c][0]>l[1]-3)&&(x++,++v!==h.length);)u=r.featuresOnBorder[h[v]];if(u=r.featuresOnBorder[h[n]],x>1){const e=u.borders[c];Math.abs(l[0]-e[0])<3&&Math.abs(l[1]-e[1])<3&&(x=1,v=n+1)}else if(0===x){i.showCentroid(e);continue}const b=r.centroidData[u.centroidDataIndex];s&&1===x&&(((m=o).flags|(_=b).flags)&tb?(m.flags|=tb,_.flags|=tb):(m.flags&=2147483647,_.flags&=2147483647));let w=new y(0,0);if(x>1)v=n;else if(a&&a.dem&&!(e.intersectsCount()>1||u.intersectsCount()>1)){const e=d[g](o,b),n=g%2?ai-1:0;f=p(e[0],Math.min(ai-1,e[1]),n,a,t,g<2,e[2]),w=new y(Math.ceil(7*(f+450)),0)}o.centroidXY=b.centroidXY=w,i.writeCentroidToBuffer(o),r.writeCentroidToBuffer(b)}else i.showCentroid(e)}i.borderDoneWithNeighborZ[g]=r.canonical.z,r.borderDoneWithNeighborZ[c]=i.canonical.z}var f,m,_;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(e)}const ZE=[1,0,0],XE=[0,1,0],YE=[0,0,1];function KE(e,t,n){const i=n.transform,r=n.shadowRenderer;if(!r)return!0;const o=e.toUnwrapped(),s=i.tileSize*r._cascades[n.currentShadowCascade].scale;let a=t.maxHeight;if(i.elevation){const t=i.elevation.getMinMaxForTile(e);t&&(a+=t.max)}const l=[...r.shadowDirection];l[2]=-l[2];const c=r.computeSimplifiedTileShadowVolume(o,a,s,l);if(!c)return!1;const u=[ZE,XE,YE,l,[l[0],0,l[2]],[0,l[1],l[2]]],h="globe"===i.projection.name,d=i.scaleZoom(s),p=Wh.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,d,!h),f=r.getCurrentCascadeFrustum();return 0===p.intersectsPrecise(c.vertices,c.planes,u)||0===f.intersectsPrecise(c.vertices,c.planes,u)}const QE=new cn(1,0,0,1),JE=new cn(0,1,0,1),$E=new cn(0,0,1,1),eC=new cn(1,0,1,1),tC=new cn(0,1,1,1);function nC(e,t,n){const i=e.context,r=e.transform,o=i.gl,s="globe"===r.projection.name,a=s?["PROJECTION_GLOBE_VIEW"]:[];let l=n.projMatrix;if(s&&Sd(r.zoom)>0){const e=xd(cd(n.canonical,r));l=vh.multiply(new Float32Array(16),r.globeMatrix,e),vh.multiply(l,r.projMatrix,l)}const c=e.getOrCreateProgram("debug",{defines:a}),u=t.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(u,c);const h=gv.disabled,d=vv.disabled,p=e.colorModeForRenderPass(),f="$debug";i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?u._makeGlobeTileDebugBuffers(e.context,r):u._makeDebugTileBoundsBuffers(e.context,r.projection);const m=u._tileDebugBuffer||e.debugBuffer,_=u._tileDebugIndexBuffer||e.debugIndexBuffer,g=u._tileDebugSegments||e.debugSegments;c.draw(e,o.LINE_STRIP,h,d,p,Sv.disabled,yE(l,cn.red),f,m,_,g,null,null,null,[u._globeTileDebugBorderBuffer]);const y=u.latestRawTileData,v=Math.floor((y&&y.byteLength||0)/1024),x=t.getTile(n).tileSize,b=512/Math.min(x,512)*(n.overscaledZ/r.zoom)*.5;let w=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(w+=" => ".concat(n.overscaledZ)),w+=" ".concat(v,"kb"),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,w);const T=u._tileDebugTextBuffer||e.debugBuffer,S=u._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,E=u._tileDebugTextSegments||e.debugSegments;c.draw(e,o.TRIANGLES,h,d,bv.alphaBlended,Sv.disabled,yE(l,cn.transparent,b),f,T,S,E,null,null,null,[u._globeTileDebugTextBuffer])}function iC(e,t,n,i){oC(e,0,t+n/2,e.transform.width,n,i)}function rC(e,t,n,i){oC(e,t-n/2,0,n,e.transform.height,i)}function oC(e,t,n,i,r,o){const s=e.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*ut.devicePixelRatio,n*ut.devicePixelRatio,i*ut.devicePixelRatio,r*ut.devicePixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}const sC=ba([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:aC}=sC;function lC(e,t,n,i){e.emplaceBack(t,n,i)}class cC{constructor(e){this.vertexArray=new ja,this.indices=new Ua,lC(this.vertexArray,-1,-1,1),lC(this.vertexArray,1,-1,1),lC(this.vertexArray,-1,1,1),lC(this.vertexArray,1,1,1),lC(this.vertexArray,-1,-1,-1),lC(this.vertexArray,1,-1,-1),lC(this.vertexArray,-1,1,-1),lC(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,aC),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=dl.simpleSegment(0,0,36,12)}}function uC(e,t,n,i,r,o){const s=e.context.gl,a=t.paint.get("sky-atmosphere-color"),l=t.paint.get("sky-atmosphere-halo-color"),c=t.paint.get("sky-atmosphere-sun-intensity"),u=((e,t,n,i,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(gh.fromMat4(gh.create(),i),r,c,a,l);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,t.skyboxTexture,0),n.draw(e,s.TRIANGLES,gv.disabled,vv.disabled,bv.unblended,Sv.frontCW,u,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const hC=ba([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dC{constructor(e){const t=new Ha;t.emplaceBack(-1,1,1,0,0),t.emplaceBack(1,1,1,1,0),t.emplaceBack(1,-1,1,1,1),t.emplaceBack(-1,-1,1,0,1);const n=new Ua;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(t,hC.members),this.indexBuffer=e.createIndexBuffer(n),this.segments=dl.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const pC=ba([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class fC{constructor(){this.colorModeAlphaBlendedWriteRGB=new bv([1,xv,1,xv],cn.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new bv([1,0,1,0],cn.transparent,[!1,!1,!1,!0])}update(e){const t=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new dC(t);const e=100,n=200,i=function(e){const t=Wr(30),n=[];for(let i=0;i<16e3;++i){const e=2*Math.PI*t(),i=Math.acos(1-2*t())-.5*Math.PI;n.push(Eh.fromValues(Math.cos(i)*Math.cos(e),Math.cos(i)*Math.sin(e),Math.sin(i)))}return n}(),r=Wr(300),o=new Wa,s=new Ua;let a=0;for(let t=0;t<i.length;++t){const l=Eh.scale([],i[t],200),c=Math.max(0,1+.01*e*(1*r()-.5)),u=Math.max(0,1+.01*n*(1*r()-.5));o.emplaceBack(l[0],l[1],l[2],-1,-1,c,u),o.emplaceBack(l[0],l[1],l[2],1,-1,c,u),o.emplaceBack(l[0],l[1],l[2],1,1,c,u),o.emplaceBack(l[0],l[1],l[2],-1,1,c,u),s.emplaceBack(a+0,a+1,a+2),s.emplaceBack(a+0,a+2,a+3),a+=4}this.starsVx=t.createVertexBuffer(o,pC.members),this.starsIdx=t.createIndexBuffer(s),this.starsSegments=dl.simpleSegment(0,0,o.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,t){const n=e.context,i=n.gl,r=e.transform,o=new gv(i.LEQUAL,gv.ReadOnly,[0,1]),s=Sd(r.zoom),a=t.properties.get("color").toArray01(),l=t.properties.get("high-color").toArray01(),c=t.properties.get("space-color").toArray01PremultipliedAlpha(),u=5e-4,h=k((t.properties.get("horizon-blend")-0)/1*.2495+u,5e-4,.25),d=Cd(e,n,r)&&h===u?r.worldSize/(2*Math.PI*1.025)-1:r.globeRadius,p=e.frameCounter/1e3%1,f=Eh.length(r.globeCenterInViewSpace),m=Math.sqrt(Math.pow(f,2)-Math.pow(d,2)),_=Math.acos(m/f),g=t=>{const u="globe"===r.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];t&&u.push("ALPHA_PASS");const d=e.getOrCreateProgram("globeAtmosphere",{defines:u}),f=((e,t,n,i,r,o,s,a,l,c,u,h)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:n,u_frustum_bl:i,u_horizon:r,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(r.frustumCorners.TL,r.frustumCorners.TR,r.frustumCorners.BR,r.frustumCorners.BL,r.frustumCorners.horizon,s,h,a,l,c,p,_);e.uploadCommonUniforms(n,d);const m=this.atmosphereBuffer;m&&d.draw(e,i.TRIANGLES,o,vv.disabled,t?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Sv.backCW,f,t?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};g(!1),g(!0)}drawStars(e,t){const n=k(t.properties.get("star-intensity"),0,1);if(0===n)return;const i=e.context,r=i.gl,o=e.transform,s=e.getOrCreateProgram("stars"),a=bh.identity([]);bh.rotateX(a,a,-o._pitch),bh.rotateZ(a,a,-o.angle),bh.rotateX(a,a,w(o._center.lat)),bh.rotateY(a,a,-w(o._center.lng));const l=vh.fromQuat(new Float32Array(16),a),c=vh.multiply([],o.starsProjMatrix,l),u=gh.fromMat4([],l),h=gh.invert([],u),d=[0,1,0];Eh.transformMat3(d,d,h),Eh.scale(d,d,.15);const p=[1,0,0];Eh.transformMat3(p,p,h),Eh.scale(p,p,.15);const f=((e,t,n,i)=>({u_matrix:Float32Array.from(e),u_up:t,u_right:n,u_intensity_multiplier:i}))(c,d,p,n);e.uploadCommonUniforms(i,s),this.starsVx&&this.starsIdx&&s.draw(e,r.TRIANGLES,gv.disabled,vv.disabled,this.colorModeAlphaBlendedWriteRGB,Sv.disabled,f,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function mC(e,t){const n=[...e],i=t.cameraWorldSizeForFog/t.worldSize,r=vh.identity([]);return vh.scale(r,r,[i,i,1]),vh.multiply(n,r,n),vh.multiply(n,t.worldToFogMatrix,n),n}function _C(e,t,n,i){const r=n.material,o=i.context,{baseColorTexture:s,metallicRoughnessTexture:a}=r.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=r;function h(t,n,i){if(t&&(e.push(n),o.activeTexture.set(o.gl.TEXTURE0+i),t.gfxTexture)){const{minFilter:e,magFilter:n,wrapS:i,wrapT:r}=t.sampler;t.gfxTexture.bindExtraParam(e,n,i,r)}}h(s,"HAS_TEXTURE_u_baseColorTexture",kE.BaseColor),h(a,"HAS_TEXTURE_u_metallicRoughnessTexture",kE.MetallicRoughness),h(l,"HAS_TEXTURE_u_normalTexture",kE.Normal),h(c,"HAS_TEXTURE_u_occlusionTexture",kE.Occlusion),h(u,"HAS_TEXTURE_u_emissionTexture",kE.Emission),n.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(e.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),"OPAQUE"!==r.alphaMode&&"MASK"!==r.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),r.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function gC(e,t,n,i,r,o){const s=n.paint.get("model-opacity"),a=t.context,l=new gv(t.context.gl.LEQUAL,gv.ReadWrite,t.depthRangeFor3D),c=t.transform,u=e.mesh,h=u.material,d=h.pbrMetallicRoughness,p=t.style.fog;let f;f="pixels"===t.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:vh.multiply([],i.zScaleMatrix,e.nodeModelMatrix),vh.multiply(f,i.negCameraPosMatrix,f);const m=vh.invert([],f);vh.transpose(m,m);const _=PE(new Float32Array(e.worldViewProjection),new Float32Array(f),new Float32Array(m),t,s,d.baseColorFactor,h.emissiveFactor,d.metallicFactor,d.roughnessFactor,h,n),g={defines:[]},y=[];_C(g.defines,y,u,t);const v=t.shadowRenderer;v&&(v.useNormalOffset=!1);let x=null;if(p){const n=mC(e.nodeModelMatrix,t.transform);if(x=new Float32Array(n),"globe"!==c.projection.name){const e=u.aabb.min,t=u.aabb.max,[i,r]=p.getOpacityForBounds(n,e[0],e[1],t[0],t[1]);g.overrideFog=i>=sw||r>=sw}}const b=WS(t,n.paint.get("model-cutoff-fade-range"));b.shouldRenderCutoff&&g.defines.push("RENDER_CUTOFF");const w=t.getOrCreateProgram("model",g);t.uploadCommonUniforms(a,w,null,x,b),"shadow"!==t.renderPass&&v&&v.setupShadowsFromMatrix(e.nodeModelMatrix,w),w.draw(t,a.gl.TRIANGLES,l,r,o,u.material.doubleSided?Sv.disabled:Sv.backCCW,_,n.id,u.vertexBuffer,u.indexBuffer,u.segments,n.paint,t.transform.zoom,void 0,y)}function yC(e,t,n,i,r,o,s){let a;a="globe"===e.projection.name?yx(n,e):[...n],vh.multiply(a,a,t.matrix);const l=vh.multiply([],i,a);if(t.meshes)for(const c of t.meshes){if("BLEND"!==c.material.alphaMode){s.push({mesh:c,depth:0,modelIndex:r,worldViewProjection:l,nodeModelMatrix:a});continue}const e=Eh.transformMat4([],c.centroid,l);e[2]>0&&o.push({mesh:c,depth:e[2],modelIndex:r,worldViewProjection:l,nodeModelMatrix:a})}if(t.children)for(const c of t.children)yC(e,c,n,i,r,o,s)}function vC(e,t,n,i){const r=n.shadowRenderer;if(!r)return;const o=r.getShadowPassDepthMode(),s=r.getShadowPassColorMode(),a=r.calculateShadowPassMatrixFromMatrix(t),l=RE(a);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,o,vv.disabled,s,Sv.backCCW,l,i.id,e.vertexBuffer,e.indexBuffer,e.segments,i.paint,n.transform.zoom,void 0,void 0)}function xC(e,t,n){const i=t.updateZoomBasedPaintProperties(),r=function(e,t,n){let i,r,o,s=e.terrain?e.terrain.exaggeration():0;if(e.terrain&&s>0){const t=e.terrain,r=t.findDEMTileFor(n);r&&r.dem?i=qm.create(t,n,r):s=0}if(0===s&&(t.terrainElevationMin=0,t.terrainElevationMax=0),s===t.validForExaggeration&&(0===s||i&&i._demTile&&i._demTile.tileID===t.validForDEMTile.id&&i._dem._timestamp===t.validForDEMTile.timestamp))return!1;for(const a in t.instancesPerModel){const e=t.instancesPerModel[a];for(let n=0;n<e.instancedDataArray.length;++n){const a=(i?s*i.getElevationAt(0|e.instancedDataArray.float32[16*n],0|e.instancedDataArray.float32[16*n+1],!0,!0):0)+e.instancesEvaluatedElevation[n];e.instancedDataArray.float32[16*n+6]=a,r=r?Math.min(t.terrainElevationMin,a):a,o=o?Math.max(t.terrainElevationMax,a):a}}return t.terrainElevationMin=r||0,t.terrainElevationMax=o||0,t.validForExaggeration=s,t.validForDEMTile=i&&i._demTile?{id:i._demTile.tileID,timestamp:i._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,n);(i||r)&&(t.uploaded=!1,t.upload(e.context))}const bC={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new Zh([0,0,0],[ai,ai,0])};function wC(e,t){const n=1<<e.canonical.z,i=t.getFreeCameraOptions().position,r=t.elevation,o=e.canonical.x/n,s=(e.canonical.x+1)/n,a=e.canonical.y/n,l=(e.canonical.y+1)/n;let c=t._centerAltitude;if(r){const t=r.getMinMaxForTile(e);t&&t.max>c&&(c=t.max)}const u=k(i.x,o,s)-i.x,h=k(i.y,a,l)-i.y,d=Hd(c,t.center.lat)-i.z;return t._zoomFromMercatorZ(Math.sqrt(u*u+h*h+d*d))}function TC(e,t,n,i,r,o,s){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new gv(a.gl.LEQUAL,gv.ReadWrite,e.depthRangeFor3D),h=e.isTileAffectedByFog(o);if(n.meshes)for(const d of n.meshes){const p=["MODEL_POSITION_ON_GPU"],f=[];let m,_,g;i.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const y=WS(e,t.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)m=e.getOrCreateProgram("modelDepth",{defines:p}),_=RE(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(n.matrix)),g=c.getShadowPassColorMode();else{_C(p,f,d,e),m=e.getOrCreateProgram("model",{defines:p,overrideFog:h});const i=d.material,l=i.pbrMetallicRoughness,u=t.paint.get("model-opacity");_=PE(o.projMatrix,Float32Array.from(n.matrix),new Float32Array(16),e,u,l.baseColorFactor,i.emissiveFactor,l.metallicFactor,l.roughnessFactor,i,t,r),c&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),g=y.shouldRenderCutoff||u<1||"OPAQUE"!==i.alphaMode?bv.alphaBlended:bv.unblended}e.uploadCommonUniforms(a,m,o.toUnwrapped(),null,y);const v=d.material.doubleSided?Sv.disabled:Sv.backCCW;if(i.instancedDataArray.length>20)f.push(i.instancedDataBuffer),m.draw(e,a.gl.TRIANGLES,u,vv.disabled,g,v,_,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f,i.instancedDataArray.length);else{const n=l?"u_instance":"u_normal_matrix";for(let r=0;r<i.instancedDataArray.length;++r)_[n]=new Float32Array(i.instancedDataArray.arrayBuffer,64*r,16),m.draw(e,a.gl.TRIANGLES,u,vv.disabled,g,v,_,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f)}}if(n.children)for(const d of n.children)TC(e,t,d,i,r,o,s)}const SC=[1,-1,1];function EC(e,t,n,i){if(!n.modelManager)return!0;const r=n.modelManager;if(!n.shadowRenderer)return!0;const o=n.shadowRenderer,s=t.aabb;let a=!0,l=e.maxHeight;if(0===l){let t=0;for(const n in e.instancesPerModel){const e=r.getModel(n,i);e?t=Math.max(t,Math.max(Math.max(e.aabb.max[0],e.aabb.max[1]),e.aabb.max[2])):a=!1}l=e.maxScale*t*1.41+e.maxVerticalOffset,a&&(e.maxHeight=l)}s.max[2]=l,s.min[2]+=e.terrainElevationMin,s.max[2]+=e.terrainElevationMax,Eh.transformMat4(s.min,s.min,t.tileMatrix),Eh.transformMat4(s.max,s.max,t.tileMatrix);const c=s.intersects(o.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===c),0===c}class CC{}class AC{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,t,n){{const n=this._storage.get(t.id);if(n)return n.lastUsedFrameIdx=e,n.buf}const i=n.gl,r=i.getBufferParameter(i.ELEMENT_ARRAY_BUFFER,i.BUFFER_SIZE),o=new ArrayBuffer(r),s=new Int16Array(o);i.getBufferSubData(i.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));const a=new La;for(let u=0;u<r/2;u+=3){const e=s[u],t=s[u+1],n=s[u+2];a.emplaceBack(e,t),a.emplaceBack(t,n),a.emplaceBack(n,e)}const l=n.bindVertexArrayOES.current,c=new CC;return c.buf=new ky(n,a),c.lastUsedFrameIdx=e,this._storage.set(t.id,c),n.bindVertexArrayOES.set(l),c.buf}update(e){for(const[t,n]of this._storage)e-n.lastUsedFrameIdx>30&&(n.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}const IC={symbol:function(e,t,n,i,r){if("translucent"!==e.renderPass)return;const o=vv.disabled,s=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,t,n,i,r,o,s){const a=t.transform,l="map"===r,c="map"===o;for(const u of e){const e=i.getTile(u),t=e.getBucket(n);if(!t||!t.text||!t.text.segments.get().length)continue;const r=a_(t.textSizeData,a.zoom),o=GT(u,t.getProjection(),a),h=a.calculatePixelsToTileUnitsMatrix(e),d=Jv(o,e.tileID.canonical,c,l,a,t.getProjection(),h),p=t.hasIconTextFit()&&t.hasIconData();if(r){const n=Math.pow(2,a.zoom-e.tileID.overscaledZ);NE(t,l,c,s,l_,a,d,u,n,r,p)}}}(i,e,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),r),0!==n.paint.get("icon-opacity").constantOr(1)&&UE(e,t,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),o,s),0!==n.paint.get("text-opacity").constantOr(1)&&UE(e,t,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),o,s),t.map.showCollisionBoxes&&(OE(e,t,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),OE(e,t,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,n,i){if("translucent"!==e.renderPass)return;const r=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),a=void 0!==n.layout.get("circle-sort-key").constantOr(1),l=n.paint.get("circle-emissive-strength");if(0===r.constantOr(1)&&(0===o.constantOr(1)||0===s.constantOr(1)))return;const c=e.context,u=c.gl,h=e.transform,d=e.depthModeForSublayer(0,gv.ReadOnly),p=vv.disabled,f=e.colorModeForDrapableLayerRenderPass(l),m="globe"===h.projection.name,_=[Gd(h.center.lng),qd(h.center.lat)],g=[];for(let v=0;v<i.length;v++){const r=i[v],o=t.getTile(r),s=o.getBucket(n);if(!s||s.projection.name!==h.projection.name)continue;const l=s.programConfigurations.get(n.id),c=Lp(n),u=e.isTileAffectedByFog(r);m&&c.push("PROJECTION_GLOBE_VIEW");const d=e.getOrCreateProgram("circle",{config:l,defines:c,overrideFog:u}),p=s.layoutVertexBuffer,f=s.globeExtVertexBuffer,y=s.indexBuffer,x=h.projection.createInversionMatrix(h,r.canonical),b={programConfiguration:l,program:d,layoutVertexBuffer:p,globeExtVertexBuffer:f,indexBuffer:y,uniformValues:zp(e,r,o,x,_,n),tile:o};if(a){const e=s.segments.get();for(const t of e)g.push({segments:new dl([t]),sortKey:t.sortKey,state:b})}else g.push({segments:s.segments,sortKey:0,state:b})}a&&g.sort(((e,t)=>e.sortKey-t.sortKey));const y={useDepthForOcclusion:h.depthOcclusionForSymbolsAndCircles};for(const v of g){const{programConfiguration:t,program:i,layoutVertexBuffer:r,globeExtVertexBuffer:o,indexBuffer:s,uniformValues:a,tile:l}=v.state,m=v.segments;e.terrain&&e.terrain.setupElevationDraw(l,i,y),e.uploadCommonUniforms(c,i,l.tileID.toUnwrapped()),i.draw(e,u.TRIANGLES,d,p,f,Sv.disabled,a,n.id,r,s,m,n.paint,h.zoom,t,[o])}},heatmap:function(e,t,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const r=e.context,o=r.gl,s=vv.disabled,a=new bv([o.ONE,o.ONE,o.ONE,o.ONE],cn.transparent,[!0,!0,!0,!0]);!function(e,t,n,i){const r=e.gl,o=t.width*i,s=t.height*i;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,o,s]);let a=n.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=n.heatmapFbo=e.createFramebuffer(o,s,!0,null),function(e,t,n,i,r,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,r,o,0,s.RGBA,e.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(e,0,t,a,o,s)}else r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(r,e,n,"globe"===e.transform.projection.name?.5:.25),r.clear({color:cn.transparent});const l=e.transform,c="globe"===l.projection.name,u=c?["PROJECTION_GLOBE_VIEW"]:[],h=c?Sv.frontCCW:Sv.disabled,d=[Gd(l.center.lng),qd(l.center.lat)];for(let p=0;p<i.length;p++){const f=i[p];if(t.hasRenderableParent(f))continue;const m=t.getTile(f),_=m.getBucket(n);if(!_||_.projection.name!==l.projection.name)continue;const g=e.isTileAffectedByFog(f),y=_.programConfigurations.get(n.id),v=e.getOrCreateProgram("heatmap",{config:y,defines:u,overrideFog:g}),{zoom:x}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,v),e.uploadCommonUniforms(r,v,f.toUnwrapped());const b=l.projection.createInversionMatrix(l,f.canonical);v.draw(e,o.TRIANGLES,gv.disabled,s,a,h,xE(e,f,m,b,d,x,n.paint.get("heatmap-intensity")),n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,n.paint,e.transform.zoom,y,c?[_.globeExtVertexBuffer]:null)}r.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,t){const n=e.context,i=n.gl,r=t.heatmapFbo;if(!r)return;n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),n.activeTexture.set(i.TEXTURE1);let o=t.colorRampTexture;o||(o=t.colorRampTexture=new gy(n,t.colorRamp,i.RGBA)),o.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.getOrCreateProgram("heatmapTexture").draw(e,i.TRIANGLES,gv.disabled,vv.disabled,e.colorModeForRenderPass(),Sv.disabled,((e,t,n,i)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,t),t.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,t.paint,e.transform.zoom)}(e,n))},line:function(e,t,n,i){if("translucent"!==e.renderPass)return;const r=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0===r.constantOr(1)||0===o.constantOr(1))return;const s=n.paint.get("line-emissive-strength"),a=e.depthModeForSublayer(0,gv.ReadOnly),l=e.colorModeForDrapableLayerRenderPass(s),c=e.terrain&&e.terrain.renderingToTexture?1:ut.devicePixelRatio,u=n.paint.get("line-dasharray"),h=u.constantOr(1),d=n.layout.get("line-cap"),p=n.paint.get("line-pattern"),f=p.constantOr(1),m=n.paint.get("line-pattern").constantOr(1),_=1!==n.paint.get("line-opacity").constantOr(1);let g=!m&&_;const y=n.paint.get("line-gradient"),v=f?"linePattern":"line",x=e.context,b=x.gl,w=Lb(n);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(g=!1);for(const T of i){const i=t.getTile(T);if(f&&!i.patternsLoaded())continue;const r=i.getBucket(n);if(!r)continue;e.prepareDrawTile();const o=r.programConfigurations.get(n.id),s=e.isTileAffectedByFog(T),m=e.getOrCreateProgram(v,{config:o,defines:w,overrideFog:s}),_=p.constantOr(null);if(_&&i.imageAtlas){const e=i.imageAtlas.patternPositions[_.toString()];e&&o.setConstantPatternPositions(e)}const S=u.constantOr(null),E=d.constantOr(null);if(!f&&S&&E&&i.lineAtlas){const e=i.lineAtlas.getDash(S,E);e&&o.setConstantPatternPositions(e)}let[C,A]=n.paint.get("line-trim-offset");if("round"===E||"square"===E){const e=1;C!==A&&(0===C&&(C-=e),1===A&&(A+=e))}const I=e.terrain?T.projMatrix:null,M=f?Db(e,i,n,I,c):Pb(e,i,n,I,r.lineClipsArray.length,c,[C,A]);if(y){const i=r.gradients[n.id];let o=i.texture;if(n.gradientVersion!==i.version){let s=256;if(n.stepInterpolant){const n=t.getSource().maxzoom,i=T.canonical.z===n?Math.ceil(1<<e.transform.maxZoom-T.canonical.z):1;s=k(j(r.maxLineLength/ai*1024*i),256,x.maxTextureSize)}i.gradient=Kp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:i.gradient||void 0,clips:r.lineClipsArray}),i.texture?i.texture.update(i.gradient):i.texture=new gy(x,i.gradient,b.RGBA),i.version=n.gradientVersion,o=i.texture}x.activeTexture.set(b.TEXTURE1),o.bind(n.stepInterpolant?b.NEAREST:b.LINEAR,b.CLAMP_TO_EDGE)}h&&(x.activeTexture.set(b.TEXTURE0),i.lineAtlasTexture.bind(b.LINEAR,b.REPEAT),o.updatePaintBuffers()),f&&(x.activeTexture.set(b.TEXTURE0),i.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),o.updatePaintBuffers()),e.uploadCommonUniforms(x,m,T.toUnwrapped());const P=t=>{m.draw(e,b.TRIANGLES,a,t,l,Sv.disabled,M,n.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,n.paint,e.transform.zoom,o,[r.layoutVertexBuffer2])};if(g){const t=e.stencilModeForClipping(T).ref;0===t&&e.terrain&&x.clear({stencil:0});const n={func:b.EQUAL,mask:255};M.u_alpha_discard_threshold=.8,P(new vv(n,t,255,b.KEEP,b.KEEP,b.INVERT)),M.u_alpha_discard_threshold=0,P(new vv(n,t,255,b.KEEP,b.KEEP,b.KEEP))}else P(e.stencilModeForClipping(T))}g&&(e.resetStencilClippingMasks(),e.terrain&&x.clear({stencil:0}))},fill:function(e,t,n,i){const r=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0===o.constantOr(1))return;const s=n.paint.get("fill-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(s),l=n.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===r.constantOr(cn.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const r=e.depthModeForSublayer(1,"opaque"===e.renderPass?gv.ReadWrite:gv.ReadOnly);GE(e,t,n,i,r,a,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const r=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,gv.ReadOnly);GE(e,t,n,i,r,a,!0)}},"fill-extrusion":function(e,t,n,i){const r=n.paint.get("fill-extrusion-opacity"),o=e.context,s=o.gl,a=e.terrain,l=a&&a.renderingToTexture,c=n.paint.get("fill-extrusion-cutoff-fade-range");if(0===r)return;const u=e.conflationActive&&e.layerUsedInConflation(n,t.getSource());if(u&&function(e,t,n,i){for(const r of i){const i=t.getTile(r).getBucket(n);i&&(i.updateReplacement(r,e.replacementSource),i.uploadCentroid(e.context))}}(e,t,n,i),a||u)for(const h of i){const i=t.getTile(h).getBucket(n);i&&WE(e.context,t,h,i,n,a,u)}if("shadow"===e.renderPass&&e.shadowRenderer){const o=e.shadowRenderer;if(a&&r<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof bo)return;const s=o.getShadowPassDepthMode(),l=o.getShadowPassColorMode();qE(e,t,n,i,s,vv.disabled,l,u)}else if("translucent"===e.renderPass){const h=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!l){const o=new gv(e.context.gl.LEQUAL,gv.ReadWrite,e.depthRangeFor3D);0===c&&1===r&&h?qE(e,t,n,i,o,vv.disabled,bv.unblended,u):(qE(e,t,n,i,o,vv.disabled,bv.disabled,u),qE(e,t,n,i,o,e.stencilModeFor3D(),e.colorModeForRenderPass(),u),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&h&&(!a&&"globe"!==e.transform.projection.name||l)){const r=n.paint.get("fill-extrusion-opacity"),c=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),h=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),d=n.paint.get("fill-extrusion-flood-light-intensity"),p=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),f=c>0&&h>0,m=d>0,_=(e,t,n)=>(1-n)*e+n*t,g=o=>{const a=e.depthModeForSublayer(1,gv.ReadOnly,s.LEQUAL,!0),l=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),f=_(.1,3,l),m=e._showOverdrawInspector;if(!m){const l=new vv({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new bv([s.ONE,s.ONE,s.ONE,s.ONE],cn.transparent,[!1,!1,!1,!0],s.MIN);HE(e,t,n,i,a,l,m,Sv.disabled,o,"sdf",r,c,h,d,p,f,u,!1)}{const l=m?vv.disabled:new vv({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),_=m?e.colorModeForRenderPass():new bv([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],cn.transparent,[!0,!0,!0,!0]);HE(e,t,n,i,a,l,_,Sv.disabled,o,"color",r,c,h,d,p,f,u,!1)}};if(l){const l=(o,a,l)=>{const f=e.depthModeForSublayer(1,gv.ReadOnly,s.LEQUAL,!1),m=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),g=_(.1,3,m);{const l=new bv([s.ONE,s.ONE,s.ONE,s.ONE],cn.transparent,[!1,!1,!1,!0]);HE(e,t,n,i,f,vv.disabled,l,Sv.disabled,o,"clear",r,c,h,d,p,g,u,a)}{const l=new vv({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new bv([s.ONE,s.ONE,s.ONE,s.ONE],cn.transparent,[!1,!1,!1,!0],s.MIN);HE(e,t,n,i,f,l,m,Sv.disabled,o,"sdf",r,c,h,d,p,g,u,a)}{const l=o?s.ZERO:s.ONE_MINUS_DST_ALPHA,m=new vv({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),_=new bv([l,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],cn.transparent,[!0,!0,!0,!0]);HE(e,t,n,i,f,m,_,Sv.disabled,o,"color",r,c,h,d,p,g,u,a)}{const m=new bv([s.ONE,s.ONE,s.ONE,o?s.ZERO:s.ONE],cn.transparent,[!1,!1,!1,!0],o?s.FUNC_ADD:s.MAX);HE(e,t,n,i,f,vv.disabled,m,Sv.disabled,o,"clear",r,c,h,d,p,g,u,a,l)}};if(f||m){let t;if(e.prepareDrawTile(),a){const e=a.drapeBufferSize[0],n=a.drapeBufferSize[1];t=a.framebufferCopyTexture,t&&(!t||t.size[0]===e&&t.size[1]===n)||(t&&t.destroy(),t=a.framebufferCopyTexture=new gy(o,new Wp({width:e,height:n}),s.RGBA)),t.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,e,n,0)}f&&l(!0,!1,t),m&&l(!1,!0,t)}}else f&&g(!0),m&&g(!1)}}},hillshade:function(e,t,n,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const r=e.context,o=e.terrain&&e.terrain.renderingToTexture,[s,a]="translucent"!==e.renderPass||o?[{},i]:e.stencilConfigForOverlap(i);for(const l of a){const i=t.getTile(l);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)VS(e,i,n);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,gv.ReadOnly),r=n.paint.get("hillshade-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(r),c=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):s[l.overscaledZ];jS(e,l,i,n,t,c,a)}}r.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,n,i,r,o){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;const s=e.context,a=s.gl,l=t.getSource(),c=function(e,t,n){const i=[];let r,o;if(e.paint.get("raster-color")){i.push("RASTER_COLOR"),r=e.paint.get("raster-color-mix"),o=e.paint.get("raster-color-range"),t.activeTexture.set(n.TEXTURE2);let s=e.colorRampTexture;s||(s=e.colorRampTexture=new gy(t,e.colorRamp,n.RGBA)),s.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:r,range:o,defines:i}}(n,s,a),u=c.defines;let h=!1;if(l instanceof qb&&!i.length){if("globe"!==e.transform.projection.name)return;if(l.onNorthPole)h=!0,u.push("PROJECTION_GLOBE_VIEW");else{if(!l.onSouthPole)return;h=!0,u.push("PROJECTION_GLOBE_VIEW")}}const d=e.colorModeForDrapableLayerRenderPass(),p=e.terrain&&e.terrain.renderingToTexture,f=!e.options.moving,m="nearest"===n.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;if(h){const i=t.getSource();if(!(i instanceof qb))return;const r=i.texture;if(!r)return;const o=e.globeSharedBuffers;if(!o)return;const l=new gv(a.LEQUAL,gv.ReadWrite,e.depthRangeFor3D),u=Float32Array.from(e.transform.projMatrix);let h=Ed(0,0,e.transform);const p=Float32Array.from(vd(ad(new Lh(0,0,0)))),f={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),r.bind(m,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),r.bind(m,a.CLAMP_TO_EDGE),r.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const[_,g,y,v]=o.getPoleBuffers(0,!0);let x;i.onNorthPole?(x=_,e.renderDefaultNorthPole=!1):(h=vh.scale(vh.create(),h,[1,-1,1]),x=g,e.renderDefaultSouthPole=!1);const b=bE(u,p,h,[0,0],1,f,n,i.perspectiveTransform||[0,0],2,c.mix||[0,0,0,0],c.range||[0,0]),w=e.getOrCreateProgram("raster",{defines:c.defines});return e.uploadCommonUniforms(s,w,null),void w.draw(e,a.TRIANGLES,l,vv.disabled,d,Sv.disabled,b,n.id,x,y,v)}if(!i.length)return;const[_,g]=l instanceof qb||p?[{},i]:e.stencilConfigForOverlap(i),y=g[g.length-1].overscaledZ;for(const v of g){const i=p?gv.disabled:e.depthModeForSublayer(v.overscaledZ-y,1===n.paint.get("raster-opacity")?gv.ReadWrite:gv.ReadOnly,a.LESS),r=v.toUnwrapped(),u=t.getTile(v);if(p&&(!u||!u.hasData()))continue;if(!u.texture)continue;const h=p?v.projMatrix:e.transform.calculateProjMatrix(r,f),g=e.terrain&&p?e.terrain.stencilModeForRTTOverlap(v):_[v.overscaledZ],x=o?0:n.paint.get("raster-fade-duration");u.registerFadeDuration(x);const b=t.findLoadedParent(v,0),w=$S(u,b,t,e.transform,x);let T,S;e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),u.texture.bind(m,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),b?(b.texture.bind(m,a.CLAMP_TO_EDGE),T=Math.pow(2,b.tileID.overscaledZ-u.tileID.overscaledZ),S=[u.tileID.canonical.x*T%1,u.tileID.canonical.y*T%1]):u.texture.bind(m,a.CLAMP_TO_EDGE),u.texture.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const E=l instanceof qb?l.perspectiveTransform:[0,0],C=new Float32Array(16),A=bE(h,C,C,S||[0,0],T||1,w,n,E,2,c.mix||[0,0,0,0],c.range||[0,0]),I=e.isTileAffectedByFog(v),M=e.getOrCreateProgram("raster",{defines:c.defines,overrideFog:I});if(e.uploadCommonUniforms(s,M,r),l instanceof qb)l.boundsBuffer&&l.boundsSegments&&M.draw(e,a.TRIANGLES,i,vv.disabled,d,Sv.disabled,A,n.id,l.boundsBuffer,e.quadTriangleIndexBuffer,l.boundsSegments);else{const{tileBoundsBuffer:t,tileBoundsIndexBuffer:r,tileBoundsSegments:o}=e.getTileBoundsBuffers(u);M.draw(e,a.TRIANGLES,i,g,d,Sv.disabled,A,n.id,t,r,o)}}e.resetStencilClippingMasks()},background:function(e,t,n,i){const r=n.paint.get("background-color"),o=n.paint.get("background-opacity"),s=n.paint.get("background-emissive-strength");if(0===o)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,h=n.paint.get("background-pattern");if(e.isPatternMissing(h,n.scope))return;const d=!h&&1===r.a&&1===o&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=vv.disabled,f=e.depthModeForSublayer(0,"opaque"===d?gv.ReadWrite:gv.ReadOnly),m=e.colorModeForDrapableLayerRenderPass(s),_=h?"backgroundPattern":"background";let g,y=i;y||(g=e.getBackgroundTiles(),y=Object.values(g).map((e=>e.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context,n.scope));for(const v of y){const d=e.isTileAffectedByFog(v),y=e.getOrCreateProgram(_,{overrideFog:d}),x=v.toUnwrapped(),b=i?v.projMatrix:e.transform.calculateProjMatrix(x);e.prepareDrawTile();const w=t?t.getTile(v):g?g[v.key]:new Iy(v,u,c.zoom,e),T=h?ME(b,s,o,e,h,n.scope,{tileID:v,tileSize:u}):IE(b,s,o,r);e.uploadCommonUniforms(a,y,x);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:E,tileBoundsSegments:C}=e.getTileBoundsBuffers(w);y.draw(e,l.TRIANGLES,f,p,m,Sv.disabled,T,n.id,S,E,C)}},sky:function(e,t,n){const i=e._atmosphere?Sd(e.transform.zoom):1,r=n.paint.get("sky-opacity")*i;if(0===r)return;const o=e.context,s=n.paint.get("sky-type"),a=new gv(o.gl.LEQUAL,gv.ReadOnly,[0,1]),l=e.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(e,t,n,i){const r=e.context,o=r.gl;let s=t.skyboxFbo;if(!s){s=t.skyboxFbo=r.createFramebuffer(32,32,!0,null),t.skyboxGeometry=new cC(r),t.skyboxTexture=r.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,t.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let e=0;e<6;++e)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}r.bindFramebuffer.set(s.framebuffer),r.viewport.set([0,0,32,32]);const a=t.getCenter(e,!0),l=e.getOrCreateProgram("skyboxCapture"),c=new Float64Array(16);vh.identity(c),vh.rotateY(c,c,.5*-Math.PI),uC(e,t,l,c,a,0),vh.identity(c),vh.rotateY(c,c,.5*Math.PI),uC(e,t,l,c,a,1),vh.identity(c),vh.rotateX(c,c,.5*-Math.PI),uC(e,t,l,c,a,2),vh.identity(c),vh.rotateX(c,c,.5*Math.PI),uC(e,t,l,c,a,3),vh.identity(c),uC(e,t,l,c,a,4),vh.identity(c),vh.rotateY(c,c,Math.PI),uC(e,t,l,c,a,5),r.viewport.set([0,0,e.width,e.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,t,n,i,r){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,n,i,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:i,u_temporal_offset:r}))(a.skyboxMatrix,t.getCenter(e,!1),0,i,r);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,n,vv.disabled,e.colorModeForRenderPass(),Sv.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,n,a,r,l):"gradient"===s&&"sky"===e.renderPass&&function(e,t,n,i,r){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skyboxGradient");t.skyboxGeometry||(t.skyboxGeometry=new cC(o)),o.activeTexture.set(s.TEXTURE0);let c=t.colorRampTexture;c||(c=t.colorRampTexture=new gy(o,t.colorRamp,s.RGBA)),c.bind(s.LINEAR,s.CLAMP_TO_EDGE);const u=((e,t,n,i,r)=>({u_matrix:e,u_color_ramp:0,u_center_direction:t,u_radius:w(n),u_opacity:i,u_temporal_offset:r}))(a.skyboxMatrix,t.getCenter(e,!1),t.paint.get("sky-gradient-radius"),i,r);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,n,vv.disabled,e.colorModeForRenderPass(),Sv.backCW,u,"skyboxGradient",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,n,a,r,l)},debug:function(e,t,n){for(let i=0;i<n.length;i++)nC(e,t,n[i])},custom:function(e,t,n,i){const r=e.context,o=n.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&n.isLayerDraped(t)){if("offscreen"===e.renderPass){const t=o.prerender;if(t){if(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const n=e.transform.pointMerc;t.call(o,r.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Sd(e.transform.zoom),[n.x,n.y],e.transform.pixelsPerMeterRatio)}else t.call(o,r.gl,e.transform.customLayerMatrix());r.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const t=o.renderToTile;if(t){const n=i[0].canonical,s=new ep(n.x+i[0].wrap*(1<<n.z),n.y,n.z);r.setDepthMode(gv.disabled),r.setStencilMode(vv.disabled),r.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),t.call(o,r.gl,s),r.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(vv.disabled);const t="3d"===o.renderingMode?new gv(e.context.gl.LEQUAL,gv.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,gv.ReadOnly);if(r.setDepthMode(t),"globe"===e.transform.projection.name){const t=e.transform.pointMerc;o.render(r.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Sd(e.transform.zoom),[t.x,t.y],e.transform.pixelsPerMeterRatio)}else o.render(r.gl,e.transform.customLayerMatrix());r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}else X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,n,i){if("opaque"===e.renderPass)return;const r=n.paint.get("model-opacity");if(0===r)return;const o=n.paint.get("model-cast-shadows");if("shadow"===e.renderPass){if(!o)return;if(e.terrain&&r<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof bo)return}const s=e.shadowRenderer,a=n.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,a||(s.enabled=!1));const l=()=>{s&&(s.useNormalOffset=!0,a||(s.enabled=!0))},c=t.getSource();if("light-beam"===e.renderPass&&"batched-model"!==c.type)return;if("vector"===c.type||"geojson"===c.type)return function(e,t,n,i){const r=e.transform;if("mercator"!==r.projection.name)return void X("Drawing 3D models for ".concat(r.projection.name," projection is not yet implemented"));const o=r.getFreeCameraOptions().position;if(!e.modelManager)return;const s=e.modelManager,a=e.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const l=n._unevaluatedLayout._values["model-id"],c={...n.layout.get("model-id").parameters};for(const u of i){const i=t.getTile(u).getBucket(n);if(!i||i.projection.name!==r.projection.name)continue;const h=wC(u,r);c.zoom=h;const d=l.possiblyEvaluate(c);if(xC(e,i,u),bC.shadowUniformsInitialized=!1,bC.useSingleShadowCascade=!!a&&0===a.getMaxCascadeForTile(u.toUnwrapped()),"shadow"===e.renderPass&&a){if(1===e.currentShadowCascade&&i.isInsideFirstShadowMapFrustum)continue;const t=r.calculatePosMatrix(u.toUnwrapped(),r.worldSize);if(bC.tileMatrix.set(t),bC.shadowTileMatrix=Float32Array.from(a.calculateShadowPassMatrixFromMatrix(t)),bC.aabb.min.fill(0),bC.aabb.max[0]=bC.aabb.max[1]=ai,bC.aabb.max[2]=0,EC(i,bC,e,n.scope))continue}const p=1<<u.canonical.z,f=[((o.x-u.wrap)*p-u.canonical.x)*ai,(o.y*p-u.canonical.y)*ai,o.z*p*ai];for(let t in i.instancesPerModel){const r=i.instancesPerModel[t];r.features.length>0&&(t=d.evaluate(r.features[0].feature,{}));const o=s.getModel(t,n.scope);if(o&&o.uploaded)for(const t of o.nodes)TC(e,n,t,r,f,u,bC)}}}(e,t,n,i),void l();if(!c.loaded())return;if("batched-model"===c.type)return function(e,t,n,i){const r=e.context,o=e.transform,s=e.style.fog,a=e.shadowRenderer;if("mercator"!==o.projection.name)return void X("Drawing 3D landmark models for ".concat(o.projection.name," projection is not yet implemented"));const l=e.transform.getFreeCameraOptions().position,c=Eh.scale([],[l.x,l.y,l.z],e.transform.worldSize);Eh.negate(c,c);const u=vh.identity([]),h=Qd(o.center.lat,o.zoom),d=vh.fromScaling([],[1,1,1/h]);vh.translate(u,u,c);const p=n.paint.get("model-opacity"),f=new gv(r.gl.LEQUAL,gv.ReadWrite,e.depthRangeFor3D),m=new gv(r.gl.LEQUAL,gv.ReadOnly,e.depthRangeFor3D),_=function(l,c){for(const h of i){const i=t.getTile(h).getBucket(n);if(!i||!i.uploaded)continue;let _=!1;a&&(_=0===a.getMaxCascadeForTile(h.toUnwrapped()));const g=o.calculatePosMatrix(h.toUnwrapped(),o.worldSize),y=i.modelTraits;for(const t of i.getNodesInfo()){if(t.hiddenByReplacement)continue;if(!t.node.meshes)continue;const i=t.node,v="light-beam"===e.renderPass,x=[...g],b=t.evaluatedScale;let w=0;e.terrain&&i.elevation&&(w=i.elevation*e.terrain.exaggeration()),vh.translate(x,x,[(i.anchor?i.anchor[0]:0)*(b[0]-1),(i.anchor?i.anchor[1]:0)*(b[1]-1),w]),b!==xx&&vh.scale(x,x,b),vh.multiply(x,x,i.matrix);const T=vh.multiply([],d,x);vh.multiply(T,u,T);const S=vh.invert([],T);vh.transpose(S,S),vh.scale(S,S,SC);const E=vh.multiply([],o.projMatrix,x);for(let u=0;u<i.meshes.length;++u){const d=i.meshes[u],g=u===i.lightMeshIndex;if(g){if(!v&&!e.terrain&&e.shadowRenderer){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);continue}}else if(v)continue;const b={defines:[]},w=[];_C(b.defines,w,d,e),4&y||b.defines.push("DIFFUSE_SHADED"),_&&b.defines.push("SHADOWS_SINGLE_CASCADE");const C="shadow"===e.renderPass;if(C){vC(d,x,e,n);continue}let A=null;if(s){const t=mC(x,e.transform);if(A=new Float32Array(t),"globe"!==o.projection.name){const e=d.aabb.min,n=d.aabb.max,[i,r]=s.getOpacityForBounds(t,e[0],e[1],n[0],n[1]);b.overrideFog=i>=sw||r>=sw}}const I=e.getOrCreateProgram("model",b);!C&&a&&(a.useNormalOffset=!!d.normalBuffer,a.setupShadowsFromMatrix(x,I,a.useNormalOffset)),e.uploadCommonUniforms(r,I,h.toUnwrapped(),A);const M=d.material,k=M.pbrMetallicRoughness;k.metallicFactor=.9,k.roughnessFactor=.5;const P=PE(new Float32Array(E),new Float32Array(T),new Float32Array(S),e,p,k.baseColorFactor,M.emissiveFactor,k.metallicFactor,k.roughnessFactor,M,n);I.draw(e,r.gl.TRIANGLES,c&&!g?f:m,vv.disabled,l?g||p<1||t.hasTranslucentParts?bv.alphaBlended:bv.unblended:bv.disabled,Sv.backCCW,P,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,e.transform.zoom,void 0,w)}}}};(function(e,t,n,i){const r=e.terrain?e.terrain.exaggeration():0,o=e.transform.zoom;for(const s of i){const i=t.getTile(s).getBucket(n);i&&(e.conflationActive&&i.updateReplacement(s,e.replacementSource),i.evaluateScale(e,n),e.terrain&&r>0&&i.elevationUpdate(e.terrain,r,s,n.source),i.needsReEvaluation(e,o,n)&&i.evaluate(n))}})(e,t,n,i),1===p?_(!0,!0):(_(!1,!0),_(!0,!1))}(e,t,n,i),void l();const u=c.getModels(),h=[],d=e.transform.getFreeCameraOptions().position,p=Eh.scale([],[d.x,d.y,d.z],e.transform.worldSize);Eh.negate(p,p);const f=[],m=[];let _=0;for(const g of u){const t=n.paint.get("model-rotation").constantOr(null),i=n.paint.get("model-scale").constantOr(null),r=n.paint.get("model-translation").constantOr(null);g.computeModelMatrix(e,t,i,r,!0,!0,!1);const o=vh.identity([]),s=Qd(g.position.lat,e.transform.zoom),a=vh.fromScaling([],[1,1,1/s]);vh.translate(o,o,p),h.push({zScaleMatrix:a,negCameraPosMatrix:o});for(const n of g.nodes)yC(e.transform,n,g.matrix,e.transform.projMatrix,_,f,m);_++}if(f.sort(((e,t)=>t.depth-e.depth)),"shadow"!==e.renderPass){if(1===r)for(const t of m)gC(t,e,n,h[t.modelIndex],vv.disabled,e.colorModeForRenderPass());else{for(const t of m)gC(t,e,n,h[t.modelIndex],vv.disabled,bv.disabled);for(const t of m)gC(t,e,n,h[t.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const t of f)gC(t,e,n,h[t.modelIndex],vv.disabled,e.colorModeForRenderPass());l()}else{for(const t of m)vC(t.mesh,t.nodeModelMatrix,e,n);for(const t of f)vC(t.mesh,t.nodeModelMatrix,e,n);l()}}},MC={modelUpload:function(e,t,n){const i=t.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(e.modelManager&&e.modelManager.upload(e,n));if("batched-model"===i.type)return;const r=i.getModels();for(const o of r)o.upload(e.context)}};class kC{constructor(e,t){this.context=new Ev(e),this.transform=t,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Cv.maxUnderzooming+Cv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new Ux,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new zC(this),this._wireframeDebugCache=new AC,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){const n=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new iE(this,e));const i=this._terrain;this.transform.elevation=n?i:null,i.update(e,this.transform,t),this.transform.elevation&&!i.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,i]=t.getFovAdjustedRange(this.transform._fov);if(n>i)return void(this.transform.fogCullDistSq=null);const r=n+.78*(i-n);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,t){if(this.width=e*ut.devicePixelRatio,this.height=t*ut.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const n of this.style.order)this.style._mergedLayers[n].resize()}setup(){const e=this.context,n=new Ta;n.emplaceBack(0,0),n.emplaceBack(ai,0),n.emplaceBack(0,ai),n.emplaceBack(ai,ai),this.tileExtentBuffer=e.createVertexBuffer(n,Dh.members),this.tileExtentSegments=dl.simpleSegment(0,0,4,2);const i=new Ta;i.emplaceBack(0,0),i.emplaceBack(ai,0),i.emplaceBack(0,ai),i.emplaceBack(ai,ai),this.debugBuffer=e.createVertexBuffer(i,Dh.members),this.debugSegments=dl.simpleSegment(0,0,4,5);const r=new Ta;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(r,Dh.members),this.viewportSegments=dl.simpleSegment(0,0,4,2);const o=new Ea;o.emplaceBack(0,0,0,0),o.emplaceBack(ai,0,ai,0),o.emplaceBack(0,ai,0,ai),o.emplaceBack(ai,ai,ai,ai),this.mercatorBoundsBuffer=e.createVertexBuffer(o,Cy.members),this.mercatorBoundsSegments=dl.simpleSegment(0,0,4,2);const s=new Ua;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new Xa;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new gy(e,new Wp({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=vh.create();const l=this.context.gl;this.stencilClearMode=new vv({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,gv.disabled,this.stencilClearMode,bv.disabled,Sv.disabled,JS(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,n){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of n)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const i=this.context,r=i.gl;this.nextStencilID+n.length>256&&this.clearStencil(),i.setColorMode(bv.disabled),i.setDepthMode(gv.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of n){const e=t.getTile(s),n=this._tileClippingMaskIDs[s.key]=this.nextStencilID++,{tileBoundsBuffer:i,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);o.draw(this,r.TRIANGLES,gv.disabled,new vv({func:r.ALWAYS,mask:0},n,255,r.KEEP,r.KEEP,r.REPLACE),bv.disabled,Sv.disabled,JS(s.projMatrix),"$clipping",i,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new vv({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new vv({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,n=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const e={};for(let n=0;n<r;n++)e[n+i]=new vv({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=r,[e,n]}return[{[i]:vv.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const t=1/8;return new bv([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new cn(t,t,t,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?bv.unblended:bv.alphaBlended}colorModeForDrapableLayerRenderPass(e){const t=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new bv([t.ONE,t.ONE_MINUS_SRC_ALPHA,t.CONSTANT_ALPHA,t.ONE_MINUS_SRC_ALPHA],new cn(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this.opaquePassEnabledForLayer()&&!i)return gv.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new gv(n||this.context.gl.LEQUAL,t,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=n;const i=this.style._mergedLayers,r=this.style.order,o=r.map((e=>i[e])),s=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(ut.now()),this.imageManager.beginFrame();let a=0,l=!1;for(const t in s){const e=s[t];e.used&&(e.prepare(this.context),e.getSource().usedInConflation&&++a)}const c={},u={},h={},d={},p={};for(const t in s){const e=s[t];c[t]=e.getVisibleCoordinates(),u[t]=c[t].slice().reverse(),h[t]=e.getVisibleCoordinates(!0).reverse(),d[t]=e.getShadowCasterCoordinates(),p[t]=e.sortCoordinatesByDistance(c[t])}const f=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(a){const e=[];for(const t of o)this.layerUsedInConflation(t,f(t))&&e.push(t);if(e&&e.length>1){const t=[];for(const n of e){const e=this.style.getLayerSourceCache(n);e&&e.used&&e.getSource().usedInConflation&&t.push({layer:n.fqid,cache:e})}this.replacementSource.setSources(t),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const t of o){const e=t.cutoffRange();if(this.longestCutoffRange=Math.max(e,this.longestCutoffRange),e>0){const e=f(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let t=0;t<o.length;t++)if(o[t].is3D()){this.opaquePassCutoff=t;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0);const _=this._shadowRenderer;if(_){_.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in s)for(const t of c[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),_.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new Ld(this.context));for(const t of o){if(t.isHidden(this.transform.zoom))continue;const n=e.getLayerSourceCache(t);this.uploadLayer(this,t,n)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new fC),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Ke.has(this.context.gl))return;this.renderPass="offscreen";for(const t of o){const n=e.getLayerSourceCache(t);if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const i=n?u[n.id]:void 0;("custom"===t.type||"raster"===t.type||t.isSky()||i&&i.length)&&this.renderLayer(this,n,t,i)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];const g=this.terrain;g&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&g.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(n.showOverdrawInspector)return cn.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const e=this.style.fog.properties.get("color").toArray01();return new cn(...e)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const e=this.style.fog.properties.get("space-color").toArray01();return new cn(...e)}return cn.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=o[this.currentLayer],n=e.getLayerSourceCache(t);if(t.isSky())continue;const i=n?(t.is3D()?p:u)[n.id]:void 0;this._renderTileClippingMasks(t,n,i),this.renderLayer(this,n,t,i)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Sd(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=o[this.currentLayer],n=e.getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,n,t,n?u[n.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let x=0;for(_&&(x=_.getShadowCastingLayerCount());this.currentLayer<r.length;){const t=o[this.currentLayer],n=e.getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(g&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=g.renderBatch(this.currentLayer);continue}let i;if(n&&(i=("symbol"===t.type?h:t.is3D()?p:u)[n.id]),this._renderTileClippingMasks(t,n,n?c[n.id]:void 0),this.renderLayer(this,n,t,i),!g&&_&&x>0&&t.hasShadowPass()&&0==--x&&(_.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=t;this.currentLayer++){const t=o[this.currentLayer];if(!t.hasLightBeamPass())continue;const n=e.getLayerSourceCache(t);this.renderLayer(this,n,t,n?u[n.id]:void 0)}this.currentLayer=t,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let t=null;o.forEach((n=>{const i=e.getLayerSourceCache(n);i&&!n.isHidden(this.transform.zoom)&&i.getVisibleCoordinates().length&&(!t||t.getSource().maxzoom<i.getSource().maxzoom)&&(t=i)})),t&&this.options.showTileBoundaries&&IC.debug(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;iC(e,e.transform.height-(t.top||0),3,QE),iC(e,t.bottom||0,3,JE),rC(e,t.left||0,3,$E),rC(e,e.transform.width-(t.right||0),3,eC);const n=e.transform.centerPoint;!function(e,t,n,i){oC(e,t-1,n-10,2,20,i),oC(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,tC)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}uploadLayer(e,t,n){this.gpuTimingStart(t),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(t.type)||e.terrain&&"custom"===t.type)&&MC["".concat(t.type,"Upload")]&&MC["".concat(t.type,"Upload")](e,n,t.scope),this.gpuTimingEnd()}renderLayer(e,t,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||"model"===n.type||"raster"===n.type||i&&i.length)&&(this.id=n.id,this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&"custom"===n.type)&&IC[n.type](e,t,n,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,n=this.context.gl;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:n.createQuery()}),i.calls++,n.beginQuery(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,n=t.createQuery();this.deferredRenderGpuTimeQueries.push(n),t.beginQuery(e.TIME_ELAPSED_EXT,n)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const n in e){const i=e[n],r=this.context.extTimerQuery,o=r.getQueryParameter(i.query,this.context.gl.QUERY_RESULT)/1e6;r.deleteQueryEXT(i.query),t[n]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,n=this.context.gl;let i=0;for(const r of e)i+=t.getQueryParameter(r,n.QUERY_RESULT)/1e6,t.deleteQueryEXT(r);return i}translatePosMatrix(e,t,n,i,r){if(!n[0]&&!n[1])return e;const o=r?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}const s=[r?n[0]:Yv(t,n[0],this.transform.zoom),r?n[1]:Yv(t,n[1],this.transform.zoom),0],a=new Float32Array(16);return vh.translate(a,e,s),a}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}terrainUseFloatDEM(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,n){const i=void 0===n?this.terrain&&this.terrain.renderingToTexture:n,r=this.terrain&&0===this.terrain.exaggeration(),o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):i||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||o.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):o.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.terrainUseFloatDEM()&&o.push("TERRAIN_DEM_FLOAT_FORMAT"),r&&o.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&o.push("GLOBE"),!this._fogVisible||i||void 0!==t&&!t||o.push("FOG","FOG_DITHERING"),i&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(e,t){this.cache=this.cache||{};const n=t&&t.defines||[],i=t&&t.config,r=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(n),o=aE.cacheKey(LS[e],e,r,i);return this.cache[o]||(this.cache[o]=new aE(this.context,e,LS[e],i,zE[e],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new gy(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,t){if(this.style.enable3dLights()){const n=this.style.directionalLight,i=this.style.ambientLight;if(n&&i){const r=((e,t)=>{const n=e.properties.get("direction"),i=e.properties.get("color").toArray01(),r=e.properties.get("intensity"),o=t.properties.get("color").toArray01(),s=t.properties.get("intensity"),a=[n.x,n.y,n.z],l=se(o,s),c=se(i,r);return{u_lighting_ambient_color:l,u_lighting_directional_dir:a,u_lighting_directional_color:c,u_ground_radiance:rE(a,c,l)}})(n,i);t.setLightsUniformValues(e,r)}}}uploadCommonUniforms(e,t,n,i,r){if(this.uploadCommonLightUniforms(e,t),this.terrain&&this.terrain.renderingToTexture)return;const o=this.style.fog;if(o){const r=o.getOpacity(this.transform.pitch),s=((e,t,n,i,r,o,s,a,l,c,u,h)=>{const d=e.transform,p=t.properties.get("color").toArray01();p[3]=i;const f=e.frameCounter/1e3%1,[m,_]=t.properties.get("vertical-range");return{u_fog_matrix:n?d.calculateFogTileMatrix(n):h||e.identityMat,u_fog_range:t.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:t.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(m,_),_],u_fog_temporal_offset:f,u_frustum_tl:r,u_frustum_tr:o,u_frustum_br:s,u_frustum_bl:a,u_globe_pos:l,u_globe_radius:c,u_viewport:u,u_globe_transition:Sd(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,o,n,r,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*ut.devicePixelRatio,this.transform.height*ut.devicePixelRatio],i);t.setFogUniformValues(e,s)}r&&t.setCutoffUniformValues(e,r.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const i of n)t[i.key]=e[i.key]||new Iy(i,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=sw||t[1]>=sw}}const PC=2048;class DC{constructor(e,t){this.aabb=e,this.lastCascade=t}}class RC{add(e,t){const n=this.receivers[e.key];void 0!==n?(n.aabb.min[0]=Math.min(n.aabb.min[0],t.min[0]),n.aabb.min[1]=Math.min(n.aabb.min[1],t.min[1]),n.aabb.min[2]=Math.min(n.aabb.min[2],t.min[2]),n.aabb.max[0]=Math.max(n.aabb.max[0],t.max[0]),n.aabb.max[1]=Math.max(n.aabb.max[1],t.max[1]),n.aabb.max[2]=Math.max(n.aabb.max[2],t.max[2])):this.receivers[e.key]=new DC(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,t,n){const i=Zh.fromPoints(e.points);let r=0;for(const o in this.receivers){const e=this.receivers[o];if(!e)continue;if(!i.intersectsAabb(e.aabb))continue;e.aabb.min=i.closestPoint(e.aabb.min),e.aabb.max=i.closestPoint(e.aabb.max);const s=e.aabb.getCorners();for(let i=0;i<n.length;i++){let o=!0;for(const e of s){const r=[e[0]*t,e[1]*t,e[2]];if(Eh.transformMat4(r,r,n[i].matrix),r[0]<-1||r[0]>1||r[1]<-1||r[1]>1){o=!1;break}}if(e.lastCascade=i,r=Math.max(r,i),o)break}}return r+1}}class zC{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new RC,this._depthMode=new gv(e.context.gl.LEQUAL,gv.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,t){const n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!t||!t.properties)return;const i=t.properties.get("shadow-intensity");if(!t.shadowsEnabled()||i<=0)return;if(this._shadowLayerCount=n.style.order.reduce(((t,i)=>{const r=n.style._mergedLayers[i];return t+(r.hasShadowPass()&&!r.isHidden(e.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const r=n.context,o=PC,s=PC;if(0===this._cascades.length)for(let d=0;d<2;++d){const e=n._shadowMapDebug,t=r.gl,i=r.createFramebuffer(o,s,e,"texture"),a=new gy(r,{width:o,height:s,data:null},t.DEPTH_COMPONENT);if(i.depthAttachment.set(a.texture),e){const e=new gy(r,{width:o,height:s,data:null},t.RGBA);i.colorAttachment.set(e.texture)}this._cascades.push({framebuffer:i,texture:a,matrix:[],far:0,boundingSphereRadius:0,frustum:new Wh,scale:0})}this.shadowDirection=OC(t);let a=0;if(e.elevation){const t=e.elevation,n=[1e4,-1e4];t.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;n[0]=Math.min(n[0],t.minimums[0]),n[1]=Math.max(n[1],t.maximums[0])})),1e4!==n[0]&&(a=(n[1]-n[0])*t.exaggeration())}const l=1.5*e.cameraToCenterDistance,c=3*l,u=new Float64Array(16);for(let d=0;d<2;++d){const t=this._cascades[d];let n=e.height/50,i=1;0===d?i=l:(n=l,i=c);const[r,o]=BC(e,this.shadowDirection,n,i,PC,a);t.scale=e.scale,t.matrix=r,t.boundingSphereRadius=o,vh.invert(u,t.matrix),t.frustum=Wh.fromInvProjectionMatrix(u,1,0,!0),t.far=i}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=i,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=PC,this._uniformValues.u_shadowmap_0=kE.ShadowMap0,this._uniformValues.u_shadowmap_1=kE.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const h=n.transform.elevation;for(const d of this._groundShadowTiles){let e={min:0,max:0};if(h){const t=h.getMinMaxForTile(d);t&&(e=t)}this.addShadowReceiver(d.toUnwrapped(),e.min,e.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,t){if(!this._enabled)return;const n=this.painter,i=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),i.viewport.set([0,0,PC,PC]);for(let r=0;r<this._numCascadesToRender;++r){n.currentShadowCascade=r,i.bindFramebuffer.set(this._cascades[r].framebuffer.framebuffer),i.clear({color:cn.white,depth:1});for(const i of e.order){const r=e._mergedLayers[i];if(!r.hasShadowPass()||r.isHidden(n.transform.zoom))continue;const o=e.getLayerSourceCache(r),s=o?t[o.id]:void 0;("model"===r.type||s&&s.length)&&n.renderLayer(n,o,r,s)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,t=e.style,n=e.context,i=t.directionalLight,r=t.ambientLight;if(!i||!r)return;const o=[],s=WS(e,e.longestCutoffRange);s.shouldRenderCutoff&&o.push("RENDER_CUTOFF");const a=FC(i,r),l=new gv(n.gl.LEQUAL,gv.ReadOnly,e.depthRangeFor3D);for(const c of this._groundShadowTiles){const t=c.toUnwrapped(),i=e.isTileAffectedByFog(c),r=e.getOrCreateProgram("groundShadow",{defines:o,overrideFog:i});this.setupShadows(t,r),e.uploadCommonUniforms(n,r,t,null,s);const u={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:a};r.draw(e,n.gl.TRIANGLES,l,vv.disabled,bv.multiply,Sv.disabled,u,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?bv.unblended:bv.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const t=this.painter.transform,n=t.calculatePosMatrix(e,t.worldSize);return vh.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(e){return vh.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this._enabled)return;const r=this.painter.transform,o=this.painter.context,s=o.gl,a=this._uniformValues,l=new Float64Array(16),c=r.calculatePosMatrix(e,r.worldSize);for(let u=0;u<2;u++)vh.multiply(l,this._cascades[u].matrix,c),a[0===u?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),o.activeTexture.set(s.TEXTURE0+kE.ShadowMap0+u),this._cascades[u].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=!!n,this.useNormalOffset){const t=$d(e.canonical),o=2/r.tileSize*ai/PC,s=o*this._cascades[0].boundingSphereRadius,l=o*this._cascades[1].boundingSphereRadius,c=("vector-tile"===n?1:3)/Math.pow(2,i-e.canonical.z-(1-r.zoom+Math.floor(r.zoom)));a.u_shadow_normal_offset=[t,s*c,l*c],a.u_shadow_bias=[6e-5,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];t.setShadowUniformValues(o,a)}setupShadowsFromMatrix(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._enabled)return;const i=this.painter.context,r=i.gl,o=this._uniformValues,s=new Float64Array(16);for(let a=0;a<2;a++)vh.multiply(s,this._cascades[a].matrix,e),o[0===a?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),i.activeTexture.set(r.TEXTURE0+kE.ShadowMap0+a),this._cascades[a].texture.bind(r.NEAREST,r.CLAMP_TO_EDGE);if(this.useNormalOffset=n,n){const e=5;o.u_shadow_normal_offset=[1,e,e],o.u_shadow_bias=[6e-5,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];t.setShadowUniformValues(i,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,t,n,i){if(i[2]>=0)return{};const r=function(e,t,n){const i=n/(1<<e.canonical.z);return new Zh([e.canonical.x*i+e.wrap*n,e.canonical.y*i+e.wrap*n,0],[(e.canonical.x+1)*i+e.wrap*n,(e.canonical.y+1)*i+e.wrap*n,t])}(e,t,n).getCorners(),o=t/-i[2];i[0]<0?(Eh.add(r[0],r[0],[i[0]*o,0,0]),Eh.add(r[3],r[3],[i[0]*o,0,0])):i[0]>0&&(Eh.add(r[1],r[1],[i[0]*o,0,0]),Eh.add(r[2],r[2],[i[0]*o,0,0])),i[1]<0?(Eh.add(r[0],r[0],[0,i[1]*o,0]),Eh.add(r[1],r[1],[0,i[1]*o,0])):i[1]>0&&(Eh.add(r[2],r[2],[0,i[1]*o,0]),Eh.add(r[3],r[3],[0,i[1]*o,0]));const s={};return s.vertices=r,s.planes=[LC(r[1],r[0],r[4]),LC(r[2],r[1],r[5]),LC(r[3],r[2],r[6]),LC(r[0],r[3],r[7])],s}addShadowReceiver(e,t,n){this._receivers.add(e,Zh.fromTileIdAndHeight(e,t,n))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function LC(e,t,n){const i=Eh.sub([],n,t),r=Eh.sub([],e,t),o=Eh.cross([],i,r),s=Eh.length(o);return 0===s?[0,0,1,0]:(Eh.scale(o,o,1/s),[o[0],o[1],o[2],-Eh.dot(o,t)])}function OC(e){const t=e.properties.get("direction"),n=J(t.x,t.y,t.z);n[2]=k(n[2],0,75);const i=Q([n[0],n[1],n[2]]);return Eh.fromValues(i.x,i.y,i.z)}function FC(e,t){const n=e.properties.get("color"),i=e.properties.get("intensity"),r=e.properties.get("direction"),o=[r.x,r.y,r.z],s=t.properties.get("color"),a=t.properties.get("intensity"),l=Math.max(Eh.dot([0,0,1],o),0),c=[0,0,0];Eh.scale(c,s.toArray01Linear().slice(0,3),a);const u=[0,0,0];return Eh.scale(u,n.toArray01Linear().slice(0,3),l*i),ae([c[0]>0?c[0]/(c[0]+u[0]):0,c[1]>0?c[1]/(c[1]+u[1]):0,c[2]>0?c[2]/(c[2]+u[2]):0])}function BC(e,t,n,i,r,o){const s=e.zoom,a=e.scale,l=e.worldSize,c=1/l,u=e.aspect,h=Math.sqrt(1+u*u)*Math.tan(.5*e.fovX),d=h*h,p=i-n,f=i+n;let m,_;d>p/f?(m=i,_=i*h):(m=.5*f*(1+d),_=.5*Math.sqrt(p*p+2*(i*i+n*n)*d+f*f*d*d));const g=e.projection.pixelsPerMeter(e.center.lat,l),y=e._camera.getCameraToWorldMercator(),v=[0,0,-m*c];Eh.transformMat4(v,v,y);let x=_*c;const b=e._edgeInsets;if(!(0===b.left&&0===b.top&&0===b.right&&0===b.bottom||b.left===b.right&&b.top===b.bottom)){const t=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?g:1),r=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,n,i);r[8]=2*-e.centerOffset.x/e.width,r[9]=2*e.centerOffset.y/e.height;const o=new Float64Array(16);vh.mul(o,r,t);const c=new Float64Array(16);vh.invert(c,o);const u=Wh.fromInvProjectionMatrix(c,l,s,!0);for(const n of u.points){const t=((w=n)[0]/=a,w[1]/=a,w[2]=Hd(w[2],e._center.lat),w);x=Math.max(x,Eh.len(Eh.subtract([],v,t)))}}var w;x*=r/(r-1);const T=Math.acos(t[2]),S=Math.atan2(-t[0],-t[1]),E=new Vv;E.position=v,E.setPitchBearing(T,S);const C=E.getWorldToCamera(l,g),A=x*l,I=Math.min(e._mercatorZfromZoom(17)*l*-2,-2*A),M=E.getCameraToClipOrthographic(-A,A,-A,A,I,(A+o*g)/t[2]),k=new Float64Array(16);vh.multiply(k,M,C);const P=Eh.fromValues(Math.floor(1e6*v[0])/1e6*l,Math.floor(1e6*v[1])/1e6*l,0),D=.5*r,R=[0,0,0];Eh.transformMat4(R,P,k),Eh.scale(R,R,D);const z=[Math.floor(R[0]),Math.floor(R[1]),Math.floor(R[2])],L=[0,0,0];Eh.sub(L,R,z),Eh.scale(L,L,-1/D);const O=new Float64Array(16);return vh.identity(O),vh.translate(O,O,L),vh.multiply(k,O,k),[k,A]}class NC extends It{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,t){return aT(this.requestManager.transformRequest(t,ye.Model).url).then((t=>{if(!t)return;const n=_T(t),i=new bx(e,void 0,void 0,n);return i.computeBoundsAndApplyParent(),i})).catch((n=>{this.fire(new At(new Error("Could not load model ".concat(e," from ").concat(t,": ").concat(n.message))))}))}load(e,t){this.models[t]||(this.models[t]={});const n=Object.keys(e);this.numModelsLoading[t]=(this.numModelsLoading[t]||0)+n.length;const i=[];for(const r of n)i.push(this.loadModel(r,e[r]));Promise.allSettled(i).then((e=>{for(let i=0;i<e.length;i++){const{status:r,value:o}=e[i];"fulfilled"===r&&o&&(this.models[t][n[i]]=o)}this.numModelsLoading[t]-=n.length,this.fire(new Ct("data",{dataType:"style"}))})).catch((e=>{this.fire(new At(new Error("Could not load models: ".concat(e.message))))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]}addModel(e,t,n){this.models[n]||(this.models[n]={}),this.hasModel(e,n)&&this.removeModel(e,n),this.load({[e]:this.requestManager.normalizeModelURL(t)},n)}addModels(e,t){const n={};for(const i in e)n[i]=this.requestManager.normalizeModelURL(e[i]);this.load(n,t)}removeModel(e,t){this.models[t]||(this.models[t]={});const n=this.models[t][e];delete this.models[t][e],n.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const n in this.models[t])this.models[t][n].upload(e.context)}}const jC=(e,t)=>ws(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),UC=O(MT,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),VC=O(MT,["setCenter","setZoom","setBearing","setPitch"]),GC={version:8,layers:[],sources:{}},qC={duration:300,delay:0},HC=new Set(["fill","line","background","hillshade","raster"]);class WC extends It{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=e,this.scope=t.scope||"",this.fragments=[],this.importDepth=t.importDepth||0,this.importsCache=t.importsCache||new Map,this.resolvedImports=t.resolvedImports||new Set,this.transition=L({},qC),this._buildingIndex=new ET(this),this.crossTileSymbolIndex=new wS,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=t.styleChanges||new ga,this.dispatcher=t.dispatcher?t.dispatcher:new _w(jw(),this),t.imageManager?this.imageManager=t.imageManager:(this.imageManager=new $b,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=t.glyphManager?t.glyphManager:new Q_(e._requestManager,t.localFontFamily?2:t.localIdeographFontFamily?1:0,t.localFontFamily||t.localIdeographFontFamily),t.modelManager?this.modelManager=t.modelManager:(this.modelManager=new NC(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this.dispatcher.broadcast("setReferrer",xe());const n=this;this._rtlTextPluginCallback=WC.registerForPluginStateChange((e=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,t)=>{if(Xs(e),t&&t.every((e=>e)))for(const i in n._sourceCaches){const e=n._sourceCaches[i],t=e.getSource().type;"vector"!==t&&"geojson"!==t||e.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const n in this._layers){const e=this._layers[n];e.source===t.id&&this._validateLayer(e)}}))}loadURL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new Ct("dataloading",{dataType:"style"}));const n="boolean"==typeof t.validate?t.validate:!Pe(e);e=this.map._requestManager.normalizeStyleURL(e,t.accessToken),this.resolvedImports.add(e);const i=this.importsCache.get(e);if(i)return this._load(i,n);const r=this.map._requestManager.transformRequest(e,ye.Style);this._request=we(r,((t,i)=>{if(this._request=null,t)this.fire(new At(t));else if(i)return this.importsCache.set(e,i),this._load(i,n)}))}loadJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new Ct("dataloading",{dataType:"style"})),this._request=ut.frame((()=>{this._request=null,this._load(e,!1!==t.validate)}))}loadEmpty(){this.fire(new Ct("dataloading",{dataType:"style"})),this._load(GC,!1)}_loadImports(e,t){if(this.importDepth>=4)return X("Style doesn't support nesting deeper than 5"),this._reloadImports();const n=[];for(const i of e){const e=this._createFragmentStyle(i),r=new Promise((t=>e.on("style.import.load",t)));if(n.push(r),this.resolvedImports.has(i.url)){e.loadEmpty();continue}const o=i.data||this.importsCache.get(i.url);o?e.loadJSON(o,{validate:t}):i.url?e.loadURL(i.url,{validate:t}):e.loadEmpty(),this.fragments.push({style:e,id:i.id,config:i.config})}Promise.all(n).then((()=>this._reloadImports()))}_createFragmentStyle(e){const t=this.scope?pa(e.id,this.scope):e.id,n=new WC(this.map,{scope:t,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager});return n.setEventedParent(this.map,{style:n}),n.setConfig(e.config),n}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Ct("data",{dataType:"style"})),this.fire(new Ct(e?"style.load":"style.import.load"))}_load(e,t){const n=e.schema;if(this.isRootStyle()&&(e.fragment||n&&!1!==e.fragment)){const n=L({},GC,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(n,t)}if(this.updateSchema(n),t&&jC(this,us(e)))return;this._loaded=!0,this.stylesheet=W(e);for(const o in e.sources)this.addSource(o,e.sources[o],{validate:!1});this._changes.changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const i=IT(this.stylesheet.layers);if(this._order=i.map((e=>e.id)),this.stylesheet.light&&X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new tw(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new tw(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const o of i){const e=Qb(o,this.options);e.setScope(this.scope),e.isConfigDependent&&this._configDependentLayers.add(e.fqid),e.setEventedParent(this,{layer:{id:e.id}}),this._layers[e.id]=e,this._layers[e.id]=e,this._serializedLayers[e.id]=e.serialize();const t=this.getOwnLayerSourceCache(e),n=!!this.directionalLight&&this.directionalLight.shadowsEnabled();t&&e.canCastShadows()&&n&&(t.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const r=this.stylesheet.terrain;if(r&&!this.terrainSetForDrapingOnly()&&this._createTerrain(r,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.fire(new Ct("data",{dataType:"style"})),e.imports)this._loadImports(e.imports,t);else{this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Ct(e?"style.load":"style.import.load"))}}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,t,n,i,r,o,s,a;this.forEachFragmentStyle((l=>{if(l.stylesheet){if(null!=l.light&&(e=l.light),l.stylesheet.lights)for(const e of l.stylesheet.lights)"ambient"===e.type&&null!=l.ambientLight&&(t=l.ambientLight),"directional"===e.type&&null!=l.directionalLight&&(n=l.directionalLight);(l.stylesheet.terrain||l.stylesheet.projection&&"globe"===l.stylesheet.projection.name)&&null!=l.terrain&&(!i||i&&0===i.drapeRenderMode||1===l.terrain.drapeRenderMode)&&(i=l.terrain),l.stylesheet.fog&&null!=l.fog&&(r=l.fog),null!=l.stylesheet.camera&&(a=l.stylesheet.camera),null!=l.stylesheet.projection&&(o=l.stylesheet.projection),null!=l.stylesheet.transition&&(s=l.stylesheet.transition)}})),this.light=e,this.ambientLight=t,this.directionalLight=n,this.terrain=i,this.fog=r,this.camera=a||{"camera-projection":"perspective"},this.projection=o||{name:"mercator"},this.transition=L({},qC,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=n=>{for(const e of n.fragments)t(e.style);e(n)};t(this)}mergeTerrain(){let e;this.forEachFragmentStyle((t=>{null!=t.terrain&&(!e||e&&0===e.drapeRenderMode||1===t.terrain.drapeRenderMode)&&(e=t.terrain)})),this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const e={},t={},n={};this.forEachFragmentStyle((i=>{for(const t in i._sourceCaches){const n=pa(t,i.scope);e[n]=i._sourceCaches[t]}for(const e in i._otherSourceCaches){const n=pa(e,i.scope);t[n]=i._otherSourceCaches[e]}for(const e in i._symbolSourceCaches){const t=pa(e,i.scope);n[t]=i._symbolSourceCaches[e]}})),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=t,this._mergedSymbolSourceCaches=n}mergeLayers(){var e=this;const t={},n=[],i={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((e=>{for(const i of e._order){const r=e._layers[i];if("slot"===r.type){const e=fa(i);if(t[e])continue;t[e]=[]}r.slot&&t[r.slot]?t[r.slot].push(r):n.push(r)}})),this._mergedOrder=[];const r=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const o of n)if("slot"===o.type){const e=fa(o.id);t[e]&&r(t[e])}else{const t=pa(o.id,o.scope);e._mergedOrder.push(t),i[t]=o,o.is3D()&&(e._has3DLayers=!0),"circle"===o.type&&(e._hasCircleLayers=!0),"symbol"===o.type&&(e._hasSymbolLayers=!0)}};r(n),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=L({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,t,n){let i,r,o;const s=ut.devicePixelRatio>1?"@2x":"";let a=we(t.transformRequest(t.normalizeSpriteURL(e,s,".json"),ye.SpriteJSON),((e,t)=>{a=null,o||(o=e,i=t,c())})),l=Ie(t.transformRequest(t.normalizeSpriteURL(e,s,".png"),ye.SpriteImage),((e,t)=>{l=null,o||(o=e,r=t,c())}));function c(){if(o)n(o);else if(i&&r){const e=ut.getImageData(r),t={};for(const n in i){const{width:r,height:o,x:s,y:a,sdf:l,pixelRatio:c,stretchX:u,stretchY:h,content:d}=i[n],p=new Wp({width:r,height:o});Wp.copy(e,p,{x:s,y:a},{x:0,y:0},{width:r,height:o}),t[n]={data:p,pixelRatio:c,sdf:l,stretchX:u,stretchY:h,content:d}}n(null,t)}}return{cancel(){a&&(a.cancel(),a=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,((e,t)=>{if(this._spriteRequest=null,e)this.fire(new At(e));else if(t)for(const n in t)this.imageManager.addImage(n,this.scope,t[n]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Ct("data",{dataType:"style"}))}))}_validateLayer(e){const t=this.getOwnSource(e.source);if(!t)return;const n=e.sourceLayer;n&&("geojson"===t.type||t.vectorLayerIds&&-1===t.vectorLayerIds.indexOf(n))&&this.fire(new At(new Error('Source layer "'.concat(n,'" does not exist on source "').concat(t.id,'" as specified by style layer "').concat(e.id,'"'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.updatedSourceCaches).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const n=this.fragments[t];return n&&n.style&&(e.data=n.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return e}_serializeLayers(e){const t=[];for(const n of e){const e=this._layers[n];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):HC.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const t=this.getOwnLayer(e);if(t)return t;this.fire(new At(new Error("The layer '".concat(e,"' does not exist in the map's style."))))}_checkSource(e){const t=this.getOwnSource(e);if(t)return t;this.fire(new At(new Error("The source '".concat(e,"' does not exist in the map's style."))))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const t=this.calculateLightsBrightness();e.brightness=t||0,t!==this._brightness&&(this._brightness=t,this.dispatcher.broadcast("setBrightness",t));const n=this._changes.changed;if(this._changes.changed){const t=this._changes.getLayerUpdatesByScope();for(const e in t){const{updatedIds:n,removedIds:i}=t[e];(n||i)&&this._updateWorkerLayers(e,n,i)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const i={};for(const r in this._mergedSourceCaches){const e=this._mergedSourceCaches[r];i[r]=e.used,e.used=!1}for(const r of this._mergedOrder){const t=this._mergedLayers[r];if(t.recalculate(e,this._availableImages),!t.isHidden(e.zoom)){const e=this.getOwnLayerSourceCache(t);e&&(e.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let n=t.minzoom||0;n<(t.maxzoom||25.5);n++){const n=this.map.painter;if(n){const i=t.getProgramIds();if(!i)continue;for(const r of i){const i=t.getDefaultProgramParams(r,e.zoom);i&&(n.style=this,this.fog&&(n._fogVisible=!0,i.overrideFog=!0,n.getOrCreateProgram(r,i)),n._fogVisible=!1,i.overrideFog=!1,n.getOrCreateProgram(r,i),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(i.overrideRtt=!0,n.getOrCreateProgram(r,i)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const r in i){const e=this._mergedSourceCaches[r];i[r]!==e.used&&e.getSource().fire(new Ct("data",{sourceDataType:"visibility",dataType:"source",sourceId:e.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new Ct("data",{dataType:"style"}));for(const{style:r}of this.fragments)r.update(e)}_updateTilesForChangedImages(){const e=Array.from(this._changes.changedImages.keys());if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.changedImages.clear()}}_updateWorkerLayers(e,t,n){const i=this.getFragmentStyle(e);this.dispatcher.broadcast("updateLayers",{layers:t?i._serializeLayers(t):[],scope:e,removedIds:n||[],options:i.options})}setState(e){if(this._checkLoaded(),jC(this,us(e)))return!1;(e=W(e)).layers=IT(e.layers);const t=function(e,t){if(!e)return[{command:MT.setStyle,args:[t]}];let n=[];try{if(!v(e.version,t.version))return[{command:MT.setStyle,args:[t]}];v(e.center,t.center)||n.push({command:MT.setCenter,args:[t.center]}),v(e.zoom,t.zoom)||n.push({command:MT.setZoom,args:[t.zoom]}),v(e.bearing,t.bearing)||n.push({command:MT.setBearing,args:[t.bearing]}),v(e.pitch,t.pitch)||n.push({command:MT.setPitch,args:[t.pitch]}),v(e.sprite,t.sprite)||n.push({command:MT.setSprite,args:[t.sprite]}),v(e.glyphs,t.glyphs)||n.push({command:MT.setGlyphs,args:[t.glyphs]}),v(e.transition,t.transition)||n.push({command:MT.setTransition,args:[t.transition]}),v(e.light,t.light)||n.push({command:MT.setLight,args:[t.light]}),v(e.fog,t.fog)||n.push({command:MT.setFog,args:[t.fog]}),v(e.projection,t.projection)||n.push({command:MT.setProjection,args:[t.projection]}),v(e.lights,t.lights)||n.push({command:MT.setLights,args:[t.lights]}),v(e.camera,t.camera)||n.push({command:MT.setCamera,args:[t.camera]});const i={},r=[];!function(e,t,n,i){let r;for(r in t=t||{},e=e||{})e.hasOwnProperty(r)&&(t.hasOwnProperty(r)||PT(r,n,i));for(r in t){if(!t.hasOwnProperty(r))continue;const o=t[r];e.hasOwnProperty(r)?v(e[r],o)||("geojson"===e[r].type&&"geojson"===o.type&&RT(e,t,r)?n.push({command:MT.setGeoJSONSourceData,args:[r,o.data]}):DT(r,t,n,i)):kT(r,t,n)}}(e.sources,t.sources,r,i);const o=[];e.layers&&e.layers.forEach((e=>{e.source&&i[e.source]?n.push({command:MT.removeLayer,args:[e.id]}):o.push(e)}));let s=e.terrain;s&&i[s.source]&&(n.push({command:MT.setTerrain,args:[void 0]}),s=void 0),n=n.concat(r),v(s,t.terrain)||n.push({command:MT.setTerrain,args:[t.terrain]}),function(e,t,n){t=t||[];const i=(e=e||[]).map(LT),r=t.map(LT),o=e.reduce(OT,{}),s=t.reduce(OT,{}),a=i.slice(),l=Object.create(null);let c,u,h,d,p,f,m;for(c=0,u=0;c<i.length;c++)h=i[c],s.hasOwnProperty(h)?u++:(n.push({command:MT.removeLayer,args:[h]}),a.splice(a.indexOf(h,u),1));for(c=0,u=0;c<r.length;c++)h=r[r.length-1-c],a[a.length-1-c]!==h&&(o.hasOwnProperty(h)?(n.push({command:MT.removeLayer,args:[h]}),a.splice(a.lastIndexOf(h,a.length-u),1)):u++,f=a[a.length-c],n.push({command:MT.addLayer,args:[s[h],f]}),a.splice(a.length-c,0,h),l[h]=!0);for(c=0;c<r.length;c++)if(h=r[c],d=o[h],p=s[h],!l[h]&&!v(d,p))if(v(d.source,p.source)&&v(d["source-layer"],p["source-layer"])&&v(d.type,p.type)){for(m in zT(d.layout,p.layout,n,h,null,MT.setLayoutProperty),zT(d.paint,p.paint,n,h,null,MT.setPaintProperty),v(d.slot,p.slot)||n.push({command:MT.setSlot,args:[h,p.slot]}),v(d.filter,p.filter)||n.push({command:MT.setFilter,args:[h,p.filter]}),v(d.minzoom,p.minzoom)&&v(d.maxzoom,p.maxzoom)||n.push({command:MT.setLayerZoomRange,args:[h,p.minzoom,p.maxzoom]}),d)d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?zT(d[m],p[m],n,h,m.slice(6),MT.setPaintProperty):v(d[m],p[m])||n.push({command:MT.setLayerProperty,args:[h,m,p[m]]}));for(m in p)p.hasOwnProperty(m)&&!d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?zT(d[m],p[m],n,h,m.slice(6),MT.setPaintProperty):v(d[m],p[m])||n.push({command:MT.setLayerProperty,args:[h,m,p[m]]}))}else n.push({command:MT.removeLayer,args:[h]}),f=a[a.lastIndexOf(h)+1],n.push({command:MT.addLayer,args:[p,f]})}(o,t.layers,n),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;t=t||[];const i=(e=e||[]).map(LT),r=t.map(LT),o=e.reduce(OT,{}),s=t.reduce(OT,{}),a=i.slice();let l,c,u,h;for(l=0,c=0;l<i.length;l++)u=i[l],s.hasOwnProperty(u)?c++:(n.push({command:MT.removeImport,args:[u]}),a.splice(a.indexOf(u,c),1));for(l=0,c=0;l<r.length;l++)u=r[r.length-1-l],a[a.length-1-l]!==u&&(o.hasOwnProperty(u)?(n.push({command:MT.removeImport,args:[u]}),a.splice(a.lastIndexOf(u,a.length-c),1)):c++,h=a[a.length-l],n.push({command:MT.addImport,args:[s[u],h]}),a.splice(a.length-l,0,u));for(const d of t){const e=o[d.id];if(!e||v(e,d))continue;v(e.config,d.config)||n.push({command:MT.setImportConfig,args:[d.id,d.config]}),v(e.url,d.url)||n.push({command:MT.setImportUrl,args:[d.id,d.url]});const t=d.data;v(e&&e.data,t)||n.push({command:MT.setImportData,args:[d.id,t]})}}(e.imports,t.imports,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:MT.setStyle,args:[t]}]}return n}(this.serialize(),e).filter((e=>!(e.command in VC)));if(0===t.length)return!1;const n=t.filter((e=>!(e.command in UC)));if(n.length>0)throw new Error("Unimplemented: ".concat(n.map((e=>e.command)).join(", "),"."));return t.forEach((e=>{this[e.command].apply(this,e.args)})),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,t){return this.getImage(e)?this.fire(new At(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,t),this._afterImageUpdated(e),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new At(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.changedImages.add(e),this._changes.changed=!0,this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Ct("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(xs,"models.".concat(e),t,null,n)||(this.modelManager.addModel(e,t,this.scope),this._changes.changed=!0),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new At(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error('There is already a source with ID "'.concat(e,'".'));if(!t.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(t).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(t.type)>=0&&this._validate(hs,"sources.".concat(e),t,null,n))return;this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);const i=xT(e,t,this.dispatcher,this);i.scope=this.scope,i.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(i.id),source:i.serialize(),sourceId:i.id})));const r=e=>{const t=(e?"symbol:":"other:")+i.id,n=pa(t,this.scope),r=this._sourceCaches[t]=new Cv(n,i,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[i.id]=r,r.onAdd(this.map)};r(!1),"vector"!==t.type&&"geojson"!==t.type||r(!0),i.onAdd&&i.onAdd(this.map),this.mergeSources(),this._changes.changed=!0}removeSource(e){this._checkLoaded();const t=this.getOwnSource(e);if(!t)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new At(new Error('Source "'.concat(e,'" cannot be removed while layer "').concat(i,'" is using it.'))));if(this.terrain&&this.terrain.get().source===e)return this.fire(new At(new Error('Source "'.concat(e,'" cannot be removed while terrain is using it.'))));const n=this.getOwnSourceCaches(e);for(const i of n){const e=fa(i.id);delete this._sourceCaches[e],delete this._changes.updatedSourceCaches[i.id],i.fire(new Ct("data",{sourceDataType:"metadata",dataType:"source",sourceId:i.getSource().id})),i.setEventedParent(null),i.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),t.setEventedParent(null),t.onRemove&&t.onRemove(this.map),this._changes.changed=!0,this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.changed=!0}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const n=this.getOwnSourceCache(t);n&&e.push(n.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const t=this._getTransitionParameters();for(const i of e){if(this._validate(ps,"lights",i))return;switch(i.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(i),e.updateTransitions(t)}else this.ambientLight=new gw(i,yw,this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(i),e.updateTransitions(t)}else this.directionalLight=new gw(i,vw,this.scope,this.options)}}const n=new ea(this.z||0,t);this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,t=this.ambientLight;if(!e||!t)return;const n=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),i=e.properties.get("color").toArray01(),r=e.properties.get("intensity"),o=e.properties.get("direction"),s=1-J(o.x,o.y,o.z)[2]/90,a=n(i)*r*s,l=t.properties.get("color").toArray01(),c=t.properties.get("intensity");return(a+n(l)*c)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;const t=this.fragments.find((t=>{let{id:n}=t;return n===e}));if(!t)throw new Error("Style import not found: ".concat(e));return t.style}setConfigProperty(e,t,n){const i=vo(n);if("success"!==i.result)return void jC(this,i.value);const r=i.value.expression,o=this.getFragmentStyle(e);o.options.set(t,r),o.updateConfigDependencies()}setConfig(e,t){if(this.options.clear(),e){for(const t in e){const n=vo(e[t]);"success"===n.result&&this.options.set(t,n.value.expression)}this.updateSchema(t)}}updateSchema(e){if(e)for(const t in e){if(this.options.has(t))continue;const n=vo(e[t].default);"success"===n.result&&this.options.set(t,n.value.expression)}}updateConfigDependencies(){for(const e of this._configDependentLayers){const t=this.getLayer(e);t&&(t.possiblyEvaluateVisibility(),this._updateLayer(t))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.changed=!0}addLayer(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=e.id;if(this._layers[i])return void this.fire(new At(new Error('Layer with id "'.concat(i,'" already exists on this map'))));let r;if("custom"===e.type){if(jC(this,function(e){const t=[],n=e.id;return void 0===n&&t.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(n,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),t}(e)))return;r=Qb(e,this.options)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=L(e=W(e),{source:i})),this._validate(_s,"layers.".concat(i),e,{arrayIndex:-1},n))return;r=Qb(e,this.options),this._validateLayer(r),r.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[r.id]=r.serialize()}r.isConfigDependent&&this._configDependentLayers.add(r.fqid),r.setScope(this.scope);const o=t?this._order.indexOf(t):this._order.length;if(t&&-1===o)return void this.fire(new At(new Error('Layer with id "'.concat(t,'" does not exist on this map.'))));this._order.splice(o,0,i),this._layerOrderChanged=!0,this._layers[i]=r;const s=this.getOwnLayerSourceCache(r),a=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&r.canCastShadows()&&a&&(s.castsShadows=!0);const l=this._changes.getRemovedLayer(r);if(l&&r.source&&s&&"custom"!==r.type){this._changes.discardLayerRemoval(r);const e=pa(r.source,r.scope);l.type!==r.type?this._changes.updatedSourceCaches[e]="clear":(this._changes.updatedSourceCaches[e]="reload",s.pause())}this._updateLayer(r),r.onAdd&&r.onAdd(this.map),r.scope=this.scope,this.mergeLayers()}moveLayer(e,t){if(this._checkLoaded(),this._changes.changed=!0,!this._checkLayer(e))return;if(e===t)return;const n=this._order.indexOf(e);this._order.splice(n,1);const i=t?this._order.indexOf(t):this._order.length;t&&-1===i?this.fire(new At(new Error('Layer with id "'.concat(t,'" does not exist on this map.')))):(this._order.splice(i,0,e),this._layerOrderChanged=!0,this.mergeLayers())}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const n=this._order.indexOf(e);this._order.splice(n,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.changed=!0,this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const i=this.getOwnLayerSourceCache(t);if(i&&i.castsShadows){let e=!1;for(const n in this._layers)if(this._layers[n].source===t.source&&this._layers[n].canCastShadows()){e=!0;break}i.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,n){this._checkLoaded();const i=this._checkLayer(e);i&&(i.minzoom===t&&i.maxzoom===n||(null!=t&&(i.minzoom=t),null!=n&&(i.maxzoom=n),this._updateLayer(i)))}setSlot(e,t){this._checkLoaded();const n=this._checkLayer(e);n&&n.slot!==t&&(n.slot=t,this._updateLayer(n))}setFilter(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this._checkLayer(e);if(i&&!v(i.filter,t))return null==t?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(gs,"layers.".concat(i.id,".filter"),t,{layerType:i.type},n)||(i.filter=W(t),this._updateLayer(i)))}getFilter(e){const t=this._checkLayer(e);if(t)return W(t.filter)}setLayoutProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const r=this._checkLayer(e);r&&(v(r.getLayoutProperty(t),n)||(r.setLayoutProperty(t,n,i),r.isConfigDependent&&this._configDependentLayers.add(r.fqid),this._updateLayer(r)))}getLayoutProperty(e,t){const n=this._checkLayer(e);if(n)return n.getLayoutProperty(t)}setPaintProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const r=this._checkLayer(e);if(!r)return;if(v(r.getPaintProperty(t),n))return;const o=r.setPaintProperty(t,n,i);r.isConfigDependent&&this._configDependentLayers.add(r.fqid),o&&this._updateLayer(r),this._changes.changed=!0,this._changes.updatedPaintProps.add(r.fqid)}getPaintProperty(e,t){const n=this._checkLayer(e);if(n)return n.getPaintProperty(t)}setFeatureState(e,t){this._checkLoaded();const n=e.source,i=e.sourceLayer,r=this._checkSource(n);if(!r)return;const o=r.type;if("geojson"===o&&i)return void this.fire(new At(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!i)return void this.fire(new At(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new At(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(n);for(const a of s)a.setFeatureState(i,e.id,t)}removeFeatureState(e,t){this._checkLoaded();const n=e.source,i=this._checkSource(n);if(!i)return;const r=i.type,o="vector"===r?e.sourceLayer:void 0;if("vector"===r&&!o)return void this.fire(new At(new Error("The sourceLayer parameter must be provided for vector source types.")));if(t&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new At(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(n);for(const a of s)a.removeFeatureState(o,e.id,t)}getFeatureState(e){this._checkLoaded();const t=e.source,n=e.sourceLayer,i=this._checkSource(t);if(i){if("vector"!==i.type||n)return void 0===e.id&&this.fire(new At(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(t)[0].getFeatureState(n,e.id);this.fire(new At(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=L({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return L({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),t=e&&this.terrain&&this.terrain.scope===this.scope?e:void 0;return H({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:t,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._changes.updateLayer(e);const t=this.getLayerSourceCache(e),n=pa(e.source,e.scope);e.source&&!this._changes.updatedSourceCaches[n]&&t&&"raster"!==t.getSource().type&&(this._changes.updatedSourceCaches[n]="reload",t.pause()),this._changes.changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type,n=this.order,i={},r=[];for(let s=n.length-1;s>=0;s--){const o=n[s];if(t(o)){i[o]=s;for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t)}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const o=[];for(let s=n.length-1;s>=0;s--){const a=n[s];if(t(a))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(i[t.layer.id]<s)break;o.push(t),r.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)o.push(t.feature)}}return o}queryRenderedFeatures(e,t,n){t&&t.filter&&this._validate(gs,"queryRenderedFeatures.filter",t.filter,null,t),t.scope=this.scope,t.availableImages=this._availableImages,t.serializedLayers=this._serializedLayers;const i={};if(t&&t.layers){if(!Array.isArray(t.layers))return this.fire(new At(new Error("parameters.layers must be an Array."))),[];for(const e of t.layers){const t=this._mergedLayers[e];if(!t)return this.fire(new At(new Error("The layer '".concat(e,"' does not exist in the map's style and cannot be queried for features.")))),[];i[t.source]=!0}}const r=[],o=t.serializedLayers||{},s=t&&t.layers?t.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),a=xw.createFromScreenPoints(e,n);for(const l in this._mergedSourceCaches){const e=this._mergedSourceCaches[l].getSource();if(!e||e.scope!==t.scope)continue;const c=this._mergedSourceCaches[l].getSource().id;t.layers&&!i[c]||r.push(wT(this._mergedSourceCaches[l],this._mergedLayers,o,a,t,n,s,!!this.map._showQueryGeometry))}return this.placement&&r.push(function(e,t,n,i,r,o,s){const a={},l=o.queryRenderedSymbols(i),c=[];for(const u of Object.keys(l).map(Number))c.push(s[u]);c.sort(ST);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],t,u.bucketIndex,u.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in n){const t=a[e]=a[e]||[],i=n[e];i.sort(((e,t)=>{const n=u.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of i)t.push(e)}}for(const u in a)a[u].forEach((t=>{const i=t.feature,r=n(e[u]);if(!r)return;const o=r.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}));return a}(this._mergedLayers,o,this.getLayerSourceCache.bind(this),a.screenGeometry,t,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(r)}querySourceFeatures(e,t){t&&t.filter&&this._validate(gs,"querySourceFeatures.filter",t.filter,null,t);const n=this.getOwnSourceCaches(e);let i=[];for(const r of n)i=i.concat(TT(r,t));return i}addSourceType(e,t,n){return WC.getSourceType(e)?n(new Error('A source type called "'.concat(e,'" already exists.'))):(WC.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this.light.getLight();let r=!1;for(const s in e)if(!v(e[s],i[s])){r=!0;break}if(!r)return;const o=this._getTransitionParameters();this.light.setLight(e,t,n),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let n=e;if(1===t){if("object"==typeof n.source){const e="terrain-dem-src";this.addSource(e,n.source),n=W(n),n=L(n,{source:e})}if(this._validate(fs,"terrain",n))return}if(!this.terrain||this.terrain&&t!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,t),this.fire(new Ct("data",{dataType:"style"}))}else{const t=this.terrain,i=t.get();for(const e of Object.keys(Mt.terrain))!n.hasOwnProperty(e)&&Mt.terrain[e].default&&(n[e]=Mt.terrain[e].default);for(const n in e)if(!v(e[n],i[n])){t.set(e),this.stylesheet.terrain=e;const n=this._getTransitionParameters({duration:0});t.updateTransitions(n),this.fire(new Ct("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new dw(e,this.map.transform);this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const t=this.fog;if(!v(t.get(),e)){t.set(e),this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:ut.now(),transition:L(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const n in this._mergedLayers)this.isLayerDraped(this._mergedLayers[n])?e.push(n):t.push(n);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const n=this.terrain=new iw(e,t);n.setScope(this.scope),this.stylesheet.terrain=e,this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(r&&!1===r.validate)return!1;const o=L({},this.serialize());return jC(this,e.call(us,L({key:t,style:o,value:n,styleSpec:Mt},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Ks.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const n of t)n.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const n of t)n.resume(),n.reload()}updateSources(e){let t;this.directionalLight&&(t=OC(this.directionalLight));for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=!1,s=!1;const a={},l={};for(const c of this._mergedOrder){const t=this._mergedLayers[c];if("symbol"!==t.type)continue;const n=pa(t.source,t.scope);let i=a[n];if(!i){const e=this.getLayerSourceCache(t);if(!e)continue;const r=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));l[n]=r.slice(),i=a[n]=r.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(t,i,e.center.lng,e.projection);o=o||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),r=r||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new Ct("neworder")),(r||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ut.now(),e.zoom))&&(this.pauseablePlacement=new uS(e,this._mergedOrder,r,t,n,i,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,a,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ut.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(const c of this._mergedOrder){const e=this._mergedLayers[c];"symbol"===e.type&&this.placement.updateLayerOpacities(e,a[pa(e.source,e.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ut.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();const t=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==t.findIndex((t=>{let{id:n}=t;return n===e.id}))?this.fire(new At(new Error("Import with id '".concat(e.id,"' already exists in the map's style.")))):(t.push(e),this._loadImports([e],!0),this)}setImportUrl(e,t){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(e);if(-1===i)return this;n[i].url=t;const r=this.fragments[i];r.style=this._createFragmentStyle({id:e,url:t});const o=new Promise((e=>r.style.on("style.import.load",e)));return r.style.loadURL(t),o.then((()=>this._reloadImports())),this}setImportData(e,t){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];return-1===n?this:t?(this.fragments[n].style.setState(t),this._reloadImports(),this):(delete i[n].data,this.setImportUrl(e,i[n].url))}setImportConfig(e,t){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];if(-1===n)return this;t?i[n].config=t:delete i[n].config;const r=this.fragments[n],o=r.style.stylesheet&&r.style.stylesheet.schema;return r.config=t,r.style.setConfig(t,o),r.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],n=this.getImportIndex(e);return-1===n||(t.splice(n,1),this.fragments[n].style._remove(),this.fragments.splice(n,1),this._reloadImports()),this}getImportIndex(e){const t=(this.stylesheet.imports||[]).findIndex((t=>t.id===e));return-1===t&&this.fire(new At(new Error("Import '".concat(e,"' does not exist in the map's style and cannot be updated.")))),t}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const n=this._mergedOtherSourceCaches[t];n&&e.push(n.getSource())}return e}getSource(e,t){const n=this.getSourceCache(e,t);return n&&n.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(e,t){const n=pa(e,t);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(e){const t=pa(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[t]:this._mergedOtherSourceCaches[t]}getSourceCaches(e){const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){for(const e in this._changes.updatedSourceCaches){const t=this._changes.updatedSourceCaches[e];"reload"===t?this.reloadSource(e):"clear"===t&&this.clearSource(e)}}updateLayers(e){for(const t of this._changes.updatedPaintProps){const n=this.getLayer(t);n&&n.updateTransitions(e)}}getImages(e,t,n){this.imageManager.getImages(t.icons,t.scope,n),this._updateTilesForChangedImages();const i=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};i(this._otherSourceCaches[t.source]),i(this._symbolSourceCaches[t.source])}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,t.scope,n)}getResource(e,t,n){return be(t,n)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(e){const t=this.getOwnSourceCaches(e);return 0===t.length?(this.fire(new At(new Error("There is no source with ID '".concat(e,"'")))),!1):t.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function ZC(e,t){let n=!1,i=null;const r=()=>{i=null,n&&(e(),i=setTimeout(r,t),n=!1)};return()=>(n=!0,i||r(),i)}WC.getSourceType=function(e){return vT[e]},WC.setSourceType=function(e,t){vT[e]=t},WC.registerForPluginStateChange=function(e){return e({pluginStatus:Ws,pluginURL:Zs}),Ks.on("pluginStateChange",e),e};class XC{constructor(e){this._hashName=e&&encodeURIComponent(e),V(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ZC(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,t.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const n=YC(e);if(this._hashName){const e=this._hashName;let i=!1;const r=t.location.hash.slice(1).split("&").map((t=>{const r=t.split("=")[0];return r===e?(i=!0,"".concat(r,"=").concat(n)):t})).filter((e=>e));return i||r.push("".concat(e,"=").concat(n)),"#".concat(r.join("&"))}return"#".concat(n)}_getCurrentHash(){const e=t.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const n=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.location.href.replace(/(#.+)?$/,this.getHashString());t.history.replaceState(t.history.state,null,e)}}function YC(e,t){const n=e.getCenter(),i=Math.round(100*e.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),s=Math.round(n.lng*o)/o,a=Math.round(n.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?"/".concat(s,"/").concat(a,"/").concat(i):"".concat(i,"/").concat(a,"/").concat(s);return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/".concat(Math.round(c))),u}const KC={linearity:.3,easing:I(0,0,.3,1)},QC=L({deceleration:2500,maxSpeed:1400},KC),JC=L({deceleration:20,maxSpeed:1400},KC),$C=L({deceleration:1e3,maxSpeed:360},KC),eA=L({deceleration:1e3,maxSpeed:90},KC);class tA{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ut.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=ut.now();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const t={zoom:0,bearing:0,pitch:0,pan:new y(0,0),pinchAround:void 0,around:void 0};for(const{settings:r}of this._inertiaBuffer)t.zoom+=r.zoomDelta||0,t.bearing+=r.bearingDelta||0,t.pitch+=r.pitchDelta||0,r.panDelta&&t.pan._add(r.panDelta),r.around&&(t.around=r.around),r.pinchAround&&(t.pinchAround=r.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(t.pan.mag()){const r=iA(t.pan.mag(),n,L({},QC,e||{}));i.offset=t.pan.mult(r.amount/t.pan.mag()),i.center=this._map.transform.center,nA(i,r)}if(t.zoom){const e=iA(t.zoom,n,JC);i.zoom=this._map.transform.zoom+e.amount,nA(i,e)}if(t.bearing){const e=iA(t.bearing,n,$C);i.bearing=this._map.transform.bearing+k(e.amount,-179,179),nA(i,e)}if(t.pitch){const e=iA(t.pitch,n,eA);i.pitch=this._map.transform.pitch+e.amount,nA(i,e)}if(i.zoom||i.bearing){const e=void 0===t.pinchAround?t.around:t.pinchAround;i.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),i.noMoveStart=!0,i}}function nA(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function iA(e,t,n){const{maxSpeed:i,linearity:r,deceleration:o}=n,s=k(e*r/(t/1e3),-i,i),a=Math.abs(s)/(o*r);return{easing:n.easing,duration:1e3*a,amount:s*(a/2)}}class rA extends Ct{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=xt(t.getCanvasContainer(),n);super(e,L({point:r,lngLat:t.unproject(r),originalEvent:n},i)),this._defaultPrevented=!1,this.target=t}}class oA extends Ct{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){const i="touchend"===e?n.changedTouches:n.touches,r=bt(t.getCanvasContainer(),i),o=r.map((e=>t.unproject(e))),s=r.reduce(((e,t,n,i)=>e.add(t.div(i.length))),new y(0,0));super(e,{points:r,point:s,lngLats:o,lngLat:t.unproject(s),originalEvent:n}),this._defaultPrevented=!1}}class sA extends Ct{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class aA{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new sA(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new rA(e.type,this._map,e))}mouseup(e){this._map.fire(new rA(e.type,this._map,e))}preclick(e){const t=L({},e);t.type="preclick",this._map.fire(new rA(t.type,this._map,t))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new rA(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new rA(e.type,this._map,e))}mouseover(e){this._map.fire(new rA(e.type,this._map,e))}mouseout(e){this._map.fire(new rA(e.type,this._map,e))}touchstart(e){return this._firePreventable(new oA(e.type,this._map,e))}touchmove(e){this._map.fire(new oA(e.type,this._map,e))}touchend(e){this._map.fire(new oA(e.type,this._map,e))}touchcancel(e){this._map.fire(new oA(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lA{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new rA(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rA("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new rA(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cA{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(_t(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t,i=this._startPos,r=this._lastPos;if(!i||!r||r.equals(n)||!this._box&&n.dist(i)<this._clickTolerance)return;this._lastPos=n,this._box||(this._box=ht("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(i.x,n.x),s=Math.max(i.x,n.x),a=Math.min(i.y,n.y),l=Math.max(i.y,n.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform="translate(".concat(o,"px,").concat(a,"px)"),this._box.style.width=s-o+"px",this._box.style.height=l-a+"px")}))}mouseupWindow(e,t){if(!this._active)return;const n=this._startPos,i=t;if(n&&0===e.button){if(this.reset(),vt(),n.x!==i.x||n.y!==i.y)return this._map.fire(new Ct("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(n,i,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),gt(),delete this._startPos,delete this._lastPos}_fireEvent(e,t){return this._map.fire(new Ct(e,{originalEvent:t}))}}function uA(e,t){const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class hA{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){const t=new y(0,0);for(const n of e)t._add(n);return t.div(e.length)}(t),this.touches=uA(n,t)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const i=uA(n,t);for(const r in this.touches){const e=i[r];(!e||e.dist(this.touches[r])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class dA{constructor(e){this.singleTap=new hA(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const i=this.singleTap.touchend(e,t,n);if(i){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class pA{constructor(){this._zoomIn=new dA({numTouches:1,numTaps:2}),this._zoomOut=new dA({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const i=this._zoomIn.touchend(e,t,n),r=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fA={0:1,2:2};class mA{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const n=wt(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}mousemoveWindow(e,t){const n=this._lastPoint;if(n)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const n=fA[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}mouseupWindow(e){this._lastPoint&&wt(e)===this._eventButton&&(this._moved&&vt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _A extends mA{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class gA extends mA{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(e){e.preventDefault()}}class yA extends mA{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(e){e.preventDefault()}}class vA{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset(),V(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new y(0,0)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!ne())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,t,n)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,t,n){n.length>0&&(this._active=!0);const i=uA(n,t),r=new y(0,0),o=new y(0,0);let s=0;for(const l in i){const e=i[l],t=this._touches[l];t&&(r._add(e),o._add(e.sub(t)),s++,i[l]=e)}if(this._touches=i,s<this._minTouches||!o.mag())return;const a=o.div(s);return this._sum._add(a),this._sum.mag()<this._clickTolerance?void 0:{around:r.div(s),panDelta:a}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ht("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class xA{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,n){return{}}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){const i=this._firstTwoTouches;if(!i)return;e.preventDefault();const[r,o]=i,s=bA(n,t,r),a=bA(n,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,o=bA(n,t,i),s=bA(n,t,r);o&&s||(this._active&&vt(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bA(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function wA(e,t){return Math.log(e/t)/Math.LN2}class TA extends xA{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(wA(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wA(this._distance,n),pinchAround:t}}}function SA(e,t){return 180*e.angleWith(t)/Math.PI}class EA extends xA{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const n=this._vector;if(this._vector=e[0].sub(e[1]),n&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:SA(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=this._startVector;if(!n)return!1;const i=SA(e,n);return Math.abs(i)<t}}function CA(e){return Math.abs(e.y)>Math.abs(e.x)}class AA extends xA{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,CA(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){const i=this._lastPoints;if(!i)return;const r=e[0].sub(i[0]),o=e[1].sub(i[1]);return this._map._cooperativeGestures&&!ne()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(r,o,n.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,r=t.mag()>=2;if(!i&&!r)return;if(!i||!r)return null==this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return CA(e)&&CA(t)&&o}}const IA={panStep:100,bearingStep:15,pitchStep:10};class MA{constructor(){const e=IA;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,i=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:kA,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+n*this._bearingStep,pitch:s.getPitch()+i*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kA(e){return e*(2-e)}const PA=4.000244140625;class DA{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._handler=t,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,V(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||ne()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=e.deltaMode===t.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=ut.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%PA==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=xt(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const t=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const n="wheel"===this._type&&Math.abs(this._delta)>PA?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);const r=t(),o=Math.pow(2,r),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*i))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:t(),i=this._startZoom,r=this._easing;let o,s=!1;if("wheel"===this._type&&i&&r){const e=Math.min((ut.now()-this._lastWheelEventTime)/200,1);o=Yi(i,n,r(e)),e<1?this._frameId||(this._frameId=!0):s=!0}else o=n,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let a=o-t();return a*this._lastDelta<0&&(a=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:a,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let t=M;if(this._prevEase){const e=this._prevEase,n=(ut.now()-e.start)/e.duration,i=e.easing(n+.01)-e.easing(n),r=.27/Math.sqrt(i*i+1e-4)*.01;t=I(r,Math.sqrt(.0729-r*r),.25,1)}return this._prevEase={start:ut.now(),duration:e,easing:t},t}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ht("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class RA{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zA{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class LA{constructor(){this._tap=new dA({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class OA{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class FA{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class BA{constructor(e,t,n,i){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const NA=e=>e.zoom||e.drag||e.pitch||e.rotate;class jA extends Ct{}class UA{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,t){const n=Eh.sub([],t,e);this.radius=Eh.length(n[2]<0?Eh.div([],n,this.constants):[n[0],n[1],0])}projectRay(e){Eh.div(e,e,this.constants),Eh.normalize(e,e),Eh.mul(e,e,this.constants);const t=Eh.scale([],e,this.radius);if(t[2]>0){const e=Eh.scale([],[0,0,1],Eh.dot(t,[0,0,1])),n=Eh.scale([],Eh.normalize([],[t[0],t[1],0]),this.radius),i=Eh.add([],t,Eh.scale([],Eh.sub([],Eh.add([],n,e),t),2));t[0]=i[0],t[1]=i[1]}return t}}function VA(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class GA{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tA(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new UA,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),V(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.document,"mousemove",{capture:!0}],[t.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t,"blur",void 0]];for(const[r,o,s]of this._listeners)r.addEventListener(o,r===t.document?this.handleWindowEvent:this.handleEvent,s)}destroy(){for(const[e,n,i]of this._listeners)e.removeEventListener(n,e===t.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new aA(t,e));const i=t.boxZoom=new cA(t,e);this._add("boxZoom",i);const r=new pA,o=new zA;t.doubleClickZoom=new RA(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const s=new LA;this._add("tapDragZoom",s);const a=t.touchPitch=new AA(t);this._add("touchPitch",a);const l=new gA(e),c=new yA(e);t.dragRotate=new FA(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new _A(e),h=new vA(t,e);t.dragPan=new OA(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new EA,p=new TA;t.touchZoomRotate=new BA(n,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new lA(t));const f=t.scrollZoom=new DA(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new MA;this._add("keyboard",m);for(const _ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[_]&&t[_].enable(e[_])}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!NA(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,n){for(const i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,"".concat(e.type,"Window"))}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}handleEvent(e,t){this._updatingCamera=!0;const n="renderFrame"===e.type,i=n?void 0:e,r={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?bt(this._el,a):n?void 0:xt(this._el,e);for(const{handlerName:h,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let n;this._blockedByActive(s,p,h)?d.reset():d[t||e.type]&&(n=d[t||e.type](e,l,a),this.mergeHandlerResult(r,o,n,h,i),n&&n.needsRenderFrame&&this._triggerRenderFrame()),(n||d.isActive())&&(s[h]=d)}const c={};for(const h in this._previousActiveHandlers)s[h]||(c[h]=i);this._previousActiveHandlers=s,(Object.keys(c).length||VA(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||VA(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,t,n,i,r){if(!n)return;L(e,n);const o={handlerName:i,originalEvent:n.originalEvent||r};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}_applyChanges(){const e={},t={},n={};for(const[i,r,o]of this._changes)i.panDelta&&(e.panDelta=(e.panDelta||new y(0,0))._add(i.panDelta)),i.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+i.pitchDelta),void 0!==i.around&&(e.around=i.around),void 0!==i.aroundCoord&&(e.aroundCoord=i.aroundCoord),void 0!==i.pinchAround&&(e.pinchAround=i.pinchAround),i.noInertia&&(e.noInertia=i.noInertia),L(t,r),L(n,o);this._updateMapTransform(e,t,n),this._changes=[]}_updateMapTransform(e,t,n){const i=this._map,r=i.transform,o=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!VA(e)){const e=r.zoom;r.cameraElevationReference="sea",null!=this._originalZoom&&r._orthographicProjectionAtLowPitch&&"globe"!==r.projection.name&&0===r.pitch?(r.cameraElevationReference="ground",r.zoom=this._originalZoom):(r.recenterOnTerrain(),r.cameraElevationReference="ground"),e!==r.zoom&&this._map._update(!0)}if(r._isCameraConstrained&&i._stop(!0),!VA(e))return void this._fireEvents(t,n,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,around:u,aroundCoord:h,pinchAround:d}=e;r._isCameraConstrained&&(a>0&&(a=0),r._isCameraConstrained=!1),void 0!==d&&(u=d),(a||(e=>t[e]&&!this._eventsInProgress[e])("drag"))&&u&&(this._dragOrigin=o(r.pointCoordinate3D(u)),this._originalZoom=r.zoom,this._trackingEllipsoid.setup(r._camera.position,this._dragOrigin)),r.cameraElevationReference="sea",i._stop(!0),u=u||i.transform.centerPoint,l&&(r.bearing+=l),c&&(r.pitch+=c),r._updateCameraState();const p=[0,0,0];if(s)if("mercator"===r.projection.name){const e=this._trackingEllipsoid.projectRay(r.screenPointToMercatorRay(u).dir),t=this._trackingEllipsoid.projectRay(r.screenPointToMercatorRay(u.sub(s)).dir);p[0]=t[0]-e[0],p[1]=t[1]-e[1]}else{const e=r.pointCoordinate(u);if("globe"===r.projection.name){s=s.rotate(-r.angle);const t=r._pixelsPerMercatorPixel/r.worldSize;p[0]=-s.x*Jd(Zd(e.y))*t,p[1]=-s.y*Jd(r.center.lat)*t}else{const t=r.pointCoordinate(u.sub(s));e&&t&&(p[0]=t.x-e.x,p[1]=t.y-e.y)}}const f=r.zoom,m=[0,0,0];if(a){const e=o(h||r.pointCoordinate3D(u)),t={dir:Eh.normalize([],Eh.sub([],e,r._camera.position))};if(t.dir[2]<0){const n=r.zoomDeltaToMovement(e,a);Eh.scale(m,t.dir,n)}}const _=Eh.add(p,p,m);r._translateCameraConstrained(_),a&&Math.abs(r.zoom-f)>1e-4&&r.recenterOnTerrain(),r.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}_fireEvents(e,t,n){const i=NA(this._eventsInProgress),r=NA(e),o={};for(const c in e){const{originalEvent:t}=e[c];this._eventsInProgress[c]||(o["".concat(c,"start")]=t),this._eventsInProgress[c]=e[c]}!i&&r&&this._fireEvent("movestart",r.originalEvent);for(const c in o)this._fireEvent(c,o[c]);r&&this._fireEvent("move",r.originalEvent);for(const c in e){const{originalEvent:t}=e[c];this._fireEvent(c,t)}const s={};let a;for(const c in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[c];this._handlersById[e].isActive()||(delete this._eventsInProgress[c],a=t[e]||n,s["".concat(c,"end")]=a)}for(const c in s)this._fireEvent(c,s[c]);const l=NA(this._eventsInProgress);if(n&&(i||r)&&!l){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),t=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;e?(t(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:a})):(this._map.fire(new Ct("moveend",{originalEvent:a})),t(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,t){this._map.fire(new Ct(e,t?{originalEvent:t}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new jA("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const qA="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class HA extends It{constructor(e,t){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=t.bearingSnap,this._respectPrefersReducedMotion=!1!==t.respectPrefersReducedMotion,V(["_renderFrameCallback"],this)}getCenter(){return new Nd(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(e,t,n){return e=y.convert(e).mult(-1),this.panTo(this.transform.center,L({offset:e},t),n)}panTo(e,t,n){return this.easeTo(L({center:e},t),n)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,n){return this.easeTo(L({zoom:e},t),n)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,n){return this.easeTo(L({bearing:e},t),n)}resetNorth(e,t){return this.rotateTo(0,L({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(L({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=$l.convert(e);const n=t&&t.bearing||0,i=t&&t.pitch||0,r=e.getNorthWest(),o=e.getSouthEast();return this._cameraForBounds(this.transform,r,o,n,i,t)}_extendCameraOptions(e){const t={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=L({padding:t,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=L(t,e.padding),e}_minimumAABBFrustumDistance(e,t){const n=t.max[0]-t.min[0],i=t.max[1]-t.min[1];return n/i>e.aspect?n/(2*Math.tan(.5*e.fovX)*e.aspect):i/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,t,n,i,r,o){const s=e.clone(),a=this._extendCameraOptions(o);s.bearing=i,s.pitch=r;const l=Nd.convert(t),c=Nd.convert(n),u=.5*(l.lat+c.lat),h=.5*(l.lng+c.lng),d=md(u,h),p=Eh.normalize([],d),f=Eh.normalize([],Eh.cross([],p,[0,1,0])),m=Eh.cross([],f,p),_=[f[0],f[1],f[2],0,m[0],m[1],m[2],0,p[0],p[1],p[2],0,0,0,0,1],g=[d,md(l.lat,l.lng),md(c.lat,l.lng),md(c.lat,c.lng),md(l.lat,c.lng),md(u,l.lng),md(u,c.lng),md(l.lat,h),md(c.lat,h)];let y=Zh.fromPoints(g.map((e=>[Eh.dot(f,e),Eh.dot(m,e),Eh.dot(p,e)])));const v=Eh.transformMat4([],y.center,_);0===Eh.squaredLength(v)&&Eh.set(v,0,0,1),Eh.normalize(v,v),Eh.scale(v,v,Kh),s.center=function(e){let[t,n,i]=e;const r=Math.hypot(t,n,i),o=Math.atan2(t,i),s=.5*Math.PI-Math.acos(-n/r);return new Nd(T(o),T(s))}(v);const x=s.getWorldToCameraMatrix(),b=vh.invert(new Float64Array(16),x);y=Zh.applyTransform(y,vh.multiply([],x,_)),Eh.transformMat4(v,v,x);const w=.5*(y.max[2]-y.min[2]),S=this._minimumAABBFrustumDistance(s,y),E=Eh.scale([],[0,0,1],w),C=Eh.add(E,v,E),A=S+(0===s.pitch?0:Eh.distance(v,C)),I=s.globeCenterInViewSpace,M=Eh.sub([],v,[I[0],I[1],I[2]]);Eh.normalize(M,M),Eh.scale(M,M,A);const k=Eh.add([],v,M);Eh.transformMat4(k,k,b);const P=Od/Kh,D=Eh.length(k),R=Hd(Math.max(D*P-Od,Number.EPSILON),0),z=Math.min(s.zoomFromMercatorZAdjusted(R),a.maxZoom);return z>.5*(Xh+Yh)?(s.setProjection({name:"mercator"}),s.zoom=z,this._cameraForBounds(s,t,n,i,r,o)):{center:s.center,zoom:z,bearing:i,pitch:r}}queryTerrainElevation(e,t){const n=this.transform.elevation;return n?(t=L({},{exaggerated:!0},t),n.getAtPoint(ep.fromLngLat(e),null,t.exaggerated)):null}_cameraForBounds(e,t,n,i,r,o){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,t,n,i,r,o);const s=e.clone(),a=this._extendCameraOptions(o),l=s.padding;s.bearing=i,s.pitch=r;const c=Nd.convert(t),u=Nd.convert(n),h=new Nd(c.lng,u.lat),d=new Nd(u.lng,c.lat),p=s.project(c),f=s.project(u),m=this.queryTerrainElevation(c),_=this.queryTerrainElevation(u),g=this.queryTerrainElevation(h),v=this.queryTerrainElevation(d),x=[[p.x,p.y,Math.min(m||0,_||0,g||0,v||0)],[f.x,f.y,Math.max(m||0,_||0,g||0,v||0)]];let b=Zh.fromPoints(x);const T=s.getWorldToCameraMatrix(),S=vh.invert(new Float64Array(16),T);b=Zh.applyTransform(b,T);const E=Eh.sub([],b.max,b.min),C=l.left||0,A=l.right||0,I=l.bottom||0,M=l.top||0,{left:k,right:P,top:D,bottom:R}=a.padding,z=.5*(C+A),L=.5*(M+I),O=Math.min(s.scaleZoom(s.scale*Math.min((s.width-(C+A+k+P))/E[0],(s.height-(I+M+R+D))/E[1])),a.maxZoom),F=s.scale/s.zoomScale(O);b=new Zh([b.min[0]-(k+z)*F,b.min[1]-(R+L)*F,b.min[2]],[b.max[0]+(P+z)*F,b.max[1]+(D+L)*F,b.max[2]]);const B=.5*E[2],N=this._minimumAABBFrustumDistance(s,b),j=[0,0,1,0];hh.transformMat4(j,j,T),hh.normalize(j,j);const U=Eh.scale([],j,N+B),V=Eh.add([],b.center,U),G=("number"==typeof a.offset.x&&"number"==typeof a.offset.y?new y(a.offset.x,a.offset.y):y.convert(a.offset)).rotate(-w(i));b.center[0]-=G.x*F,b.center[1]+=G.y*F,Eh.transformMat4(b.center,b.center,S),Eh.transformMat4(V,V,S);const q=[b.center[0],b.center[1],V[2]*s.pixelsPerMeter];Eh.scale(q,q,1/s.worldSize);const H=Wd(q[0]),W=Zd(q[1]),Z=Math.min(s._zoomFromMercatorZ(q[2]),a.maxZoom),X=new Nd(H,W);return s.mercatorFromTransition&&Z<.5*(Xh+Yh)?(s.setProjection({name:"globe"}),s.zoom=Z,this._cameraForBounds(s,t,n,i,r,o)):{center:X,zoom:Z,bearing:i,pitch:r}}fitBounds(e,t,n){const i=this.cameraForBounds(e,t);return this._fitInternal(i,t,n)}fitScreenCoordinates(e,t,n,i,r){const o=y.convert(e),s=y.convert(t),a=new y(Math.min(o.x,s.x),Math.min(o.y,s.y)),l=new y(Math.max(o.x,s.x),Math.max(o.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,s))return this;const c=this.transform.pointLocation3D(a),u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(new y(a.x,l.y)),d=this.transform.pointLocation3D(new y(l.x,a.y)),p=[Math.min(c.lng,u.lng,h.lng,d.lng),Math.min(c.lat,u.lat,h.lat,d.lat)],f=[Math.max(c.lng,u.lng,h.lng,d.lng),Math.max(c.lat,u.lat,h.lat,d.lat)],m=i&&i.pitch?i.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,p,f,n,m,i);return this._fitInternal(_,i,r)}_fitInternal(e,t,n){return e?(delete(t=L(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}jumpTo(e,t){this.stop();const n=e.preloadOnly?this.transform.clone():this.transform;let i=!1,r=!1,o=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(i=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=Nd.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(r=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),e.preloadOnly?(this._preloadTiles(n),this):(this.fire(new Ct("movestart",t)).fire(new Ct("move",t)),i&&this.fire(new Ct("zoomstart",t)).fire(new Ct("zoom",t)).fire(new Ct("zoomend",t)),r&&this.fire(new Ct("rotatestart",t)).fire(new Ct("rotate",t)).fire(new Ct("rotateend",t)),o&&this.fire(new Ct("pitchstart",t)).fire(new Ct("pitch",t)).fire(new Ct("pitchend",t)),this.fire(new Ct("moveend",t)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||X(qA),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,t){const n=this.transform;if(!n.projection.supportsFreeCamera)return X(qA),this;this.stop();const i=n.zoom,r=n.pitch,o=n.bearing;n.setFreeCameraOptions(e);const s=i!==n.zoom,a=r!==n.pitch,l=o!==n.bearing;return this.fire(new Ct("movestart",t)).fire(new Ct("move",t)),s&&this.fire(new Ct("zoomstart",t)).fire(new Ct("zoom",t)).fire(new Ct("zoomend",t)),l&&this.fire(new Ct("rotatestart",t)).fire(new Ct("rotate",t)).fire(new Ct("rotateend",t)),a&&this.fire(new Ct("pitchstart",t)).fire(new Ct("pitch",t)).fire(new Ct("pitchend",t)),this.fire(new Ct("moveend",t)),this}easeTo(e,t){this._stop(!1,e.easeId),(!1===(e=L({offset:[0,0],duration:500,easing:M},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const n=this.transform,i=this.getZoom(),r=this.getBearing(),o=this.getPitch(),s=this.getPadding(),a="zoom"in e?+e.zoom:i,l="bearing"in e?this._normalizeBearing(e.bearing,r):r,c="pitch"in e?+e.pitch:o,u="padding"in e?e.padding:n.padding,h=y.convert(e.offset);let d,p,f;if("globe"===n.projection.name){const t=ep.fromLngLat(n.center),i=h.rotate(-n.angle);t.x+=i.x/n.worldSize,t.y+=i.y/n.worldSize;const r=t.toLngLat(),o=Nd.convert(e.center||r);this._normalizeCenter(o),d=n.centerPoint.add(i),p=new y(t.x,t.y).mult(n.worldSize),f=new y(Gd(o.lng),qd(o.lat)).mult(n.worldSize).sub(p)}else{d=n.centerPoint.add(h);const t=n.pointLocation(d),i=Nd.convert(e.center||t);this._normalizeCenter(i),p=n.project(t),f=n.project(i).sub(p)}const m=n.zoomScale(a-i);let _,g;e.around&&(_=Nd.convert(e.around),g=n.locationPoint(_));const v=this._zooming||a!==i,x=this._rotating||r!==l,b=this._pitching||c!==o,w=!n.isPaddingEqual(u),T=n=>y=>{if(v&&(n.zoom=Yi(i,a,y)),x&&(n.bearing=Yi(r,l,y)),b&&(n.pitch=Yi(o,c,y)),w&&(n.interpolatePadding(s,u,y),d=n.centerPoint.add(h)),_)n.setLocationAtPoint(_,g);else{const e=n.zoomScale(n.zoom-i),t=a>i?Math.min(2,m):Math.max(.5,m),r=Math.pow(t,1-y),o=n.unproject(p.add(f.mult(y*r)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,d)}return e.preloadOnly||this._fireMoveEvents(t),n};if(e.preloadOnly){const t=this._emulate(T,e.duration,n);return this._preloadTiles(t),this}const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=e.easeId,this._prepareEase(t,e.noMoveStart,S),this._ease(T(n),(e=>{"sea"===n.cameraElevationReference&&n.recenterOnTerrain(),this._afterEase(t,e)}),e),this}_prepareEase(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),t||n.moving||this.fire(new Ct("movestart",e)),this._zooming&&!n.zooming&&this.fire(new Ct("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new Ct("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new Ct("pitchstart",e))}_fireMoveEvents(e){this.fire(new Ct("move",e)),this._zooming&&this.fire(new Ct("zoom",e)),this._rotating&&this.fire(new Ct("rotate",e)),this._pitching&&this.fire(new Ct("pitch",e))}_afterEase(e,t){if(this._easeId&&t&&this._easeId===t)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,i=this._rotating,r=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new Ct("zoomend",e)),i&&this.fire(new Ct("rotateend",e)),r&&this.fire(new Ct("pitchend",e)),this.fire(new Ct("moveend",e))}flyTo(e,t){if(this._prefersReducedMotion(e)){const n=O(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,t)}this.stop(),e=L({offset:[0,0],speed:1.2,curve:1.42,easing:M},e);const n=this.transform,i=this.getZoom(),r=this.getBearing(),o=this.getPitch(),s=this.getPadding(),a="zoom"in e?k(+e.zoom,n.minZoom,n.maxZoom):i,l="bearing"in e?this._normalizeBearing(e.bearing,r):r,c="pitch"in e?+e.pitch:o,u="padding"in e?e.padding:n.padding,h=n.zoomScale(a-i),d=y.convert(e.offset);let p=n.centerPoint.add(d);const f=n.pointLocation(p),m=Nd.convert(e.center||f);this._normalizeCenter(m);const _=n.project(f),g=n.project(m).sub(_);let v=e.curve;const x=Math.max(n.width,n.height),b=x/h,w=g.mag();if("minZoom"in e){const t=k(Math.min(e.minZoom,i,a),n.minZoom,n.maxZoom),r=x/n.zoomScale(t-i);v=Math.sqrt(r/w*2)}const T=v*v;function S(e){const t=(b*b-x*x+(e?-1:1)*T*T*w*w)/(2*(e?b:x)*T*w);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function C(e){return(Math.exp(e)+Math.exp(-e))/2}const A=S(0);let I=function(e){return C(A)/C(A+v*e)},P=function(e){return x*((C(A)*(E(t=A+v*e)/C(t))-E(A))/T)/w;var t},D=(S(1)-A)/v;if(Math.abs(w)<1e-6||!isFinite(D)){if(Math.abs(x-b)<1e-6)return this.easeTo(e,t);const n=b<x?-1:1;D=Math.abs(Math.log(b/x))/v,P=function(){return 0},I=function(e){return Math.exp(n*v*e)}}e.duration="duration"in e?+e.duration:1e3*D/("screenSpeed"in e?+e.screenSpeed/v:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const R=r!==l,z=c!==o,F=!n.isPaddingEqual(u),B=n=>h=>{const f=h*D,y=1/I(f);n.zoom=1===h?a:i+n.scaleZoom(y),R&&(n.bearing=Yi(r,l,h)),z&&(n.pitch=Yi(o,c,h)),F&&(n.interpolatePadding(s,u,h),p=n.centerPoint.add(d));const v=1===h?m:n.unproject(_.add(g.mult(P(f))).mult(y));return n.setLocationAtPoint(n.renderWorldCopies?v.wrap():v,p),n._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(t),n};if(e.preloadOnly){const t=this._emulate(B,e.duration,n);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=R,this._pitching=z,this._padding=F,this._prepareEase(t,!1),this._ease(B(n),(()=>this._afterEase(t)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this._easeStart=ut.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((ut.now()-this._easeStart)/this._easeOptions.duration,1),t=this._onEaseFrame;t&&t(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,t){e=D(e,-180,180);const n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.maxBounds)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&ut.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,t,n){const i=Math.ceil(15*t/1e3),r=[],o=e(n.clone());for(let s=0;s<=i;s++){const e=o(s/i);r.push(e.clone())}return r}}class WA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,V(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=ht("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ht("button","mapboxgl-ctrl-attrib-button",this._container),ht("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ht("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString("AttributionControl.".concat(t));e.setAttribute("aria-label",n),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const t=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.ACCESS_TOKEN}];if(e){const n=t.reduce(((e,n,i)=>(n.value&&(e+="".concat(n.key,"=").concat(n.value).concat(i<t.length-1?"&":"")),e)),"?");e.href="".concat(r.FEEDBACK_URL,"/").concat(n,"#").concat(YC(this._map,!0)),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,n)=>{for(let i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ZA{constructor(){V(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=ht("div","mapboxgl-ctrl");const t=ht("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class XA{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const i of n)if(i.id===e)return void(i.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function YA(e,t,n){if(e=new Nd(e.lng,e.lat),t){const i=new Nd(e.lng-360,e.lat),r=new Nd(e.lng+360,e.lat),o=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),s=n.locationPoint(e).distSqr(t),a=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(i).distSqr(t)<s&&(a||Math.abs(i.lng-n.center.lng)<o)?e=i:n.locationPoint(r).distSqr(t)<s&&(a||Math.abs(r.lng-n.center.lng)<o)&&(e=r)}for(;Math.abs(e.lng-n.center.lng)>180;){const t=n.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=n.width&&t.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const KA={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class QA extends It{constructor(e,n){if(super(),(e instanceof t.HTMLElement||n)&&(e=L({element:e},n)),V(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=y.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ht("div");const t=41,n=27,i=dt("svg",{display:"block",height:t*this._scale+"px",width:n*this._scale+"px",viewBox:"0 0 ".concat(n," ").concat(t)},this._element),r=dt("radialGradient",{id:"shadowGradient"},dt("defs",{},i));dt("stop",{offset:"10%","stop-opacity":.4},r),dt("stop",{offset:"100%","stop-opacity":.05},r),dt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},i),dt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},i),dt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},i),dt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},i),this._offset=y.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const i=this._element.classList;for(const t in KA)i.remove("mapboxgl-marker-anchor-".concat(t));i.add("mapboxgl-marker-anchor-".concat(this._anchor));const r=e&&e.className?e.className.trim().split(/\s+/):[];i.add(...r),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=Nd.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const n=e.unproject(t),i=e.getFreeCameraOptions();if(!i.position)return!1;const r=i.position.toLngLat();return r.distanceTo(n)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const t=this._pos;if(!t||t.x<0||t.x>e.transform.width||t.y<0||t.y>e.transform.height)return void this._clearFadeTimer();const n=e.unproject(t);let i;e._showingGlobe()&&Pd(e.transform,this._lngLat)?i=0:(i=1-e._queryFogOpacity(n),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(i*=this._occludedOpacity)),this._element.style.opacity="".concat(i),this._element.style.pointerEvents=i>0?"auto":"none",this._popup&&this._popup._setOpacity(i),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(e.x,"px,").concat(e.y,"px)\n            ").concat(KA[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(t.x,"px,").concat(t.y,"px)\n        ")}_calculateXYTransform(){const e=this._pos,t=this._map,n=this.getPitchAlignment();if(!t||!e||"map"!==n)return"";if(!t._showingGlobe()){const e=t.getPitch();return e?"rotateX(".concat(e,"deg)"):""}const i=T(kd(t.transform,this._lngLat)),r=e.sub(Md(t.transform)),o=Math.abs(r.x)+Math.abs(r.y);if(0===o)return"";const s=i/o;return"rotateX(".concat(-r.y*s,"deg) rotateY(").concat(r.x*s,"deg)")}_calculateZTransform(){const e=this._pos,t=this._map;if(!t||!e)return"";let n=0;const i=this.getRotationAlignment();if("map"===i)if(t._showingGlobe()){const e=t.project(new Nd(this._lngLat.lng,this._lngLat.lat+.001)),i=t.project(new Nd(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);n=T(Math.atan2(i.y,i.x))-90}else n=-t.getBearing();else if("horizon"===i){const i=P(4,6,t.getZoom()),r=Md(t.transform);r.y+=i*t.transform.height;const o=e.sub(r),s=T(Math.atan2(o.y,o.x));n=(s>90?s-270:s+90)*(1-i)}return n+=this._rotation,n?"rotateZ(".concat(n,"deg)"):""}_update(e){t.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=YA(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),!0===e?this._updateFrameId=t.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),n._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=y.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){const t=this._map;if(!t)return;const n=this._pointerdownPos,i=this._positionDelta;if(n&&i){if(!this._isDragging){const i=this._clickTolerance||t._clickTolerance;if(e.point.dist(n)<i)return;this._isDragging=!0}this._pos=e.point.sub(i),this._lngLat=t.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Ct("dragstart"))),this.fire(new Ct("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new Ct("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,n=this._pos;t&&n&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(n),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const JA={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},$A=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function eI(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y(0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new y(0,e);case"top-left":return new y(n,n);case"top-right":return new y(-n,n);case"bottom":return new y(0,-e);case"bottom-left":return new y(n,-n);case"bottom-right":return new y(-n,-n);case"left":return new y(e,0);case"right":return new y(-e,0)}return new y(0,0)}return e instanceof y||Array.isArray(e)?y.convert(e):y.convert(e[t]||[0,0])}class tI{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const t=E((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-t)+this._end*t}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}const nI={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},iI={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},rI={showCompass:!0,showZoom:!0,visualizePitch:!1};class oI{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=t,this.mouseRotate=new gA({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new yA({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),V(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),t.addEventListener("mousedown",this.mousedown),t.addEventListener("touchstart",this.touchstart,{passive:!1}),t.addEventListener("touchmove",this.touchmove),t.addEventListener("touchend",this.touchend),t.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),_t()}move(e,t){const n=this.map,i=this.mouseRotate.mousemoveWindow(e,t),r=i&&i.bearingDelta;if(r&&n.setBearing(n.getBearing()+r),this.mousePitch){const i=this.mousePitch.mousemoveWindow(e,t),r=i&&i.pitchDelta;r&&n.setPitch(n.getPitch()+r)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){gt(),t.removeEventListener("mousemove",this.mousemove),t.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(L({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),xt(this.element,e)),t.addEventListener("mousemove",this.mousemove),t.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,xt(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=bt(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=bt(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const sI={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},aI={maxWidth:100,unit:"metric"},lI={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},cI={version:n,supported:it,setRTLTextPlugin:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ws===Vs||Ws===Gs||Ws===qs)throw new Error("setRTLTextPlugin cannot be called multiple times.");Zs=ut.resolveURL(e),Ws=Vs,Hs=t,Ys(),n||Js()},getRTLTextPluginStatus:Qs,Map:class extends HA{constructor(e){if($e.mark(Je.create),null!=(e=L({},iI,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==te){const t=e.navigator?e.navigator.userAgent:null;te=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return te}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(t)&&(e.antialias=!1,X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mx(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new XA,this._domRenderTaskQueue=new XA,this._controls=[],this._markers=[],this._popups=[],this._mapId=B(),this._locale=L({},nI,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new tI(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new ke(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=t.document.getElementById(e.container),!this._container)throw new Error("Container '".concat(e.container.toString(),"' not found."))}else{if(!(e.container instanceof t.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),V(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==t&&(this._fullscreenchangeEvent="onfullscreenchange"in t.document?"fullscreenchange":"webkitfullscreenchange",t.addEventListener("online",this._onWindowOnline,!1),t.addEventListener("resize",this._onWindowResize,!1),t.addEventListener("orientationchange",this._onWindowResize,!1),t.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),t.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new GA(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||r.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new XC("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const t=e.bounds;t&&(this.resize(),this.fitBounds(t,L({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new WA({customAttribution:e.customAttribution})),this._logoControl=new ZA,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new Ct("".concat(e.dataType,"data"),e))})),this.on("dataloading",(e=>{this.fire(new Ct("".concat(e.dataType,"dataloading"),e))}))}_getMapId(){return this._mapId}addControl(e,t){if(void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new At(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const i=this._controlPositions[t];return-1!==t.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new At(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new Ct("movestart",e)).fire(new Ct("move",e)),this.fire(new Ct("resize",e)),t&&this.fire(new Ct("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds($l.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Ct("zoomstart")).fire(new Ct("zoom")).fire(new Ct("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Ct("zoomstart")).fire(new Ct("zoom")).fire(new Ct("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Ct("pitchstart")).fire(new Ct("pitch")).fire(new Ct("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Ct("pitchstart")).fire(new Ct("pitch")).fire(new Ct("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?t.navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?t.navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.clearSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.clearSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,t=e.projection.name;let n;"globe"===t&&e.zoom>=Yh?(e.setMercatorFromTransition(),n=!0):"mercator"===t&&e.zoom<Yh&&(e.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t="globe"===e.name&&this.transform.zoom>=Yh?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(Nd.convert(e))}unproject(e){return this.transform.pointLocation3D(y.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let i=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e))),s=o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];s.length?i||(i=!0,n.call(this,new rA(e,this,r.originalEvent,{features:s}))):i=!1},o=()=>{i=!1};return{layers:new Set(t),listener:n,delegates:{mousemove:r,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e)));(o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?i=!0:i&&(i=!1,n.call(this,new rA(e,this,r.originalEvent)))},o=t=>{i&&(i=!1,n.call(this,new rA(e,this,t.originalEvent)))};return{layers:new Set(t),listener:n,delegates:{mousemove:r,mouseout:o}}}{const i=e=>{const i=t.filter((e=>this.getLayer(e))),r=i.length?this.queryRenderedFeatures(e.point,{layers:i}):[];r.length&&(e.features=r,n.call(this,e),delete e.features)};return{layers:new Set(t),listener:n,delegates:{[e]:i}}}}on(e,t,n){if(void 0===n)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const r of t)if(!this._isValidId(r))return this;const i=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const r in i.delegates)this.on(r,i.delegates[r]);return this}once(e,t,n){if(void 0===n)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const r of t)if(!this._isValidId(r))return this;const i=this._createDelegatedListener(e,t,n);for(const r in i.delegates)this.once(r,i.delegates[r]);return this}off(e,t,n){if(void 0===n)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const o of t)if(!this._isValidId(o))return this;const i=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const o=e[r];if(o.listener===n&&i(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(void 0!==t||void 0===e||e instanceof y||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const n of t.layers)if(!this._isValidId(n))return[];return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&X("".concat(t," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(y.convert(e))}setStyle(e,t){return!1!==(t=L({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new WC(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new WC(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if("string"==typeof e){const n=this._requestManager.normalizeStyleURL(e),i=this._requestManager.transformRequest(n,ye.Style);we(i,((e,n)=>{e?this.fire(new At(e)):n&&this._updateDiff(n,t)}))}else"object"==typeof e&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(n){X("Unable to perform style diff: ".concat(n.message||n.error||n,".  Rebuilding the style from scratch.")),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(X("There is no style added to the map."),!1)}_isValidId(e){return!function(e){return e.indexOf("\x1f")>=0}(e)||(this.fire(new At(new Error("IDs can't contain special symbols: \"".concat(e,'".')))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,n){let{pixelRatio:i=1,sdf:r=!1,stretchX:o,stretchY:s,content:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._lazyInitEmptyStyle(),n instanceof t.HTMLImageElement||t.ImageBitmap&&n instanceof t.ImageBitmap){const{width:t,height:l,data:c}=ut.getImageData(n);this.style.addImage(e,{data:new Wp({width:t,height:l},c),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new At(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:t,height:l}=n,c=n;this.style.addImage(e,{data:new Wp({width:t,height:l},new Uint8Array(c.data)),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}}updateImage(e,n){this._lazyInitEmptyStyle();const i=this.style.getImage(e);if(!i)return void this.fire(new At(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof t.HTMLImageElement||t.ImageBitmap&&n instanceof t.ImageBitmap?ut.getImageData(n):n,{width:o,height:s}=r;void 0!==o&&void 0!==s?o===i.data.width&&s===i.data.height?(i.data.replace(r.data,!(n instanceof t.HTMLImageElement||t.ImageBitmap&&n instanceof t.ImageBitmap)),this.style.updateImage(e,i)):this.fire(new At(new Error("The width and height of the updated image (".concat(o,", ").concat(s,")\n                must be that same as the previous version of the image\n                (").concat(i.data.width,", ").concat(i.data.height,")")))):this.fire(new At(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new At(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,n){Ie(this._requestManager.transformRequest(e,ye.Image),((e,i)=>{n(e,i instanceof t.HTMLImageElement?ut.getImageData(i):i)}))}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new At(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,i),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,i),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(Nd.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let i,r,o,s=this._container;for(;s&&(!r||!o);){const e=t.getComputedStyle(s).transform;e&&"none"!==e&&(i=e.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(r=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(o=i[3])),s=s.parentElement}this._containerWidth=r?Math.abs(e/r):e,this._containerHeight=o?Math.abs(n/o):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=ht("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ht("div","mapboxgl-canvas-container",e);this._canvas=ht("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=ht("div","mapboxgl-control-container",e),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{i[e]=ht("div","mapboxgl-ctrl-".concat(e),n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){const n=ut.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(t),this._canvas.style.width="".concat(e,"px"),this._canvas.style.height="".concat(t,"px")}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const e=L({},it.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(Qe(t,!0),this.painter=new kC(t,this.transform),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),o.testSupport(t)):this.fire(new At(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Ct("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Ct("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let n;this.fire(new Ct("renderstart"));const i=this.painter.context.extTimerQuery,r=ut.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=o.createQuery(),o.beginQuery(i.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],t.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],t.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,t=this.transform.pitch,n=ut.now(),i=new ea(e,{now:n,fadeDuration:s,pitch:t,transition:this.style.transition});this.style.update(i)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(r),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Ct("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Ct("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const e=ut.now()-r;o.endQuery(i.TIME_ELAPSED_EXT),setTimeout((()=>{const i=o.getQueryParameter(n,o.QUERY_RESULT)/1e6;o.deleteQuery(n),this.fire(new Ct("gpu-timing-frame",{cpuTime:e,gpuTime:i})),t.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:i}})}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const t=this.painter.queryGpuTimers(e);this.fire(new Ct("gpu-timing-layer",{layerTimes:t}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const t=this.painter.queryGpuTimeDeferredRender(e);this.fire(new Ct("gpu-timing-deferred-render",{gpuTime:t}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new Ct("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new Ct("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,$e.mark(Je.fullLoad),this._performanceMetricsCollection&&Ze(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let r=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-r);if(o>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(r),n(r);this._averageElevation.easeTo(r,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(r),n(r)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){Ye(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(e=>{if(e&&(e.message===Me||401===e.status)){const e=this.painter.context.gl;Qe(e,!1),this._logoControl instanceof ZA&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new At(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),He(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function r(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,n){let i=n[1]-n[0];const r=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);i+=(n[o+2]-n[o+1])*(1-a/r)}return i}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==t&&(t.removeEventListener("resize",this._onWindowResize,!1),t.removeEventListener("orientationchange",this._onWindowResize,!1),t.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),t.removeEventListener("online",this._onWindowOnline,!1),t.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ke.delete(this.painter.context.gl),this._removed=!0,this.fire(new Ct("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=ut.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(e){return R(this.style?Object.values(this.style._sourceCaches):[],((t,n)=>t._preloadTiles(e,n)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===t.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){!function(e,t){he=e,de=t}(e,t)}get version(){return n}},NavigationControl:class{constructor(e){this.options=L({},rI,e),this._container=ht("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(V(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),ht("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),ht("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(V(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=ht("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),i=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(e.transform.pitch,"deg) rotateZ(").concat(e.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(e.transform.angle*(180/Math.PI),"deg)");e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new oI(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=ht("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends It{constructor(e){super(),this.options=L({geolocation:t.navigator.geolocation},sI,e),V(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ZC(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=ht("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var n=this;const i=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!n.options.geolocation;n._supportsGeolocation=t,e(t)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==t.navigator.permissions?t.navigator.permissions.query({name:"geolocation"}).then((e=>i("denied"!==e.state))).catch((()=>i())):i()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new Ct("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Ct("geolocate",e)),this._finish()}}_updateCamera(e){const t=new Nd(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,i=L({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),i,{geolocateSource:!0})}_updateMarker(e){if(e){const t=new Nd(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,t=Hd(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width="".concat(n,"px"),this._circleElement.style.height="".concat(n,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Ct("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=ht("button","mapboxgl-ctrl-geolocate",this._container),ht("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){X("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ht("div","mapboxgl-user-location"),this._dotElement.appendChild(ht("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ht("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new QA({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ht("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new QA({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Ct("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Ct("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Ct("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Ct("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{t.addEventListener("ondeviceorientationabsolute"in t?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==t.DeviceMotionEvent&&"function"==typeof t.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),t.removeEventListener("deviceorientation",this._onDeviceOrientation),t.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:WA,ScaleControl:class{constructor(e){this.options=L({},aI,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),V(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,i=t._containerWidth/2-e/2,r=t.unproject([i,n]),o=t.unproject([i+e,n]),s=r.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*s;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,n){this._map._requestDomTask((()=>{const i=function(e){const t=Math.pow(10,"".concat(Math.floor(e)).length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(t),r=i/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):"".concat(i,"&nbsp;").concat(lI[n]),this._container.style.width=e*r+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=ht("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.HTMLElement?this._container=e.container:X("Full screen control 'container' must be a DOM element.")),V(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=ht("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.document.fullscreenEnabled&&!t.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=ht("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ht("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.document.fullscreenElement||t.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.document.exitFullscreen?t.document.exitFullscreen():t.document.webkitCancelFullScreen&&t.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends It{constructor(e){super(),this.options=L(Object.create(JA),e),V(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Ct("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Ct("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=Nd.convert(e),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.document.createTextNode(e))}setHTML(e){const n=t.document.createDocumentFragment(),i=t.document.createElement("body");let r;for(i.innerHTML=e;r=i.firstChild,r;)n.appendChild(r);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ht("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=ht("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,i=this._pos;if(!t||!n||!i)return"bottom";const r=n.offsetWidth,o=n.offsetHeight,s=i.x<r/2,a=i.x>t.transform.width-r/2;if(i.y+e<o)return s?"top-left":a?"top-right":"top";if(i.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let i=this._container;if(i||(i=this._container=ht("div","mapboxgl-popup",t.getContainer()),this._tip=ht("div","mapboxgl-popup-tip",i),i.appendChild(n)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=YA(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){const n=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),i=eI(this.options.offset),r=this._anchor=this._getAnchor(i.y),o=eI(this.options.offset,r),s=n.add(o).round();t._requestDomTask((()=>{this._container&&r&&(this._container.style.transform="".concat(KA[r]," translate(").concat(s.x,"px,").concat(s.y,"px)"))}))}if(!this._marker&&t._showingGlobe()){const e=Pd(t.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector($A);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:QA,Style:WC,LngLat:Nd,LngLatBounds:$l,Point:y,MercatorCoordinate:ep,FreeCameraOptions:Uv,Evented:It,config:r,prewarm:function(){jw().acquire(Fw)},clearPrewarmedResources:function(){const e=Nw;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Fw),Nw=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return r.ACCESS_TOKEN},set accessToken(e){r.ACCESS_TOKEN=e},get baseApiUrl(){return r.API_URL},set baseApiUrl(e){r.API_URL=e},get workerCount(){return Bw.workerCount},set workerCount(e){Bw.workerCount=e},get maxParallelImageRequests(){return r.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){r.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){!function(e){if(!pe())return;const n=t.caches.delete(le);e&&n.catch(e).then((()=>e()))}(e)},workerUrl:"",workerClass:null,get dracoUrl(){return Hw()},set dracoUrl(e){!function(e){Vw=ut.resolveURL(e),qw||(qw=new _w(jw(),new It)),qw.broadcast("setDracoUrl",Vw)}(e)},setNow:ut.setNow,restoreNow:ut.restoreNow};e.A=mw,e.D=Vm,e.E=ai,e.F=Hm,e.K=dS,e.O=Fh,e.P=y,e.T=Fx,e.V=nm,e.a=Gf,e.b=sm,e.c=Qb,e.d=class extends It{constructor(e,t,n,i,r,o){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=r||Dw,this.loading={},this.loaded={},this.deduped=new Pw(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler,this.brightness=o}loadTile(e,t){const n=e.uid,i=e&&e.request,r=i&&i.collectResourceTiming,o=this.loading[n]=new Mw(e);o.abort=this.loadVectorData(e,((s,a)=>{const l=!this.loading[n];if(delete this.loading[n],l||s||!a)return o.status="done",l||(this.loaded[n]=o),t(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new tm(new Am(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,n)=>{if(e||!n)return t(e);const o={};if(r){const e=nt(i);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,L({rawTileData:c.slice(0)},n,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[n]=o}))}reloadTile(e,t){const n=this.loaded,i=e.uid,r=this;if(n&&n[i]){const o=n[i];o.showCollisionBoxes=e.showCollisionBoxes,o.projection=e.projection,o.brightness=e.brightness,o.tileTransform=Tg(e.tileID.canonical,e.projection),o.extraShadowCaster=e.extraShadowCaster;const s=(e,n)=>{const i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,i)),t(e,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}},e.e=vo,e.f=nt,e.g=d,e.h=we,e.i=Te,e.j=function(e,t){const n=_T(e);for(const i of n){for(const e of i.meshes)gT(e);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(yT(i.lights,t)))}return n},e.k=ea,e.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==eT){const n=new Uint32Array(e,0,7),[,,i,r,o,s]=n;t=n.byteLength+r+o+s+o,(i!==e.byteLength||t>=e.byteLength)&&X("Invalid b3dm header information.")}return sT(e,t)},e.m=Zg,e.n=$s,e.o=Ct,e.p=_,e.q=function(e){fe(),ce&&ce.then((t=>{t.keys().then((n=>{for(let i=0;i<n.length-e;i++)t.delete(n[i])}))}))},e.r=CT,e.s=cI,e.t=$d,e.v=z,e.w=t})),i(["./shared"],(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let n="[";for(const i of e)n+="".concat(t(i),",");return"".concat(n,"]")}let n="{";for(const i of Object.keys(e).sort())n+="".concat(i,":").concat(t(e[i]),",");return"".concat(n,"}")}function n(n){let i="";for(const r of e.r)i+="/".concat(t(n[r]));return i}class i{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,i,r){this._options=r;for(const n of t){this._layerConfigs[n.id]=n;const t=this._layers[n.id]=e.c(n,this._options);t.setScope(this.scope),t.compileFilter(),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const o=function(e,t){const i={};for(let o=0;o<e.length;o++){const r=t&&t[e[o].id]||n(e[o]);t&&(t[e[o].id]=r);let s=i[r];s||(s=i[r]=[]),s.push(e[o])}const r=[];for(const n in i)r.push(i[n]);return r}(e.v(this._layerConfigs),this.keyCache);for(const e of o){const t=e.map((e=>this._layers[e.id])),n=t[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(t)}}}class r{loadTile(t,n){const{uid:i,encoding:r,rawImageData:o,padding:s}=t,a=e.w.ImageBitmap&&o instanceof e.w.ImageBitmap?this.getImageData(o,s):o;n(null,new e.D(i,a,r,t.convertToFloat,s<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}function o(e,t){if(0!==e.length){s(e[0],t);for(var n=1;n<e.length;n++)s(e[n],!t)}}function s(e,t){for(var n=0,i=0,r=0,o=e.length,s=o-1;r<o;s=r++){var a=(e[r][0]-e[s][0])*(e[s][1]+e[r][1]),l=n+a;i+=Math.abs(n)>=Math.abs(a)?n-l+a:a-l+n,n=l}n+i>=0!=!!t&&e.reverse()}var a=e.g((function e(t,n){var i,r=t&&t.type;if("FeatureCollection"===r)for(i=0;i<t.features.length;i++)e(t.features[i],n);else if("GeometryCollection"===r)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],n);else if("Feature"===r)e(t.geometry,n);else if("Polygon"===r)o(t.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<t.coordinates.length;i++)o(t.coordinates[i],n);return t}));const l=e.V.prototype.toGeoJSON;var c={exports:{}},u=e.p,h=e.a.VectorTileFeature,d=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function f(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new f(this.features[e],this.options.extent)},f.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var n=e[t],i=[],r=0;r<n.length;r++)i.push(new u(n[r][0],n[r][1]));this.geometry.push(i)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[t,i,n,r]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=e.b,_=d;function g(e){var t=new m;return function(e,t){for(var n in e.layers)t.writeMessage(3,y,e.layers[n])}(e,t),t.finish()}function y(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)i.feature=e.feature(n),t.writeMessage(2,v,i);var r=i.keys;for(n=0;n<r.length;n++)t.writeStringField(3,r[n]);var o=i.values;for(n=0;n<o.length;n++)t.writeMessage(4,S,o[n])}function v(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,x,e),t.writeVarintField(3,n.type),t.writeMessage(4,T,n)}function x(e,t){var n=e.feature,i=e.keys,r=e.values,o=e.keycache,s=e.valuecache;for(var a in n.properties){var l=n.properties[a],c=o[a];if(null!==l){void 0===c&&(i.push(a),o[a]=c=i.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(r.push(l),s[h]=d=r.length-1),t.writeVarint(d)}}}function b(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function T(e,t){for(var n=e.loadGeometry(),i=e.type,r=0,o=0,s=n.length,a=0;a<s;a++){var l=n[a],c=1;1===i&&(c=l.length),t.writeVarint(b(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&t.writeVarint(b(2,u-1));var d=l[h].x-r,p=l[h].y-o;t.writeVarint(w(d)),t.writeVarint(w(p)),r+=d,o+=p}3===i&&t.writeVarint(b(7,1))}}function S(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}c.exports=g,c.exports.fromVectorTileJs=g,c.exports.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var i in e)n[i]=new _(e[i].features,t),n[i].name=i,n[i].version=t.version,n[i].extent=t.extent;return g({layers:n})},c.exports.GeoJSONWrapper=_;var E=e.g(c.exports);const C={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},A=Math.fround||(I=new Float32Array(1),e=>(I[0]=+e,I[0]));var I;const M=3,k=5,P=6;class D{constructor(e){this.options=Object.assign(Object.create(C),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const r="prepare ".concat(e.length," points");t&&console.time(r),this.points=e;const o=[];for(let a=0;a<e.length;a++){const t=e[a];if(!t.geometry)continue;const[n,i]=t.geometry.coordinates,r=A(L(n)),s=A(O(i));o.push(r,s,1/0,a,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(r);for(let a=i;a>=n;a--){const e=+Date.now();s=this.trees[a]=this._createTree(this._cluster(s,a)),t&&console.log("z%d: %d clusters in %dms",a,s.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),s=this.getClusters([-180,i,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(L(n),O(o),L(r),O(i)),l=s.data,c=[];for(const u of a){const e=this.stride*u;c.push(l[e+k]>1?R(l,e,this.clusterProps):this.points[l[e+M]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.data;if(t*this.stride>=o.length)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=r.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const c of a){const t=c*this.stride;o[t+4]===e&&l.push(o[t+k]>1?R(o,t,this.clusterProps):this.points[o[t+M]])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((t-a)/r,l,(t+1+a)/r,c),i.data,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.data,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const s of o){const t=s.properties;if(t&&t.cluster?r+t.point_count<=i?r+=t.point_count:r=this._appendLeaves(e,t.cluster_id,n,i,r):r<i?r++:e.push(s),e.length===n)break}return r}_createTree(t){const n=new e.K(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,i,r,o){for(const s of e){const e=s*this.stride,a=t[e+k]>1;let l,c,u;if(a)l=z(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+M]];l=n.properties;const[i,r]=n.geometry.coordinates;c=L(i),u=O(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=a||this.options.generateId?t[e+M]:this.points[t[e+M]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:r,minPoints:o}=this.options,s=n/(i*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let u=0;u<a.length;u+=c){if(a[u+2]<=t)continue;a[u+2]=t;const n=a[u],i=a[u+1],h=e.within(a[u],a[u+1],s),d=a[u+k];let p=d;for(const e of h){const n=e*c;a[n+2]>t&&(p+=a[n+k])}if(p>d&&p>=o){let e,o=n*d,s=i*d,f=-1;const m=((u/c|0)<<5)+(t+1)+this.points.length;for(const n of h){const i=n*c;if(a[i+2]<=t)continue;a[i+2]=t;const l=a[i+k];o+=a[i]*l,s+=a[i+1]*l,a[i+4]=m,r&&(e||(e=this._map(a,u,!0),f=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(a,i)))}a[u+4]=m,l.push(o/p,s/p,1/0,m,-1,p),r&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[u+e]);if(p>1)for(const e of h){const n=e*c;if(!(a[n+2]<=t)){a[n+2]=t;for(let e=0;e<c;e++)l.push(a[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+k]>1){const i=this.clusterProps[e[t+P]];return n?Object.assign({},i):i}const i=this.points[e[t+M]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function R(e,t,n){return{type:"Feature",id:e[t+M],properties:z(e,t,n),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),F(e[t+1])]}};var i}function z(e,t,n){const i=e[t+k],r=i>=1e4?"".concat(Math.round(i/1e3),"k"):i>=1e3?Math.round(i/100)/10+"k":i,o=e[t+P],s=-1===o?{}:Object.assign({},n[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+M],point_count:i,point_count_abbreviated:r})}function L(e){return e/360+.5}function O(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function F(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}var B={exports:{}};B.exports=function(){function e(n,i,r,o){for(var s,a=o,l=r-i>>1,c=r-i,u=n[i],h=n[i+1],d=n[r],p=n[r+1],f=i+3;f<r;f+=3){var m=t(n[f],n[f+1],u,h,d,p);if(m>a)s=f,a=m;else if(m===a){var _=Math.abs(f-l);_<c&&(s=f,c=_)}}a>o&&(s-i>3&&e(n,i,s,o),n[s+2]=a,r-s>3&&e(n,s,r,o))}function t(e,t,n,i,r,o){var s=r-n,a=o-i;if(0!==s||0!==a){var l=((e-n)*s+(t-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return(s=e-n)*s+(a=t-i)*a}function n(e,t,n,r){var o={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)i(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)i(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++)i(e,t[r][o])}(o),o}function i(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function r(e,t,i,l){if(t.geometry){var c=t.geometry.coordinates,u=t.geometry.type,h=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),d=[],p=t.id;if(i.promoteId?p=t.properties[i.promoteId]:i.generateId&&(p=l||0),"Point"===u)o(c,d);else if("MultiPoint"===u)for(var f=0;f<c.length;f++)o(c[f],d);else if("LineString"===u)s(c,d,h,!1);else if("MultiLineString"===u){if(i.lineMetrics){for(f=0;f<c.length;f++)s(c[f],d=[],h,!1),e.push(n(p,"LineString",d,t.properties));return}a(c,d,h,!1)}else if("Polygon"===u)a(c,d,h,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(f=0;f<t.geometry.geometries.length;f++)r(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},i,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];a(c[f],m,h,!0),d.push(m)}}e.push(n(p,u,d,t.properties))}}function o(e,t){t.push(l(e[0])),t.push(c(e[1])),t.push(0)}function s(t,n,i,r){for(var o,s,a=0,u=0;u<t.length;u++){var h=l(t[u][0]),d=c(t[u][1]);n.push(h),n.push(d),n.push(0),u>0&&(a+=r?(o*d-h*s)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(d-s,2))),o=h,s=d}var p=n.length-3;n[2]=1,e(n,0,p,i),n[p+2]=1,n.size=Math.abs(a),n.start=0,n.end=n.size}function a(e,t,n,i){for(var r=0;r<e.length;r++){var o=[];s(e[r],o,n,i),t.push(o)}}function l(e){return e/360+.5}function c(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function u(e,t,i,r,o,s,a,l){if(r/=t,s>=(i/=t)&&a<r)return e;if(a<i||s>=r)return null;for(var c=[],u=0;u<e.length;u++){var p=e[u],m=p.geometry,_=p.type,g=0===o?p.minX:p.minY,y=0===o?p.maxX:p.maxY;if(g>=i&&y<r)c.push(p);else if(!(y<i||g>=r)){var v=[];if("Point"===_||"MultiPoint"===_)h(m,v,i,r,o);else if("LineString"===_)d(m,v,i,r,o,!1,l.lineMetrics);else if("MultiLineString"===_)f(m,v,i,r,o,!1);else if("Polygon"===_)f(m,v,i,r,o,!0);else if("MultiPolygon"===_)for(var x=0;x<m.length;x++){var b=[];f(m[x],b,i,r,o,!0),b.length&&v.push(b)}if(v.length){if(l.lineMetrics&&"LineString"===_){for(x=0;x<v.length;x++)c.push(n(p.id,_,v[x],p.tags));continue}"LineString"!==_&&"MultiLineString"!==_||(1===v.length?(_="LineString",v=v[0]):_="MultiLineString"),"Point"!==_&&"MultiPoint"!==_||(_=3===v.length?"Point":"MultiPoint"),c.push(n(p.id,_,v,p.tags))}}}return c.length?c:null}function h(e,t,n,i,r){for(var o=0;o<e.length;o+=3){var s=e[o+r];s>=n&&s<=i&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function d(e,t,n,i,r,o,s){for(var a,l,c=p(e),u=0===r?_:g,h=e.start,d=0;d<e.length-3;d+=3){var f=e[d],y=e[d+1],v=e[d+2],x=e[d+3],b=e[d+4],w=0===r?f:y,T=0===r?x:b,S=!1;s&&(a=Math.sqrt(Math.pow(f-x,2)+Math.pow(y-b,2))),w<n?T>n&&(l=u(c,f,y,x,b,n),s&&(c.start=h+a*l)):w>i?T<i&&(l=u(c,f,y,x,b,i),s&&(c.start=h+a*l)):m(c,f,y,v),T<n&&w>=n&&(l=u(c,f,y,x,b,n),S=!0),T>i&&w<=i&&(l=u(c,f,y,x,b,i),S=!0),!o&&S&&(s&&(c.end=h+a*l),t.push(c),c=p(e)),s&&(h+=a)}var E=e.length-3;f=e[E],y=e[E+1],v=e[E+2],(w=0===r?f:y)>=n&&w<=i&&m(c,f,y,v),E=c.length-3,o&&E>=3&&(c[E]!==c[0]||c[E+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&t.push(c)}function p(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function f(e,t,n,i,r,o){for(var s=0;s<e.length;s++)d(e[s],t,n,i,r,o,!1)}function m(e,t,n,i){e.push(t),e.push(n),e.push(i)}function _(e,t,n,i,r,o){var s=(o-t)/(i-t);return e.push(o),e.push(n+(r-n)*s),e.push(1),s}function g(e,t,n,i,r,o){var s=(o-n)/(r-n);return e.push(t+(i-t)*s),e.push(o),e.push(1),s}function y(e,t){for(var i=[],r=0;r<e.length;r++){var o,s=e[r],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=v(s.geometry,t);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var l=0;l<s.geometry.length;l++)o.push(v(s.geometry[l],t))}else if("MultiPolygon"===a)for(o=[],l=0;l<s.geometry.length;l++){for(var c=[],u=0;u<s.geometry[l].length;u++)c.push(v(s.geometry[l][u],t));o.push(c)}i.push(n(s.id,a,o,s.tags))}return i}function v(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function x(e,t){if(e.transformed)return e;var n,i,r,o=1<<e.z,s=e.x,a=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(b(c[i],c[i+1],t,o,s,a));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(b(c[i][r],c[i][r+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function b(e,t,n,i,r,o){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-o))]}function w(e,t,n,i,r){for(var o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,T(s,e[a],o,r);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function T(e,t,n,i){var r=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)S(s,r,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<r.length;a++)S(s,r[a],e,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)S(s,c[a],e,n,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function S(e,t,n,i,r,o){var s=i*i;if(i>0&&t.size<(r?s:i))n.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>s)&&(n.numSimplified++,a.push(t[l]),a.push(t[l+1])),n.numPoints++;r&&function(e,t){for(var n=0,i=0,r=e.length,o=r-2;i<r;o=i,i+=2)n+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(n>0===t)for(i=0,r=e.length;i<r/2;i+=2){var s=e[i],a=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=s,e[r-1-i]=a}}(a,o),e.push(a)}}function E(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)r(n,e.features[i],t,i);else r(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(e,t){var n=t.buffer/t.extent,i=e,r=u(e,1,-1-n,n,0,-1,2,t),o=u(e,1,1-n,2+n,0,-1,2,t);return(r||o)&&(i=u(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=y(r,1).concat(i)),o&&(i=i.concat(y(o,-1)))),i}(i,t)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function C(e,t,n){return 32*((1<<e)*n+t)+e}return E.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},E.prototype.splitTile=function(e,t,n,i,r,o,s){for(var a=[e,t,n,i],l=this.options,c=l.debug;a.length;){i=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var h=1<<t,d=C(t,n,i),p=this.tiles[d];if(!p&&(c>1&&console.time("creation"),p=this.tiles[d]=w(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,r){if(t===l.maxZoom||t===r)continue;var m=1<<r-t;if(n!==Math.floor(o/m)||i!==Math.floor(s/m))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time("clipping");var _,g,y,v,x,b,T=.5*l.buffer/l.extent,S=.5-T,E=.5+T,A=1+T;_=g=y=v=null,x=u(e,h,n-T,n+E,0,p.minX,p.maxX,l),b=u(e,h,n+S,n+A,0,p.minX,p.maxX,l),e=null,x&&(_=u(x,h,i-T,i+E,1,p.minY,p.maxY,l),g=u(x,h,i+S,i+A,1,p.minY,p.maxY,l),x=null),b&&(y=u(b,h,i-T,i+E,1,p.minY,p.maxY,l),v=u(b,h,i+S,i+A,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(_||[],t+1,2*n,2*i),a.push(g||[],t+1,2*n,2*i+1),a.push(y||[],t+1,2*n+1,2*i),a.push(v||[],t+1,2*n+1,2*i+1)}}},E.prototype.getTile=function(e,t,n){var i=this.options,r=i.extent,o=i.debug;if(e<0||e>24)return null;var s=1<<e,a=C(e,t=(t%s+s)%s,n);if(this.tiles[a])return x(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,c=e,u=t,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[C(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?x(this.tiles[a],r):null):null},function(e,t){return new E(e,t)}}();var N=e.g(B.exports);function j(t,n){const i=t.tileID.canonical;if(!this._geoJSONIndex)return n(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return n(null,null);const o=new class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.E,this.length=t.length,this._features=t}feature(t){return new class{constructor(t){this._feature=t,this.extent=e.E,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.P(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const i=[];for(const t of n)i.push(new e.P(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,n){return l.call(this,e,t,n)}}(this._features[t])}}(r.features);let s=E(o);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),n(null,{vectorTile:o,rawData:s.buffer})}class U extends e.d{constructor(e,t,n,i,r,o){super(e,t,n,i,j,o),r&&(this.loadGeoJSON=r)}loadData(t,n){const i=t&&t.request,r=i&&i.collectResourceTiming;this.loadGeoJSON(t,((o,s)=>{if(o||!s)return n(o);if("object"!=typeof s)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));{a(s,!0);try{if(t.filter){const n=e.e(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));const i=s.features.filter((e=>n.value.evaluate({zoom:0},e)));s={type:"FeatureCollection",features:i}}this._geoJSONIndex=t.cluster?new D(function(t){let{superclusterOptions:n,clusterProperties:i}=t;if(!i||!n)return n;const r={},o={},s={accumulated:null,zoom:0},a={properties:null},l=Object.keys(i);for(const c of l){const[t,n]=i[c],s=e.e(n),a=e.e("string"==typeof t?[t,["accumulated"],["get",c]]:t);r[c]=s.value,o[c]=a.value}return n.map=e=>{a.properties=e;const t={};for(const n of l)t[n]=r[n].evaluate(s,a);return t},n.reduce=(e,t)=>{a.properties=t;for(const n of l)s.accumulated=e[n],e[n]=o[n].evaluate(s,a)},n}(t)).load(s.features):N(s,t.geojsonVtOptions)}catch(o){return n(o)}this.loaded={};const l={};if(r){const n=e.f(i);n&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(n)))}n(null,l)}}))}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,n){if(t.request)e.h(t.request,n);else{if("string"!=typeof t.data)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class V{constructor(t,n){this.tileID=new e.O(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=n}parse(t,n,i,r){this.status="parsing";const o=new e.O(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),s={},a=n.familiesBySource[i.source],l=new e.F(o,i.promoteId);return l.bucketLayerIDs=[],e.l(t).then((t=>{if(!t)return r(new Error("Could not parse tile"));const n=e.j(t,1/e.t(i.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features"),u=new e.k(this.zoom,{brightness:this.brightness});for(const i in a)for(const r of a[i]){const i=r[0],a=t.json.extensionsUsed;i.recalculate(u,[]);const l=new e.T(n,o,a&&a.includes("MAPBOX_mesh_features"),this.brightness);c||(l.needsUpload=!0),s[i.fqid]=l,l.evaluate(i)}this.status="done",r(null,{buckets:s,featureIndex:l})})).catch((e=>r(new Error(e.message))))}}class G{constructor(e,t,n,i,r,o){this.actor=e,this.layerIndex=t,this.brightness=o,this.loading={},this.loaded={}}loadTile(t,n){const i=t.uid,r=this.loading[i]=new V(t,this.brightness);e.i(t.request,((e,o)=>{const s=!this.loading[i];return delete this.loading[i],s||e?(r.status="done",s||(this.loaded[i]=r),n(e)):o&&0!==o.byteLength?void r.parse(o,this.layerIndex,t,((e,t)=>{r.status="done",this.loaded=this.loaded||{},this.loaded[i]=r,e||!t?n(e):n(null,t)})):(r.status="done",this.loaded[i]=r,n())}))}reloadTile(e,t){const n=this.loaded,i=e.uid;if(n&&n[i]){const r=n[i];r.projection=e.projection,r.brightness=e.brightness;const o=(n,i)=>{r.reloadCallback&&(delete r.reloadCallback,this.loadTile(e,t)),t(n,i)};"parsing"===r.status?r.reloadCallback=o:"done"===r.status&&this.loadTile(e,t)}}abortTile(e,t){const n=e.uid;this.loading[n]&&delete this.loading[n],t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}class q{constructor(t){this.self=t,this.actor=new e.A(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.m({name:"mercator"}),this.workerSourceTypes={vector:e.d,geojson:U,"batched-model":G},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.n.isParsed())throw new Error("RTL text plugin already registered.");e.n.applyArabicShaping=t.applyArabicShaping,e.n.processBidirectionalText=t.processBidirectionalText,e.n.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],n()}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,n){let{scope:i,isLoaded:r}=n;if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][i]=r,this.workerSources[t]&&this.workerSources[t][i])for(const o in this.workerSources[t][i]){const n=this.workerSources[t][i][o];for(const t in n)n[t]instanceof e.d&&(n[t].isSpriteLoaded=r,n[t].fire(new e.o("isSpriteLoaded")))}}setImages(e,t,n){let{scope:i,images:r}=t;if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][i]=r,this.workerSources[e]&&this.workerSources[e][i]){for(const t in this.workerSources[e][i]){const n=this.workerSources[e][i][t];for(const e in n)n[e].availableImages=r}n()}else n()}setProjection(t,n){this.projections[t]=e.m(n)}setBrightness(e,t,n){this.brightness=t,n()}setLayers(e,t,n){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),n()}updateLayers(e,t,n){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),n()}loadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,n)}loadDEMTile(e,t,n){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,n)}reloadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,n)}removeSource(e,t,n){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const i=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,i){try{e.n.setState(n);const t=e.n.getPluginURL();if(e.n.isLoaded()&&!e.n.isParsed()&&null!=t){this.self.importScripts(t);const n=e.n.isParsed();i(n?void 0:new Error("RTL Text Plugin failed to import scripts from ".concat(t)),n)}}catch(e){i(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let n=this.availableImages[e][t];return n||(n=[]),n}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let n=this.layerIndexes[e][t];return n||(n=this.layerIndexes[e][t]=new i,n.scope=t),n}getWorkerSource(e,t,n,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][i]||(this.workerSources[e][i]={}),this.workerSources[e][i][t]||(this.workerSources[e][i][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),!this.workerSources[e][i][t][n]){const r={send:(t,n,i,r,o,s)=>{this.actor.send(t,n,i,e,o,s)},scheduler:this.actor.scheduler};this.workerSources[e][i][t][n]=new this.workerSourceTypes[t](r,this.getLayerIndex(e,i),this.getAvailableImages(e,i),this.isSpriteLoaded[e][i],void 0,this.brightness)}return this.workerSources[e][i][t][n]}getDEMWorkerSource(e,t,n){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][n]||(this.demWorkerSources[e][n]={}),this.demWorkerSources[e][n][t]||(this.demWorkerSources[e][n][t]=new r),this.demWorkerSources[e][n][t]}enforceCacheSizeLimit(t,n){e.q(n)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new q(self)),q})),i(["./shared"],(function(e){return e.s})),n}()},463:(e,t,n)=>{"use strict";var i=n(791),r=n(296);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,i,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){_[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];_[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){_[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){_[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){_[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){_[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){_[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){_[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){_[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function v(e,t,n,i){var r=_.hasOwnProperty(t)?_[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);_[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);_[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);_[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){_[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),_.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){_[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),A=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var z=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=z&&e[z]||e["@@iterator"])?e:null}var O,F=Object.assign;function B(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var N=!1;function j(e,t){if(!e||N)return"";N=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),o=i.stack.split("\n"),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||r[s]!==o[a]){var l="\n"+r[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{N=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?B(e):""}function U(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case w:return"Portal";case E:return"Profiler";case S:return"StrictMode";case M:return"Suspense";case k:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case P:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Z(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=H(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function K(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function J(e,t){Q(e,t);var n=q(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function oe(e,t){var n=q(t.value),i=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function _e(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ge=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Te=null,Se=null;function Ee(e){if(e=vr(e)){if("function"!==typeof we)throw Error(o(280));var t=e.stateNode;t&&(t=br(t),we(e.stateNode,e.type,t))}}function Ce(e){Te?Se?Se.push(e):Se=[e]:Te=e}function Ae(){if(Te){var e=Te,t=Se;if(Se=Te=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Ie(e,t){return e(t)}function Me(){}var ke=!1;function Pe(e,t,n){if(ke)return e(t,n);ke=!0;try{return Ie(e,t,n)}finally{ke=!1,(null!==Te||null!==Se)&&(Me(),Ae())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Re=!1;if(u)try{var ze={};Object.defineProperty(ze,"passive",{get:function(){Re=!0}}),window.addEventListener("test",ze,ze),window.removeEventListener("test",ze,ze)}catch(ue){Re=!1}function Le(e,t,n,i,r,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Oe=!1,Fe=null,Be=!1,Ne=null,je={onError:function(e){Oe=!0,Fe=e}};function Ue(e,t,n,i,r,o,s,a,l){Oe=!1,Fe=null,Le.apply(je,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Ve(e)!==e)throw Error(o(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(i=r.return)){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return qe(r),e;if(s===i)return qe(r),t;s=s.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=s;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=s;break}if(l===i){a=!0,i=r,n=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===n){a=!0,n=s,i=r;break}if(l===i){a=!0,i=s,n=r;break}l=l.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ze=r.unstable_scheduleCallback,Xe=r.unstable_cancelCallback,Ye=r.unstable_shouldYield,Ke=r.unstable_requestPaint,Qe=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~r;0!==a?i=ht(a):0!==(o&=s)&&(i=ht(o))}else 0!==(s=n&~r)?i=ht(s):0!==o&&(i=ht(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!==(4194240&o)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-st(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function _t(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-st(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var vt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,Tt,St,Et,Ct=!1,At=[],It=null,Mt=null,kt=null,Pt=new Map,Dt=new Map,Rt=[],zt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":Mt=null;break;case"mouseover":case"mouseout":kt=null;break;case"pointerover":case"pointerout":Pt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Ot(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=vr(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ft(e){var t=yr(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void Et(e.priority,(function(){Tt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Bt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=vr(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xe=i,n.target.dispatchEvent(i),xe=null,t.shift()}return!0}function Nt(e,t,n){Bt(e)&&n.delete(t)}function jt(){Ct=!1,null!==It&&Bt(It)&&(It=null),null!==Mt&&Bt(Mt)&&(Mt=null),null!==kt&&Bt(kt)&&(kt=null),Pt.forEach(Nt),Dt.forEach(Nt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,jt)))}function Vt(e){function t(t){return Ut(t,e)}if(0<At.length){Ut(At[0],e);for(var n=1;n<At.length;n++){var i=At[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==It&&Ut(It,e),null!==Mt&&Ut(Mt,e),null!==kt&&Ut(kt,e),Pt.forEach(t),Dt.forEach(t),n=0;n<Rt.length;n++)(i=Rt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Rt.length&&null===(n=Rt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Rt.shift()}var Gt=x.ReactCurrentBatchConfig,qt=!0;function Ht(e,t,n,i){var r=vt,o=Gt.transition;Gt.transition=null;try{vt=1,Zt(e,t,n,i)}finally{vt=r,Gt.transition=o}}function Wt(e,t,n,i){var r=vt,o=Gt.transition;Gt.transition=null;try{vt=4,Zt(e,t,n,i)}finally{vt=r,Gt.transition=o}}function Zt(e,t,n,i){if(qt){var r=Yt(e,t,n,i);if(null===r)qi(e,t,i,Xt,n),Lt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return It=Ot(It,e,t,n,i,r),!0;case"dragenter":return Mt=Ot(Mt,e,t,n,i,r),!0;case"mouseover":return kt=Ot(kt,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return Pt.set(o,Ot(Pt.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Dt.set(o,Ot(Dt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Lt(e,i),4&t&&-1<zt.indexOf(e)){for(;null!==r;){var o=vr(r);if(null!==o&&bt(o),null===(o=Yt(e,t,n,i))&&qi(e,t,i,Xt,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else qi(e,t,i,null,n)}}var Xt=null;function Yt(e,t,n,i){if(Xt=null,null!==(e=yr(e=be(i))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Qt=null,Jt=null,$t=null;function en(){if($t)return $t;var e,t,n=Jt,i=n.length,r="value"in Qt?Qt.value:Qt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),hn=F({},cn,{view:0,detail:0}),dn=on(hn),pn=F({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=on(pn),mn=on(F({},pn,{dataTransfer:0})),_n=on(F({},hn,{relatedTarget:0})),gn=on(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=on(yn),xn=on(F({},cn,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function En(){return Sn}var Cn=F({},hn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),An=on(Cn),In=on(F({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mn=on(F({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),kn=on(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Pn=F({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=on(Pn),Rn=[9,13,27,32],zn=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var On=u&&"TextEvent"in window&&!Ln,Fn=u&&(!zn||Ln&&8<Ln&&11>=Ln),Bn=String.fromCharCode(32),Nn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function Hn(e,t,n,i){Ce(i),0<(t=Wi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Wn=null,Zn=null;function Xn(e){Bi(e,0)}function Yn(e){if(Z(xr(e)))return e}function Kn(e,t){if("change"===e)return t}var Qn=!1;if(u){var Jn;if(u){var $n="oninput"in document;if(!$n){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),$n="function"===typeof ei.oninput}Jn=$n}else Jn=!1;Qn=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){Wn&&(Wn.detachEvent("onpropertychange",ni),Zn=Wn=null)}function ni(e){if("value"===e.propertyName&&Yn(Zn)){var t=[];Hn(t,Zn,e,be(e)),Pe(Xn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Zn=n,(Wn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Zn)}function oi(e,t){if("click"===e)return Yn(t)}function si(e,t){if("input"===e||"change"===e)return Yn(t)}var ai="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(ai(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(t,r)||!ai(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function di(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fi(e){var t=di(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=ui(n,o);var s=ui(n,i);r&&s&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,_i=null,gi=null,yi=null,vi=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vi||null==_i||_i!==X(i)||("selectionStart"in(i=_i)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Wi(gi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=_i)))}function bi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Ti={},Si={};function Ei(e){if(Ti[e])return Ti[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Si)return Ti[e]=n[t];return e}u&&(Si=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ci=Ei("animationend"),Ai=Ei("animationiteration"),Ii=Ei("animationstart"),Mi=Ei("transitionend"),ki=new Map,Pi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Di(e,t){ki.set(e,t),l(t,[e])}for(var Ri=0;Ri<Pi.length;Ri++){var zi=Pi[Ri];Di(zi.toLowerCase(),"on"+(zi[0].toUpperCase()+zi.slice(1)))}Di(Ci,"onAnimationEnd"),Di(Ai,"onAnimationIteration"),Di(Ii,"onAnimationStart"),Di("dblclick","onDoubleClick"),Di("focusin","onFocus"),Di("focusout","onBlur"),Di(Mi,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Li="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Li));function Fi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,s,a,l,c){if(Ue.apply(this,arguments),Oe){if(!Oe)throw Error(o(198));var u=Fe;Oe=!1,Fe=null,Be||(Be=!0,Ne=u)}}(i,t,void 0,e),e.currentTarget=null}function Bi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;Fi(r,a,c),o=l}else for(s=0;s<i.length;s++){if(l=(a=i[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;Fi(r,a,c),o=l}}}if(Be)throw e=Ne,Be=!1,Ne=null,e}function Ni(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||(Gi(t,e,2,!1),n.add(i))}function ji(e,t,n){var i=0;t&&(i|=4),Gi(n,e,i,t)}var Ui="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[Ui]){e[Ui]=!0,s.forEach((function(t){"selectionchange"!==t&&(Oi.has(t)||ji(t,!1,e),ji(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ui]||(t[Ui]=!0,ji("selectionchange",!1,t))}}function Gi(e,t,n,i){switch(Kt(t)){case 1:var r=Ht;break;case 4:r=Wt;break;default:r=Zt}n=r.bind(null,t,n,e),r=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function qi(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===s)for(s=i.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==a;){if(null===(s=yr(a)))return;if(5===(l=s.tag)||6===l){i=o=s;continue e}a=a.parentNode}}i=i.return}Pe((function(){var i=o,r=be(n),s=[];e:{var a=ki.get(e);if(void 0!==a){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=An;break;case"focusin":c="focus",l=_n;break;case"focusout":c="blur",l=_n;break;case"beforeblur":case"afterblur":l=_n;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mn;break;case Ci:case Ai:case Ii:l=gn;break;case Mi:l=kn;break;case"scroll":l=dn;break;case"wheel":l=Dn;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=In}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=De(f,d))&&u.push(Hi(f,m,p)))),h)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,r),s.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!yr(c)&&!c[fr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?yr(c):null)&&(c!==(h=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=In,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?a:xr(l),p=null==c?a:xr(c),(a=new u(m,f+"leave",l,n,r)).target=h,a.relatedTarget=p,m=null,yr(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=Zi(p))f++;for(p=0,m=d;m;m=Zi(m))p++;for(;0<f-p;)u=Zi(u),f--;for(;0<p-f;)d=Zi(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Zi(u),d=Zi(d)}u=null}else u=null;null!==l&&Xi(s,a,l,u,!1),null!==c&&null!==h&&Xi(s,h,c,u,!0)}if("select"===(l=(a=i?xr(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var _=Kn;else if(qn(a))if(Qn)_=si;else{_=ri;var g=ii}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(_=oi);switch(_&&(_=_(e,i))?Hn(s,_,n,r):(g&&g(e,a,i),"focusout"===e&&(g=a._wrapperState)&&g.controlled&&"number"===a.type&&ee(a,"number",a.value)),g=i?xr(i):window,e){case"focusin":(qn(g)||"true"===g.contentEditable)&&(_i=g,gi=i,yi=null);break;case"focusout":yi=gi=_i=null;break;case"mousedown":vi=!0;break;case"contextmenu":case"mouseup":case"dragend":vi=!1,xi(s,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(s,n,r)}var y;if(zn)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Vn?jn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Fn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Vn&&(y=en()):(Jt="value"in(Qt=r)?Qt.value:Qt.textContent,Vn=!0)),0<(g=Wi(i,v)).length&&(v=new xn(v,e,null,n,r),s.push({event:v,listeners:g}),y?v.data=y:null!==(y=Un(n))&&(v.data=y))),(y=On?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Nn=!0,Bn);case"textInput":return(e=t.data)===Bn&&Nn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!zn&&jn(e,t)?(e=en(),$t=Jt=Qt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Wi(i,"onBeforeInput")).length&&(r=new xn("onBeforeInput","beforeinput",null,n,r),s.push({event:r,listeners:i}),r.data=y))}Bi(s,t)}))}function Hi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=De(e,n))&&i.unshift(Hi(e,o,r)),null!=(o=De(e,t))&&i.push(Hi(e,o,r))),e=e.return}return i}function Zi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xi(e,t,n,i,r){for(var o=t._reactName,s=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=De(n,o))&&s.unshift(Hi(n,l,a)):r||null!=(l=De(n,o))&&s.push(Hi(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Yi=/\r\n?/g,Ki=/\u0000|\uFFFD/g;function Qi(e){return("string"===typeof e?e:""+e).replace(Yi,"\n").replace(Ki,"")}function Ji(e,t,n){if(t=Qi(t),Qi(e)!==t&&n)throw Error(o(425))}function $i(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,or="function"===typeof Promise?Promise:void 0,sr="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof or?function(e){return or.resolve(null).then(e).catch(ar)}:ir;function ar(e){setTimeout((function(){throw e}))}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Vt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Vt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,pr="__reactProps$"+hr,fr="__reactContainer$"+hr,mr="__reactEvents$"+hr,_r="__reactListeners$"+hr,gr="__reactHandles$"+hr;function yr(e){var t=e[dr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fr]||n[dr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[dr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function vr(e){return!(e=e[dr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function br(e){return e[pr]||null}var wr=[],Tr=-1;function Sr(e){return{current:e}}function Er(e){0>Tr||(e.current=wr[Tr],wr[Tr]=null,Tr--)}function Cr(e,t){Tr++,wr[Tr]=e.current,e.current=t}var Ar={},Ir=Sr(Ar),Mr=Sr(!1),kr=Ar;function Pr(e,t){var n=e.type.contextTypes;if(!n)return Ar;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Dr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Rr(){Er(Mr),Er(Ir)}function zr(e,t,n){if(Ir.current!==Ar)throw Error(o(168));Cr(Ir,t),Cr(Mr,n)}function Lr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,G(e)||"Unknown",r));return F({},n,i)}function Or(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ar,kr=Ir.current,Cr(Ir,e),Cr(Mr,Mr.current),!0}function Fr(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=Lr(e,t,kr),i.__reactInternalMemoizedMergedChildContext=e,Er(Mr),Er(Ir),Cr(Ir,e)):Er(Mr),Cr(Mr,n)}var Br=null,Nr=!1,jr=!1;function Ur(e){null===Br?Br=[e]:Br.push(e)}function Vr(){if(!jr&&null!==Br){jr=!0;var e=0,t=vt;try{var n=Br;for(vt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Br=null,Nr=!1}catch(r){throw null!==Br&&(Br=Br.slice(e+1)),Ze($e,Vr),r}finally{vt=t,jr=!1}}return null}var Gr=[],qr=0,Hr=null,Wr=0,Zr=[],Xr=0,Yr=null,Kr=1,Qr="";function Jr(e,t){Gr[qr++]=Wr,Gr[qr++]=Hr,Hr=e,Wr=t}function $r(e,t,n){Zr[Xr++]=Kr,Zr[Xr++]=Qr,Zr[Xr++]=Yr,Yr=e;var i=Kr;e=Qr;var r=32-st(i)-1;i&=~(1<<r),n+=1;var o=32-st(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,Kr=1<<32-st(t)+r|n<<r|i,Qr=o+e}else Kr=1<<o|n<<r|i,Qr=e}function eo(e){null!==e.return&&(Jr(e,1),$r(e,1,0))}function to(e){for(;e===Hr;)Hr=Gr[--qr],Gr[qr]=null,Wr=Gr[--qr],Gr[qr]=null;for(;e===Yr;)Yr=Zr[--Xr],Zr[Xr]=null,Qr=Zr[--Xr],Zr[Xr]=null,Kr=Zr[--Xr],Zr[Xr]=null}var no=null,io=null,ro=!1,oo=null;function so(e,t){var n=Dc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,io=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,io=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yr?{id:Kr,overflow:Qr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Dc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,io=null,!0);default:return!1}}function lo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(ro){var t=io;if(t){var n=t;if(!ao(e,t)){if(lo(e))throw Error(o(418));t=cr(n.nextSibling);var i=no;t&&ao(e,t)?so(i,n):(e.flags=-4097&e.flags|2,ro=!1,no=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,ro=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!ro)return uo(e),ro=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=io)){if(lo(e))throw po(),Error(o(418));for(;t;)so(e,t),t=cr(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){io=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}io=null}}else io=no?cr(e.stateNode.nextSibling):null;return!0}function po(){for(var e=io;e;)e=cr(e.nextSibling)}function fo(){io=no=null,ro=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var _o=x.ReactCurrentBatchConfig;function go(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var yo=Sr(null),vo=null,xo=null,bo=null;function wo(){bo=xo=vo=null}function To(e){var t=yo.current;Er(yo),e._currentValue=t}function So(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Eo(e,t){vo=e,bo=xo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xa=!0),e.firstContext=null)}function Co(e){var t=e._currentValue;if(bo!==e)if(e={context:e,memoizedValue:t,next:null},null===xo){if(null===vo)throw Error(o(308));xo=e,vo.dependencies={lanes:0,firstContext:e}}else xo=xo.next=e;return t}var Ao=null;function Io(e){null===Ao?Ao=[e]:Ao.push(e)}function Mo(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Io(t)):(n.next=r.next,r.next=n),t.interleaved=n,ko(e,i)}function ko(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Po=!1;function Do(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ro(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function zo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Lo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Ml)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,ko(e,n)}return null===(r=i.interleaved)?(t.next=t,Io(i)):(t.next=r.next,r.next=t),i.interleaved=t,ko(e,n)}function Oo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Fo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Bo(e,t,n,i){var r=e.updateQueue;Po=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=r.baseState;for(s=0,u=c=l=null,a=o;;){var d=a.lane,p=a.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(d=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break e;h=F({},h,d);break e;case 2:Po=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=d;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(d=a).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Fl|=s,e.lanes=s,e.memoizedState=h}}function No(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var jo=(new i.Component).refs;function Uo(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Vo={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=zo(i,r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Lo(e,o,r))&&(ic(t,e,r,i),Oo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=zo(i,r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Lo(e,o,r))&&(ic(t,e,r,i),Oo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),i=nc(e),r=zo(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Lo(e,r,i))&&(ic(t,e,i,n),Oo(t,e,i))}};function Go(e,t,n,i,r,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,o))}function qo(e,t,n){var i=!1,r=Ar,o=t.contextType;return"object"===typeof o&&null!==o?o=Co(o):(r=Dr(t)?kr:Ir.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?Pr(e,r):Ar),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Vo,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function Ho(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Vo.enqueueReplaceState(t,t.state,null)}function Wo(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=jo,Do(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=Co(o):(o=Dr(t)?kr:Ir.current,r.context=Pr(e,o)),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(Uo(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Vo.enqueueReplaceState(r,r.state,null),Bo(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function Zo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=r.refs;t===jo&&(t=r.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Xo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yo(e){return(0,e._init)(e._payload)}function Ko(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=zc(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Bc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var o=n.type;return o===T?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===D&&Yo(o)===t.type)?((i=r(t,n.props)).ref=Zo(e,t,n),i.return=e,i):((i=Lc(n.type,n.key,n.props,null,e.mode,i)).ref=Zo(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Nc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,o){return null===t||7!==t.tag?((t=Oc(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Bc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Lc(t.type,t.key,t.props,null,e.mode,n)).ref=Zo(e,null,t),n.return=e,n;case w:return(t=Nc(t,e.mode,n)).return=e,t;case D:return d(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Oc(t,e.mode,n,null)).return=e,t;Xo(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?c(e,t,n,i):null;case w:return n.key===r?u(e,t,n,i):null;case D:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||L(n))return null!==r?null:h(e,t,n,i,null);Xo(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case D:return f(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||L(i))return h(t,e=e.get(n)||null,i,r,null);Xo(t,i)}return null}function m(r,o,a,l){for(var c=null,u=null,h=o,m=o=0,_=null;null!==h&&m<a.length;m++){h.index>m?(_=h,h=null):_=h.sibling;var g=p(r,h,a[m],l);if(null===g){null===h&&(h=_);break}e&&h&&null===g.alternate&&t(r,h),o=s(g,o,m),null===u?c=g:u.sibling=g,u=g,h=_}if(m===a.length)return n(r,h),ro&&Jr(r,m),c;if(null===h){for(;m<a.length;m++)null!==(h=d(r,a[m],l))&&(o=s(h,o,m),null===u?c=h:u.sibling=h,u=h);return ro&&Jr(r,m),c}for(h=i(r,h);m<a.length;m++)null!==(_=f(h,r,m,a[m],l))&&(e&&null!==_.alternate&&h.delete(null===_.key?m:_.key),o=s(_,o,m),null===u?c=_:u.sibling=_,u=_);return e&&h.forEach((function(e){return t(r,e)})),ro&&Jr(r,m),c}function _(r,a,l,c){var u=L(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var h=u=null,m=a,_=a=0,g=null,y=l.next();null!==m&&!y.done;_++,y=l.next()){m.index>_?(g=m,m=null):g=m.sibling;var v=p(r,m,y.value,c);if(null===v){null===m&&(m=g);break}e&&m&&null===v.alternate&&t(r,m),a=s(v,a,_),null===h?u=v:h.sibling=v,h=v,m=g}if(y.done)return n(r,m),ro&&Jr(r,_),u;if(null===m){for(;!y.done;_++,y=l.next())null!==(y=d(r,y.value,c))&&(a=s(y,a,_),null===h?u=y:h.sibling=y,h=y);return ro&&Jr(r,_),u}for(m=i(r,m);!y.done;_++,y=l.next())null!==(y=f(m,r,_,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?_:y.key),a=s(y,a,_),null===h?u=y:h.sibling=y,h=y);return e&&m.forEach((function(e){return t(r,e)})),ro&&Jr(r,_),u}return function e(i,o,s,l){if("object"===typeof s&&null!==s&&s.type===T&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case b:e:{for(var c=s.key,u=o;null!==u;){if(u.key===c){if((c=s.type)===T){if(7===u.tag){n(i,u.sibling),(o=r(u,s.props.children)).return=i,i=o;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&Yo(c)===u.type){n(i,u.sibling),(o=r(u,s.props)).ref=Zo(i,u,s),o.return=i,i=o;break e}n(i,u);break}t(i,u),u=u.sibling}s.type===T?((o=Oc(s.props.children,i.mode,l,s.key)).return=i,i=o):((l=Lc(s.type,s.key,s.props,null,i.mode,l)).ref=Zo(i,o,s),l.return=i,i=l)}return a(i);case w:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(i,o.sibling),(o=r(o,s.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=Nc(s,i.mode,l)).return=i,i=o}return a(i);case D:return e(i,o,(u=s._init)(s._payload),l)}if(te(s))return m(i,o,s,l);if(L(s))return _(i,o,s,l);Xo(i,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,s)).return=i,i=o):(n(i,o),(o=Bc(s,i.mode,l)).return=i,i=o),a(i)):n(i,o)}}var Qo=Ko(!0),Jo=Ko(!1),$o={},es=Sr($o),ts=Sr($o),ns=Sr($o);function is(e){if(e===$o)throw Error(o(174));return e}function rs(e,t){switch(Cr(ns,t),Cr(ts,e),Cr(es,$o),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Er(es),Cr(es,t)}function os(){Er(es),Er(ts),Er(ns)}function ss(e){is(ns.current);var t=is(es.current),n=le(t,e.type);t!==n&&(Cr(ts,e),Cr(es,n))}function as(e){ts.current===e&&(Er(es),Er(ts))}var ls=Sr(0);function cs(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var us=[];function hs(){for(var e=0;e<us.length;e++)us[e]._workInProgressVersionPrimary=null;us.length=0}var ds=x.ReactCurrentDispatcher,ps=x.ReactCurrentBatchConfig,fs=0,ms=null,_s=null,gs=null,ys=!1,vs=!1,xs=0,bs=0;function ws(){throw Error(o(321))}function Ts(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ai(e[n],t[n]))return!1;return!0}function Ss(e,t,n,i,r,s){if(fs=s,ms=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ds.current=null===e||null===e.memoizedState?aa:la,e=n(i,r),vs){s=0;do{if(vs=!1,xs=0,25<=s)throw Error(o(301));s+=1,gs=_s=null,t.updateQueue=null,ds.current=ca,e=n(i,r)}while(vs)}if(ds.current=sa,t=null!==_s&&null!==_s.next,fs=0,gs=_s=ms=null,ys=!1,t)throw Error(o(300));return e}function Es(){var e=0!==xs;return xs=0,e}function Cs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===gs?ms.memoizedState=gs=e:gs=gs.next=e,gs}function As(){if(null===_s){var e=ms.alternate;e=null!==e?e.memoizedState:null}else e=_s.next;var t=null===gs?ms.memoizedState:gs.next;if(null!==t)gs=t,_s=e;else{if(null===e)throw Error(o(310));e={memoizedState:(_s=e).memoizedState,baseState:_s.baseState,baseQueue:_s.baseQueue,queue:_s.queue,next:null},null===gs?ms.memoizedState=gs=e:gs=gs.next=e}return gs}function Is(e,t){return"function"===typeof t?t(e):t}function Ms(e){var t=As(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=_s,r=i.baseQueue,s=n.pending;if(null!==s){if(null!==r){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,n.pending=null}if(null!==r){s=r.next,i=i.baseState;var l=a=null,c=null,u=s;do{var h=u.lane;if((fs&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=i):c=c.next=d,ms.lanes|=h,Fl|=h}u=u.next}while(null!==u&&u!==s);null===c?a=i:c.next=l,ai(i,t.memoizedState)||(xa=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{s=r.lane,ms.lanes|=s,Fl|=s,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function ks(e){var t=As(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,s=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{s=e(s,a.action),a=a.next}while(a!==r);ai(s,t.memoizedState)||(xa=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function Ps(){}function Ds(e,t){var n=ms,i=As(),r=t(),s=!ai(i.memoizedState,r);if(s&&(i.memoizedState=r,xa=!0),i=i.queue,qs(Ls.bind(null,n,i,e),[e]),i.getSnapshot!==t||s||null!==gs&&1&gs.memoizedState.tag){if(n.flags|=2048,Ns(9,zs.bind(null,n,i,r,t),void 0,null),null===kl)throw Error(o(349));0!==(30&fs)||Rs(n,t,r)}return r}function Rs(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function zs(e,t,n,i){t.value=n,t.getSnapshot=i,Os(t)&&Fs(e)}function Ls(e,t,n){return n((function(){Os(t)&&Fs(e)}))}function Os(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ai(e,n)}catch(i){return!0}}function Fs(e){var t=ko(e,1);null!==t&&ic(t,e,1,-1)}function Bs(e){var t=Cs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,ms,e),[t.memoizedState,e]}function Ns(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function js(){return As().memoizedState}function Us(e,t,n,i){var r=Cs();ms.flags|=e,r.memoizedState=Ns(1|t,n,void 0,void 0===i?null:i)}function Vs(e,t,n,i){var r=As();i=void 0===i?null:i;var o=void 0;if(null!==_s){var s=_s.memoizedState;if(o=s.destroy,null!==i&&Ts(i,s.deps))return void(r.memoizedState=Ns(t,n,o,i))}ms.flags|=e,r.memoizedState=Ns(1|t,n,o,i)}function Gs(e,t){return Us(8390656,8,e,t)}function qs(e,t){return Vs(2048,8,e,t)}function Hs(e,t){return Vs(4,2,e,t)}function Ws(e,t){return Vs(4,4,e,t)}function Zs(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Xs(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Vs(4,4,Zs.bind(null,t,e),n)}function Ys(){}function Ks(e,t){var n=As();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ts(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Qs(e,t){var n=As();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ts(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Js(e,t,n){return 0===(21&fs)?(e.baseState&&(e.baseState=!1,xa=!0),e.memoizedState=n):(ai(n,t)||(n=mt(),ms.lanes|=n,Fl|=n,e.baseState=!0),t)}function $s(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var i=ps.transition;ps.transition={};try{e(!1),t()}finally{vt=n,ps.transition=i}}function ea(){return As().memoizedState}function ta(e,t,n){var i=nc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},ia(e))ra(t,n);else if(null!==(n=Mo(e,t,n,i))){ic(n,e,i,tc()),oa(n,t,i)}}function na(e,t,n){var i=nc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(ia(e))ra(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,ai(a,s)){var l=t.interleaved;return null===l?(r.next=r,Io(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Mo(e,t,r,i))&&(ic(n,e,i,r=tc()),oa(n,t,i))}}function ia(e){var t=e.alternate;return e===ms||null!==t&&t===ms}function ra(e,t){vs=ys=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function oa(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var sa={readContext:Co,useCallback:ws,useContext:ws,useEffect:ws,useImperativeHandle:ws,useInsertionEffect:ws,useLayoutEffect:ws,useMemo:ws,useReducer:ws,useRef:ws,useState:ws,useDebugValue:ws,useDeferredValue:ws,useTransition:ws,useMutableSource:ws,useSyncExternalStore:ws,useId:ws,unstable_isNewReconciler:!1},aa={readContext:Co,useCallback:function(e,t){return Cs().memoizedState=[e,void 0===t?null:t],e},useContext:Co,useEffect:Gs,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Us(4194308,4,Zs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Us(4194308,4,e,t)},useInsertionEffect:function(e,t){return Us(4,2,e,t)},useMemo:function(e,t){var n=Cs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Cs();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ta.bind(null,ms,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Cs().memoizedState=e},useState:Bs,useDebugValue:Ys,useDeferredValue:function(e){return Cs().memoizedState=e},useTransition:function(){var e=Bs(!1),t=e[0];return e=$s.bind(null,e[1]),Cs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=ms,r=Cs();if(ro){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===kl)throw Error(o(349));0!==(30&fs)||Rs(i,t,n)}r.memoizedState=n;var s={value:n,getSnapshot:t};return r.queue=s,Gs(Ls.bind(null,i,s,e),[e]),i.flags|=2048,Ns(9,zs.bind(null,i,s,n,t),void 0,null),n},useId:function(){var e=Cs(),t=kl.identifierPrefix;if(ro){var n=Qr;t=":"+t+"R"+(n=(Kr&~(1<<32-st(Kr)-1)).toString(32)+n),0<(n=xs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=bs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},la={readContext:Co,useCallback:Ks,useContext:Co,useEffect:qs,useImperativeHandle:Xs,useInsertionEffect:Hs,useLayoutEffect:Ws,useMemo:Qs,useReducer:Ms,useRef:js,useState:function(){return Ms(Is)},useDebugValue:Ys,useDeferredValue:function(e){return Js(As(),_s.memoizedState,e)},useTransition:function(){return[Ms(Is)[0],As().memoizedState]},useMutableSource:Ps,useSyncExternalStore:Ds,useId:ea,unstable_isNewReconciler:!1},ca={readContext:Co,useCallback:Ks,useContext:Co,useEffect:qs,useImperativeHandle:Xs,useInsertionEffect:Hs,useLayoutEffect:Ws,useMemo:Qs,useReducer:ks,useRef:js,useState:function(){return ks(Is)},useDebugValue:Ys,useDeferredValue:function(e){var t=As();return null===_s?t.memoizedState=e:Js(t,_s.memoizedState,e)},useTransition:function(){return[ks(Is)[0],As().memoizedState]},useMutableSource:Ps,useSyncExternalStore:Ds,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var n="",i=t;do{n+=U(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r,digest:null}}function ha(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var pa="function"===typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=zo(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Hl||(Hl=!0,Wl=i),da(0,t)},n}function ma(e,t,n){(n=zo(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){da(0,t),"function"!==typeof i&&(null===Zl?Zl=new Set([this]):Zl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function _a(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new pa;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function ga(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ya(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=zo(-1,1)).tag=2,Lo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var va=x.ReactCurrentOwner,xa=!1;function ba(e,t,n,i){t.child=null===e?Jo(t,null,n,i):Qo(t,e.child,n,i)}function wa(e,t,n,i,r){n=n.render;var o=t.ref;return Eo(t,r),i=Ss(e,t,n,i,o,r),n=Es(),null===e||xa?(ro&&n&&eo(t),t.flags|=1,ba(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ha(e,t,r))}function Ta(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Rc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lc(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Sa(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:li)(s,i)&&e.ref===t.ref)return Ha(e,t,r)}return t.flags|=1,(e=zc(o,i)).ref=t.ref,e.return=t,t.child=e}function Sa(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(li(o,i)&&e.ref===t.ref){if(xa=!1,t.pendingProps=i=o,0===(e.lanes&r))return t.lanes=e.lanes,Ha(e,t,r);0!==(131072&e.flags)&&(xa=!0)}}return Aa(e,t,n,i,r)}function Ea(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(zl,Rl),Rl|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cr(zl,Rl),Rl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,Cr(zl,Rl),Rl|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,Cr(zl,Rl),Rl|=i;return ba(e,t,r,n),t.child}function Ca(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Aa(e,t,n,i,r){var o=Dr(n)?kr:Ir.current;return o=Pr(t,o),Eo(t,r),n=Ss(e,t,n,i,o,r),i=Es(),null===e||xa?(ro&&i&&eo(t),t.flags|=1,ba(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ha(e,t,r))}function Ia(e,t,n,i,r){if(Dr(n)){var o=!0;Or(t)}else o=!1;if(Eo(t,r),null===t.stateNode)qa(e,t),qo(t,n,i),Wo(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=Co(c):c=Pr(t,c=Dr(n)?kr:Ir.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;h||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==i||l!==c)&&Ho(t,s,i,c),Po=!1;var d=t.memoizedState;s.state=d,Bo(t,i,s,r),l=t.memoizedState,a!==i||d!==l||Mr.current||Po?("function"===typeof u&&(Uo(t,n,u,i),l=t.memoizedState),(a=Po||Go(t,n,a,i,d,l,c))?(h||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=c,i=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,Ro(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:go(t.type,a),s.props=c,h=t.pendingProps,d=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=Co(l):l=Pr(t,l=Dr(n)?kr:Ir.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==h||d!==l)&&Ho(t,s,i,l),Po=!1,d=t.memoizedState,s.state=d,Bo(t,i,s,r);var f=t.memoizedState;a!==h||d!==f||Mr.current||Po?("function"===typeof p&&(Uo(t,n,p,i),f=t.memoizedState),(c=Po||Go(t,n,c,i,d,f,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=l,i=c):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Ma(e,t,n,i,o,r)}function Ma(e,t,n,i,r,o){Ca(e,t);var s=0!==(128&t.flags);if(!i&&!s)return r&&Fr(t,n,!1),Ha(e,t,o);i=t.stateNode,va.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=Qo(t,e.child,null,o),t.child=Qo(t,null,a,o)):ba(e,t,a,o),t.memoizedState=i.state,r&&Fr(t,n,!0),t.child}function ka(e){var t=e.stateNode;t.pendingContext?zr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&zr(0,t.context,!1),rs(e,t.containerInfo)}function Pa(e,t,n,i,r){return fo(),mo(r),t.flags|=256,ba(e,t,n,i),t.child}var Da,Ra,za,La,Oa={dehydrated:null,treeContext:null,retryLane:0};function Fa(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ba(e,t,n){var i,r=t.pendingProps,s=ls.current,a=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&s)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Cr(ls,1&s),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,a?(r=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Fc(l,r,0,null),e=Oc(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Fa(n),t.memoizedState=Oa,e):Na(t,l));if(null!==(s=e.memoizedState)&&null!==(i=s.dehydrated))return function(e,t,n,i,r,s,a){if(n)return 256&t.flags?(t.flags&=-257,ja(e,t,a,i=ha(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=i.fallback,r=t.mode,i=Fc({mode:"visible",children:i.children},r,0,null),(s=Oc(s,r,a,null)).flags|=2,i.return=t,s.return=t,i.sibling=s,t.child=i,0!==(1&t.mode)&&Qo(t,e.child,null,a),t.child.memoizedState=Fa(a),t.memoizedState=Oa,s);if(0===(1&t.mode))return ja(e,t,a,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,ja(e,t,a,i=ha(s=Error(o(419)),i,void 0))}if(l=0!==(a&e.childLanes),xa||l){if(null!==(i=kl)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|a))?0:r)&&r!==s.retryLane&&(s.retryLane=r,ko(e,r),ic(i,e,r,-1))}return _c(),ja(e,t,a,i=ha(Error(o(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Ic.bind(null,e),r._reactRetry=t,null):(e=s.treeContext,io=cr(r.nextSibling),no=t,ro=!0,oo=null,null!==e&&(Zr[Xr++]=Kr,Zr[Xr++]=Qr,Zr[Xr++]=Yr,Kr=e.id,Qr=e.overflow,Yr=t),t=Na(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,s,n);if(a){a=r.fallback,l=t.mode,i=(s=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==s?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=zc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==i?a=zc(i,a):(a=Oc(a,l,n,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,l=null===(l=e.child.memoizedState)?Fa(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=Oa,r}return e=(a=e.child).sibling,r=zc(a,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Na(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function ja(e,t,n,i){return null!==i&&mo(i),Qo(t,e.child,null,n),(e=Na(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ua(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),So(e.return,t,n)}function Va(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Ga(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(ba(e,t,i.children,n),0!==(2&(i=ls.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ua(e,n,t);else if(19===e.tag)Ua(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Cr(ls,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===cs(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Va(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===cs(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Va(t,!0,n,null,o);break;case"together":Va(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qa(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ha(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=zc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wa(e,t){if(!ro)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Za(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xa(e,t,n){var i=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Za(t),null;case 1:case 17:return Dr(t.type)&&Rr(),Za(t),null;case 3:return i=t.stateNode,os(),Er(Mr),Er(Ir),hs(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(ac(oo),oo=null))),Ra(e,t),Za(t),null;case 5:as(t);var r=is(ns.current);if(n=t.type,null!==e&&null!=t.stateNode)za(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return Za(t),null}if(e=is(es.current),ho(t)){i=t.stateNode,n=t.type;var s=t.memoizedProps;switch(i[dr]=t,i[pr]=s,e=0!==(1&t.mode),n){case"dialog":Ni("cancel",i),Ni("close",i);break;case"iframe":case"object":case"embed":Ni("load",i);break;case"video":case"audio":for(r=0;r<Li.length;r++)Ni(Li[r],i);break;case"source":Ni("error",i);break;case"img":case"image":case"link":Ni("error",i),Ni("load",i);break;case"details":Ni("toggle",i);break;case"input":K(i,s),Ni("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Ni("invalid",i);break;case"textarea":re(i,s),Ni("invalid",i)}for(var l in ye(n,s),r=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==s.suppressHydrationWarning&&Ji(i.textContent,c,e),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Ji(i.textContent,c,e),r=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Ni("scroll",i)}switch(n){case"input":W(i),$(i,s,!0);break;case"textarea":W(i),se(i);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(i.onclick=$i)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[dr]=t,e[pr]=i,Da(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(n,i),n){case"dialog":Ni("cancel",e),Ni("close",e),r=i;break;case"iframe":case"object":case"embed":Ni("load",e),r=i;break;case"video":case"audio":for(r=0;r<Li.length;r++)Ni(Li[r],e);r=i;break;case"source":Ni("error",e),r=i;break;case"img":case"image":case"link":Ni("error",e),Ni("load",e),r=i;break;case"details":Ni("toggle",e),r=i;break;case"input":K(e,i),r=Y(e,i),Ni("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=F({},i,{value:void 0}),Ni("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Ni("invalid",e)}for(s in ye(n,r),c=r)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?_e(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Ni("scroll",e):null!=u&&v(e,s,u,l))}switch(n){case"input":W(e),$(e,i,!1);break;case"textarea":W(e),se(e);break;case"option":null!=i.value&&e.setAttribute("value",""+q(i.value));break;case"select":e.multiple=!!i.multiple,null!=(s=i.value)?ne(e,!!i.multiple,s,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$i)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Za(t),null;case 6:if(e&&null!=t.stateNode)La(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(n=is(ns.current),is(es.current),ho(t)){if(i=t.stateNode,n=t.memoizedProps,i[dr]=t,(s=i.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Ji(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=t,t.stateNode=i}return Za(t),null;case 13:if(Er(ls),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ro&&null!==io&&0!==(1&t.mode)&&0===(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==i&&null!==i.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[dr]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Za(t),s=!1}else null!==oo&&(ac(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ls.current)?0===Ll&&(Ll=3):_c())),null!==t.updateQueue&&(t.flags|=4),Za(t),null);case 4:return os(),Ra(e,t),null===e&&Vi(t.stateNode.containerInfo),Za(t),null;case 10:return To(t.type._context),Za(t),null;case 19:if(Er(ls),null===(s=t.memoizedState))return Za(t),null;if(i=0!==(128&t.flags),null===(l=s.rendering))if(i)Wa(s,!1);else{if(0!==Ll||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=cs(e))){for(t.flags|=128,Wa(s,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Cr(ls,1&ls.current|2),t.child}e=e.sibling}null!==s.tail&&Qe()>Gl&&(t.flags|=128,i=!0,Wa(s,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=cs(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wa(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!ro)return Za(t),null}else 2*Qe()-s.renderingStartTime>Gl&&1073741824!==n&&(t.flags|=128,i=!0,Wa(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Qe(),t.sibling=null,n=ls.current,Cr(ls,i?1&n|2:1&n),t):(Za(t),null);case 22:case 23:return dc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Rl)&&(Za(t),6&t.subtreeFlags&&(t.flags|=8192)):Za(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Ya(e,t){switch(to(t),t.tag){case 1:return Dr(t.type)&&Rr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return os(),Er(Mr),Er(Ir),hs(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return as(t),null;case 13:if(Er(ls),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Er(ls),null;case 4:return os(),null;case 10:return To(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Da=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ra=function(){},za=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,is(es.current);var o,s=null;switch(n){case"input":r=Y(e,r),i=Y(e,i),s=[];break;case"select":r=F({},r,{value:void 0}),i=F({},i,{value:void 0}),s=[];break;case"textarea":r=ie(e,r),i=ie(e,i),s=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=$i)}for(u in ye(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Ni("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},La=function(e,t,n,i){n!==i&&(t.flags|=4)};var Ka=!1,Qa=!1,Ja="function"===typeof WeakSet?WeakSet:Set,$a=null;function el(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Ec(e,t,i)}else n.current=null}function tl(e,t,n){try{n()}catch(i){Ec(e,t,i)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&tl(t,n,o)}r=r.next}while(r!==i)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dr],delete t[pr],delete t[mr],delete t[_r],delete t[gr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$i));else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var hl=null,dl=!1;function pl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(rt,n)}catch(a){}switch(n.tag){case 5:Qa||el(n,t);case 6:var i=hl,r=dl;hl=null,pl(e,t,n),dl=r,null!==(hl=i)&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),Vt(e)):lr(hl,n.stateNode));break;case 4:i=hl,r=dl,hl=n.stateNode.containerInfo,dl=!0,pl(e,t,n),hl=i,dl=r;break;case 0:case 11:case 14:case 15:if(!Qa&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&tl(n,t,s),r=r.next}while(r!==i)}pl(e,t,n);break;case 1:if(!Qa&&(el(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Ec(n,t,a)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Qa=(i=Qa)||null!==n.memoizedState,pl(e,t,n),Qa=i):pl(e,t,n);break;default:pl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ja),t.forEach((function(t){var i=Mc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function _l(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(o(160));fl(s,a,r),hl=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Ec(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(_l(t,e),yl(e),4&i){try{il(3,e,e.return),rl(3,e)}catch(_){Ec(e,e.return,_)}try{il(5,e,e.return)}catch(_){Ec(e,e.return,_)}}break;case 1:_l(t,e),yl(e),512&i&&null!==n&&el(n,n.return);break;case 5:if(_l(t,e),yl(e),512&i&&null!==n&&el(n,n.return),32&e.flags){var r=e.stateNode;try{de(r,"")}catch(_){Ec(e,e.return,_)}}if(4&i&&null!=(r=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&Q(r,s),ve(l,a);var u=ve(l,s);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?_e(r,d):"dangerouslySetInnerHTML"===h?he(r,d):"children"===h?de(r,d):v(r,h,d,u)}switch(l){case"input":J(r,s);break;case"textarea":oe(r,s);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ne(r,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(r,!!s.multiple,s.defaultValue,!0):ne(r,!!s.multiple,s.multiple?[]:"",!1))}r[pr]=s}catch(_){Ec(e,e.return,_)}}break;case 6:if(_l(t,e),yl(e),4&i){if(null===e.stateNode)throw Error(o(162));r=e.stateNode,s=e.memoizedProps;try{r.nodeValue=s}catch(_){Ec(e,e.return,_)}}break;case 3:if(_l(t,e),yl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(_){Ec(e,e.return,_)}break;case 4:default:_l(t,e),yl(e);break;case 13:_l(t,e),yl(e),8192&(r=e.child).flags&&(s=null!==r.memoizedState,r.stateNode.isHidden=s,!s||null!==r.alternate&&null!==r.alternate.memoizedState||(Vl=Qe())),4&i&&ml(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Qa=(u=Qa)||h,_l(t,e),Qa=u):_l(t,e),yl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for($a=e,h=e.child;null!==h;){for(d=$a=h;null!==$a;){switch(f=(p=$a).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:el(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){i=p,n=p.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(_){Ec(i,n,_)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){wl(d);continue}}null!==f?(f.return=p,$a=f):wl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,u?"function"===typeof(s=r.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=d.stateNode,a=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",a))}catch(_){Ec(e,e.return,_)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(_){Ec(e,e.return,_)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:_l(t,e),yl(e),4&i&&ml(e);case 21:}}function yl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var i=n;break e}n=n.return}throw Error(o(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(de(r,""),i.flags&=-33),ul(e,ll(e),r);break;case 3:case 4:var s=i.stateNode.containerInfo;cl(e,ll(e),s);break;default:throw Error(o(161))}}catch(a){Ec(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vl(e,t,n){$a=e,xl(e,t,n)}function xl(e,t,n){for(var i=0!==(1&e.mode);null!==$a;){var r=$a,o=r.child;if(22===r.tag&&i){var s=null!==r.memoizedState||Ka;if(!s){var a=r.alternate,l=null!==a&&null!==a.memoizedState||Qa;a=Ka;var c=Qa;if(Ka=s,(Qa=l)&&!c)for($a=r;null!==$a;)l=(s=$a).child,22===s.tag&&null!==s.memoizedState?Tl(r):null!==l?(l.return=s,$a=l):Tl(r);for(;null!==o;)$a=o,xl(o,t,n),o=o.sibling;$a=r,Ka=a,Qa=c}bl(e)}else 0!==(8772&r.subtreeFlags)&&null!==o?(o.return=r,$a=o):bl(e)}}function bl(e){for(;null!==$a;){var t=$a;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qa||rl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Qa)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:go(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&No(t,s,i);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}No(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Vt(d)}}}break;default:throw Error(o(163))}Qa||512&t.flags&&ol(t)}catch(p){Ec(t,t.return,p)}}if(t===e){$a=null;break}if(null!==(n=t.sibling)){n.return=t.return,$a=n;break}$a=t.return}}function wl(e){for(;null!==$a;){var t=$a;if(t===e){$a=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$a=n;break}$a=t.return}}function Tl(e){for(;null!==$a;){var t=$a;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Ec(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Ec(t,r,l)}}var o=t.return;try{ol(t)}catch(l){Ec(t,o,l)}break;case 5:var s=t.return;try{ol(t)}catch(l){Ec(t,s,l)}}}catch(l){Ec(t,t.return,l)}if(t===e){$a=null;break}var a=t.sibling;if(null!==a){a.return=t.return,$a=a;break}$a=t.return}}var Sl,El=Math.ceil,Cl=x.ReactCurrentDispatcher,Al=x.ReactCurrentOwner,Il=x.ReactCurrentBatchConfig,Ml=0,kl=null,Pl=null,Dl=0,Rl=0,zl=Sr(0),Ll=0,Ol=null,Fl=0,Bl=0,Nl=0,jl=null,Ul=null,Vl=0,Gl=1/0,ql=null,Hl=!1,Wl=null,Zl=null,Xl=!1,Yl=null,Kl=0,Ql=0,Jl=null,$l=-1,ec=0;function tc(){return 0!==(6&Ml)?Qe():-1!==$l?$l:$l=Qe()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Ml)&&0!==Dl?Dl&-Dl:null!==_o.transition?(0===ec&&(ec=mt()),ec):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Kt(e.type)}function ic(e,t,n,i){if(50<Ql)throw Ql=0,Jl=null,Error(o(185));gt(e,n,i),0!==(2&Ml)&&e===kl||(e===kl&&(0===(2&Ml)&&(Bl|=n),4===Ll&&lc(e,Dl)),rc(e,i),1===n&&0===Ml&&0===(1&t.mode)&&(Gl=Qe()+500,Nr&&Vr()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,l=r[s];-1===l?0!==(a&n)&&0===(a&i)||(r[s]=pt(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var i=dt(e,e===kl?Dl:0);if(0===i)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Nr=!0,Ur(e)}(cc.bind(null,e)):Ur(cc.bind(null,e)),sr((function(){0===(6&Ml)&&Vr()})),n=null;else{switch(xt(i)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=kc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if($l=-1,ec=0,0!==(6&Ml))throw Error(o(327));var n=e.callbackNode;if(Tc()&&e.callbackNode!==n)return null;var i=dt(e,e===kl?Dl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gc(e,i);else{t=i;var r=Ml;Ml|=2;var s=mc();for(kl===e&&Dl===t||(ql=null,Gl=Qe()+500,pc(e,t));;)try{vc();break}catch(l){fc(e,l)}wo(),Cl.current=s,Ml=r,null!==Pl?t=0:(kl=null,Dl=0,t=Ll)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(i=r,t=sc(e,r))),1===t)throw n=Ol,pc(e,0),lc(e,i),rc(e,Qe()),n;if(6===t)lc(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!ai(o(),r))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,i))&&(0!==(s=ft(e))&&(i=s,t=sc(e,s))),1===t))throw n=Ol,pc(e,0),lc(e,i),rc(e,Qe()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:wc(e,Ul,ql);break;case 3:if(lc(e,i),(130023424&i)===i&&10<(t=Vl+500-Qe())){if(0!==dt(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tc(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(wc.bind(null,e,Ul,ql),t);break}wc(e,Ul,ql);break;case 4:if(lc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var a=31-st(i);s=1<<a,(a=t[a])>r&&(r=a),i&=~s}if(i=r,10<(i=(120>(i=Qe()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*El(i/1960))-i)){e.timeoutHandle=ir(wc.bind(null,e,Ul,ql),i);break}wc(e,Ul,ql);break;default:throw Error(o(329))}}}return rc(e,Qe()),e.callbackNode===n?oc.bind(null,e):null}function sc(e,t){var n=jl;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Ul,Ul=n,null!==t&&ac(t)),e}function ac(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function lc(e,t){for(t&=~Nl,t&=~Bl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),i=1<<n;e[n]=-1,t&=~i}}function cc(e){if(0!==(6&Ml))throw Error(o(327));Tc();var t=dt(e,0);if(0===(1&t))return rc(e,Qe()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var i=ft(e);0!==i&&(t=i,n=sc(e,i))}if(1===n)throw n=Ol,pc(e,0),lc(e,t),rc(e,Qe()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Ul,ql),rc(e,Qe()),null}function uc(e,t){var n=Ml;Ml|=1;try{return e(t)}finally{0===(Ml=n)&&(Gl=Qe()+500,Nr&&Vr())}}function hc(e){null!==Yl&&0===Yl.tag&&0===(6&Ml)&&Tc();var t=Ml;Ml|=1;var n=Il.transition,i=vt;try{if(Il.transition=null,vt=1,e)return e()}finally{vt=i,Il.transition=n,0===(6&(Ml=t))&&Vr()}}function dc(){Rl=zl.current,Er(zl)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Pl)for(n=Pl.return;null!==n;){var i=n;switch(to(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Rr();break;case 3:os(),Er(Mr),Er(Ir),hs();break;case 5:as(i);break;case 4:os();break;case 13:case 19:Er(ls);break;case 10:To(i.type._context);break;case 22:case 23:dc()}n=n.return}if(kl=e,Pl=e=zc(e.current,null),Dl=Rl=t,Ll=0,Ol=null,Nl=Bl=Fl=0,Ul=jl=null,null!==Ao){for(t=0;t<Ao.length;t++)if(null!==(i=(n=Ao[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var s=o.next;o.next=r,i.next=s}n.pending=i}Ao=null}return e}function fc(e,t){for(;;){var n=Pl;try{if(wo(),ds.current=sa,ys){for(var i=ms.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ys=!1}if(fs=0,gs=_s=ms=null,vs=!1,xs=0,Al.current=null,null===n||null===n.return){Ll=1,Ol=t,Pl=null;break}e:{var s=e,a=n.return,l=n,c=t;if(t=Dl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=ga(a);if(null!==f){f.flags&=-257,ya(f,a,l,0,t),1&f.mode&&_a(s,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var _=new Set;_.add(c),t.updateQueue=_}else m.add(c);break e}if(0===(1&t)){_a(s,u,t),_c();break e}c=Error(o(426))}else if(ro&&1&l.mode){var g=ga(a);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ya(g,a,l,0,t),mo(ua(c,l));break e}}s=c=ua(c,l),4!==Ll&&(Ll=2),null===jl?jl=[s]:jl.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Fo(s,fa(0,c,t));break e;case 1:l=c;var y=s.type,v=s.stateNode;if(0===(128&s.flags)&&("function"===typeof y.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Zl||!Zl.has(v)))){s.flags|=65536,t&=-t,s.lanes|=t,Fo(s,ma(s,l,t));break e}}s=s.return}while(null!==s)}bc(n)}catch(x){t=x,Pl===n&&null!==n&&(Pl=n=n.return);continue}break}}function mc(){var e=Cl.current;return Cl.current=sa,null===e?sa:e}function _c(){0!==Ll&&3!==Ll&&2!==Ll||(Ll=4),null===kl||0===(268435455&Fl)&&0===(268435455&Bl)||lc(kl,Dl)}function gc(e,t){var n=Ml;Ml|=2;var i=mc();for(kl===e&&Dl===t||(ql=null,pc(e,t));;)try{yc();break}catch(r){fc(e,r)}if(wo(),Ml=n,Cl.current=i,null!==Pl)throw Error(o(261));return kl=null,Dl=0,Ll}function yc(){for(;null!==Pl;)xc(Pl)}function vc(){for(;null!==Pl&&!Ye();)xc(Pl)}function xc(e){var t=Sl(e.alternate,e,Rl);e.memoizedProps=e.pendingProps,null===t?bc(e):Pl=t,Al.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xa(n,t,Rl)))return void(Pl=n)}else{if(null!==(n=Ya(n,t)))return n.flags&=32767,void(Pl=n);if(null===e)return Ll=6,void(Pl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pl=t);Pl=t=e}while(null!==t);0===Ll&&(Ll=5)}function wc(e,t,n){var i=vt,r=Il.transition;try{Il.transition=null,vt=1,function(e,t,n,i){do{Tc()}while(null!==Yl);if(0!==(6&Ml))throw Error(o(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-st(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,s),e===kl&&(Pl=kl=null,Dl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xl||(Xl=!0,kc(tt,(function(){return Tc(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Il.transition,Il.transition=null;var a=vt;vt=1;var l=Ml;Ml|=4,Al.current=null,function(e,t){if(er=qt,pi(e=di())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch(b){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=a+r),d!==s||0!==i&&3!==d.nodeType||(c=a+i),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===r&&(l=a),p===s&&++h===i&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},qt=!1,$a=t;null!==$a;)if(e=(t=$a).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$a=e;else for(;null!==$a;){t=$a;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var _=m.memoizedProps,g=m.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?_:go(t.type,_),g);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(o(163))}}catch(b){Ec(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,$a=e;break}$a=t.return}m=nl,nl=!1}(e,n),gl(n,e),fi(tr),qt=!!er,tr=er=null,e.current=n,vl(n,e,r),Ke(),Ml=l,vt=a,Il.transition=s}else e.current=n;if(Xl&&(Xl=!1,Yl=e,Kl=r),s=e.pendingLanes,0===s&&(Zl=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Qe()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Hl)throw Hl=!1,e=Wl,Wl=null,e;0!==(1&Kl)&&0!==e.tag&&Tc(),s=e.pendingLanes,0!==(1&s)?e===Jl?Ql++:(Ql=0,Jl=e):Ql=0,Vr()}(e,t,n,i)}finally{Il.transition=r,vt=i}return null}function Tc(){if(null!==Yl){var e=xt(Kl),t=Il.transition,n=vt;try{if(Il.transition=null,vt=16>e?16:e,null===Yl)var i=!1;else{if(e=Yl,Yl=null,Kl=0,0!==(6&Ml))throw Error(o(331));var r=Ml;for(Ml|=4,$a=e.current;null!==$a;){var s=$a,a=s.child;if(0!==(16&$a.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for($a=u;null!==$a;){var h=$a;switch(h.tag){case 0:case 11:case 15:il(8,h,s)}var d=h.child;if(null!==d)d.return=h,$a=d;else for(;null!==$a;){var p=(h=$a).sibling,f=h.return;if(sl(h),h===u){$a=null;break}if(null!==p){p.return=f,$a=p;break}$a=f}}}var m=s.alternate;if(null!==m){var _=m.child;if(null!==_){m.child=null;do{var g=_.sibling;_.sibling=null,_=g}while(null!==_)}}$a=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,$a=a;else e:for(;null!==$a;){if(0!==(2048&(s=$a).flags))switch(s.tag){case 0:case 11:case 15:il(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,$a=y;break e}$a=s.return}}var v=e.current;for($a=v;null!==$a;){var x=(a=$a).child;if(0!==(2064&a.subtreeFlags)&&null!==x)x.return=a,$a=x;else e:for(a=v;null!==$a;){if(0!==(2048&(l=$a).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(w){Ec(l,l.return,w)}if(l===a){$a=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,$a=b;break e}$a=l.return}}if(Ml=r,Vr(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(rt,e)}catch(w){}i=!0}return i}finally{vt=n,Il.transition=t}}return!1}function Sc(e,t,n){e=Lo(e,t=fa(0,t=ua(n,t),1),1),t=tc(),null!==e&&(gt(e,1,t),rc(e,t))}function Ec(e,t,n){if(3===e.tag)Sc(e,e,n);else for(;null!==t;){if(3===t.tag){Sc(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Zl||!Zl.has(i))){t=Lo(t,e=ma(t,e=ua(n,e),1),1),e=tc(),null!==t&&(gt(t,1,e),rc(t,e));break}}t=t.return}}function Cc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,kl===e&&(Dl&n)===n&&(4===Ll||3===Ll&&(130023424&Dl)===Dl&&500>Qe()-Vl?pc(e,0):Nl|=n),rc(e,t)}function Ac(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=tc();null!==(e=ko(e,t))&&(gt(e,t,n),rc(e,n))}function Ic(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ac(e,n)}function Mc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),Ac(e,n)}function kc(e,t){return Ze(e,t)}function Pc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dc(e,t,n,i){return new Pc(e,t,n,i)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zc(e,t){var n=e.alternate;return null===n?((n=Dc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lc(e,t,n,i,r,s){var a=2;if(i=e,"function"===typeof e)Rc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case T:return Oc(n.children,r,s,t);case S:a=8,r|=8;break;case E:return(e=Dc(12,n,t,2|r)).elementType=E,e.lanes=s,e;case M:return(e=Dc(13,n,t,r)).elementType=M,e.lanes=s,e;case k:return(e=Dc(19,n,t,r)).elementType=k,e.lanes=s,e;case R:return Fc(n,r,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:a=10;break e;case A:a=9;break e;case I:a=11;break e;case P:a=14;break e;case D:a=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Dc(a,n,t,r)).elementType=e,t.type=i,t.lanes=s,t}function Oc(e,t,n,i){return(e=Dc(7,e,i,t)).lanes=n,e}function Fc(e,t,n,i){return(e=Dc(22,e,i,t)).elementType=R,e.lanes=n,e.stateNode={isHidden:!1},e}function Bc(e,t,n){return(e=Dc(6,e,null,t)).lanes=n,e}function Nc(e,t,n){return(t=Dc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function jc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_t(0),this.expirationTimes=_t(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_t(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,i,r,o,s,a,l){return e=new jc(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Dc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Do(o),e}function Vc(e){if(!e)return Ar;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Dr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Dr(n))return Lr(e,n,t)}return t}function Gc(e,t,n,i,r,o,s,a,l){return(e=Uc(n,i,!0,e,0,o,0,a,l)).context=Vc(null),n=e.current,(o=zo(i=tc(),r=nc(n))).callback=void 0!==t&&null!==t?t:null,Lo(n,o,r),e.current.lanes=r,gt(e,r,i),rc(e,i),e}function qc(e,t,n,i){var r=t.current,o=tc(),s=nc(r);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=zo(o,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Lo(r,t,s))&&(ic(e,r,s,o),Oo(e,r,s)),s}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Zc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Sl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Mr.current)xa=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xa=!1,function(e,t,n){switch(t.tag){case 3:ka(t),fo();break;case 5:ss(t);break;case 1:Dr(t.type)&&Or(t);break;case 4:rs(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Cr(yo,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Cr(ls,1&ls.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ba(e,t,n):(Cr(ls,1&ls.current),null!==(e=Ha(e,t,n))?e.sibling:null);Cr(ls,1&ls.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Ga(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Cr(ls,ls.current),i)break;return null;case 22:case 23:return t.lanes=0,Ea(e,t,n)}return Ha(e,t,n)}(e,t,n);xa=0!==(131072&e.flags)}else xa=!1,ro&&0!==(1048576&t.flags)&&$r(t,Wr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;qa(e,t),e=t.pendingProps;var r=Pr(t,Ir.current);Eo(t,n),r=Ss(null,t,i,e,r,n);var s=Es();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Dr(i)?(s=!0,Or(t)):s=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Do(t),r.updater=Vo,t.stateNode=r,r._reactInternals=t,Wo(t,i,e,n),t=Ma(null,t,i,!0,s,n)):(t.tag=0,ro&&s&&eo(t),ba(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(qa(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Rc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===P)return 14}return 2}(i),e=go(i,e),r){case 0:t=Aa(null,t,i,e,n);break e;case 1:t=Ia(null,t,i,e,n);break e;case 11:t=wa(null,t,i,e,n);break e;case 14:t=Ta(null,t,i,go(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Aa(e,t,i,r=t.elementType===i?r:go(i,r),n);case 1:return i=t.type,r=t.pendingProps,Ia(e,t,i,r=t.elementType===i?r:go(i,r),n);case 3:e:{if(ka(t),null===e)throw Error(o(387));i=t.pendingProps,r=(s=t.memoizedState).element,Ro(e,t),Bo(t,i,null,n);var a=t.memoizedState;if(i=a.element,s.isDehydrated){if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Pa(e,t,i,n,r=ua(Error(o(423)),t));break e}if(i!==r){t=Pa(e,t,i,n,r=ua(Error(o(424)),t));break e}for(io=cr(t.stateNode.containerInfo.firstChild),no=t,ro=!0,oo=null,n=Jo(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),i===r){t=Ha(e,t,n);break e}ba(e,t,i,n)}t=t.child}return t;case 5:return ss(t),null===e&&co(t),i=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,a=r.children,nr(i,r)?a=null:null!==s&&nr(i,s)&&(t.flags|=32),Ca(e,t),ba(e,t,a,n),t.child;case 6:return null===e&&co(t),null;case 13:return Ba(e,t,n);case 4:return rs(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Qo(t,null,i,n):ba(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,wa(e,t,i,r=t.elementType===i?r:go(i,r),n);case 7:return ba(e,t,t.pendingProps,n),t.child;case 8:case 12:return ba(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,s=t.memoizedProps,a=r.value,Cr(yo,i._currentValue),i._currentValue=a,null!==s)if(ai(s.value,a)){if(s.children===r.children&&!Mr.current){t=Ha(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===s.tag){(c=zo(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),So(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),So(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}ba(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Eo(t,n),i=i(r=Co(r)),t.flags|=1,ba(e,t,i,n),t.child;case 14:return r=go(i=t.type,t.pendingProps),Ta(e,t,i,r=go(i.type,r),n);case 15:return Sa(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:go(i,r),qa(e,t),t.tag=1,Dr(i)?(e=!0,Or(t)):e=!1,Eo(t,n),qo(t,i,r),Wo(t,i,r,n),Ma(null,t,i,!0,e,n);case 19:return Ga(e,t,n);case 22:return Ea(e,t,n)}throw Error(o(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Kc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function eu(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof r){var a=r;r=function(){var e=Hc(s);a.call(e)}}qc(t,s,e,r)}else s=function(e,t,n,i,r){if(r){if("function"===typeof i){var o=i;i=function(){var e=Hc(s);o.call(e)}}var s=Gc(t,i,e,0,null,!1,0,"",$c);return e._reactRootContainer=s,e[fr]=s.current,Vi(8===e.nodeType?e.parentNode:e),hc(),s}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var a=i;i=function(){var e=Hc(l);a.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=l,e[fr]=l.current,Vi(8===e.nodeType?e.parentNode:e),hc((function(){qc(t,l,n,i)})),l}(n,t,e,r,i);return Hc(s)}Kc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));qc(e,t,null,null)},Kc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){qc(null,e,null,null)})),t[fr]=null}},Kc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Rt.length&&0!==t&&t<Rt[n].priority;n++);Rt.splice(n,0,e),0===n&&Ft(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Qe()),0===(6&Ml)&&(Gl=Qe()+500,Vr()))}break;case 13:hc((function(){var t=ko(e,1);if(null!==t){var n=tc();ic(t,e,1,n)}})),Zc(e,1)}},wt=function(e){if(13===e.tag){var t=ko(e,134217728);if(null!==t)ic(t,e,134217728,tc());Zc(e,134217728)}},Tt=function(e){if(13===e.tag){var t=nc(e),n=ko(e,t);if(null!==n)ic(n,e,t,tc());Zc(e,t)}},St=function(){return vt},Et=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=br(i);if(!r)throw Error(o(90));Z(i),J(i,r)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=uc,Me=hc;var tu={usingClientEntryPoint:!1,Events:[vr,xr,br,Ce,Ae,uc]},nu={findFiberByHostInstance:yr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{rt=ru.inject(iu),ot=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(o(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(o(299));var n=!1,i="",r=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,i,r),e[fr]=t.current,Vi(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(o(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(o(405));var i=null!=n&&n.hydratedSources||null,r=!1,s="",a=Xc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Gc(t,null,e,1,null!=n?n:null,r,0,s,a),e[fr]=t.current,Vi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Kc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(o(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(o(40));return!!e._reactRootContainer&&(hc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fr]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Jc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},250:(e,t,n)=>{"use strict";var i=n(164);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},164:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},374:(e,t,n)=>{"use strict";var i=n(791),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,o={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,i)&&!l.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:o,_owner:a.current}}t.jsx=c,t.jsxs=c},117:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,_={};function g(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||f}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=v.prototype=new y;x.constructor=v,m(x,g.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,T={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,i){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)w.call(t,r)&&!S.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:T.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var A=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,r,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return s=s(l=e),e=""===o?"."+I(l,0):o,b(s)?(r="",null!=e&&(r=e.replace(A,"$&/")+"/"),M(s,t,r,"",(function(e){return e}))):null!=s&&(C(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,r+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(A,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",b(e))for(var c=0;c<e.length;c++){var u=o+I(a=e[c],c);l+=M(a,t,r,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=M(a=a.value,t,r,u=o+I(a,c++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function k(e,t,n){if(null==e)return e;var i=[],r=0;return M(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function P(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},R={transition:null},z={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:R,ReactCurrentOwner:T};t.Children={map:k,forEach:function(e,t,n){k(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return k(e,(function(){t++})),t},toArray:function(e){return k(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=r,t.Profiler=s,t.PureComponent=v,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=T.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!S.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:o,ref:s,props:r,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.2.0"},791:(e,t,n)=>{"use strict";e.exports=n(117)},184:(e,t,n)=>{"use strict";e.exports=n(374)},813:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,s=r>>>1;i<s;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<r&&0>o(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<r&&0>o(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,_=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function b(e){if(_=!1,x(e),!m)if(null!==i(c))m=!0,R(w);else{var t=i(u);null!==t&&z(b,t.startTime-e)}}function w(e,n){m=!1,_&&(_=!1,y(C),C=-1),f=!0;var o=p;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||e&&!M());){var s=d.callback;if("function"===typeof s){d.callback=null,p=d.priorityLevel;var a=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?d.callback=a:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&z(b,h.startTime-n),l=!1}return l}finally{d=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,S=!1,E=null,C=-1,A=5,I=-1;function M(){return!(t.unstable_now()-I<A)}function k(){if(null!==E){var e=t.unstable_now();I=e;var n=!0;try{n=E(!0,e)}finally{n?T():(S=!1,E=null)}}else S=!1}if("function"===typeof v)T=function(){v(k)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,D=P.port2;P.port1.onmessage=k,T=function(){D.postMessage(null)}}else T=function(){g(k,0)};function R(e){E=e,S||(S=!0,T())}function z(e,n){C=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,R(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===i(c)&&e===i(u)&&(_?(y(C),C=-1):_=!0,z(b,o-s))):(e.sortIndex=a,n(c,e),m||f||(m=!0,R(w))),e},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},296:(e,t,n)=>{"use strict";e.exports=n(813)},613:e=>{e.exports=function(e,t,n,i){var r=n?n.call(i,e,t):void 0;if(void 0!==r)return!!r;if(e===t)return!0;if("object"!==typeof e||!e||"object"!==typeof t||!t)return!1;var o=Object.keys(e),s=Object.keys(t);if(o.length!==s.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(t),l=0;l<o.length;l++){var c=o[l];if(!a(c))return!1;var u=e[c],h=t[c];if(!1===(r=n?n.call(i,u,h,c):void 0)||void 0===r&&u!==h)return!1}return!0}},878:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAGzSURBVHgB7dm/SsNQFAbw04rvUEFBt45ZHHTq6GbeRBydTLeuPoWO9Q10UcElY50VyairiPUcTPEikabJd0+Gfj8o+TOEnC+5ybmNCBERERERERER0VrpCVCS7icim+e6mufTu7EAJenBiUg/Ffk4zaePuYBsCNBguHepiyP9jQbDHSlmz7cCkKSHGmpvoqu7espbetwrAekL1Nd1sJH9nHg75TGyYBfs6hvoHVDMXh70ytuwGpW7Wt0JFcWPdWhlAgQNwGixN4gQPIo38ABM2xC8ijdRAjBNQ/As3kQLwKwagnfxJmoApm4IXRRvogdgloXQVfEG2gkuo4Vmugh7g+zP0rgVb1wDMBUhhFyLNy5DIFQxHBbcizfgVri2ec190bnfARUPvAXoBKou1wCqnvb6s4JH5bZ7CG4B/PeqQ80dmnIJYNl7vssQogdQt8npKoSoAaza4XURQrQAmra33iFECaBtb+8ZAjwA1MTGKwRoAOhZXXUI2+/236OAoFvhJFiH9PblMcJvDMcCBP4uMHjSTIe6epFP7ycC8nsnzN9EPs+K2WshRERERERERERE1MQ32AYXtnzGBNMAAAAASUVORK5CYII="},648:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/bg.1257ad761e504e66013f.png"},140:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAwSSURBVHgB7Z19kJVVHce/5+5dYEEiLUNZ48UKrFDQHPwjlUpSwrKpP8h8i7cFFCTNXpzMWrXoTXOkQVwWFoqRlJqaMcnATKSmaYphMJs0awZJIDbsFZFluXufvr9z2VHWu3tfzu953fPZefY+9/2e833OOb/zO79zDuDxeDwej8fj8Xg8Ho/H4/F4PB6Px+PxeAYpBlmmDY0YghFM5Qj0YChyaMAx3jP8X0QXnzuCbhzGIt7PKNkQWITM4QyKeC5vp/CRd/KYwPPRCDCSRxNTmudjOfv6gH8GBZ69wuMQ73Xydjcf+xPPn+bt77EA+3gbIOWkV+B2ige8lymYydsLKcUE3g6DDgV+3m7ebuOxhWX8CdyM/yCFpEvgdRTwGKbzbDHL4kUU4U2IAkOJi3icFfwqvIjtaGX1nhLSIfBajGH1ey1/7Tzem4g4CfA8/3dQ7A2Yj/1IOMkWuANvpbA38mwujzcjWbzE3FuPo1iBJSzXCSWZAq/DG1kV385fdzOSfhEGlBhYyUr8riS208nKPLFtO3AV27t7eG800kUn7YJb2IhsTJL1nRyB23A6M2g1zz6MdPMoTbBFbFgS0T4nQ+A1uJzX/DqenYosYHCQRtgcWg4/Q8w0IG7asZD/H+RxErLDCDYzn8QVbJPfQ6fJtviq7DgFNhR3FW/vQDZdppKmyzAKJ7N+2s6KOxZ3aDwZ2063YoCf8NvPx2DAYAedoh/DMuxFxEQvcBvG8lu38DgLg4kAz/G4jObX3xAhOUTJSjouBqO4gqRZ0n4P8yBCohO4DcM55vPjQSluL5L2kcyDCGvOaARu5fcYLM94m3uEVXCx4qskD9bifkRENAI3YykTdiOyi4wu3QRx0gR2nHlgihwNe8B2D0Mn/KpiHWYxyT9F1O19lARM40I8Zs/Xs+d7DFt5dkqFdxWRx0fCdoaEK7C4HxvwNDMgGx6qchTRQst4zQmPdeA8Pr614ni1eLyOYGqYbs3wSlVgY5/aMy0uKG1fcYV52MlS/EGm/d8DvlvyZij970F4BS08T1YzrubPvhXZ5QaW3bZ+n92MA/go/sgzCSlq6vd1BhOxC3/BI3gGIRDOlSPjuQV27NM35FctSynuyqpeuRYfYgndUKG67mR7fBbbY/Xx5HCq6B4O1mdV3CI+XbW4wnxrfF3DovTPAV41mp/7JYSAfgkuhdlI3JJWhGMykO5PA7s381km62G1jSV7nDk+tuzzEiSQwzi236rhP/oluECXetbElVTlcFvd4goLedE3YgbP9pR9vhSpvQzK6JZgiX4ssluUvAA5FyRG+suslr+hEoqzBm/np+yCjBn3JWA13oBzNKM1dUtwgGuRNXGBr6iJKyzAX/lZS8o+Z2iIFXEdFNErwa2slptt6Y03blmPHuZOK0vT11SD6GS4NIftPBtX9nmDP3PseAor66NQQK8Ej7EzDrIhrgwaGNzJ4fnlquKKAZqzbsxxA3z3JFbe06FEHnosRlYwNIkWOBhU5WjD21gnbOPZGRVf24Pr+X8rFNApwffSsWHomssCBl9lm6sr7lqcyZz+JaoRt8RFxyfXOaMj8BtwCcpZhWkjwNdZcm+HJu2YwApfxB1b9XvE2ApwIRTQEVhijdKOwTdZMX8RmqxhW2usuONqfm9OJ0/dBZZojSLehzQT4G6WXN2BkftxMj/3SR7jUQ9SgmViuyPuAp9C+9nYydfpxOA7LLmfgyYy2NKInwNO+TKeBacZjrgL3IRp0LXGo0K6P7ex5N4CTVZRmAJ+w7NpcKOJXq1z4Yi7wIFdEyNtiOf3XlrLy6GJtLl5PIrSGiHuGPe81TCydBITHVJy78NU5TZXPFSBFffd0CLAu+CIhsDa7e/B45Oqw0CG5L6LUfgCzlecK9RhA/pF3MnQxTlv3QRuxRAm7DTocZDHlZBJW9oiS7kt0rY9jM9jNrqhxUYOrkjUqMHZ0EaWgXK0pN0EHofh0Jv2WRK3hf3GhXgKmiKLuDmKe5QG1TLFC6eN4r6MhzXayrLIGl9D3BxIbgLnbTDZcLiz3y6L1GKdAiVEZIOP8+xfcCXAHbSWl6iK+z16m3Ls5xp8AOHRxFrHKX/dBO7iEGHg2EUKODiWYybN5zBZX1psULiMMdcvssEGLGJjoska9v677cWo3eb2Jc9L0ik6xrUE5230c72IuIZ+7HLi9uIm8kaW3E9BE/FQwYp7DsInZ/PY6QNccKnwesVtwW8rvrYekQ0e4vuuARTHc2XULE9xo+z7O5qDbgI32JCWyjPq+lKLuL3UJvIm1gpXQVNcWUbxJDzB3z0V0RFgqFt3zk3ggr2+avsB9Yjby6siDzSD70eslq9UjcRYwWwu4Ic8Ow/RItGcToahm8DD2KtETQtz7rHL/dYjbi8icoAZ/XShllPc2arirsJbaMdKdEUc63eJAfoKHHATeI/98perfPVBZvwMG1XoSvl+8kbss8sfapbcU9kMbeInXow4MDhkFyx3wNWT1c3EH6jqtYaD6Rri9nKiyA+zZV7M31O7PdAf4sRooqFm9ALg6qDTdTV6DV/07qpeFTD722oIW6mGkjNkGlPRQu/yIWgh4ubwA56F6cSoTLHKvB0Ad4GNnUVYDc02ZFRb5Bb8gRaznrhiLedY3cNOM4mbZ+GIu8A9dhpGtUwKRWQtRNwCe7tITIRoLXlbFneBh2InZIWZ6plEw+UpDrE5j3Wqsolu/YINs0lKfHfBbg7iiLvA3bRdg35mzPVHYOONNidGZBn2/J8VN06D6kRkUxDZ+cURd4HFysvhV6iVpIgs463NeIy/5/1IEjls0+jy6cRFF7EF9dArsjgT4qCVnuWc9Y7Fay2Xo9487YOOwAa/rrBEQf+IyHn6eKMWWeK5x/DiSoa13JfDzJdfQAEdgVvYIQ/slMh6mcyKMjqRJaaymd9mcCmSyVY2ff+FAnrTR4MBlhSq7v2TWZJ3sqvyDoTJWozkgP1DQDRLCdZFDg9ACT2BG63r8Hm40czOwZOhiSziFtHOs9lIKjIB/HSblyroCTyXo0qyKY474YgsQ35FfItnn0CSCbAes/Rix3TX6JD4J9kRzJ2SyFoeLxG3Cd+GdOqSjCzCksP3oYiuwLI6jFyBOuj5rkviLkXyN/9Yp70fov46WXmWF71QGXffdbud0J0GcY/SZbQCyugLLCu1BdZhr0X9vuvV1hq9E2nYtifAyjA2udQXWGjEXYDdVVuHetyaIq5JeJv7Kp3H80ydcASWVVNzyvNuaxE5XeLC5tXccHYuDbPqMsxomZR1OTQxeIFt1QW4Hv8o+3zaxJXNLBfgCoS0Y2k4JbhEwL8WlCaVaX5q/77r9Il7kLXSQoS4HW2YAkuv8+8UY46VWpfX+67bcWuqxA3senpzbR6FSDTWpWwh0+Doqy7PPjpEZvIiEr9yGrpCJQL7dxPFVe8W9SW6DAmr+gxwiJ8rc5TTs4OpwX3Yi8+ohvn2+1XRIUbX7zK++1llAuzAaZhOs8ppxkK1hNsGn0hA61cmdFcbZptFnrN5EJG4QvTVmixYUqD7cTBuL5vHpdp7MlQiyhJcQhJo7KZROzBYkA2iu5jmiMUtfXVcPILhOGAXIlvmtEpA0pHojHm4Icy+7sBfHxfSDu2nJWnYXQjiSXyoSJp62GuYT5+biS99ySg57ZgF2HHkrOxzKN67OccnrMdKfCX4tUhGFDGF1/lmpB1JQxemJkFcIWltn+xXejVv70b6tsbrZJX8WVbKD8ZZJfclmcaNrLcs+x8WOQRuMBTJprRybQPHc0Ma8nMh2dZrqc8sVvYcJG/DrZf4u9bjKP3JS6Lv/lRLOronspO4wXU85rG8TIztV5cqXon97mCJ3aAdIBcG6ep/ygTtIi62+wqVtvGJZqcXCWc12G77tC/ytrWmlYViJb0OhjaMYoZfwhTMpAAyr/dM6G0t0MXPfMFOi5VZfjK5rkUxxixCsuFBkpmC41mNd+ECVp1TKY74uSfY9ZZlSV5ZETc4YV1NGaaT1WukJB7ic5187W4++izfv4u3cux1XeEmCWTXRSjsQCOeYTXejSYKOMwu7HmMaS4twdhlFxk7G4dVV3/3eDwej8fj8Xg8Ho/H4/F4PB6Px+PxeDyeZPB/0N0U7I7/voMAAAAASUVORK5CYII="},426:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAwCAYAAAC4wJK5AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAX8SURBVHgB7VnNTxtHFH8zaz6iqqpREzW9mUpgyySC5NKcisOtp7h8lSqHOKfeCuQPKIZbL43pP4BziJQYTM0/EJxbe4o5QAxSxfbWQyLcQyV/7U7fWwzsDrPrXZsoF/+kFXh23rx5b97XvAXooYce7GBwhYgtJBOmyScZsAn8SU+49RAqQgidMaYLEHucm8Xyi0IRrgBdCxFJJsP9/XwRN74EFxv2C10IKPKGsVouFHToEB0LQZsf6OcrcLr5roHCZDsVRoMOEP1+ZjGk8QIKkIArAmNofhp/8PlYvPJ+/+1eEFoOARGdn34KAjKgNp0KaZQJ8VgT/E6tbgwd5vLsh/htRv/TGL0TAM9oroJ+GE0jizx+hQDwbU6W+fRpvyNFQvEanRXS9bqxoxcKFT/rxefmwAQjJRhboeXl96iMN/WGMeVnPd9CjM5Nv8HIMiENIwO2epjbykCH+PrhQ6jUakvABQnjPF0Bu4eb+al2a/gyJzIhhQA6qxt3uhGA8Ofz5/DlrVsZxo27tKbjJYP7fkyr7UnE5qbpyDfsYxjvS7xhfucWSc7DrkDHb5kfmQf+v36Uyz9T0STSafinXBo2Db4tKUwAE08OX25nOhICk1dEmNouOG2WTuC+mwAuNHYcI/2Uiv5MEKR/JdGfYGD4ys0/PM3JNLW0tFjFSwCCMLQNcBeAMCz6tVd0WvKLIgpxMzZxjKZFfmDf8BDmpJ/dFnQVgjSKx/TIOcq6yqw2DKO5KZMkCfKZ9skxmGxN4r2kEpzgKkTrFOzQ/TixMGH9nC3mA8oPqFmK/w5fQH/5xm0NcvaBgQHipdtJ3AR3FQKZTjo2h3kAfOAony9YG68bw+VcPkV2vBCb0Kt1Y1likPBa55rFUvzmJGE/qeYqhaBqFCRfcIsqKtDG7WZXxGdwMFhx+O3ICNTrZhacvhGOzc4m5LlKIbCcdkwUDArQBfRSacgUmuSYouRFk0bf6Lt2rSLA3HFQaaacryCkXoKNO/lZygyM0fmZR2iWp3WWcK6IwX+9HX2o2UQXY69RiWcBhqHDk5k7fFPtE0JEnD+NQFUlnHO0/EhlRrpf8zRAK0mLjstzlEJgxozYfzcaUjngHxHFmJXswAfmx8aQd0OXhi8pxS06OSb6rUzbAaPLKkauu35zDfnF4OBgxWtvhBB8WFRsTI/Lua00fABwD+bncMuU7YAXIMoNOj4n+P9aUHo6iWq1GvbaG8HtJOwahL4+y7Y9Q6IK5c3tLP7JQofI7e8j774IBn3bqNDlecqTEJc2zCfgI0EDw8lbsL/lOeroBOK18zebhI+AZijETObkLZi4FO6V5sRMXhL8IjthJyKJfrEcNEqNzk+vUD+KLi3YMNuo1c21IGuEQk0wDHhgGxLc5EV5nvIkyltbNNFRs2A9n4IAsK60wNJEKyz/YstedwIZViOhaqTAGVL11t4ccK1iUXNSWcAWIRBYyt+YGqH+fqzWmUNoLD+KqrmuQmAFKd8dIqjdJegOvkI1dUBqzSopLWIbFrxmKMO0qxCW7QqQT2MllkxGwA8EXKqNUJPZdmR0z/7X+G8Y6Z/KtG6Z3vOOXWsYaZB8A+/Hu34EsWgvlEAKydRrxhNoI4CtUWDHsdspENq2bKKzs9TYcmqlTcumE3h0OrBsh8deVW/bhvL7g4M/rsfjQyjuvbMxrHJvYvM3eWMkuvOuXO66OPQQgMxy/Wgz/4sXve82ZnRuZld1L8Yolj7Kba9Ch7DamOTEQnH38NnG9N3a/3Q0uhPi/B4KErGPYy5IXB+Lp4K05Kmw08Ph8BfjYz9WjeYLHFrAZxAkAdCvpivlcrXdeoE/suCJZJDKLWdQa7+A74t0G6TLFEU52nS2VApTIalhHSaojMEqANxCLgYBPIFl8ImOvhS1+rPKlnyXOEGHWzt8GaxJ3dGXoncHb0s3bkd3hOBD7PQDY/dA7ZP5/JXfLkJAdP3hkdqd1C1sNdsiEAwV9Kn1ar2Z6eYKfLWfgLGxZXIzgRsbx1wSaTUczj8Bt54S+Qwz2J6qmOuhhx66x//kGJsh6yK13gAAAABJRU5ErkJggg=="},816:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/confetti.3128d0f6038fae8c1cb4.png"},558:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAADAFBMVEVHcEzrbSrlSDflSTflSTbx8fLlSTflSTfmUzvx8vPlSTflSTfmSjblSTfoYT7lSTflSDflSTflSDblSDfmSTflSTfx8fLx8fLlSTflSTfx8fLlSTfx8fLlSTflSDblSTflSTflSDb+0gPyyhLlSTf90QTlSDflSTf90gTlSDb4zgzlSTf3zQzvxBb90gTxyBTkviH3zQzluiD4zgvkviHkviHlSTf+0wPkvyDtumfkviHlSTfx8fLx8fPx8fL90wTuxBfx8fLx8fLx8fLndiznZFXx8fLkviHkviHx8fLscSjkkCrknSfqjoTrnZTqjILpgHXxvtTx8fL90gTlSTfx8fLkviHR0tTQ0dPz8/Ty8vPx8vXs7O7h4ePW1tj8zwTmTDblRTP/0wLx9ffx8vfl5efy/v/T09X+0QDlPjnkxCDkxx/knSfkkCrlPTnT1Nbx8/Tp6evkvh/y797jviLocGP81iLkvRvy9/jx9PXx8fHlQS7kvBXkPirlQzDx7u7y+vzpgXXkPCnnYVLlSDbx6urqjoTy+Pry/P7lRjbx9ALkOCTz///60Afx9P/y9P3+1wLmVUTy8/rkQznqwxrx5+fnZ1jx7/DnXE380QXmTTvw3t3uw77kOifv1dPrlIrmUUDtxRbqhXrw2tjsoprrmpHx7O3xyRLv0c7vz8zobV/owR3nWUnlvybw4uLuyMXvzMnrnpb4zQvpc2b1yw7lSjjttrDspJ3lwjDuurXsqKHpfG//2gHmyFDtsqzqioDmxkTmxTrx6tDw6Mb62TbraCnuvrrqg3fmvx/25ZXv4aXs4LHnylzoalvr2Y7s3JvR09zueiTpd2ruxsLx7Nnx7ubqz2vnvR3y8enx8/zq03fR09fu5b7y57Ty8ez8ygftrKXq1oLylRv63U/7wwnkMh3tr6j44nL1pBTwiB/pWi791A7X2N35ug3dxmr4zyPT0cbbyX74sRDZy5PW0bvd3d/83SDnvyT7uwDmmyby+vD0rDvsh07rjvlHcExHcEzf365ZAAABAHRSTlMAASvOVOsb+gghDOsT7wPXTL19l/Oi4j2FPS6o1kW0Jl8xghI2161o7OJYxDco+rVQb4BH7tOfndsgmW2L+HTACzfM1JmYwqKhsrbs2td3VbP/m////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wAARG3jGQAAGClJREFUeNrsm8lv29gdxyeWYzmO9yVL0xjJzGSbTGcwGGAGAZK0M9Mp0AJdUD5eqEPCsBCaG4HCBSmC1C6KkA4mBC2jHdogCYIWCLIhKZBOsU8+xP4DYgSxkQQICuQwh7aHkrLTxIkixxQTW1K+F1IERfL74e/93u89kh999EH7qs+//FVv+z8HnetlAl9fhCDo3Oc96/8z0b9A4OvetP+br7b8Q9DFz3rS/8dfbPuHfrr41WjP+f/kW+iFbl38uNcIfPIl9LJufdFjBK78GnpV3/YAgUOjo4MDJ89MTv3h4mv+oflzv508c3JgcHT0UDd6Hx0a7uufPKUYUSoBd+/h6/6hG9DTJw6lckRxarK/b3iom+JhcKCv/8TECNiSw3Hv/jzUTPMP7zq4rZ1GJk709w0MdsOdH/j0zJQCvJDD8Rhq7l8gcP/ecwKiFFNnPh3o6EgYFe/8NHhZDvBg/k3+BQI3dhAAYFqMhE5l0HdhZgy8Ikfp0Z03+xcIQI8dplf+MzZzoa/z3A9cODVWetU+4G4+ugO11PytB68RAKWxUxcGOir0x2fGlKCJbj7bxb+IoAkBAJRjM+Od0hQGJhUjzdwDx5On89Dumn9k4pr9fUQx2QlhcHbmaNObD0yOu2/lXyRwsykBoDw6c/ZgV3qDJ2ebuxeav+Puw7fzD0F3nj1p1gwaDGZPDh7YSnF4/DIAb/T/pvJnjwQAuDw+fDDt90+AFv4f33h7/wKBp3ffTABM9A8fQPuzoIV/rlX505TAw3stCIDZA4Zg9PR5ZSv/pgfzt6C96c79e7dbHFJ5/vQB6hX7vhkBrfzvWv40Hxg8vl1qcdSRbw5KfTh04hKQ379A4KfHt1se+NKJoYPgf1yhbHmZjifP5iFpuvWgVR4Q2oFifP+T39R0S/tvX/40i4H5B4Brefjpqf1Nhof6L6G7SCh//i5Z0J1HN3c5/qX+91MXDR5pois/zu2i9H//9fM/29HP/0nvdo4frzS7tiOydhKHjl/9/tjh10Sod5PuH23r37uehDjcRN9f/U7G23/9GowgsBSRf2tXKknnhTXw4euyNY6r1+BO1LXrMvk/frgj/cOaY8flSQC/hztVf5UFwJEfOhbA747IAeC7Yx0L4IdfyJICOhfALz8A+ADgA4APAA4GAEytxjTiCq5Ts0jvAcCDhUKQEMcG2c3CUgLvNQCIJkZRcY3gm/VzTNGH9RoAlTlCU64oAePauIHJJImtsMDxrcYgjDQRHBcXKhxBkOcbke4BQGbTjInyszDmc6EcmmMb9hNOpxkmhVVtQqNxOjUJLZxwmhMJd8O/NpHoHgBYNIya6JAWJ3OUCQQWhAhQuf0Rl6tay2K4uxYp1+b00UjMXzduhixlVvRfsMTw7gGQokuAMfowbYgCJbrgxnFziLJRaMAwF9Ul9BtG1KDPb/C8jUt5aBeMw+oFLx0nuycJ1gy8y0uvEU4PY3QZlp2kZtGApuOxiJcqIm4hQRhD+TyNlvSb2gIaLusQbJXis0i3AECE1GeMuQIhbY7yxuu2lSyRDVN62G6310zeBSJioJbsuhxNVzV2lS/M6HXqJZ6Oq7omByDmqiHtWw54nCHKGAzZwlFiiTKlQ/W6pV5iIupIwOsjsDwdKNiF5KinPEl1hPZG8a4BgDuNhqp60cT4PdSqPUbTKayCAnpDkI2yzekigUwUw/IGalEAgOQYJhb1BCzu7ukGcR+g6/aUkXJx3kX7gjewgGwy4XplUVShDEdsHp8IgKmIEeBM03N6ypSSoVqSB8CfNO3GIrLGmGJ2YpUyoZ6gPecxxN1BBg0RCKwRen1cuwMAAm/SpRIdMasOCICzf9S2fSnrDF+2WmNeDi3qiOiKQZ8wr9LhQta5Nre6RuwEIBQNvFAs+Yn2/auu/VmGp5+zlrYBuOsGT4olgjwNKizpXrUZnVgyQ9EcoCh0mdDqN8QckLPRDQC4NiT0B1kZWgBm/kv7z04nDTIAiGSqTgxm9Z4VHw5b47wxi2PBaibs5V1xt1Adhed8GJnkPTW12GDIzQCzoJNjDG7WT7br//S0DAA0wVRUSOmkLxkkxYFBMqUVxoVYvrZe9lmFROBLBbUIYk4ls2Lth2XTtmKWkAcAdbrNtz4VQAYAMME2/GCNhQZjG1MiCKtWW7Ht7Yj4myXFORN8iWYqalgeALSirbdLB6eALAD21Gea0zaXj5ULAJhq57OLfvD+ASApjyemg2UDAPrb6AHG9gEAbI76zKSMAMak9wRTYD8AIBgm05zhFgAwJfn9r+l9ASCftgFMS3yXbGjrWyeJAJDt+T5xtu/VUQ2OIe8TAFBIe59wUikZAMJaCZy1bj0AeG1yk9RkX2bC2tWN7u/dAVBKKof6tr94kgCAYIMLhfhiOUgQGsy3GFra4Q93LxYr7hcz5qnKQhZ7pwDAWJ/UDCgJAOGMGymbzca44j4rm+c36jsAsLlwAI0+DwGh8t9A/bp3C0BKHhw/KhUA7itSdMDEcwEDVcyrk0YqtBNAMGML/3++D3fHbXzuXQM4uuc8OHQeSAWQWKWoTCWfzMUyNBWziwAQnVVHbNW8mFVH5mI5wT9hFVaFhFiw8Sl7o1pmreJzQyF5bGcPGNOpdYRQIhMacd2qw6QCAOeHJNSA0gCQFY5xBTEdy8LBqkWrEwH4QsVqGcbxpcJSatXiK8drGtxdrhYtQTJRKVLhiN+9Xqi5K9Vi3Ill48XVdbEUQpC1SFG/YK4UygSC+ZeL9RwmFcBe68HhWckAcBfK+3WN0Q5pTpBs0sisZACKmgpuIuJ1GW16ZxFdcbtjHMqY+LLTyAFARRIuU6bKCXut+o3CzmjdSSKJuJdj0FI1XFq2suteFOX4GCEVwOywxADYKwBVlGfmng9lhB5QBGDyrrhKTDhlXTZx/FyZSFMuJBqmjEXeu+As8lyJD2mNKFdypb0o8HpXhAW6xiLrKOp1pXkTx+nt0TSdEXYvSAawtxAYnpAMAFsLm+ov5TQRgLemS0ToQNka4UoxO5YQAOBBiorb15bcJC7kgLyaMKLAQqjjHFdaZPEQHdjEnBmUr7G6aFoEkDTaQonouvQmACb2EgLjoC0AFutOAHPioy5DoMZG0EyeIEUAcDYd8NaTLLbdC2BGxuMj2LyH8WhgdZkJLOJ+gFrssIbNh1G93awPoMt5rA0AewmBocvSAZDRMFN8DkClEgFQFjdsLaM2EYAnijUAaMmcJ2ALF/5H3dnGRHWlcRwkESNC1I2JDVFoNDV9MTVGG2u/7If90GT328xc6FzUAKPSul3Hy12GGcZBF9aXVKDOguMAIiwqsTCCrFRag/K2W3kd2gLLILB1SZZ0IVZTm3a/7bkzA9yZuTP3vN3h8nyQF4ne/49zn+c5zznnObfYJQBFZn1+TVHBNw7dmerKazeM3xXXegtjxqbMs2fO3B46/UnlzQoWH8Cb8IHgFS0+AJ2uyHa55ZI38mdbCgUnKOQBF/6h9QGo8gPQn695VHu64L5+EUDBlQu6/PqigrMCgNpPbhj/U1wr1Aj1FgGA5VjV9aaC0+fwfYBW+wr0IbjtJACyb2RmflZ1KT/7/LGaB3fzlwC0BQIwms35zVdsVx3LAI7phBHwlR+A/nZxJvD+5kufVwIAxsL8M7f/ZmtC2lwSBGA77BmKV+OJRkDFkC2z6G5LffPdotMXv7wkDcDiuPug5vwDW20IgMURoCu8Yqu8XlXx+VXgBC/kf/lNc/ajzKaafHwA8bAnr9/REgHIrimy2bRNV5vabLahmmPSABxf2DKbimozH1jCAjA3V2a2XS2qtRUXn71UXVlwGfz4ZzojPgDtO5CV4AQyALrsqr9WFoO0pbj2egUrRAEvgEohClwsEgD80TZkuXMWpD0Xh+rNjpvXmgQAmUMAQP0Vm+8VuHYfJI7VV0FKVHnzMgBQcU7IpYpasgl8gDZhLUodAB8A+C3Vf3f90fWHVeAz459bquuFxYBvq+8Ya6qbb+n1jtvVLRZ9YfONm19UGHWW+urmClbfUt1i9v5wjUVnrvi2ukoIInce3rxf72iurjHr9bfv331YodORAICsC8RpSQEIWbA528zqxRUh4YOwF2ypWgTcoP8ro/evjUE/7A2qZvCJ7wu993MiANo4qCw4MRjALTo12hWrCYrOG8PMipODDmdeOzezWoui5omv/hQoZov8AaG1gb1/ij/8+/jE6gUw+N+/BPYkkneD78UHHf39ZW7VjgDD2Owvgb044t9DewOKhc4ns6t2BNhzZ4UGbWJFybJZYOAb8PW/Ps2ZHTWsUgCe7t4cQEB8AF22PrxL/Ptv+/rIp5qc3lH7ah0BAIDQok4regt2ycyDtog7P3x/JCsrK6c317M69bOl3b1AACAgak21JQlqNcTb+OvfrSXAjvT2jBlX4xiw68ame48IElq/X25NJfMOiGqBH/7vxD+99nNXh3u0jLWsLvkGe/dwR9fPPgknPv4DZGFoqwjA7z/ivcaZTNaOAUfZqtJfNubutJpMjE+CGMDWiBPBTQEAmCWzcpPdpewqevt7xoH6JRMD2BQpF9oZHwYAY7J2DpQZxK+B/gM1mXiaZLHb+7usHCMNIH5nBACp2nAAGM7qeloo8oX6jENqsgwRAc/YpCtAfwAAbWrkTWHhAIBBwA12L78Fh06mqciOHz60RMDQ0yEe/iEAImwbWxsXCQDDmbqmdH4ER9PS1QQgLf34UR8BVjfQbuKYCAAi7BxMaYsIgOE4l9tfHTmcpjJLX/ACYCeGXVyw/kAAbSlQC0JSAAQEk2N28D9lnFQdgMMO4Jjso+Nc6FMHAtCGrYokbZUFAF6Djm4Pq3OoEAD49Xt6Ok2MLICt4bLh9ZvkAYBo0DXlMeh/SlcbgJ8+MNgH2q2MPIBN4dbINiRAAABJUbvbYMg4nK4uW8iws26XtP4gAInh1olTtFAAGJAR6LIzDi0cVo8tHMqwF05yYfQHAdCugfGBEQCAjGB8zGDJUJPp7LmDJhMDByDMfCh2MywAwRWOsno1GdvdaeIYSACbpZuMJSVDAwCDoLNHVXOjqa4I+oMBJEuHgaQ4BACMqWvAoBYELNvfzkV62CAAcdIA1iWiAGBMLjerjmqp3QKyPwYBQKL0bCAlHgkAcIVPHWqoFnomJsO7P0kA8dLJ8DZEAIzJOj628sVCT+6glWPQAEgeJUtKbUMEALLCwdGVHgOe7g5Z/cEA2lKlnEBSYBSEAQAIdHSv7Biw93RaZR8zGIB2c5JcNQQSAMgKO6fsK1gvtg90QegPASBZE1mXjANACIcr9xZku9tNDAaA5HWyc0FoAIyp3W1nVyj8D7ug9IcAkJwPro/DAwASgmHjShAwWJ66OAYLgOQpqvWvYwJgOC6gXhyt139inIPUHwLg9fXyu+MQAIBgEP2EwDMqH/7DhkHJ/XIp+ABWICGACv9hR0CCVCq4hgCAkBD0lEVxIahsCib8hwcgVRLZSQJASAgGTh2Nlp2CC//hAUjtGt6ZSASAN7X/OHI8OjbyI1z4DwsgUWp9cBsZAB+BtCiUP9NGXrjQ9IcC2KYAAEDA9eLJE8Xr30+evHBxjBoBAFfIvEhTmsCT9Gccqv6oAWA407N0ZQmMPH9mQtYPB2AnBQAgHD57PqKofoT0B9EJvppAAQAIh4PPRxTzfyMvO6w4DwUVBtfQAcBYO14uHD+piC287MTSD5cIpdABwPPWjinDKSUsYwBTP1wqvJbSCPAumiiRFpdOd5kYSgDWUp0Oh8aCroFS+jv/+ttx9cNNh7ELIlIE2vspV4lYuxtfP2RBZBM1AACBy82yK1L9wi+JYRZFwyaFbh1Ls/qFkf4gFkXxyuLhPaFp2EFr6dAwM2kl0Q9XFsdZGInsCJ7O0CFgGCPUD7cwgrE0JpcWT05QWDSx2MfGCfXDLY2hL47Kj4HxMQ8pAQvM4iciAOnFUeTlcahqcS4hAUvZKLl+yOVxxA0S0akWlyFVf8k2SKBtkYGuFhMtHwtbP8n1Q26RQdokBe8HOnuwCbCeqS4ThYcIBvBaEuk2OaSEoGvKgJv+DrRT0Q+5TQ5+oyQigfaB0DHAGjylIvNITB1YQ7+Ljn7IjZLQW2VxCAS0PjAAxWPdU9P9fT7rn+4ZnQHfCziaZzS4aemH3SoLuVkah0B/mVGkPne6b262N29+8X7lrPm83tm5vh5d6XLIMNrp6Q8CkLCBZLs8HgGXu4z1y5/pn+vN818srXHmOMGfmhzw4ch83uxcj91/OI+1D9PTD7tdHubABD4B4S1nS0fneue90iUMfDtvtk/n8b7/www9/bAHJmI3KgYAqBkGqkbn8pw5ka5bz8mZ7+2zsKzuKUdRP+yRGdlDU4TT45m+PE2O3I3zAoJph+zeTwIAEQ5NyRybI0yJyn/QQFmOZv6HRo5RDECEY3ORD04SGf+4wZmjgbWskjqOVwpApH77qUoB4BtbszQIlpV1r5FXCEAq1uFpQv11JUj6BQSt5bwiACIeng57fJ5MPt/gRNXvfQ14XgEAEY/PBzVQoPb6a9D1AwLOBlqOALqBQkALDUoA+MZ7OPK9CGg5AvgWGqImKpQA8OWtuPoFR0CHgAiATBMVURsdOgAw3F+gI6DiCkUAZNroiBop0QFQ59SQmbOOLoBdkNcqUAEguD9yq2N4egDkr1pIpgeAf3wviwIATcNjnhoA2WZqy+30iAEQuH/awWAJAEQ7vaWGiqQAiNw/5WCwBACioWLMFjoA+PISWvrJ8+IlAPItNWNiNibSAMDXOenpJw6HiwCgmqouttUlA9Dg1NA1onC4CACqre5iY2USAFTCX2gwIAUA2VjZv18OHwA19x8cDLDDoR8AZGttf3N1bAB8Y6tGGcMOh34AkM3V/e31cQFQdf+UwqEPAHR7fd8FC3gAeMLZj3ww4LEBQF+w4LtiAwsA0O/UKGhZTqwykQ8A9BUbvktWcADwDF7xB4GApgFjbuQFgHDJircwhAEAzH4U1u8lgF4o8wJAuWlJuGgJHYBQ+1Zav7di/hgHANJFS8IQQAfQWKKJjrU2YgBAu21tw3Z0AOXR0q/RlJQjA0C8bA0MATQAPKOs+w+eGZQjuUIAAPX65fWvIQHguQZNVM2JVCg78THyhYsxGxMQAPCPG7KiCwAtGJz4LcbVw7+CB0Cr+IdG4B48gRO/Qdcfu+Z3HyGEP03UDWUB+cBunIuH90ICUHD2Q2luxO/Funl63f4orX0oHQ75/b/Gu3x8zz4o/ZoVNKhC2b49uNfPH1Rf+Ash0CA/OzyIqz9mxwGI2c9Km2yh7MAObACxe9To/lFLhdgvgOAHD0Zp7UfBYHBwHQGAmHf3qzD8Ia2a7H83hsj28FFa+yEjUBfuMfk9ZPpjYveGX/tRi37vfqowBPbGEgKI2fG25D/MKV/8QiQg+Zhv7yDVHxO7W8oNqCD8hYRDie3F+3fHkFtsaEKo3NoPWaGMp5YCBs2K+KDav1rcv8wmAsw5kIS9H7z2oUb9ocHgfVr6Axyh8msfZOtGyw9KwQEuO0LRpEC9+n3rRmRFkHDLpW/tWy5+qVe/t0zkK5Tx+96KoWmxvoxQne5fanYIMsBYqgCS3lDP7AdmbvTG/9u5n+Q2YSgM4J+AkRj+CAxmxkwmjg0B29hxxs7CyxyiB2int+pBfL/CNF20i8ykRdKTw29lvPseek+IBRgZk+fh9PPFBv3Z6ASJ0Z0Nvvz74HZ4hhKVJQX4UanJD1kdP3X+fhDYUIFjNe78/6sLbMiv1Il6AU4MiitAuguOJwnVui3d/NsOGhwaqvmbA7R4eqWZ//UJTE8F6gvF/Jca+lTkBsG20nX730YhsUHQdNDs8Ewp//MB2tVk2uD7tqphgHwh0gbNi4QZ9YXAY+HxUsMY1jVfDWs6xpi5CiDK598MmucRTEvdPz/GqpFwUxAQLHZm8u8WAWhwilh//LhwQIa8bzX3gWjvfVASeUud+ZdeBGJY5M10xZ/Ri/9rFaR7HfH3Kc34wyjwy6XiWSCWpc9A2boIldVAhMUa9PHMVbIrxm7GYQeZFsnIy0AkRSphEb65S65jpb8mdxsO6zibIhkjflJsHNhJOt5iNv+f8PPZwnMkLCb54yp3/y29m68eudXpfx8X+bASPrQzxMOd5wFuhx9Ejpe1bizEO7PxKkTstpnnRIGP28OYlD4vV1ne7pNdGIbxm/7nLtm3ebYquS8lw23rqxD0+MO6LNNeWa4f+PBPnx2fB3v3cjKZTCaTyUS9n+FuYZDsdvFWAAAAAElFTkSuQmCC"},493:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/santa.63ddfb0bf39f42c99f9b.png"}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var o=Object.create(null);n.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>i[e]));return s.default=()=>i,n.d(o,s),o}})(),n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,i)=>(n.f[i](e,t),t)),[])),n.u=e=>"static/js/"+e+".a3a57bc5.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="treasurehunt:";n.l=(i,r,o,s)=>{if(e[i])e[i].push(r);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+o){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+o),a.src=i),e[i]=[r];var d=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var r=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(n))),t)return t(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/treasurehunt/",(()=>{var e={179:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var o=new Promise(((n,i)=>r=e[t]=[n,i]));i.push(r[2]=o);var s=n.p+n.u(t),a=new Error;n.l(s,(i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,r[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,o,s=i[0],a=i[1],l=i[2],c=0;if(s.some((t=>0!==e[t]))){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(l)l(n)}for(t&&t(i);c<s.length;c++)o=s[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},i=self.webpackChunktreasurehunt=self.webpackChunktreasurehunt||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),n.nc=void 0,(()=>{"use strict";var e=n(791),t=n.t(e,2),i=n(250);function r(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var o,s=n(164),a=n.t(s,2);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},l.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(o||(o={}));const c="popstate";function u(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function h(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function d(e,t){return{usr:e.state,key:e.key,idx:t}}function p(e,t,n,i){return void 0===n&&(n=null),l({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?m(t):t,{state:n,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function f(e){let{pathname:t="/",search:n="",hash:i=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function m(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function _(e,t,n,i){void 0===i&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,a=r.history,h=o.Pop,m=null,_=g();function g(){return(a.state||{idx:null}).idx}function y(){h=o.Pop;let e=g(),t=null==e?null:e-_;_=e,m&&m({action:h,location:x.location,delta:t})}function v(e){let t="null"!==r.location.origin?r.location.origin:r.location.href,n="string"===typeof e?e:f(e);return u(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==_&&(_=0,a.replaceState(l({},a.state,{idx:_}),""));let x={get action(){return h},get location(){return e(r,a)},listen(e){if(m)throw new Error("A history only accepts one active listener");return r.addEventListener(c,y),m=e,()=>{r.removeEventListener(c,y),m=null}},createHref:e=>t(r,e),createURL:v,encodeLocation(e){let t=v(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){h=o.Push;let i=p(x.location,e,t);n&&n(i,e),_=g()+1;let l=d(i,_),c=x.createHref(i);try{a.pushState(l,"",c)}catch(ws){if(ws instanceof DOMException&&"DataCloneError"===ws.name)throw ws;r.location.assign(c)}s&&m&&m({action:h,location:x.location,delta:1})},replace:function(e,t){h=o.Replace;let i=p(x.location,e,t);n&&n(i,e),_=g();let r=d(i,_),l=x.createHref(i);a.replaceState(r,"",l),s&&m&&m({action:h,location:x.location,delta:0})},go:e=>a.go(e)};return x}var g;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(g||(g={}));const y=new Set(["lazy","caseSensitive","path","id","index","children"]);function v(e,t,n,i){return void 0===n&&(n=[]),void 0===i&&(i={}),e.map(((e,r)=>{let o=[...n,r],s="string"===typeof e.id?e.id:o.join("-");if(u(!0!==e.index||!e.children,"Cannot specify children on an index route"),u(!i[s],'Found a route id collision on id "'+s+"\".  Route id's must be globally unique within Data Router usages"),function(e){return!0===e.index}(e)){let n=l({},e,t(e),{id:s});return i[s]=n,n}{let n=l({},e,t(e),{id:s,children:void 0});return i[s]=n,e.children&&(n.children=v(e.children,t,o,i)),n}}))}function x(e,t,n){void 0===n&&(n="/");let i=z(("string"===typeof t?m(t):t).pathname||"/",n);if(null==i)return null;let r=b(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(r);let o=null;for(let s=0;null==o&&s<r.length;++s)o=P(r[s],R(i));return o}function b(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");let r=(e,r,o)=>{let s={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};s.relativePath.startsWith("/")&&(u(s.relativePath.startsWith(i),'Absolute route path "'+s.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),s.relativePath=s.relativePath.slice(i.length));let a=B([i,s.relativePath]),l=n.concat(s);e.children&&e.children.length>0&&(u(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+a+'".'),b(e.children,t,l,a)),(null!=e.path||e.index)&&t.push({path:a,score:k(a,e.index),routesMeta:l})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let i of w(e.path))r(e,t,i);else r(e,t)})),t}function w(e){let t=e.split("/");if(0===t.length)return[];let[n,...i]=t,r=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===i.length)return r?[o,""]:[o];let s=w(i.join("/")),a=[];return a.push(...s.map((e=>""===e?o:[o,e].join("/")))),r&&a.push(...s),a.map((t=>e.startsWith("/")&&""===t?"/":t))}const T=/^:\w+$/,S=3,E=2,C=1,A=10,I=-2,M=e=>"*"===e;function k(e,t){let n=e.split("/"),i=n.length;return n.some(M)&&(i+=I),t&&(i+=E),n.filter((e=>!M(e))).reduce(((e,t)=>e+(T.test(t)?S:""===t?C:A)),i)}function P(e,t){let{routesMeta:n}=e,i={},r="/",o=[];for(let s=0;s<n.length;++s){let e=n[s],a=s===n.length-1,l="/"===r?t:t.slice(r.length)||"/",c=D({path:e.relativePath,caseSensitive:e.caseSensitive,end:a},l);if(!c)return null;Object.assign(i,c.params);let u=e.route;o.push({params:i,pathname:B([r,c.pathname]),pathnameBase:N(B([r,c.pathnameBase])),route:u}),"/"!==c.pathnameBase&&(r=B([r,c.pathnameBase]))}return o}function D(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,i]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);h("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:(\w+)(\?)?/g,((e,t,n)=>(i.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(i.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let o=new RegExp(r,t?void 0:"i");return[o,i]}(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let o=r[0],s=o.replace(/(.)\/+$/,"$1"),a=r.slice(1),l=i.reduce(((e,t,n)=>{let{paramName:i,isOptional:r}=t;if("*"===i){let e=a[n]||"";s=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const l=a[n];return e[i]=r&&!l?void 0:function(e,t){try{return decodeURIComponent(e)}catch(ws){return h(!1,'The value for the URL param "'+t+'" will not be decoded because the string "'+e+'" is a malformed URL segment. This is probably due to a bad percent encoding ('+ws+")."),e}}(l||"",i),e}),{});return{params:l,pathname:o,pathnameBase:s,pattern:e}}function R(e){try{return decodeURI(e)}catch(ws){return h(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+ws+")."),e}}function z(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,i=e.charAt(n);return i&&"/"!==i?null:e.slice(n)||"/"}function L(e,t,n,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function O(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function F(e,t,n,i){let r;void 0===i&&(i=!1),"string"===typeof e?r=m(e):(r=l({},e),u(!r.pathname||!r.pathname.includes("?"),L("?","pathname","search",r)),u(!r.pathname||!r.pathname.includes("#"),L("#","pathname","hash",r)),u(!r.search||!r.search.includes("#"),L("#","search","hash",r)));let o,s=""===e||""===r.pathname,a=s?"/":r.pathname;if(null==a)o=n;else if(i){let e=t[t.length-1].replace(/^\//,"").split("/");if(a.startsWith("..")){let t=a.split("/");for(;".."===t[0];)t.shift(),e.pop();r.pathname=t.join("/")}o="/"+e.join("/")}else{let e=t.length-1;if(a.startsWith("..")){let t=a.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}o=e>=0?t[e]:"/"}let c=function(e,t){void 0===t&&(t="/");let{pathname:n,search:i="",hash:r=""}="string"===typeof e?m(e):e,o=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:o,search:j(i),hash:U(r)}}(r,o),h=a&&"/"!==a&&a.endsWith("/"),d=(s||"."===a)&&n.endsWith("/");return c.pathname.endsWith("/")||!h&&!d||(c.pathname+="/"),c}const B=e=>e.join("/").replace(/\/\/+/g,"/"),N=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),j=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",U=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;class V{constructor(e,t,n,i){void 0===i&&(i=!1),this.status=e,this.statusText=t||"",this.internal=i,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}}function G(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const q=["post","put","patch","delete"],H=new Set(q),W=["get",...q],Z=new Set(W),X=new Set([301,302,303,307,308]),Y=new Set([307,308]),K={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Q={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},J={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},$=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ee=e=>({hasErrorBoundary:Boolean(e.hasErrorBoundary)}),te="remix-router-transitions";function ne(e){const t=e.window?e.window:"undefined"!==typeof window?window:void 0,n="undefined"!==typeof t&&"undefined"!==typeof t.document&&"undefined"!==typeof t.document.createElement,i=!n;let r;if(u(e.routes.length>0,"You must provide a non-empty routes array to createRouter"),e.mapRouteProperties)r=e.mapRouteProperties;else if(e.detectErrorBoundary){let t=e.detectErrorBoundary;r=e=>({hasErrorBoundary:t(e)})}else r=ee;let s,a={},c=v(e.routes,r,void 0,a),d=e.basename||"/",f=l({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_prependBasename:!1},e.future),m=null,_=new Set,y=null,b=null,w=null,T=null!=e.hydrationData,S=x(c,e.history.location,d),E=null;if(null==S){let t=ve(404,{pathname:e.history.location.pathname}),{matches:n,route:i}=ye(c);S=n,E={[i.id]:t}}let C,A,I=!S.some((e=>e.route.lazy))&&(!S.some((e=>e.route.loader))||null!=e.hydrationData),M={historyAction:e.history.action,location:e.history.location,matches:S,initialized:I,navigation:K,restoreScrollPosition:null==e.hydrationData&&null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||E,fetchers:new Map,blockers:new Map},k=o.Pop,P=!1,D=!1,R=new Map,L=null,O=!1,F=!1,B=[],N=[],j=new Map,U=0,V=-1,G=new Map,q=new Set,H=new Map,W=new Map,Z=new Set,X=new Map,ne=new Map,oe=!1;function ae(e,t){void 0===t&&(t={}),M=l({},M,e);let n=[],i=[];f.v7_fetcherPersist&&M.fetchers.forEach(((e,t)=>{"idle"===e.state&&(Z.has(t)?i.push(t):n.push(t))})),[..._].forEach((e=>e(M,{deletedFetchers:i,unstable_viewTransitionOpts:t.viewTransitionOpts,unstable_flushSync:!0===t.flushSync}))),f.v7_fetcherPersist&&(n.forEach((e=>M.fetchers.delete(e))),i.forEach((e=>ke(e))))}function le(t,n,i){var r,a;let u,{flushSync:h}=void 0===i?{}:i,d=null!=M.actionData&&null!=M.navigation.formMethod&&Ae(M.navigation.formMethod)&&"loading"===M.navigation.state&&!0!==(null==(r=t.state)?void 0:r._isRedirect);u=n.actionData?Object.keys(n.actionData).length>0?n.actionData:null:d?M.actionData:null;let p=n.loaderData?_e(M.loaderData,n.loaderData,n.matches||[],n.errors):M.loaderData,f=M.blockers;f.size>0&&(f=new Map(f),f.forEach(((e,t)=>f.set(t,J))));let m,_=!0===P||null!=M.navigation.formMethod&&Ae(M.navigation.formMethod)&&!0!==(null==(a=t.state)?void 0:a._isRedirect);if(s&&(c=s,s=void 0),O||k===o.Pop||(k===o.Push?e.history.push(t,t.state):k===o.Replace&&e.history.replace(t,t.state)),k===o.Pop){let e=R.get(M.location.pathname);e&&e.has(t.pathname)?m={currentLocation:M.location,nextLocation:t}:R.has(t.pathname)&&(m={currentLocation:t,nextLocation:M.location})}else if(D){let e=R.get(M.location.pathname);e?e.add(t.pathname):(e=new Set([t.pathname]),R.set(M.location.pathname,e)),m={currentLocation:M.location,nextLocation:t}}ae(l({},n,{actionData:u,loaderData:p,historyAction:k,location:t,initialized:!0,navigation:K,revalidation:"idle",restoreScrollPosition:He(t,n.matches||M.matches),preventScrollReset:_,blockers:f}),{viewTransitionOpts:m,flushSync:!0===h}),k=o.Pop,P=!1,D=!1,O=!1,F=!1,B=[],N=[]}async function ce(t,n,i){A&&A.abort(),A=null,k=t,O=!0===(i&&i.startUninterruptedRevalidation),function(e,t){if(y&&w){let n=qe(e,t);y[n]=w()}}(M.location,M.matches),P=!0===(i&&i.preventScrollReset),D=!0===(i&&i.enableViewTransition);let u=s||c,h=i&&i.overrideNavigation,p=x(u,n,d),f=!0===(i&&i.flushSync);if(!p){let e=ve(404,{pathname:n.pathname}),{matches:t,route:i}=ye(u);return Ge(),void le(n,{matches:t,loaderData:{},errors:{[i.id]:e}},{flushSync:f})}if(M.initialized&&!F&&function(e,t){if(e.pathname!==t.pathname||e.search!==t.search)return!1;if(""===e.hash)return""!==t.hash;if(e.hash===t.hash)return!0;if(""!==t.hash)return!0;return!1}(M.location,n)&&!(i&&i.submission&&Ae(i.submission.formMethod)))return void le(n,{matches:p},{flushSync:f});A=new AbortController;let m,_,v=he(e.history,n,A.signal,i&&i.submission);if(i&&i.pendingError)_={[ge(p).route.id]:i.pendingError};else if(i&&i.submission&&Ae(i.submission.formMethod)){let e=await async function(e,t,n,i,s){void 0===s&&(s={});fe();let l,c=function(e,t){let n={state:"submitting",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text};return n}(t,n);ae({navigation:c},{flushSync:!0===s.flushSync});let u=Pe(i,t);if(u.route.action||u.route.lazy){if(l=await ue("action",e,u,i,a,r,d),e.signal.aborted)return{shortCircuited:!0}}else l={type:g.error,error:ve(405,{method:e.method,pathname:t.pathname,routeId:u.route.id})};if(Se(l)){let e;return e=s&&null!=s.replace?s.replace:l.location===M.location.pathname+M.location.search,await de(M,l,{submission:n,replace:e}),{shortCircuited:!0}}if(Te(l)){let e=ge(i,u.route.id);return!0!==(s&&s.replace)&&(k=o.Push),{pendingActionData:{},pendingActionError:{[e.route.id]:l.error}}}if(we(l))throw ve(400,{type:"defer-action"});return{pendingActionData:{[u.route.id]:l.data}}}(v,n,i.submission,p,{replace:i.replace,flushSync:f});if(e.shortCircuited)return;m=e.pendingActionData,_=e.pendingActionError,h=Re(n,i.submission),f=!1,v=new Request(v.url,{signal:v.signal})}let{shortCircuited:b,loaderData:T,errors:S}=await async function(t,n,i,r,o,a,u,h,p,f){let m=r||Re(n,o),_=o||a||De(m),g=s||c,[y,v]=se(e.history,M,i,_,n,F,B,N,Z,H,q,g,d,p,f);if(Ge((e=>!(i&&i.some((t=>t.route.id===e)))||y&&y.some((t=>t.route.id===e)))),V=++U,0===y.length&&0===v.length){let e=Be();return le(n,l({matches:i,loaderData:{},errors:f||null},p?{actionData:p}:{},e?{fetchers:new Map(M.fetchers)}:{}),{flushSync:h}),{shortCircuited:!0}}if(!O){v.forEach((e=>{let t=M.fetchers.get(e.key),n=ze(void 0,t?t.data:void 0);M.fetchers.set(e.key,n)}));let e=p||M.actionData;ae(l({navigation:m},e?0===Object.keys(e).length?{actionData:null}:{actionData:e}:{},v.length>0?{fetchers:new Map(M.fetchers)}:{}),{flushSync:h})}v.forEach((e=>{j.has(e.key)&&Oe(e.key),e.controller&&j.set(e.key,e.controller)}));let x=()=>v.forEach((e=>Oe(e.key)));A&&A.signal.addEventListener("abort",x);let{results:b,loaderResults:w,fetcherResults:T}=await pe(M.matches,i,y,v,t);if(t.signal.aborted)return{shortCircuited:!0};A&&A.signal.removeEventListener("abort",x);v.forEach((e=>j.delete(e.key)));let S=xe(b);if(S){if(S.idx>=y.length){let e=v[S.idx-y.length].key;q.add(e)}return await de(M,S.result,{replace:u}),{shortCircuited:!0}}let{loaderData:E,errors:C}=me(M,i,y,w,f,v,T,X);X.forEach(((e,t)=>{e.subscribe((n=>{(n||e.done)&&X.delete(t)}))}));let I=Be(),k=Ne(V),P=I||k||v.length>0;return l({loaderData:E,errors:C},P?{fetchers:new Map(M.fetchers)}:{})}(v,n,p,h,i&&i.submission,i&&i.fetcherSubmission,i&&i.replace,f,m,_);b||(A=null,le(n,l({matches:p},m?{actionData:m}:{},{loaderData:T,errors:S})))}async function de(i,r,s){let{submission:a,fetcherSubmission:c,replace:h}=void 0===s?{}:s;r.revalidate&&(F=!0);let f=p(i.location,r.location,{_isRedirect:!0});if(u(f,"Expected a location on the redirect navigation"),n){let n=!1;if(r.reloadDocument)n=!0;else if($.test(r.location)){const i=e.history.createURL(r.location);n=i.origin!==t.location.origin||null==z(i.pathname,d)}if(n)return void(h?t.location.replace(r.location):t.location.assign(r.location))}A=null;let m=!0===h?o.Replace:o.Push,{formMethod:_,formAction:g,formEncType:y}=i.navigation;!a&&!c&&_&&g&&y&&(a=De(i.navigation));let v=a||c;if(Y.has(r.status)&&v&&Ae(v.formMethod))await ce(m,f,{submission:l({},v,{formAction:r.location}),preventScrollReset:P});else{let e=Re(f,a);await ce(m,f,{overrideNavigation:e,fetcherSubmission:c,preventScrollReset:P})}}async function pe(t,n,i,o,s){let l=await Promise.all([...i.map((e=>ue("loader",s,e,n,a,r,d))),...o.map((t=>{if(t.matches&&t.match&&t.controller)return ue("loader",he(e.history,t.path,t.controller.signal),t.match,t.matches,a,r,d);return{type:g.error,error:ve(404,{pathname:t.path})}}))]),c=l.slice(0,i.length),u=l.slice(i.length);return await Promise.all([Ie(t,i,c,c.map((()=>s.signal)),!1,M.loaderData),Ie(t,o.map((e=>e.match)),u,o.map((e=>e.controller?e.controller.signal:null)),!0)]),{results:l,loaderResults:c,fetcherResults:u}}function fe(){F=!0,B.push(...Ge()),H.forEach(((e,t)=>{j.has(t)&&(N.push(t),Oe(t))}))}function be(e,t,n){void 0===n&&(n={}),M.fetchers.set(e,t),ae({fetchers:new Map(M.fetchers)},{flushSync:!0===(n&&n.flushSync)})}function Ee(e,t,n,i){void 0===i&&(i={});let r=ge(M.matches,t);ke(e),ae({errors:{[r.route.id]:n},fetchers:new Map(M.fetchers)},{flushSync:!0===(i&&i.flushSync)})}function Ce(e){return f.v7_fetcherPersist&&(W.set(e,(W.get(e)||0)+1),Z.has(e)&&Z.delete(e)),M.fetchers.get(e)||Q}function ke(e){let t=M.fetchers.get(e);!j.has(e)||t&&"loading"===t.state&&G.has(e)||Oe(e),H.delete(e),G.delete(e),q.delete(e),Z.delete(e),M.fetchers.delete(e)}function Oe(e){let t=j.get(e);u(t,"Expected fetch controller: "+e),t.abort(),j.delete(e)}function Fe(e){for(let t of e){let e=Le(Ce(t).data);M.fetchers.set(t,e)}}function Be(){let e=[],t=!1;for(let n of q){let i=M.fetchers.get(n);u(i,"Expected fetcher: "+n),"loading"===i.state&&(q.delete(n),e.push(n),t=!0)}return Fe(e),t}function Ne(e){let t=[];for(let[n,i]of G)if(i<e){let e=M.fetchers.get(n);u(e,"Expected fetcher: "+n),"loading"===e.state&&(Oe(n),G.delete(n),t.push(n))}return Fe(t),t.length>0}function je(e){M.blockers.delete(e),ne.delete(e)}function Ue(e,t){let n=M.blockers.get(e)||J;u("unblocked"===n.state&&"blocked"===t.state||"blocked"===n.state&&"blocked"===t.state||"blocked"===n.state&&"proceeding"===t.state||"blocked"===n.state&&"unblocked"===t.state||"proceeding"===n.state&&"unblocked"===t.state,"Invalid blocker state transition: "+n.state+" -> "+t.state);let i=new Map(M.blockers);i.set(e,t),ae({blockers:i})}function Ve(e){let{currentLocation:t,nextLocation:n,historyAction:i}=e;if(0===ne.size)return;ne.size>1&&h(!1,"A router only supports one blocker at a time");let r=Array.from(ne.entries()),[o,s]=r[r.length-1],a=M.blockers.get(o);return a&&"proceeding"===a.state?void 0:s({currentLocation:t,nextLocation:n,historyAction:i})?o:void 0}function Ge(e){let t=[];return X.forEach(((n,i)=>{e&&!e(i)||(n.cancel(),t.push(i),X.delete(i))})),t}function qe(e,t){if(b){let n=b(e,t.map((e=>function(e,t){let{route:n,pathname:i,params:r}=e;return{id:n.id,pathname:i,params:r,data:t[n.id],handle:n.handle}}(e,M.loaderData))));return n||e.key}return e.key}function He(e,t){if(y){let n=qe(e,t),i=y[n];if("number"===typeof i)return i}return null}return C={get basename(){return d},get state(){return M},get routes(){return c},get window(){return t},initialize:function(){if(m=e.history.listen((t=>{let{action:n,location:i,delta:r}=t;if(oe)return void(oe=!1);h(0===ne.size||null!=r,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let o=Ve({currentLocation:M.location,nextLocation:i,historyAction:n});return o&&null!=r?(oe=!0,e.history.go(-1*r),void Ue(o,{state:"blocked",location:i,proceed(){Ue(o,{state:"proceeding",proceed:void 0,reset:void 0,location:i}),e.history.go(r)},reset(){let e=new Map(M.blockers);e.set(o,J),ae({blockers:e})}})):ce(n,i)})),n){!function(e,t){try{let n=e.sessionStorage.getItem(te);if(n){let e=JSON.parse(n);for(let[n,i]of Object.entries(e||{}))i&&Array.isArray(i)&&t.set(n,new Set(i||[]))}}catch(n){}}(t,R);let e=()=>function(e,t){if(t.size>0){let n={};for(let[e,i]of t)n[e]=[...i];try{e.sessionStorage.setItem(te,JSON.stringify(n))}catch(ws){h(!1,"Failed to save applied view transitions in sessionStorage ("+ws+").")}}}(t,R);t.addEventListener("pagehide",e),L=()=>t.removeEventListener("pagehide",e)}return M.initialized||ce(o.Pop,M.location),C},subscribe:function(e){return _.add(e),()=>_.delete(e)},enableScrollRestoration:function(e,t,n){if(y=e,w=t,b=n||null,!T&&M.navigation===K){T=!0;let e=He(M.location,M.matches);null!=e&&ae({restoreScrollPosition:e})}return()=>{y=null,w=null,b=null}},navigate:async function t(n,i){if("number"===typeof n)return void e.history.go(n);let r=ie(M.location,M.matches,d,f.v7_prependBasename,n,null==i?void 0:i.fromRouteId,null==i?void 0:i.relative),{path:s,submission:a,error:c}=re(f.v7_normalizeFormMethod,!1,r,i),u=M.location,h=p(M.location,s,i&&i.state);h=l({},h,e.history.encodeLocation(h));let m=i&&null!=i.replace?i.replace:void 0,_=o.Push;!0===m?_=o.Replace:!1===m||null!=a&&Ae(a.formMethod)&&a.formAction===M.location.pathname+M.location.search&&(_=o.Replace);let g=i&&"preventScrollReset"in i?!0===i.preventScrollReset:void 0,y=!0===(i&&i.unstable_flushSync),v=Ve({currentLocation:u,nextLocation:h,historyAction:_});if(!v)return await ce(_,h,{submission:a,pendingError:c,preventScrollReset:g,replace:i&&i.replace,enableViewTransition:i&&i.unstable_viewTransition,flushSync:y});Ue(v,{state:"blocked",location:h,proceed(){Ue(v,{state:"proceeding",proceed:void 0,reset:void 0,location:h}),t(n,i)},reset(){let e=new Map(M.blockers);e.set(v,J),ae({blockers:e})}})},fetch:function(t,n,o,l){if(i)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");j.has(t)&&Oe(t);let h=!0===(l&&l.unstable_flushSync),p=s||c,m=ie(M.location,M.matches,d,f.v7_prependBasename,o,n,null==l?void 0:l.relative),_=x(p,m,d);if(!_)return void Ee(t,n,ve(404,{pathname:m}),{flushSync:h});let{path:g,submission:y,error:v}=re(f.v7_normalizeFormMethod,!0,m,l);if(v)return void Ee(t,n,v,{flushSync:h});let b=Pe(_,g);P=!0===(l&&l.preventScrollReset),y&&Ae(y.formMethod)?async function(t,n,i,o,l,h,p){if(fe(),H.delete(t),!o.route.action&&!o.route.lazy){let e=ve(405,{method:p.formMethod,pathname:i,routeId:n});return void Ee(t,n,e,{flushSync:h})}let f=M.fetchers.get(t);be(t,function(e,t){let n={state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t?t.data:void 0};return n}(p,f),{flushSync:h});let m=new AbortController,_=he(e.history,i,m.signal,p);j.set(t,m);let g=U,y=await ue("action",_,o,l,a,r,d);if(_.signal.aborted)return void(j.get(t)===m&&j.delete(t));if(Z.has(t))return void be(t,Le(void 0));if(Se(y))return j.delete(t),V>g?void be(t,Le(void 0)):(q.add(t),be(t,ze(p)),de(M,y,{fetcherSubmission:p}));if(Te(y))return void Ee(t,n,y.error);if(we(y))throw ve(400,{type:"defer-action"});let v=M.navigation.location||M.location,b=he(e.history,v,m.signal),w=s||c,T="idle"!==M.navigation.state?x(w,M.navigation.location,d):M.matches;u(T,"Didn't find any matches after fetcher action");let S=++U;G.set(t,S);let E=ze(p,y.data);M.fetchers.set(t,E);let[C,I]=se(e.history,M,T,p,v,F,B,N,Z,H,q,w,d,{[o.route.id]:y.data},void 0);I.filter((e=>e.key!==t)).forEach((e=>{let t=e.key,n=M.fetchers.get(t),i=ze(void 0,n?n.data:void 0);M.fetchers.set(t,i),j.has(t)&&Oe(t),e.controller&&j.set(t,e.controller)})),ae({fetchers:new Map(M.fetchers)});let P=()=>I.forEach((e=>Oe(e.key)));m.signal.addEventListener("abort",P);let{results:D,loaderResults:R,fetcherResults:z}=await pe(M.matches,T,C,I,b);if(m.signal.aborted)return;m.signal.removeEventListener("abort",P),G.delete(t),j.delete(t),I.forEach((e=>j.delete(e.key)));let L=xe(D);if(L){if(L.idx>=C.length){let e=I[L.idx-C.length].key;q.add(e)}return de(M,L.result)}let{loaderData:O,errors:W}=me(M,M.matches,C,R,void 0,I,z,X);if(M.fetchers.has(t)){let e=Le(y.data);M.fetchers.set(t,e)}Ne(S),"loading"===M.navigation.state&&S>V?(u(k,"Expected pending action"),A&&A.abort(),le(M.navigation.location,{matches:T,loaderData:O,errors:W,fetchers:new Map(M.fetchers)})):(ae({errors:W,loaderData:_e(M.loaderData,O,T,W),fetchers:new Map(M.fetchers)}),F=!1)}(t,n,g,b,_,h,y):(H.set(t,{routeId:n,path:g}),async function(t,n,i,o,s,l,c){let h=M.fetchers.get(t);be(t,ze(c,h?h.data:void 0),{flushSync:l});let p=new AbortController,f=he(e.history,i,p.signal);j.set(t,p);let m=U,_=await ue("loader",f,o,s,a,r,d);we(_)&&(_=await Me(_,f.signal,!0)||_);j.get(t)===p&&j.delete(t);if(f.signal.aborted)return;if(Z.has(t))return void be(t,Le(void 0));if(Se(_))return V>m?void be(t,Le(void 0)):(q.add(t),void await de(M,_));if(Te(_))return void Ee(t,n,_.error);u(!we(_),"Unhandled fetcher deferred data"),be(t,Le(_.data))}(t,n,g,b,_,h,y))},revalidate:function(){fe(),ae({revalidation:"loading"}),"submitting"!==M.navigation.state&&("idle"!==M.navigation.state?ce(k||M.historyAction,M.navigation.location,{overrideNavigation:M.navigation}):ce(M.historyAction,M.location,{startUninterruptedRevalidation:!0}))},createHref:t=>e.history.createHref(t),encodeLocation:t=>e.history.encodeLocation(t),getFetcher:Ce,deleteFetcher:function(e){if(f.v7_fetcherPersist){let t=(W.get(e)||0)-1;t<=0?(W.delete(e),Z.add(e)):W.set(e,t)}else ke(e);ae({fetchers:new Map(M.fetchers)})},dispose:function(){m&&m(),L&&L(),_.clear(),A&&A.abort(),M.fetchers.forEach(((e,t)=>ke(t))),M.blockers.forEach(((e,t)=>je(t)))},getBlocker:function(e,t){let n=M.blockers.get(e)||J;return ne.get(e)!==t&&ne.set(e,t),n},deleteBlocker:je,_internalFetchControllers:j,_internalActiveDeferreds:X,_internalSetRoutes:function(e){a={},s=v(e,r,void 0,a)}},C}Symbol("deferred");function ie(e,t,n,i,r,o,s){let a,l;if(o){a=[];for(let e of t)if(a.push(e),e.route.id===o){l=e;break}}else a=t,l=t[t.length-1];let c=F(r||".",O(a).map((e=>e.pathnameBase)),z(e.pathname,n)||e.pathname,"path"===s);return null==r&&(c.search=e.search,c.hash=e.hash),null!=r&&""!==r&&"."!==r||!l||!l.route.index||ke(c.search)||(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),i&&"/"!==n&&(c.pathname="/"===c.pathname?n:B([n,c.pathname])),f(c)}function re(e,t,n,i){if(!i||!function(e){return null!=e&&("formData"in e&&null!=e.formData||"body"in e&&void 0!==e.body)}(i))return{path:n};if(i.formMethod&&!Ce(i.formMethod))return{path:n,error:ve(405,{method:i.formMethod})};let r,o,s=()=>({path:n,error:ve(400,{type:"invalid-body"})}),a=i.formMethod||"get",l=e?a.toUpperCase():a.toLowerCase(),c=be(n);if(void 0!==i.body){if("text/plain"===i.formEncType){if(!Ae(l))return s();let e="string"===typeof i.body?i.body:i.body instanceof FormData||i.body instanceof URLSearchParams?Array.from(i.body.entries()).reduce(((e,t)=>{let[n,i]=t;return""+e+n+"="+i+"\n"}),""):String(i.body);return{path:n,submission:{formMethod:l,formAction:c,formEncType:i.formEncType,formData:void 0,json:void 0,text:e}}}if("application/json"===i.formEncType){if(!Ae(l))return s();try{let e="string"===typeof i.body?JSON.parse(i.body):i.body;return{path:n,submission:{formMethod:l,formAction:c,formEncType:i.formEncType,formData:void 0,json:e,text:void 0}}}catch(p){return s()}}}if(u("function"===typeof FormData,"FormData is not available in this environment"),i.formData)r=de(i.formData),o=i.formData;else if(i.body instanceof FormData)r=de(i.body),o=i.body;else if(i.body instanceof URLSearchParams)r=i.body,o=pe(r);else if(null==i.body)r=new URLSearchParams,o=new FormData;else try{r=new URLSearchParams(i.body),o=pe(r)}catch(p){return s()}let h={formMethod:l,formAction:c,formEncType:i&&i.formEncType||"application/x-www-form-urlencoded",formData:o,json:void 0,text:void 0};if(Ae(h.formMethod))return{path:n,submission:h};let d=m(n);return t&&d.search&&ke(d.search)&&r.append("index",""),d.search="?"+r,{path:f(d),submission:h}}function oe(e,t){let n=e;if(t){let i=e.findIndex((e=>e.route.id===t));i>=0&&(n=e.slice(0,i))}return n}function se(e,t,n,i,r,o,s,a,c,u,h,d,p,f,m){let _=m?Object.values(m)[0]:f?Object.values(f)[0]:void 0,g=e.createURL(t.location),y=e.createURL(r),v=m?Object.keys(m)[0]:void 0,b=oe(n,v).filter(((e,n)=>{if(e.route.lazy)return!0;if(null==e.route.loader)return!1;if(function(e,t,n){let i=!t||n.route.id!==t.route.id,r=void 0===e[n.route.id];return i||r}(t.loaderData,t.matches[n],e)||s.some((t=>t===e.route.id)))return!0;let r=t.matches[n],a=e;return le(e,l({currentUrl:g,currentParams:r.params,nextUrl:y,nextParams:a.params},i,{actionResult:_,defaultShouldRevalidate:o||g.pathname+g.search===y.pathname+y.search||g.search!==y.search||ae(r,a)}))})),w=[];return u.forEach(((e,r)=>{if(!n.some((t=>t.route.id===e.routeId))||c.has(r))return;let s=x(d,e.path,p);if(!s)return void w.push({key:r,routeId:e.routeId,path:e.path,matches:null,match:null,controller:null});let u=t.fetchers.get(r),f=Pe(s,e.path),m=!1;m=!h.has(r)&&(!!a.includes(r)||(u&&"idle"!==u.state&&void 0===u.data?o:le(f,l({currentUrl:g,currentParams:t.matches[t.matches.length-1].params,nextUrl:y,nextParams:n[n.length-1].params},i,{actionResult:_,defaultShouldRevalidate:o})))),m&&w.push({key:r,routeId:e.routeId,path:e.path,matches:s,match:f,controller:new AbortController})})),[b,w]}function ae(e,t){let n=e.route.path;return e.pathname!==t.pathname||null!=n&&n.endsWith("*")&&e.params["*"]!==t.params["*"]}function le(e,t){if(e.route.shouldRevalidate){let n=e.route.shouldRevalidate(t);if("boolean"===typeof n)return n}return t.defaultShouldRevalidate}async function ce(e,t,n){if(!e.lazy)return;let i=await e.lazy();if(!e.lazy)return;let r=n[e.id];u(r,"No route found in manifest");let o={};for(let s in i){let e=void 0!==r[s]&&"hasErrorBoundary"!==s;h(!e,'Route "'+r.id+'" has a static property "'+s+'" defined but its lazy function is also returning a value for this property. The lazy route property "'+s+'" will be ignored.'),e||y.has(s)||(o[s]=i[s])}Object.assign(r,o),Object.assign(r,l({},t(r),{lazy:void 0}))}async function ue(e,t,n,i,r,o,s,a){let l,c,h;void 0===a&&(a={});let d=e=>{let i,r=new Promise(((e,t)=>i=t));return h=()=>i(),t.signal.addEventListener("abort",h),Promise.race([e({request:t,params:n.params,context:a.requestContext}),r])};try{let i=n.route[e];if(n.route.lazy)if(i){let e,t=await Promise.all([d(i).catch((t=>{e=t})),ce(n.route,o,r)]);if(e)throw e;c=t[0]}else{if(await ce(n.route,o,r),i=n.route[e],!i){if("action"===e){let e=new URL(t.url),i=e.pathname+e.search;throw ve(405,{method:t.method,pathname:i,routeId:n.route.id})}return{type:g.data,data:void 0}}c=await d(i)}else{if(!i){let e=new URL(t.url);throw ve(404,{pathname:e.pathname+e.search})}c=await d(i)}u(void 0!==c,"You defined "+("action"===e?"an action":"a loader")+' for route "'+n.route.id+"\" but didn't return anything from your `"+e+"` function. Please return a value or `null`.")}catch(m){l=g.error,c=m}finally{h&&t.signal.removeEventListener("abort",h)}if(Ee(c)){let e,r=c.status;if(X.has(r)){let e=c.headers.get("Location");if(u(e,"Redirects returned/thrown from loaders/actions must have a Location header"),$.test(e)){if(!a.isStaticRequest){let n=new URL(t.url),i=e.startsWith("//")?new URL(n.protocol+e):new URL(e),r=null!=z(i.pathname,s);i.origin===n.origin&&r&&(e=i.pathname+i.search+i.hash)}}else e=ie(new URL(t.url),i.slice(0,i.indexOf(n)+1),s,!0,e);if(a.isStaticRequest)throw c.headers.set("Location",e),c;return{type:g.redirect,status:r,location:e,revalidate:null!==c.headers.get("X-Remix-Revalidate"),reloadDocument:null!==c.headers.get("X-Remix-Reload-Document")}}if(a.isRouteRequest){throw{type:l===g.error?g.error:g.data,response:c}}let o=c.headers.get("Content-Type");return e=o&&/\bapplication\/json\b/.test(o)?await c.json():await c.text(),l===g.error?{type:l,error:new V(r,c.statusText,e),headers:c.headers}:{type:g.data,data:e,statusCode:c.status,headers:c.headers}}return l===g.error?{type:l,error:c}:function(e){let t=e;return t&&"object"===typeof t&&"object"===typeof t.data&&"function"===typeof t.subscribe&&"function"===typeof t.cancel&&"function"===typeof t.resolveData}(c)?{type:g.deferred,deferredData:c,statusCode:null==(p=c.init)?void 0:p.status,headers:(null==(f=c.init)?void 0:f.headers)&&new Headers(c.init.headers)}:{type:g.data,data:c};var p,f}function he(e,t,n,i){let r=e.createURL(be(t)).toString(),o={signal:n};if(i&&Ae(i.formMethod)){let{formMethod:e,formEncType:t}=i;o.method=e.toUpperCase(),"application/json"===t?(o.headers=new Headers({"Content-Type":t}),o.body=JSON.stringify(i.json)):"text/plain"===t?o.body=i.text:"application/x-www-form-urlencoded"===t&&i.formData?o.body=de(i.formData):o.body=i.formData}return new Request(r,o)}function de(e){let t=new URLSearchParams;for(let[n,i]of e.entries())t.append(n,"string"===typeof i?i:i.name);return t}function pe(e){let t=new FormData;for(let[n,i]of e.entries())t.append(n,i);return t}function fe(e,t,n,i,r){let o,s={},a=null,l=!1,c={};return n.forEach(((n,h)=>{let d=t[h].route.id;if(u(!Se(n),"Cannot handle redirect results in processLoaderData"),Te(n)){let t=ge(e,d),r=n.error;i&&(r=Object.values(i)[0],i=void 0),a=a||{},null==a[t.route.id]&&(a[t.route.id]=r),s[d]=void 0,l||(l=!0,o=G(n.error)?n.error.status:500),n.headers&&(c[d]=n.headers)}else we(n)?(r.set(d,n.deferredData),s[d]=n.deferredData.data):s[d]=n.data,null==n.statusCode||200===n.statusCode||l||(o=n.statusCode),n.headers&&(c[d]=n.headers)})),i&&(a=i,s[Object.keys(i)[0]]=void 0),{loaderData:s,errors:a,statusCode:o||200,loaderHeaders:c}}function me(e,t,n,i,r,o,s,a){let{loaderData:c,errors:h}=fe(t,n,i,r,a);for(let d=0;d<o.length;d++){let{key:t,match:n,controller:i}=o[d];u(void 0!==s&&void 0!==s[d],"Did not find corresponding fetcher result");let r=s[d];if(!i||!i.signal.aborted)if(Te(r)){let i=ge(e.matches,null==n?void 0:n.route.id);h&&h[i.route.id]||(h=l({},h,{[i.route.id]:r.error})),e.fetchers.delete(t)}else if(Se(r))u(!1,"Unhandled fetcher revalidation redirect");else if(we(r))u(!1,"Unhandled fetcher deferred data");else{let n=Le(r.data);e.fetchers.set(t,n)}}return{loaderData:c,errors:h}}function _e(e,t,n,i){let r=l({},t);for(let o of n){let n=o.route.id;if(t.hasOwnProperty(n)?void 0!==t[n]&&(r[n]=t[n]):void 0!==e[n]&&o.route.loader&&(r[n]=e[n]),i&&i.hasOwnProperty(n))break}return r}function ge(e,t){let n=t?e.slice(0,e.findIndex((e=>e.route.id===t))+1):[...e];return n.reverse().find((e=>!0===e.route.hasErrorBoundary))||e[0]}function ye(e){let t=1===e.length?e[0]:e.find((e=>e.index||!e.path||"/"===e.path))||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function ve(e,t){let{pathname:n,routeId:i,method:r,type:o}=void 0===t?{}:t,s="Unknown Server Error",a="Unknown @remix-run/router error";return 400===e?(s="Bad Request",r&&n&&i?a="You made a "+r+' request to "'+n+'" but did not provide a `loader` for route "'+i+'", so there is no way to handle the request.':"defer-action"===o?a="defer() is not supported in actions":"invalid-body"===o&&(a="Unable to encode submission body")):403===e?(s="Forbidden",a='Route "'+i+'" does not match URL "'+n+'"'):404===e?(s="Not Found",a='No route matches URL "'+n+'"'):405===e&&(s="Method Not Allowed",r&&n&&i?a="You made a "+r.toUpperCase()+' request to "'+n+'" but did not provide an `action` for route "'+i+'", so there is no way to handle the request.':r&&(a='Invalid request method "'+r.toUpperCase()+'"')),new V(e||500,s,new Error(a),!0)}function xe(e){for(let t=e.length-1;t>=0;t--){let n=e[t];if(Se(n))return{result:n,idx:t}}}function be(e){return f(l({},"string"===typeof e?m(e):e,{hash:""}))}function we(e){return e.type===g.deferred}function Te(e){return e.type===g.error}function Se(e){return(e&&e.type)===g.redirect}function Ee(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"object"===typeof e.headers&&"undefined"!==typeof e.body}function Ce(e){return Z.has(e.toLowerCase())}function Ae(e){return H.has(e.toLowerCase())}async function Ie(e,t,n,i,r,o){for(let s=0;s<n.length;s++){let a=n[s],l=t[s];if(!l)continue;let c=e.find((e=>e.route.id===l.route.id)),h=null!=c&&!ae(c,l)&&void 0!==(o&&o[l.route.id]);if(we(a)&&(r||h)){let e=i[s];u(e,"Expected an AbortSignal for revalidating fetcher deferred result"),await Me(a,e,r).then((e=>{e&&(n[s]=e||n[s])}))}}}async function Me(e,t,n){if(void 0===n&&(n=!1),!await e.deferredData.resolveData(t)){if(n)try{return{type:g.data,data:e.deferredData.unwrappedData}}catch(i){return{type:g.error,error:i}}return{type:g.data,data:e.deferredData.data}}}function ke(e){return new URLSearchParams(e).getAll("index").some((e=>""===e))}function Pe(e,t){let n="string"===typeof t?m(t).search:t.search;if(e[e.length-1].route.index&&ke(n||""))return e[e.length-1];let i=O(e);return i[i.length-1]}function De(e){let{formMethod:t,formAction:n,formEncType:i,text:r,formData:o,json:s}=e;if(t&&n&&i)return null!=r?{formMethod:t,formAction:n,formEncType:i,formData:void 0,json:void 0,text:r}:null!=o?{formMethod:t,formAction:n,formEncType:i,formData:o,json:void 0,text:void 0}:void 0!==s?{formMethod:t,formAction:n,formEncType:i,formData:void 0,json:s,text:void 0}:void 0}function Re(e,t){if(t){return{state:"loading",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}}return{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function ze(e,t){if(e){return{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t}}return{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function Le(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function Oe(){return Oe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Oe.apply(this,arguments)}const Fe=e.createContext(null);const Be=e.createContext(null);const Ne=e.createContext(null);const je=e.createContext(null);const Ue=e.createContext({outlet:null,matches:[],isDataRoute:!1});const Ve=e.createContext(null);function Ge(){return null!=e.useContext(je)}function qe(){return Ge()||u(!1),e.useContext(je).location}function He(t,n,i){Ge()||u(!1);let{navigator:r}=e.useContext(Ne),{matches:s}=e.useContext(Ue),a=s[s.length-1],l=a?a.params:{},c=(a&&a.pathname,a?a.pathnameBase:"/");a&&a.route;let h,d=qe();if(n){var p;let e="string"===typeof n?m(n):n;"/"===c||(null==(p=e.pathname)?void 0:p.startsWith(c))||u(!1),h=e}else h=d;let f=h.pathname||"/",_=x(t,{pathname:"/"===c?f:f.slice(c.length)||"/"});let g=Ke(_&&_.map((e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:B([c,r.encodeLocation?r.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:B([c,r.encodeLocation?r.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),s,i);return n&&g?e.createElement(je.Provider,{value:{location:Oe({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:o.Pop}},g):g}function We(){let t=function(){var t;let n=e.useContext(Ve),i=Je(Qe.UseRouteError),r=$e(Qe.UseRouteError);if(n)return n;return null==(t=i.errors)?void 0:t[r]}(),n=G(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),i=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:r};return e.createElement(e.Fragment,null,e.createElement("h2",null,"Unexpected Application Error!"),e.createElement("h3",{style:{fontStyle:"italic"}},n),i?e.createElement("pre",{style:o},i):null,null)}const Ze=e.createElement(We,null);class Xe extends e.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error?e.createElement(Ue.Provider,{value:this.props.routeContext},e.createElement(Ve.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ye(t){let{routeContext:n,match:i,children:r}=t,o=e.useContext(Fe);return o&&o.static&&o.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=i.route.id),e.createElement(Ue.Provider,{value:n},r)}function Ke(t,n,i){var r;if(void 0===n&&(n=[]),void 0===i&&(i=null),null==t){var o;if(null==(o=i)||!o.errors)return null;t=i.matches}let s=t,a=null==(r=i)?void 0:r.errors;if(null!=a){let e=s.findIndex((e=>e.route.id&&(null==a?void 0:a[e.route.id])));e>=0||u(!1),s=s.slice(0,Math.min(s.length,e+1))}return s.reduceRight(((t,r,o)=>{let l=r.route.id?null==a?void 0:a[r.route.id]:null,c=null;i&&(c=r.route.errorElement||Ze);let u=n.concat(s.slice(0,o+1)),h=()=>{let n;return n=l?c:r.route.Component?e.createElement(r.route.Component,null):r.route.element?r.route.element:t,e.createElement(Ye,{match:r,routeContext:{outlet:t,matches:u,isDataRoute:null!=i},children:n})};return i&&(r.route.ErrorBoundary||r.route.errorElement||0===o)?e.createElement(Xe,{location:i.location,revalidation:i.revalidation,component:c,error:l,children:h(),routeContext:{outlet:null,matches:u,isDataRoute:!0}}):h()}),null)}var Qe=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Qe||{});function Je(t){let n=e.useContext(Be);return n||u(!1),n}function $e(t){let n=function(t){let n=e.useContext(Ue);return n||u(!1),n}(),i=n.matches[n.matches.length-1];return i.route.id||u(!1),i.route.id}t.startTransition;function et(t){let{basename:n="/",children:i=null,location:r,navigationType:s=o.Pop,navigator:a,static:l=!1}=t;Ge()&&u(!1);let c=n.replace(/^\/*/,"/"),h=e.useMemo((()=>({basename:c,navigator:a,static:l})),[c,a,l]);"string"===typeof r&&(r=m(r));let{pathname:d="/",search:p="",hash:f="",state:_=null,key:g="default"}=r,y=e.useMemo((()=>{let e=z(d,c);return null==e?null:{location:{pathname:e,search:p,hash:f,state:_,key:g},navigationType:s}}),[c,d,p,f,_,g,s]);return null==y?null:e.createElement(Ne.Provider,{value:h},e.createElement(je.Provider,{children:i,value:y}))}new Promise((()=>{}));e.Component;function tt(t){let n={hasErrorBoundary:null!=t.ErrorBoundary||null!=t.errorElement};return t.Component&&Object.assign(n,{element:e.createElement(t.Component),Component:void 0}),t.ErrorBoundary&&Object.assign(n,{errorElement:e.createElement(t.ErrorBoundary),ErrorBoundary:void 0}),n}function nt(){return nt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},nt.apply(this,arguments)}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function it(){var e;let t=null==(e=window)?void 0:e.__staticRouterHydrationData;return t&&t.errors&&(t=nt({},t,{errors:rt(t.errors)})),t}function rt(e){if(!e)return null;let t=Object.entries(e),n={};for(let[r,o]of t)if(o&&"RouteErrorResponse"===o.__type)n[r]=new V(o.status,o.statusText,o.data,!0===o.internal);else if(o&&"Error"===o.__type){if(o.__subType){let e=window[o.__subType];if("function"===typeof e)try{let t=new e(o.message);t.stack="",n[r]=t}catch(i){}}if(null==n[r]){let e=new Error(o.message);e.stack="",n[r]=e}}else n[r]=o;return n}const ot=e.createContext({isTransitioning:!1});const st=e.createContext(new Map);const at=t.startTransition,lt=a.flushSync;function ct(e){lt?lt(e):e()}class ut{constructor(){this.status="pending",this.promise=new Promise(((e,t)=>{this.resolve=t=>{"pending"===this.status&&(this.status="resolved",e(t))},this.reject=e=>{"pending"===this.status&&(this.status="rejected",t(e))}}))}}function ht(t){let{fallbackElement:n,router:i,future:r}=t,[o,s]=e.useState(i.state),[a,l]=e.useState(),[c,u]=e.useState({isTransitioning:!1}),[h,d]=e.useState(),[p,f]=e.useState(),[m,_]=e.useState(),g=e.useRef(new Map),{v7_startTransition:y}=r||{},v=e.useCallback((e=>{y?function(e){at?at(e):e()}(e):e()}),[y]),x=e.useCallback(((e,t)=>{let{deletedFetchers:n,unstable_flushSync:r,unstable_viewTransitionOpts:o}=t;n.forEach((e=>g.current.delete(e))),e.fetchers.forEach(((e,t)=>{void 0!==e.data&&g.current.set(t,e.data)}));let a=null==i.window||"function"!==typeof i.window.document.startViewTransition;if(o&&!a){if(r){ct((()=>{p&&(h&&h.resolve(),p.skipTransition()),u({isTransitioning:!0,flushSync:!0,currentLocation:o.currentLocation,nextLocation:o.nextLocation})}));let t=i.window.document.startViewTransition((()=>{ct((()=>s(e)))}));return t.finished.finally((()=>{ct((()=>{d(void 0),f(void 0),l(void 0),u({isTransitioning:!1})}))})),void ct((()=>f(t)))}p?(h&&h.resolve(),p.skipTransition(),_({state:e,currentLocation:o.currentLocation,nextLocation:o.nextLocation})):(l(e),u({isTransitioning:!0,flushSync:!1,currentLocation:o.currentLocation,nextLocation:o.nextLocation}))}else r?ct((()=>s(e))):v((()=>s(e)))}),[i.window,p,h,g,v]);e.useLayoutEffect((()=>i.subscribe(x)),[i,x]),e.useEffect((()=>{c.isTransitioning&&!c.flushSync&&d(new ut)}),[c]),e.useEffect((()=>{if(h&&a&&i.window){let e=a,t=h.promise,n=i.window.document.startViewTransition((async()=>{v((()=>s(e))),await t}));n.finished.finally((()=>{d(void 0),f(void 0),l(void 0),u({isTransitioning:!1})})),f(n)}}),[v,a,h,i.window]),e.useEffect((()=>{h&&a&&o.location.key===a.location.key&&h.resolve()}),[h,p,o.location,a]),e.useEffect((()=>{!c.isTransitioning&&m&&(l(m.state),u({isTransitioning:!0,flushSync:!1,currentLocation:m.currentLocation,nextLocation:m.nextLocation}),_(void 0))}),[c.isTransitioning,m]);let b=e.useMemo((()=>({createHref:i.createHref,encodeLocation:i.encodeLocation,go:e=>i.navigate(e),push:(e,t,n)=>i.navigate(e,{state:t,preventScrollReset:null==n?void 0:n.preventScrollReset}),replace:(e,t,n)=>i.navigate(e,{replace:!0,state:t,preventScrollReset:null==n?void 0:n.preventScrollReset})})),[i]),w=i.basename||"/",T=e.useMemo((()=>({router:i,navigator:b,static:!1,basename:w})),[i,b,w]);return e.createElement(e.Fragment,null,e.createElement(Fe.Provider,{value:T},e.createElement(Be.Provider,{value:o},e.createElement(st.Provider,{value:g.current},e.createElement(ot.Provider,{value:c},e.createElement(et,{basename:w,location:o.location,navigationType:o.historyAction,navigator:b},o.initialized?e.createElement(dt,{routes:i.routes,state:o}):n))))),null)}function dt(e){let{routes:t,state:n}=e;return He(t,void 0,n)}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var pt,ft;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(pt||(pt={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(ft||(ft={}));const mt={black:{background:"radial-gradient(circle at 24.1% 68.8%, rgb(50, 50, 50) 0%, rgb(0, 0, 0) 99.4%)",light:"rgb(50, 50, 50)",dark:"rgb(0, 0, 0)",text:"white"},blue:{background:"radial-gradient(circle at 10% 20%, #2E3192, #1BFFFF)",light:"#2E3192",dark:"#1BFFFF",text:"black"},green:{background:"radial-gradient(circle at 10% 20%, #11998E, #38EF7D)",light:"#11998E",dark:"#38EF7D",text:"black"},red:{background:"radial-gradient(circle at 10% 20%, rgb(221, 49, 49) 0%, rgb(119, 0, 0) 90%)",light:"rgb(221, 49, 49)",dark:"rgb(119, 0, 0)",text:"white"},pink:{background:"radial-gradient(circle at 10% 20%, #662D8C, #ED1E79)",light:"#662D8C",dark:"#ED1E79",text:"white"},yellow:{background:"radial-gradient(circle at 90% 10%, rgb(248, 241, 10) 0%, rgb(248, 185, 47) 82.6%)",light:"rgb(248, 241, 10)",dark:"rgb(248, 185, 47)",text:"black"}},_t={A:{question:"What is the first block of flats on the left called?",clue:"An wild dog (often seen in urban areas) + where a farmer might grow their crops",answer:"Foxfield",coords:{lon:"-0.141337",lat:"51.536485"}},B:{question:"Which Crystallographer lived at 44 Albert Street?",clue:"Look for a blue plaque",answer:"Bernal",coords:{lon:"-0.1418423",lat:"51.5348863"}},C:{question:"Who lived on the South West corner of Greenland & Bayham in 1823",clue:"Check the walls of the building on the corner",answer:"Charles Dickens",coords:{lon:"-0.141311",lat:"51.5390068"}},D:{question:"On the sign at the bottom of the stairs on the towpath, how far away is Little Venice?",clue:"Write it as you see it",answer:"2 3/4 miles",coords:{lon:"-0.137267",lat:"51.540917"}},E:{question:"Beneath the bridge on Kentish Town Road, how many vertical poles are there in the railing?",clue:"Just count the vertical poles, what else can I say?",answer:"9",coords:{lon:"-0.135555",lat:"51.540263"}},F:{question:"How many windows are surrounded by brickwork on the pub that solely devotes itself to Adam's partner?",clue:"Just count them, what else can I say. Only the ones with glass count. Oh, and the pub is All about Eve",answer:"18",coords:{lon:"-0.1460422",lat:"51.5401708"}},G:{question:"Who is Melrose's companion?",clue:"It's the name of a restaurant",answer:"Morgan",coords:{lon:"-0.1460422",lat:"51.5401708"}},H:{question:"In the main yard next to Middle yard, what might you buy at Half Hitch?",clue:"It's a shop around the outside of the food stalls",answer:"Gin",coords:{lon:"-0.146480",lat:"51.541341"}},I:{question:"On the side of scum and above Hawley Wharf, what year is it since?",clue:"Look on the side of the buildings from the bridge",answer:"1974",coords:{lon:"-0.145031",lat:"51.541490"}},J:{question:"Which pub is also the name of a Simon Pegg film and an installment of a Franchise starring Johnny Depp?",clue:"It's a Pirates of the Carribean film",answer:"worlds end",coords:{lon:"-0.142316",lat:"51.539059"}},K:{question:"According to the writing by the door, who are the activities for at Castlehaven Community Association",clue:"Try writing it as you see it",answer:"All ages, cultures",coords:{lon:"-0.144493",lat:"51.542864"}},L:{question:"On the corner of Hawley & Hartland you'll find a much needed ________ _____ in the heart of Camden. Fill in the blanks.",clue:"Check the sign on side of the Castlehaven Horticulture Hub.",answer:"Tranquil Oasis",coords:{lon:"-0.146239",lat:"51.543219"}},M:{question:"Foxtons new homes are for residents, _________, foodies and nine-to-fivers. Fill in the blank.",clue:"Check the promo banners on the windows",answer:"Explorers",coords:{lon:"-0.146270",lat:"51.536898"}},N:{question:"Cecil Sharp House is home to which society?",clue:"Look for the old sign on the corner of the road",answer:"English Folk Dance",coords:{lon:"-0.148846",lat:"51.537912"}},O:{question:"Camden Road is one of 6 stations on the North London railway in what style of architecture?",clue:"Look for the red plaque on the station building",answer:"Italianate",coords:{lon:"-0.138874",lat:"51.541654"}},P:{question:"For the full house, what colour is the A on the Mecca sign?",clue:"We're talking about Mecca Bingo",answer:"Blue",coords:{lon:"-0.1442916",lat:"51.5389677"}},Q:{question:"There is a prominent grave in the middle of the path. Who is the smaller grave immediately behind it in memory of?",clue:"As you walk from the studio to the grave it's written on the left hand side of the small grave immediately behind the big one",answer:"John Willey",coords:{lon:"-0.139413",lat:"51.538202"}},HawleyArms:{question:"In the pub, how many lights hang above the bar?",clue:"Christmas lights don't count",answer:"6",isPub:!0,coords:{lon:"-0.145371",lat:"51.542043"}},SpreadEagle:{question:"What was the tsunami that threatened to drown us all in 1977? You'll find the answer in the pub.",clue:"Check the poster on the pillar by the bar",answer:"Punk rock",isPub:!0,coords:{lon:"-0.144829",lat:"51.537794"}},EarlOfCamden:{question:"What is the third named step in the brewery process?. You'll find the answer just inside the pub.",clue:"Check the illustration in the entrance",answer:"Mashing",isPub:!0,coords:{lon:"-0.144829",lat:"51.537794"}},LockTavern:{question:"What instrument glows inside the door?",clue:"If you need this you're probably in the wrong place. It's played by cherubs.",answer:"harp",isPub:!0,coords:{lon:"-0.147853",lat:"51.542805"}},ColonelFawcett:{question:"What activity was Colonel Fawcett doing before he died?. You'll find the answer in the pub.",clue:"Check the mirror on the right wall as you walk in the door.",answer:"Duel",isPub:!0,coords:{lon:"-0.136054",lat:"51.541882"}},Landsdowne:{question:"The Lansdowne used to be part of which brewery?. You'll find the answer in the pub.",clue:"Check the old photos on the wall, starts with Ch...",answer:"Charringtons",isPub:!0,coords:{lon:"-0.153214",lat:"51.541396"}}};let gt={blue:[{directions:"Head out of the office and towards the madness of Camden. On the corner of the station...",..._t.J},{directions:"Continue towards the chaos up the high street. When you reach the road bridge over the lock, take a look around...",rewardsWithPub:!0,..._t.I},{directions:"Your reward is a pub, head to the Hawley Arms.",..._t.HawleyArms},{revealAtHour:11,revealAtMinute:50,directions:"Head to the canal and take the towpath South East. When Kentish Town Road is overhead...",..._t.C},{directions:"Continue under 3 more road bridges. Just after the third...",rewardsWithPub:!0,..._t.E},{directions:"Another answer, another pub... To the Colonel Fawcett!",..._t.ColonelFawcett},{revealAtHour:12,revealAtMinute:50,directions:"Go to where you'd catch the Overground",..._t.O},{directions:"Up Bonny Street and Right down Prowse Place. At the end turn left, then straight over onto Hawley Road... By the T junction by the park",rewardsWithPub:!0,..._t.K},{directions:"'Blimey', I hear you cry, 'Another pub?!'. You're on your way to the LockTavern.",..._t.LockTavern},{revealAtHour:13,revealAtMinute:50,directions:"Head back towards town. When Hawley Road is on your left, turn right into Camden Market down Camden Lock Place. Take a left into Middle Yard then right under the West Yard sign. Search the square in front of you...",..._t.H},{directions:"Join the towpath on your right and cross the footbridge towards Wetherspoons. Turn back on yourself and go behind spoons.",rewardsWithPub:!0,..._t.F},{directions:"That was quick! Go on then, another pub. Head to the Spread Eagle",..._t.SpreadEagle},{revealAtHour:14,revealAtMinute:50,directions:"Head West on the main road",..._t.M},{directions:"Right down Oval, then right down Gloucester Avenue. One more right at Inverness",rewardsWithPub:!0,..._t.P},{directions:"You're within touching distance of the end. Head to the Earl of Camden.... Pretty much where you were 10 minutes ago \ud83e\udd23",..._t.EarlOfCamden}],black:[{directions:"Head out of the office and towards the madness of Camden. On the corner of the station...",..._t.J},{directions:"Continue towards the chaos up the high street. When you reach the road bridge over the lock, take a look around...",rewardsWithPub:!0,..._t.I},{directions:"Your reward is a rest (already). Head to the Hawley Arms.",..._t.HawleyArms},{revealAtHour:11,revealAtMinute:50,directions:"Head out and turn left. Straight over into Camden Market down Camden Lock Place. Take a left into Middle Yard then right under the West Yard sign. Search the square in front of you...",..._t.H},{directions:"Go onto the canal on the right hand side. Cross the footbridge on your left and then turn right. Head behind Spoons.",rewardsWithPub:!0,..._t.F},{directions:"Another answer, another pub... To the Spread Eagle!",..._t.SpreadEagle},{revealAtHour:12,revealAtMinute:50,directions:"Out the pub and West on the main road",..._t.M},{directions:"Turn right onto Regents Park Road and pause at the turn for Gloucester Avenue... ",rewardsWithPub:!0,..._t.N},{directions:"'Blimey', I hear you cry, 'Another pub?!'. You're on your way to the Landsdowne.",..._t.Landsdowne},{revealAtHour:13,revealAtMinute:50,directions:"Head down Gloucester Avenue and join the towpath on the ramp on your left hand side. Before you join the towpath...",..._t.G},{directions:"Take the towpath past the lights of Camden High Street to where Kentish Town Road is overhead...",rewardsWithPub:!0,..._t.E},{directions:"Go on then, another pub. Head to the Colonel Fawcett",..._t.ColonelFawcett},{revealAtHour:14,revealAtMinute:50,directions:"Head back to the towpath. Stop when you reach it.",..._t.D},{directions:"You're not going town here again.. Back onto the road, south then right down Georgiana. Right at the end, then second left.",rewardsWithPub:!0,..._t.C},{directions:"You're within touching distance of the end. Head to the Earl of Camden!",..._t.EarlOfCamden}],red:[{directions:"Head out of the office and towards Blues Kitchen. At the door of the BK turn left. Turn right just before Oxfam. Head up that passageway...",..._t.A},{directions:"To the end and left. Then right at Mornington",rewardsWithPub:!0,..._t.B},{directions:"Time for a drink. Head to the Spread Eagle.",..._t.SpreadEagle},{revealAtHour:11,revealAtMinute:50,directions:"Head out past the station and straight over onto Greenland...",..._t.C},{directions:"Continue to the end of Greenland Road. Turn right, then first left, then second left and pause at the canal bridge, cross the road...",rewardsWithPub:!0,..._t.D},{directions:"Another answer, another pub! Head to the Colonel Fawcett.",..._t.ColonelFawcett},{revealAtHour:12,revealAtMinute:50,directions:"A bit of a treck ahead, head back to where you saw the sign for Little Venice and head North West up the towpath. Where Kentish Town road goes overhead...",..._t.E},{directions:"Head south on Kentish Town Road and immediately right onto Hawley Crescent. Continue across two roads...",rewardsWithPub:!0,..._t.F},{directions:"'Blimey', I hear you cry, 'Another pub?!'. Carry on up Jamestown Road and cross the canal at the Pirate Castle. Join the towpath and you're on your way to the Landsdowne.",..._t.Landsdowne},{revealAtHour:13,revealAtMinute:50,directions:"You're in for a treat. The rest of the walks are much shorter than the last. Head down Gloucester Avenue and back towards town, but join the towpath down the ramp on the left. Just at the top of the ramp...",..._t.G},{directions:"Walk the towpath towards town. Before the footbridge over the lock head left into the market. Search the square you're in...",rewardsWithPub:!0,..._t.H},{directions:"That was quick wasn't it. Go on then, another pub. Head to the Hawley Arms",..._t.HawleyArms},{revealAtHour:14,revealAtMinute:50,directions:"Back towards town down the main road and stop before the bridge over the canal...",..._t.I},{directions:"Continue down the high street. When you reach the crossroads at the station corner...",rewardsWithPub:!0,..._t.J},{directions:"You're within touching distance of the end. Head to the Earl of Camden!",..._t.EarlOfCamden}],green:[{directions:"Head out of the office and towards Blues Kitchen. At the door of the Blues Kitchen turn left. Turn right just before Oxfam. Head up that passageway...",..._t.A},{directions:"To the end and left. Then right at Mornington",rewardsWithPub:!0,..._t.B},{directions:"Your reward is a rest (already), head to the Spread Eagle.",..._t.SpreadEagle},{revealAtHour:11,revealAtMinute:50,directions:"Head North to the end of Arlington Road",..._t.F},{directions:"Over the footbridge by Spoons and into Camden Market. Search the first market square you see...",rewardsWithPub:!0,..._t.H},{directions:"Another answer, another pub! Head to the Hawley Arms.",..._t.HawleyArms},{revealAtHour:12,revealAtMinute:50,directions:"Head East down Castlehaven Road. Before the football pitch...",..._t.K},{directions:"North-ish through the Park.",rewardsWithPub:!0,..._t.L},{directions:"'Blimey', I hear you cry, 'Another pub?!'. You're on your way to the Lock Tavern.",..._t.LockTavern},{revealAtHour:13,revealAtMinute:50,directions:"Head down the main road back towards town and pause on the road bridge over the canal... ",..._t.I},{directions:"Get on the towpath walking away from Regents Park. When you walk under Kentish Town Road...",rewardsWithPub:!0,..._t.E},{directions:"Go on then, another pub. Head to the Colonel Fawcett",..._t.ColonelFawcett},{revealAtHour:14,revealAtMinute:50,directions:"Head back towards town and Left at Royal College Street. When you reach the canal bridge pause...",..._t.D},{directions:"Back up to the road, continue South, then turn right down Georgiana. The the end then Right and second left...",rewardsWithPub:!0,..._t.C},{directions:"You're within touching distance of the end. Head to the Earl of Camden!",..._t.EarlOfCamden}],pink:[{directions:"Head out of the office and over the road, down pratt street to the gardens on the left. Head in through the gate and 10 metres ahead stands a grave...",..._t.Q},{directions:"Through the park and over the road, down Georgiana and left onto Royal College. You'll soon reach the canal. When you do, cross the road...",rewardsWithPub:!0,..._t.D},{directions:"Your reward is a rest (already). Head to the Colonel Fawcett.",..._t.ColonelFawcett},{revealAtHour:11,revealAtMinute:50,directions:"Go to where you'd catch the Overground.",..._t.O},{directions:"Head up Bonny Street then right onto Prowse Place. At the end take a left onto Jeffrey street then straight to Hawley Road. At the T junction on the park...",rewardsWithPub:!0,..._t.K},{directions:"Another answer, another pub! Head to the Hawley Arms.",..._t.HawleyArms},{revealAtHour:12,revealAtMinute:50,directions:"Head out and turn left. Straight over into camden market down Camden Lock Place. Take a left into Middle Yard then right under the West Yard sign. Search the square in front of you...",..._t.H},{directions:"Continue onto the towpath Westwards. After the second bridge you walk under, turn right up the ramp and make your way onto Gloucester Avenue.",rewardsWithPub:!0,..._t.G},{directions:"'Blimey', I hear you cry, 'Another pub?!'. You're on your way to the Landsdowne.",..._t.Landsdowne},{revealAtHour:13,revealAtMinute:50,directions:"Back the way you came, but this time Gloucester Avenue until the end.",..._t.N},{directions:"Turn left onto Regents Park Road.",rewardsWithPub:!0,..._t.M},{directions:"That was quick! Go on then, another pub. Head to the Spread Eagle",..._t.SpreadEagle},{revealAtHour:14,revealAtMinute:50,directions:"Up Arlington Road, right to the end.",..._t.F},{directions:"Right down Jamestown past Wagamammas then Right onto Camden High Street. Walk to the underground.",rewardsWithPub:!0,..._t.J},{directions:"You're within touching distance of the end. Head to the Earl of Camden.... Pretty much where you were 10 minutes ago \ud83e\udd23",..._t.EarlOfCamden}],yellow:[{directions:"Head out of the office and over the road, down pratt street to the gardens on the left. Head in through the gate and 10 metres ahead stands a grave...",..._t.Q},{directions:"Through the park and over the road, down Georgiana and left onto Royal College. You'll soon reach the canal. When you do, cross the road...",rewardsWithPub:!0,..._t.D},{directions:"Your reward is a rest (already). Head to the Colonel Fawcett.",..._t.ColonelFawcett},{revealAtHour:11,revealAtMinute:50,directions:"Go to where you'd catch the overground.",..._t.O},{directions:"Carry on the main road towards Camden and take a left onto Camden Street and right onto Greenland Street",rewardsWithPub:!0,..._t.C},{directions:"Another answer, another pub! Head to the Spread Eagle.",..._t.SpreadEagle},{revealAtHour:12,revealAtMinute:50,directions:"Head North on Arlington",..._t.F},{directions:"Head over the canal via the footbridge and into the market main square... Search it!",rewardsWithPub:!0,..._t.H},{directions:"'Blimey', I hear you cry, 'Another pub?!'. You're on your way to the Lock Tavern.",..._t.LockTavern},{revealAtHour:13,revealAtMinute:50,directions:"Head out onto Harmood Street, take a right at Clarence Way and Right onto Hartland.",..._t.L},{directions:"Head through the park and find CastleHaven Community Association",rewardsWithPub:!0,..._t.K},{directions:"That was quick wasn't it. Go on then, another pub. Head to the Hawley arms",..._t.HawleyArms},{revealAtHour:14,revealAtMinute:50,directions:"You're on the home straight. Head out the pub and towards the lock down the main road. Stop when you reach the road bridge over the lock...",..._t.I},{directions:"Continue down the main road to station junction...",rewardsWithPub:!0,..._t.J},{directions:"You're within touching distance of the end. Head to the Earl of Camden!",..._t.EarlOfCamden}]},yt=Object.keys(gt);for(var vt=yt.length-1;vt>=0;vt--){let e=gt[yt[vt]];for(var xt=0;xt<e.length;xt++)if(e[xt].revealAtHour){let t=new Date;t.setHours(e[xt].revealAtHour),t.setMinutes(e[xt].revealAtMinute),t.setSeconds(0),t.setMilliseconds(0),e[xt].revealAtDate=t.getTime()}gt[yt[vt]]=e}const bt=gt;var wt=function(){return wt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},wt.apply(this,arguments)};Object.create;function Tt(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}Object.create;"function"===typeof SuppressedError&&SuppressedError;var St=n(613),Et=n.n(St),Ct="-ms-",At="-moz-",It="-webkit-",Mt="comm",kt="rule",Pt="decl",Dt="@import",Rt="@keyframes",zt="@layer",Lt=Math.abs,Ot=String.fromCharCode,Ft=Object.assign;function Bt(e){return e.trim()}function Nt(e,t){return(e=t.exec(e))?e[0]:e}function jt(e,t,n){return e.replace(t,n)}function Ut(e,t){return e.indexOf(t)}function Vt(e,t){return 0|e.charCodeAt(t)}function Gt(e,t,n){return e.slice(t,n)}function qt(e){return e.length}function Ht(e){return e.length}function Wt(e,t){return t.push(e),e}function Zt(e,t){return e.filter((function(e){return!Nt(e,t)}))}var Xt=1,Yt=1,Kt=0,Qt=0,Jt=0,$t="";function en(e,t,n,i,r,o,s,a){return{value:e,root:t,parent:n,type:i,props:r,children:o,line:Xt,column:Yt,length:s,return:"",siblings:a}}function tn(e,t){return Ft(en("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function nn(e){for(;e.root;)e=tn(e.root,{children:[e]});Wt(e,e.siblings)}function rn(){return Jt=Qt>0?Vt($t,--Qt):0,Yt--,10===Jt&&(Yt=1,Xt--),Jt}function on(){return Jt=Qt<Kt?Vt($t,Qt++):0,Yt++,10===Jt&&(Yt=1,Xt++),Jt}function sn(){return Vt($t,Qt)}function an(){return Qt}function ln(e,t){return Gt($t,e,t)}function cn(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function un(e){return Xt=Yt=1,Kt=qt($t=e),Qt=0,[]}function hn(e){return $t="",e}function dn(e){return Bt(ln(Qt-1,mn(91===e?e+2:40===e?e+1:e)))}function pn(e){for(;(Jt=sn())&&Jt<33;)on();return cn(e)>2||cn(Jt)>3?"":" "}function fn(e,t){for(;--t&&on()&&!(Jt<48||Jt>102||Jt>57&&Jt<65||Jt>70&&Jt<97););return ln(e,an()+(t<6&&32==sn()&&32==on()))}function mn(e){for(;on();)switch(Jt){case e:return Qt;case 34:case 39:34!==e&&39!==e&&mn(Jt);break;case 40:41===e&&mn(e);break;case 92:on()}return Qt}function _n(e,t){for(;on()&&e+Jt!==57&&(e+Jt!==84||47!==sn()););return"/*"+ln(t,Qt-1)+"*"+Ot(47===e?e:on())}function gn(e){for(;!cn(sn());)on();return ln(e,Qt)}function yn(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function vn(e,t,n,i){switch(e.type){case zt:if(e.children.length)break;case Dt:case Pt:return e.return=e.return||e.value;case Mt:return"";case Rt:return e.return=e.value+"{"+yn(e.children,i)+"}";case kt:if(!qt(e.value=e.props.join(",")))return""}return qt(n=yn(e.children,i))?e.return=e.value+"{"+n+"}":""}function xn(e,t,n){switch(function(e,t){return 45^Vt(e,0)?(((t<<2^Vt(e,0))<<2^Vt(e,1))<<2^Vt(e,2))<<2^Vt(e,3):0}(e,t)){case 5103:return It+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return It+e+e;case 4789:return At+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return It+e+At+e+Ct+e+e;case 5936:switch(Vt(e,t+11)){case 114:return It+e+Ct+jt(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return It+e+Ct+jt(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return It+e+Ct+jt(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return It+e+Ct+e+e;case 6165:return It+e+Ct+"flex-"+e+e;case 5187:return It+e+jt(e,/(\w+).+(:[^]+)/,It+"box-$1$2"+Ct+"flex-$1$2")+e;case 5443:return It+e+Ct+"flex-item-"+jt(e,/flex-|-self/g,"")+(Nt(e,/flex-|baseline/)?"":Ct+"grid-row-"+jt(e,/flex-|-self/g,""))+e;case 4675:return It+e+Ct+"flex-line-pack"+jt(e,/align-content|flex-|-self/g,"")+e;case 5548:return It+e+Ct+jt(e,"shrink","negative")+e;case 5292:return It+e+Ct+jt(e,"basis","preferred-size")+e;case 6060:return It+"box-"+jt(e,"-grow","")+It+e+Ct+jt(e,"grow","positive")+e;case 4554:return It+jt(e,/([^-])(transform)/g,"$1"+It+"$2")+e;case 6187:return jt(jt(jt(e,/(zoom-|grab)/,It+"$1"),/(image-set)/,It+"$1"),e,"")+e;case 5495:case 3959:return jt(e,/(image-set\([^]*)/,It+"$1$`$1");case 4968:return jt(jt(e,/(.+:)(flex-)?(.*)/,It+"box-pack:$3"+Ct+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+It+e+e;case 4200:if(!Nt(e,/flex-|baseline/))return Ct+"grid-column-align"+Gt(e,t)+e;break;case 2592:case 3360:return Ct+jt(e,"template-","")+e;case 4384:case 3616:return n&&n.some((function(e,n){return t=n,Nt(e.props,/grid-\w+-end/)}))?~Ut(e+(n=n[t].value),"span")?e:Ct+jt(e,"-start","")+e+Ct+"grid-row-span:"+(~Ut(n,"span")?Nt(n,/\d+/):+Nt(n,/\d+/)-+Nt(e,/\d+/))+";":Ct+jt(e,"-start","")+e;case 4896:case 4128:return n&&n.some((function(e){return Nt(e.props,/grid-\w+-start/)}))?e:Ct+jt(jt(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return jt(e,/(.+)-inline(.+)/,It+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(qt(e)-1-t>6)switch(Vt(e,t+1)){case 109:if(45!==Vt(e,t+4))break;case 102:return jt(e,/(.+:)(.+)-([^]+)/,"$1"+It+"$2-$3$1"+At+(108==Vt(e,t+3)?"$3":"$2-$3"))+e;case 115:return~Ut(e,"stretch")?xn(jt(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return jt(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,(function(t,n,i,r,o,s,a){return Ct+n+":"+i+a+(r?Ct+n+"-span:"+(o?s:+s-+i)+a:"")+e}));case 4949:if(121===Vt(e,t+6))return jt(e,":",":"+It)+e;break;case 6444:switch(Vt(e,45===Vt(e,14)?18:11)){case 120:return jt(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+It+(45===Vt(e,14)?"inline-":"")+"box$3$1"+It+"$2$3$1"+Ct+"$2box$3")+e;case 100:return jt(e,":",":"+Ct)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return jt(e,"scroll-","scroll-snap-")+e}return e}function bn(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case Pt:return void(e.return=xn(e.value,e.length,n));case Rt:return yn([tn(e,{value:jt(e.value,"@","@"+It)})],i);case kt:if(e.length)return function(e,t){return e.map(t).join("")}(n=e.props,(function(t){switch(Nt(t,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":nn(tn(e,{props:[jt(t,/:(read-\w+)/,":"+At+"$1")]})),nn(tn(e,{props:[t]})),Ft(e,{props:Zt(n,i)});break;case"::placeholder":nn(tn(e,{props:[jt(t,/:(plac\w+)/,":"+It+"input-$1")]})),nn(tn(e,{props:[jt(t,/:(plac\w+)/,":"+At+"$1")]})),nn(tn(e,{props:[jt(t,/:(plac\w+)/,Ct+"input-$1")]})),nn(tn(e,{props:[t]})),Ft(e,{props:Zt(n,i)})}return""}))}}function wn(e){return hn(Tn("",null,null,null,[""],e=un(e),0,[0],e))}function Tn(e,t,n,i,r,o,s,a,l){for(var c=0,u=0,h=s,d=0,p=0,f=0,m=1,_=1,g=1,y=0,v="",x=r,b=o,w=i,T=v;_;)switch(f=y,y=on()){case 40:if(108!=f&&58==Vt(T,h-1)){-1!=Ut(T+=jt(dn(y),"&","&\f"),"&\f")&&(g=-1);break}case 34:case 39:case 91:T+=dn(y);break;case 9:case 10:case 13:case 32:T+=pn(f);break;case 92:T+=fn(an()-1,7);continue;case 47:switch(sn()){case 42:case 47:Wt(En(_n(on(),an()),t,n,l),l);break;default:T+="/"}break;case 123*m:a[c++]=qt(T)*g;case 125*m:case 59:case 0:switch(y){case 0:case 125:_=0;case 59+u:-1==g&&(T=jt(T,/\f/g,"")),p>0&&qt(T)-h&&Wt(p>32?Cn(T+";",i,n,h-1,l):Cn(jt(T," ","")+";",i,n,h-2,l),l);break;case 59:T+=";";default:if(Wt(w=Sn(T,t,n,c,u,r,a,v,x=[],b=[],h,o),o),123===y)if(0===u)Tn(T,t,w,w,x,o,h,a,b);else switch(99===d&&110===Vt(T,3)?100:d){case 100:case 108:case 109:case 115:Tn(e,w,w,i&&Wt(Sn(e,w,w,0,0,r,a,v,r,x=[],h,b),b),r,b,h,a,i?x:b);break;default:Tn(T,w,w,w,[""],b,0,a,b)}}c=u=p=0,m=g=1,v=T="",h=s;break;case 58:h=1+qt(T),p=f;default:if(m<1)if(123==y)--m;else if(125==y&&0==m++&&125==rn())continue;switch(T+=Ot(y),y*m){case 38:g=u>0?1:(T+="\f",-1);break;case 44:a[c++]=(qt(T)-1)*g,g=1;break;case 64:45===sn()&&(T+=dn(on())),d=sn(),u=h=qt(v=T+=gn(an())),y++;break;case 45:45===f&&2==qt(T)&&(m=0)}}return o}function Sn(e,t,n,i,r,o,s,a,l,c,u,h){for(var d=r-1,p=0===r?o:[""],f=Ht(p),m=0,_=0,g=0;m<i;++m)for(var y=0,v=Gt(e,d+1,d=Lt(_=s[m])),x=e;y<f;++y)(x=Bt(_>0?p[y]+" "+v:jt(v,/&\f/g,p[y])))&&(l[g++]=x);return en(e,t,n,0===r?kt:a,l,c,u,h)}function En(e,t,n,i){return en(e,t,n,Mt,Ot(Jt),Gt(e,2,-2),0,i)}function Cn(e,t,n,i,r){return en(e,t,n,Pt,Gt(e,0,i),Gt(e,i+1,-1),i,r)}var An={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},In="undefined"!=typeof process&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&({NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_ATTR||{NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_ATTR)||"data-styled",Mn="undefined"!=typeof window&&"HTMLElement"in window,kn=Boolean("boolean"==typeof SC_DISABLE_SPEEDY?SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY&&""!=={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY?"false"!=={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY&&{NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&""!=={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&("false"!=={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&{NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY)),Pn=(new Set,Object.freeze([])),Dn=Object.freeze({});function Rn(e,t,n){return void 0===n&&(n=Dn),e.theme!==n.theme&&e.theme||t||n.theme}var zn=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),Ln=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,On=/(^-|-$)/g;function Fn(e){return e.replace(Ln,"-").replace(On,"")}var Bn=/(a)(d)/gi,Nn=function(e){return String.fromCharCode(e+(e>25?39:97))};function jn(e){var t,n="";for(t=Math.abs(e);t>52;t=t/52|0)n=Nn(t%52)+n;return(Nn(t%52)+n).replace(Bn,"$1-$2")}var Un,Vn=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},Gn=function(e){return Vn(5381,e)};function qn(e){return jn(Gn(e)>>>0)}function Hn(e){return e.displayName||e.name||"Component"}function Wn(e){return"string"==typeof e&&!0}var Zn="function"==typeof Symbol&&Symbol.for,Xn=Zn?Symbol.for("react.memo"):60115,Yn=Zn?Symbol.for("react.forward_ref"):60112,Kn={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},Qn={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Jn={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},$n=((Un={})[Yn]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Un[Xn]=Jn,Un);function ei(e){return("type"in(t=e)&&t.type.$$typeof)===Xn?Jn:"$$typeof"in e?$n[e.$$typeof]:Kn;var t}var ti=Object.defineProperty,ni=Object.getOwnPropertyNames,ii=Object.getOwnPropertySymbols,ri=Object.getOwnPropertyDescriptor,oi=Object.getPrototypeOf,si=Object.prototype;function ai(e,t,n){if("string"!=typeof t){if(si){var i=oi(t);i&&i!==si&&ai(e,i,n)}var r=ni(t);ii&&(r=r.concat(ii(t)));for(var o=ei(e),s=ei(t),a=0;a<r.length;++a){var l=r[a];if(!(l in Qn||n&&n[l]||s&&l in s||o&&l in o)){var c=ri(t,l);try{ti(e,l,c)}catch(e){}}}}return e}function li(e){return"function"==typeof e}function ci(e){return"object"==typeof e&&"styledComponentId"in e}function ui(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function hi(e,t){if(0===e.length)return"";for(var n=e[0],i=1;i<e.length;i++)n+=t?t+e[i]:e[i];return n}function di(e){return null!==e&&"object"==typeof e&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function pi(e,t,n){if(void 0===n&&(n=!1),!n&&!di(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)e[i]=pi(e[i],t[i]);else if(di(t))for(var i in t)e[i]=pi(e[i],t[i]);return e}function fi(e,t){Object.defineProperty(e,"toString",{value:t})}function mi(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var _i=function(){function e(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return e.prototype.indexOfGroup=function(e){for(var t=0,n=0;n<e;n++)t+=this.groupSizes[n];return t},e.prototype.insertRules=function(e,t){if(e>=this.groupSizes.length){for(var n=this.groupSizes,i=n.length,r=i;e>=r;)if((r<<=1)<0)throw mi(16,"".concat(e));this.groupSizes=new Uint32Array(r),this.groupSizes.set(n),this.length=r;for(var o=i;o<r;o++)this.groupSizes[o]=0}for(var s=this.indexOfGroup(e+1),a=(o=0,t.length);o<a;o++)this.tag.insertRule(s,t[o])&&(this.groupSizes[e]++,s++)},e.prototype.clearGroup=function(e){if(e<this.length){var t=this.groupSizes[e],n=this.indexOfGroup(e),i=n+t;this.groupSizes[e]=0;for(var r=n;r<i;r++)this.tag.deleteRule(n)}},e.prototype.getGroup=function(e){var t="";if(e>=this.length||0===this.groupSizes[e])return t;for(var n=this.groupSizes[e],i=this.indexOfGroup(e),r=i+n,o=i;o<r;o++)t+="".concat(this.tag.getRule(o)).concat("/*!sc*/\n");return t},e}(),gi=new Map,yi=new Map,vi=1,xi=function(e){if(gi.has(e))return gi.get(e);for(;yi.has(vi);)vi++;var t=vi++;return gi.set(e,t),yi.set(t,e),t},bi=function(e,t){vi=t+1,gi.set(e,t),yi.set(t,e)},wi="style[".concat(In,"][").concat("data-styled-version",'="').concat("6.1.1",'"]'),Ti=new RegExp("^".concat(In,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Si=function(e,t,n){for(var i,r=n.split(","),o=0,s=r.length;o<s;o++)(i=r[o])&&e.registerName(t,i)},Ei=function(e,t){for(var n,i=(null!==(n=t.textContent)&&void 0!==n?n:"").split("/*!sc*/\n"),r=[],o=0,s=i.length;o<s;o++){var a=i[o].trim();if(a){var l=a.match(Ti);if(l){var c=0|parseInt(l[1],10),u=l[2];0!==c&&(bi(u,c),Si(e,u,l[3]),e.getTag().insertRules(c,r)),r.length=0}else r.push(a)}}};function Ci(){return n.nc}var Ai=function(e){var t=document.head,n=e||t,i=document.createElement("style"),r=function(e){var t=Array.from(e.querySelectorAll("style[".concat(In,"]")));return t[t.length-1]}(n),o=void 0!==r?r.nextSibling:null;i.setAttribute(In,"active"),i.setAttribute("data-styled-version","6.1.1");var s=Ci();return s&&i.setAttribute("nonce",s),n.insertBefore(i,o),i},Ii=function(){function e(e){this.element=Ai(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(e){if(e.sheet)return e.sheet;for(var t=document.styleSheets,n=0,i=t.length;n<i;n++){var r=t[n];if(r.ownerNode===e)return r}throw mi(17)}(this.element),this.length=0}return e.prototype.insertRule=function(e,t){try{return this.sheet.insertRule(t,e),this.length++,!0}catch(e){return!1}},e.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},e.prototype.getRule=function(e){var t=this.sheet.cssRules[e];return t&&t.cssText?t.cssText:""},e}(),Mi=function(){function e(e){this.element=Ai(e),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(e,t){if(e<=this.length&&e>=0){var n=document.createTextNode(t);return this.element.insertBefore(n,this.nodes[e]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},e.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},e}(),ki=function(){function e(e){this.rules=[],this.length=0}return e.prototype.insertRule=function(e,t){return e<=this.length&&(this.rules.splice(e,0,t),this.length++,!0)},e.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},e.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},e}(),Pi=Mn,Di={isServer:!Mn,useCSSOMInjection:!kn},Ri=function(){function e(e,t,n){void 0===e&&(e=Dn),void 0===t&&(t={});var i=this;this.options=wt(wt({},Di),e),this.gs=t,this.names=new Map(n),this.server=!!e.isServer,!this.server&&Mn&&Pi&&(Pi=!1,function(e){for(var t=document.querySelectorAll(wi),n=0,i=t.length;n<i;n++){var r=t[n];r&&"active"!==r.getAttribute(In)&&(Ei(e,r),r.parentNode&&r.parentNode.removeChild(r))}}(this)),fi(this,(function(){return function(e){for(var t=e.getTag(),n=t.length,i="",r=function(n){var r=function(e){return yi.get(e)}(n);if(void 0===r)return"continue";var o=e.names.get(r),s=t.getGroup(n);if(void 0===o||0===s.length)return"continue";var a="".concat(In,".g").concat(n,'[id="').concat(r,'"]'),l="";void 0!==o&&o.forEach((function(e){e.length>0&&(l+="".concat(e,","))})),i+="".concat(s).concat(a,'{content:"').concat(l,'"}').concat("/*!sc*/\n")},o=0;o<n;o++)r(o);return i}(i)}))}return e.registerId=function(e){return xi(e)},e.prototype.reconstructWithOptions=function(t,n){return void 0===n&&(n=!0),new e(wt(wt({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(e=function(e){var t=e.useCSSOMInjection,n=e.target;return e.isServer?new ki(n):t?new Ii(n):new Mi(n)}(this.options),new _i(e)));var e},e.prototype.hasNameForId=function(e,t){return this.names.has(e)&&this.names.get(e).has(t)},e.prototype.registerName=function(e,t){if(xi(e),this.names.has(e))this.names.get(e).add(t);else{var n=new Set;n.add(t),this.names.set(e,n)}},e.prototype.insertRules=function(e,t,n){this.registerName(e,t),this.getTag().insertRules(xi(e),n)},e.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},e.prototype.clearRules=function(e){this.getTag().clearGroup(xi(e)),this.clearNames(e)},e.prototype.clearTag=function(){this.tag=void 0},e}(),zi=/&/g,Li=/^\s*\/\/.*$/gm;function Oi(e,t){return e.map((function(e){return"rule"===e.type&&(e.value="".concat(t," ").concat(e.value),e.value=e.value.replaceAll(",",",".concat(t," ")),e.props=e.props.map((function(e){return"".concat(t," ").concat(e)}))),Array.isArray(e.children)&&"@keyframes"!==e.type&&(e.children=Oi(e.children,t)),e}))}function Fi(e){var t,n,i,r=void 0===e?Dn:e,o=r.options,s=void 0===o?Dn:o,a=r.plugins,l=void 0===a?Pn:a,c=function(e,i,r){return r===n||r.startsWith(n)&&r.endsWith(n)&&r.replaceAll(n,"").length>0?".".concat(t):e},u=l.slice();u.push((function(e){e.type===kt&&e.value.includes("&")&&(e.props[0]=e.props[0].replace(zi,n).replace(i,c))})),s.prefix&&u.push(bn),u.push(vn);var h=function(e,r,o,a){void 0===r&&(r=""),void 0===o&&(o=""),void 0===a&&(a="&"),t=a,n=r,i=new RegExp("\\".concat(n,"\\b"),"g");var l=e.replace(Li,""),c=wn(o||r?"".concat(o," ").concat(r," { ").concat(l," }"):l);s.namespace&&(c=Oi(c,s.namespace));var h,d=[];return yn(c,function(e){var t=Ht(e);return function(n,i,r,o){for(var s="",a=0;a<t;a++)s+=e[a](n,i,r,o)||"";return s}}(u.concat((h=function(e){return d.push(e)},function(e){e.root||(e=e.return)&&h(e)})))),d};return h.hash=l.length?l.reduce((function(e,t){return t.name||mi(15),Vn(e,t.name)}),5381).toString():"",h}var Bi=new Ri,Ni=Fi(),ji=e.createContext({shouldForwardProp:void 0,styleSheet:Bi,stylis:Ni}),Ui=(ji.Consumer,e.createContext(void 0));function Vi(){return(0,e.useContext)(ji)}function Gi(t){var n=(0,e.useState)(t.stylisPlugins),i=n[0],r=n[1],o=Vi().styleSheet,s=(0,e.useMemo)((function(){var e=o;return t.sheet?e=t.sheet:t.target&&(e=e.reconstructWithOptions({target:t.target},!1)),t.disableCSSOMInjection&&(e=e.reconstructWithOptions({useCSSOMInjection:!1})),e}),[t.disableCSSOMInjection,t.sheet,t.target,o]),a=(0,e.useMemo)((function(){return Fi({options:{namespace:t.namespace,prefix:t.enableVendorPrefixes},plugins:i})}),[t.enableVendorPrefixes,t.namespace,i]);(0,e.useEffect)((function(){Et()(i,t.stylisPlugins)||r(t.stylisPlugins)}),[t.stylisPlugins]);var l=(0,e.useMemo)((function(){return{shouldForwardProp:t.shouldForwardProp,styleSheet:s,stylis:a}}),[t.shouldForwardProp,s,a]);return e.createElement(ji.Provider,{value:l},e.createElement(Ui.Provider,{value:a},t.children))}var qi=function(){function e(e,t){var n=this;this.inject=function(e,t){void 0===t&&(t=Ni);var i=n.name+t.hash;e.hasNameForId(n.id,i)||e.insertRules(n.id,i,t(n.rules,i,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=t,fi(this,(function(){throw mi(12,String(n.name))}))}return e.prototype.getName=function(e){return void 0===e&&(e=Ni),this.name+e.hash},e}(),Hi=function(e){return e>="A"&&e<="Z"};function Wi(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(1===n&&"-"===i&&"-"===e[0])return e;Hi(i)?t+="-"+i.toLowerCase():t+=i}return t.startsWith("ms-")?"-"+t:t}var Zi=function(e){return null==e||!1===e||""===e},Xi=function(e){var t,n,i=[];for(var r in e){var o=e[r];e.hasOwnProperty(r)&&!Zi(o)&&(Array.isArray(o)&&o.isCss||li(o)?i.push("".concat(Wi(r),":"),o,";"):di(o)?i.push.apply(i,Tt(Tt(["".concat(r," {")],Xi(o),!1),["}"],!1)):i.push("".concat(Wi(r),": ").concat((t=r,null==(n=o)||"boolean"==typeof n||""===n?"":"number"!=typeof n||0===n||t in An||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function Yi(e,t,n,i){return Zi(e)?[]:ci(e)?[".".concat(e.styledComponentId)]:li(e)?!li(r=e)||r.prototype&&r.prototype.isReactComponent||!t?[e]:Yi(e(t),t,n,i):e instanceof qi?n?(e.inject(n,i),[e.getName(i)]):[e]:di(e)?Xi(e):Array.isArray(e)?Array.prototype.concat.apply(Pn,e.map((function(e){return Yi(e,t,n,i)}))):[e.toString()];var r}function Ki(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(li(n)&&!ci(n))return!1}return!0}var Qi=Gn("6.1.1"),Ji=function(){function e(e,t,n){this.rules=e,this.staticRulesId="",this.isStatic=(void 0===n||n.isStatic)&&Ki(e),this.componentId=t,this.baseHash=Vn(Qi,t),this.baseStyle=n,Ri.registerId(t)}return e.prototype.generateAndInjectStyles=function(e,t,n){var i=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,t,n):"";if(this.isStatic&&!n.hash)if(this.staticRulesId&&t.hasNameForId(this.componentId,this.staticRulesId))i=ui(i,this.staticRulesId);else{var r=hi(Yi(this.rules,e,t,n)),o=jn(Vn(this.baseHash,r)>>>0);if(!t.hasNameForId(this.componentId,o)){var s=n(r,".".concat(o),void 0,this.componentId);t.insertRules(this.componentId,o,s)}i=ui(i,o),this.staticRulesId=o}else{for(var a=Vn(this.baseHash,n.hash),l="",c=0;c<this.rules.length;c++){var u=this.rules[c];if("string"==typeof u)l+=u;else if(u){var h=hi(Yi(u,e,t,n));a=Vn(a,h+c),l+=h}}if(l){var d=jn(a>>>0);t.hasNameForId(this.componentId,d)||t.insertRules(this.componentId,d,n(l,".".concat(d),void 0,this.componentId)),i=ui(i,d)}}return i},e}(),$i=e.createContext(void 0);$i.Consumer;var er={};new Set;function tr(t,n,i){var r=ci(t),o=t,s=!Wn(t),a=n.attrs,l=void 0===a?Pn:a,c=n.componentId,u=void 0===c?function(e,t){var n="string"!=typeof e?"sc":Fn(e);er[n]=(er[n]||0)+1;var i="".concat(n,"-").concat(qn("6.1.1"+n+er[n]));return t?"".concat(t,"-").concat(i):i}(n.displayName,n.parentComponentId):c,h=n.displayName,d=void 0===h?function(e){return Wn(e)?"styled.".concat(e):"Styled(".concat(Hn(e),")")}(t):h,p=n.displayName&&n.componentId?"".concat(Fn(n.displayName),"-").concat(n.componentId):n.componentId||u,f=r&&o.attrs?o.attrs.concat(l).filter(Boolean):l,m=n.shouldForwardProp;if(r&&o.shouldForwardProp){var _=o.shouldForwardProp;if(n.shouldForwardProp){var g=n.shouldForwardProp;m=function(e,t){return _(e,t)&&g(e,t)}}else m=_}var y=new Ji(i,p,r?o.componentStyle:void 0);function v(t,n){return function(t,n,i){var r=t.attrs,o=t.componentStyle,s=t.defaultProps,a=t.foldedComponentIds,l=t.styledComponentId,c=t.target,u=e.useContext($i),h=Vi(),d=t.shouldForwardProp||h.shouldForwardProp,p=function(e,t,n){for(var i,r=wt(wt({},t),{className:void 0,theme:n}),o=0;o<e.length;o+=1){var s=li(i=e[o])?i(r):i;for(var a in s)r[a]="className"===a?ui(r[a],s[a]):"style"===a?wt(wt({},r[a]),s[a]):s[a]}return t.className&&(r.className=ui(r.className,t.className)),r}(r,n,Rn(n,u,s)||Dn),f=p.as||c,m={};for(var _ in p)void 0===p[_]||"$"===_[0]||"as"===_||"theme"===_||("forwardedAs"===_?m.as=p.forwardedAs:d&&!d(_,f)||(m[_]=p[_]));var g=function(e,t){var n=Vi();return e.generateAndInjectStyles(t,n.styleSheet,n.stylis)}(o,p),y=ui(a,l);return g&&(y+=" "+g),p.className&&(y+=" "+p.className),m[Wn(f)&&!zn.has(f)?"class":"className"]=y,m.ref=i,(0,e.createElement)(f,m)}(x,t,n)}v.displayName=d;var x=e.forwardRef(v);return x.attrs=f,x.componentStyle=y,x.displayName=d,x.shouldForwardProp=m,x.foldedComponentIds=r?ui(o.foldedComponentIds,o.styledComponentId):"",x.styledComponentId=p,x.target=r?o.target:t,Object.defineProperty(x,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(e){this._foldedDefaultProps=r?function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0,r=t;i<r.length;i++)pi(e,r[i],!0);return e}({},o.defaultProps,e):e}}),fi(x,(function(){return".".concat(x.styledComponentId)})),s&&ai(x,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),x}function nr(e,t){for(var n=[e[0]],i=0,r=t.length;i<r;i+=1)n.push(t[i],e[i+1]);return n}var ir=function(e){return Object.assign(e,{isCss:!0})};function rr(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(li(e)||di(e))return ir(Yi(nr(Pn,Tt([e],t,!0))));var i=e;return 0===t.length&&1===i.length&&"string"==typeof i[0]?Yi(i):ir(Yi(nr(i,t)))}function or(e,t,n){if(void 0===n&&(n=Dn),!t)throw mi(1,t);var i=function(i){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return e(t,n,rr.apply(void 0,Tt([i],r,!1)))};return i.attrs=function(i){return or(e,t,wt(wt({},n),{attrs:Array.prototype.concat(n.attrs,i).filter(Boolean)}))},i.withConfig=function(i){return or(e,t,wt(wt({},n),i))},i}var sr=function(e){return or(tr,e)},ar=sr;zn.forEach((function(e){ar[e]=sr(e)}));!function(){function e(e,t){this.rules=e,this.componentId=t,this.isStatic=Ki(e),Ri.registerId(this.componentId+1)}e.prototype.createStyles=function(e,t,n,i){var r=i(hi(Yi(this.rules,t,n,i)),""),o=this.componentId+e;n.insertRules(o,o,r)},e.prototype.removeStyles=function(e,t){t.clearRules(this.componentId+e)},e.prototype.renderStyles=function(e,t,n,i){e>2&&Ri.registerId(this.componentId+e),this.removeStyles(e,n),this.createStyles(e,t,n,i)}}();(function(){function t(){var t=this;this._emitSheetCSS=function(){var e=t.instance.toString(),n=Ci(),i=hi([n&&'nonce="'.concat(n,'"'),"".concat(In,'="true"'),"".concat("data-styled-version",'="').concat("6.1.1",'"')].filter(Boolean)," ");return"<style ".concat(i,">").concat(e,"</style>")},this.getStyleTags=function(){if(t.sealed)throw mi(2);return t._emitSheetCSS()},this.getStyleElement=function(){var n;if(t.sealed)throw mi(2);var i=((n={})[In]="",n["data-styled-version"]="6.1.1",n.dangerouslySetInnerHTML={__html:t.instance.toString()},n),r=Ci();return r&&(i.nonce=r),[e.createElement("style",wt({},i,{key:"sc-0-0"}))]},this.seal=function(){t.sealed=!0},this.instance=new Ri({isServer:!0}),this.sealed=!1}t.prototype.collectStyles=function(t){if(this.sealed)throw mi(2);return e.createElement(Gi,{sheet:this.instance},t)},t.prototype.interleaveWithNodeStream=function(e){throw mi(3)}})(),"__sc-".concat(In,"__");var lr,cr=n(184);const ur=ar.input(lr||(lr=r(["\n  height:64px;\n  width:100%;\n  background:white;\n  outline: none;\n  border:1px solid #E1E6EF;\n  transition:all 0.3s ease;\n  border-radius:20px;\n  font-size:20px;\n  padding:16px;\n  box-sizing:border-box;\n  \n"])));const hr=function(t){let{background:n,textColor:i,value:r,type:o,onChange:s,incorrectValue:a}=t;const[l,c]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{let e;return c(!0),e=setTimeout((()=>{c(!1)}),500),()=>{clearTimeout(e)}}),[a]),(0,cr.jsx)("div",{children:(0,cr.jsx)(ur,{type:o||"text",value:r,onChange:s,placeholder:"Type your answer",style:l?{border:"1px solid red"}:{background:n,color:i}})})};var dr,pr;const fr=ar.button(dr||(dr=r(["\n  height:56px;\n  width:100%;\n  background:white;\n  outline: none;\n  \n  border:none;\n  border-radius:20px;\n  font-size:16px;\n  padding:12px;\n  box-sizing:border-box;\n  color: white;\n  margin-top:16px;\n"])));ar.p(pr||(pr=r(["\n  color: white;\n"])));const mr=function(e){let{color:t,textColor:n,text:i,team:r,secondary:o,isDisabled:s,onSubmit:a}=e;return(0,cr.jsx)(fr,{placeholder:"Type your answer",style:{background:o?"white":s?"#EAEAEA":t?t.dark:"#CA4035",color:o?"#CA4035":s?"#717171":t?t.text:"white",border:o?t?"1ps solid ".concat(t.dark):"1px solid #CA4035":"none"},onClick:()=>a(r),children:i||"Submit"})},_r=e=>e=(e=e.toLowerCase()).replace(/[^A-Z0-9]+/gi,"");var gr;ar.p(gr||(gr=r(["\n  color:red;\n"])));const yr=!1,vr=!1,xr="${JSCORE_VERSION}",br=function(e,t){if(!e)throw wr(t)},wr=function(e){return new Error("Firebase Database ("+xr+") INTERNAL ASSERT FAILED: "+e)},Tr=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296===(64512&r)&&i+1<e.length&&56320===(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},Sr={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<e.length;r+=3){const t=e[r],o=r+1<e.length,s=o?e[r+1]:0,a=r+2<e.length,l=a?e[r+2]:0,c=t>>2,u=(3&t)<<4|s>>4;let h=(15&s)<<2|l>>6,d=63&l;a||(d=64,o||(h=64)),i.push(n[c],n[u],n[h],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Tr(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const o=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&o)}else if(r>239&&r<365){const o=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(o>>10)),t[i++]=String.fromCharCode(56320+(1023&o))}else{const o=e[n++],s=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&o)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<e.length;){const t=n[e.charAt(r++)],o=r<e.length?n[e.charAt(r)]:0;++r;const s=r<e.length?n[e.charAt(r)]:64;++r;const a=r<e.length?n[e.charAt(r)]:64;if(++r,null==t||null==o||null==s||null==a)throw new Er;const l=t<<2|o>>4;if(i.push(l),64!==s){const e=o<<4&240|s>>2;if(i.push(e),64!==a){const e=s<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Er extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Cr=function(e){const t=Tr(e);return Sr.encodeByteArray(t,!0)},Ar=function(e){return Cr(e).replace(/\./g,"")},Ir=function(e){try{return Sr.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Mr(e){return kr(void 0,e)}function kr(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=kr(e[n],t[n]));return e}const Pr=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Dr=()=>{try{return Pr()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&Ir(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},Rr=e=>{const t=(e=>{var t,n;return null===(n=null===(t=Dr())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},zr=()=>{var e;return null===(e=Dr())||void 0===e?void 0:e.config};class Lr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function Or(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Fr(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Or())}function Br(){return!0===yr||!0===vr}class Nr extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Nr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,jr.prototype.create)}}class jr{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),i=this.errors[e],r=i?function(e,t){return e.replace(Ur,((e,n)=>{const i=t[n];return null!=i?String(i):"<".concat(n,"?>")}))}(i,t):"Error",o="".concat(this.serviceName,": ").concat(r," (").concat(n,").");return new Nr(n,o,t)}}const Ur=/\{\$([^}]+)}/g;function Vr(e){return JSON.parse(e)}function Gr(e){return JSON.stringify(e)}const qr=function(e){let t={},n={},i={},r="";try{const o=e.split(".");t=Vr(Ir(o[0])||""),n=Vr(Ir(o[1])||""),r=o[2],i=n.d||{},delete n.d}catch(o){}return{header:t,claims:n,data:i,signature:r}};function Hr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Wr(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Zr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Xr(e,t,n){const i={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function Yr(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],o=t[r];if(Kr(n)&&Kr(o)){if(!Yr(n,o))return!1}else if(n!==o)return!1}for(const r of i)if(!n.includes(r))return!1;return!0}function Kr(e){return null!==e&&"object"===typeof e}class Qr{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"===typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let i,r,o=this.chain_[0],s=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(i=l^s&(a^l),r=1518500249):(i=s^a^l,r=1859775393):u<60?(i=s&a|l&(s|a),r=2400959708):(i=s^a^l,r=3395469782);const e=(o<<5|o>>>27)+i+c+r+n[u]&4294967295;c=l,l=a,a=4294967295&(s<<30|s>>>2),s=o,o=e}this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<t;){if(0===o)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"===typeof e){for(;i<t;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<t;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[i]>>t&255,++n;return e}}function Jr(e,t){return"".concat(e," failed: ").concat(t," argument ")}const $r=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function eo(e){return e&&e._delegate?e._delegate:e}class to{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const no="[DEFAULT]";class io{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Lr;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),i=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:no})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:i});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:no;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:no;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:no;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,o]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(r)&&o.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(i){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:ro(t),options:n}),this.instances.set(t,i),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(r){}return i||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:no;return this.component?this.component.multipleInstances?e:no:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function ro(e){return e===no?void 0:e}class oo{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new io(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const so=[];var ao;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(ao||(ao={}));const lo={debug:ao.DEBUG,verbose:ao.VERBOSE,info:ao.INFO,warn:ao.WARN,error:ao.ERROR,silent:ao.SILENT},co=ao.INFO,uo={[ao.DEBUG]:"log",[ao.VERBOSE]:"log",[ao.INFO]:"info",[ao.WARN]:"warn",[ao.ERROR]:"error"},ho=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),i=uo[t];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var r=arguments.length,o=new Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];console[i]("[".concat(n,"]  ").concat(e.name,":"),...o)};class po{constructor(e){this.name=e,this._logLevel=co,this._logHandler=ho,this._userLogHandler=null,so.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ao))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?lo[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ao.DEBUG,...t),this._logHandler(this,ao.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ao.VERBOSE,...t),this._logHandler(this,ao.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ao.INFO,...t),this._logHandler(this,ao.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ao.WARN,...t),this._logHandler(this,ao.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ao.ERROR,...t),this._logHandler(this,ao.ERROR,...t)}}const fo=(e,t)=>t.some((t=>e instanceof t));let mo,_o;const go=new WeakMap,yo=new WeakMap,vo=new WeakMap,xo=new WeakMap,bo=new WeakMap;let wo={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return yo.get(e);if("objectStoreNames"===t)return e.objectStoreNames||vo.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Eo(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function To(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(_o||(_o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.apply(Co(this),n),Eo(go.get(this))}:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Eo(e.apply(Co(this),n))}:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];const o=e.call(Co(this),t,...i);return vo.set(o,t.sort?t.sort():[t]),Eo(o)}}function So(e){return"function"===typeof e?To(e):(e instanceof IDBTransaction&&function(e){if(yo.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",o),e.removeEventListener("abort",o)},r=()=>{t(),i()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",o),e.addEventListener("abort",o)}));yo.set(e,t)}(e),fo(e,mo||(mo=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,wo):e)}function Eo(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",o)},r=()=>{t(Eo(e.result)),i()},o=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&go.set(t,e)})).catch((()=>{})),bo.set(t,e),t}(e);if(xo.has(e))return xo.get(e);const t=So(e);return t!==e&&(xo.set(e,t),bo.set(t,e)),t}const Co=e=>bo.get(e);const Ao=["get","getKey","getAll","getAllKeys","count"],Io=["put","add","delete","clear"],Mo=new Map;function ko(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Mo.get(t))return Mo.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=Io.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Ao.includes(n))return;const o=async function(e){const t=this.transaction(e,r?"readwrite":"readonly");let o=t.store;for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];return i&&(o=o.index(a.shift())),(await Promise.all([o[n](...a),r&&t.done]))[0]};return Mo.set(t,o),o}wo=(e=>({...e,get:(t,n,i)=>ko(t,n)||e.get(t,n,i),has:(t,n)=>!!ko(t,n)||e.has(t,n)}))(wo);class Po{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((e=>e)).join(" ")}}const Do="@firebase/app",Ro="0.9.24",zo=new po("@firebase/app"),Lo="[DEFAULT]",Oo={[Do]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Fo=new Map,Bo=new Map;function No(e,t){try{e.container.addComponent(t)}catch(n){zo.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function jo(e){const t=e.name;if(Bo.has(t))return zo.debug("There were multiple attempts to register component ".concat(t,".")),!1;Bo.set(t,e);for(const n of Fo.values())No(n,e);return!0}function Uo(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Vo=new jr("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Go{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new to("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Vo.create("app-deleted",{appName:this._name})}}function qo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const i=Object.assign({name:Lo,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!==typeof r||!r)throw Vo.create("bad-app-name",{appName:String(r)});if(n||(n=zr()),!n)throw Vo.create("no-options");const o=Fo.get(r);if(o){if(Yr(n,o.options)&&Yr(i,o.config))return o;throw Vo.create("duplicate-app",{appName:r})}const s=new oo(r);for(const l of Bo.values())s.addComponent(l);const a=new Go(n,i,s);return Fo.set(r,a),a}function Ho(e,t,n){var i;let r=null!==(i=Oo[e])&&void 0!==i?i:e;n&&(r+="-".concat(n));const o=r.match(/\s|\//),s=t.match(/\s|\//);if(o||s){const e=['Unable to register library "'.concat(r,'" with version "').concat(t,'":')];return o&&e.push('library name "'.concat(r,'" contains illegal characters (whitespace or "/")')),o&&s&&e.push("and"),s&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void zo.warn(e.join(" "))}jo(new to("".concat(r,"-version"),(()=>({library:r,version:t})),"VERSION"))}const Wo="firebase-heartbeat-database",Zo=1,Xo="firebase-heartbeat-store";let Yo=null;function Ko(){return Yo||(Yo=function(e,t){let{blocked:n,upgrade:i,blocking:r,terminated:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),a=Eo(s);return i&&s.addEventListener("upgradeneeded",(e=>{i(Eo(s.result),e.oldVersion,e.newVersion,Eo(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{o&&e.addEventListener("close",(()=>o())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(Wo,Zo,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(Xo)}}).catch((e=>{throw Vo.create("idb-open",{originalErrorMessage:e.message})}))),Yo}async function Qo(e,t){try{const n=(await Ko()).transaction(Xo,"readwrite"),i=n.objectStore(Xo);await i.put(t,Jo(e)),await n.done}catch(n){if(n instanceof Nr)zo.warn(n.message);else{const e=Vo.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});zo.warn(e.message)}}}function Jo(e){return"".concat(e.name,"!").concat(e.options.appId)}class $o{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ts(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=es();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==i&&!this._heartbeatsCache.heartbeats.some((e=>e.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=es(),{heartbeatsToSend:n,unsentEntries:i}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),ns(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),ns(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=Ar(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function es(){return(new Date).toISOString().substring(0,10)}class ts{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"===typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(ws){t(ws)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await Ko();return await t.transaction(Xo).objectStore(Xo).get(Jo(e))}catch(t){if(t instanceof Nr)zo.warn(t.message);else{const e=Vo.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});zo.warn(e.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Qo(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Qo(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ns(e){return Ar(JSON.stringify({version:2,heartbeats:e})).length}var is;is="",jo(new to("platform-logger",(e=>new Po(e)),"PRIVATE")),jo(new to("heartbeat",(e=>new $o(e)),"PRIVATE")),Ho(Do,Ro,is),Ho(Do,Ro,"esm2017"),Ho("fire-js","");const rs="@firebase/database",os="1.0.1";let ss="";function as(e){ss=e}class ls{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Gr(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Vr(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class cs{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Hr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const us=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new ls(t)}}catch(t){}return new cs},hs=us("localStorage"),ds=us("sessionStorage"),ps=new po("@firebase/database"),fs=function(){let e=1;return function(){return e++}}(),ms=function(e){const t=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){const t=r-55296;i++,br(i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):r<65536?(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t}(e),n=new Qr;n.update(t);const i=n.digest();return Sr.encodeByteArray(i)},_s=function(){let e="";for(let t=0;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];Array.isArray(n)||n&&"object"===typeof n&&"number"===typeof n.length?e+=_s.apply(null,n):e+="object"===typeof n?Gr(n):n,e+=" "}return e};let gs=null,ys=!0;const vs=function(e,t){br(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(ps.logLevel=ao.VERBOSE,gs=ps.log.bind(ps),t&&ds.set("logging_enabled",!0)):"function"===typeof e?gs=e:(gs=null,ds.remove("logging_enabled"))},xs=function(){if(!0===ys&&(ys=!1,null===gs&&!0===ds.get("logging_enabled")&&vs(!0)),gs){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=_s.apply(null,t);gs(i)}},bs=function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];xs(e,...n)}},ws=function(){const e="FIREBASE INTERNAL ERROR: "+_s(...arguments);ps.error(e)},Ts=function(){const e="FIREBASE FATAL ERROR: ".concat(_s(...arguments));throw ps.error(e),new Error(e)},Ss=function(){const e="FIREBASE WARNING: "+_s(...arguments);ps.warn(e)},Es=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Cs="[MIN_NAME]",As="[MAX_NAME]",Is=function(e,t){if(e===t)return 0;if(e===Cs||t===As)return-1;if(t===Cs||e===As)return 1;{const n=Os(e),i=Os(t);return null!==n?null!==i?n-i===0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},Ms=function(e,t){return e===t?0:e<t?-1:1},ks=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Gr(t))},Ps=function(e){if("object"!==typeof e||null===e)return Gr(e);const t=[];for(const i in e)t.push(i);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=Gr(t[i]),n+=":",n+=Ps(e[t[i]]);return n+="}",n},Ds=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function Rs(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const zs=function(e){br(!Es(e),"Invalid JSON number");const t=1023;let n,i,r,o,s;0===e?(i=0,r=0,n=1/e===-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),i=o+t,r=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(i=0,r=Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;s-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)a.push(i%2?1:0),i=Math.floor(i/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(l.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const Ls=new RegExp("^-?(0*)\\d{1,10}$"),Os=function(e){if(Ls.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Fs=function(e){try{e()}catch(t){setTimeout((()=>{const e=t.stack||"";throw Ss("Exception was thrown by user callback.",e),t}),Math.floor(0))}},Bs=function(e,t){const n=setTimeout(e,t);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"===typeof n&&n.unref&&n.unref(),n};class Ns{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){Ss('Provided AppCheck credentials for the app named "'.concat(this.appName_,'" ')+"are invalid. This usually indicates your app was not initialized correctly.")}}class js{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(xs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ss(e)}}class Us{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Us.OWNER="owner";const Vs="5",Gs=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,qs="ac",Hs="websocket",Ws="long_polling";class Zs{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=hs.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&hs.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns=".concat(this.namespace):"";return"".concat(e).concat(this.host,"/").concat(t)}}function Xs(e,t,n){let i;if(br("string"===typeof t,"typeof type must == string"),br("object"===typeof n,"typeof params must == object"),t===Hs)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Ws)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const r=[];return Rs(n,((e,t)=>{r.push(e+"="+t)})),i+r.join("&")}class Ys{constructor(){this.counters_={}}incrementCounter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Hr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Mr(this.counters_)}}const Ks={},Qs={};function Js(e){const t=e.toString();return Ks[t]||(Ks[t]=new Ys),Ks[t]}class $s{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Fs((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const ea="start";class ta{constructor(e,t,n,i,r,o,s){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=bs(e),this.stats_=Js(t),this.urlFn=e=>(this.appCheckToken&&(e[qs]=this.appCheckToken),Xs(t,Ws,e))}open(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new $s(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Br()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new na((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const[r,o,s,a,l]=t;if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,r===ea)n.id=o,n.password=s;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(()=>{n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const[r,o]=t;n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(r,o)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[ea]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Vs,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[qs]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&Gs.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ta.forceAllow_=!0}static forceDisallow(){ta.forceDisallow_=!0}static isAvailable(){return!Br()&&(!!ta.forceAllow_||!ta.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Gr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Cr(t),i=Ds(n,1840);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Br())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Gr(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class na{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Br())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=fs(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=na.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(r){xs("frame writing exception"),r.stack&&xs(r.stack),xs(r)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||xs("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){Br()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{xs("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(n){}}),Math.floor(1))}}let ia=null;"undefined"!==typeof MozWebSocket?ia=MozWebSocket:"undefined"!==typeof WebSocket&&(ia=WebSocket);class ra{constructor(e,t,n,i,r,o,s){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=bs(this.connId),this.stats_=Js(t),this.connURL=ra.connectionURL_(t,o,s,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){const o={};return o.v=Vs,!Br()&&"undefined"!==typeof location&&location.hostname&&Gs.test(location.hostname)&&(o.r="f"),t&&(o.s=t),n&&(o.ls=n),i&&(o[qs]=i),r&&(o.p=r),Xs(e,Hs,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,hs.set("previous_websocket_failure",!0);try{let e;if(Br()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":"Firebase/".concat(Vs,"/").concat(ss,"/").concat(process.platform,"/").concat(t),"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization="Bearer ".concat(this.authToken)),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0},i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new ia(this.connURL,[],e)}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ra.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==ia&&!ra.forceDisallow_}static previouslyFailed(){return hs.isInMemoryStorage||!0===hs.get("previous_websocket_failure")}markConnectionHealthy(){hs.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Vr(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(br(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Gr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Ds(t,16384);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ra.responsesRequiredToBeHealthy=2,ra.healthyTimeout=3e4;class oa{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[ta,ra]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=ra&&ra.isAvailable();let n=t&&!ra.previouslyFailed();if(e.webSocketOnly&&(t||Ss("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ra];else{const e=this.transports_=[];for(const t of oa.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);oa.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}oa.globalTransportInitialized_=!1;class sa{constructor(e,t,n,i,r,o,s,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=bs("c:"+this.id+":"),this.transportManager_=new oa(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Bs((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=ks("t",e),n=ks("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=ks("t",e),n=ks("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=ks("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?ws("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ws("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Vs!==n&&Ss("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Bs((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Bs((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(hs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class aa{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class la{constructor(e){this.allowedEvents_=e,this.listeners_={},br(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!n||n===i[r].context))return void i.splice(r,1)}validateEventType_(e){br(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class ca extends la{constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||Fr()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new ca}getInitialEvent(e){return br("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const ua=32,ha=768;class da{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function pa(){return new da("")}function fa(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ma(e){return e.pieces_.length-e.pieceNum_}function _a(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new da(e.pieces_,t)}function ga(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function ya(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.pieces_.slice(e.pieceNum_+t)}function va(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new da(t,0)}function xa(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof da)for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new da(n,0)}function ba(e){return e.pieceNum_>=e.pieces_.length}function wa(e,t){const n=fa(e),i=fa(t);if(null===n)return t;if(n===i)return wa(_a(e),_a(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Ta(e,t){if(ma(e)!==ma(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function Sa(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(ma(e)>ma(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class Ea{constructor(e,t){this.errorPrefix_=t,this.parts_=ya(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=$r(this.parts_[n]);Ca(this)}}function Ca(e){if(e.byteLength_>ha)throw new Error(e.errorPrefix_+"has a key path longer than "+ha+" bytes ("+e.byteLength_+").");if(e.parts_.length>ua)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ua+") or object contains a cycle "+Aa(e))}function Aa(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Ia extends la{constructor(){let e,t;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(t="visibilitychange",e="hidden"):"undefined"!==typeof document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):"undefined"!==typeof document.msHidden?(t="msvisibilitychange",e="msHidden"):"undefined"!==typeof document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Ia}getInitialEvent(e){return br("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Ma=1e3;class ka extends aa{constructor(e,t,n,i,r,o,s,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=s,this.authOverride_=a,this.id=ka.nextPersistentConnectionId_++,this.log_=bs("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ma,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!Br())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ia.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&ca.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(Gr(r)),br(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const t=new Lr,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),br(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),br(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const s={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(o).set(r,s),this.connected_&&this.sendListen_(s)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,(r=>{const o=r.d,s=r.s;ka.warnOnListenWarnings_(o,t);(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==s&&this.removeListen_(n,i),e.onComplete&&e.onComplete(s,o))}))}static warnOnListenWarnings_(e,t){if(e&&"object"===typeof e&&Hr(e,"w")){const n=Wr(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();Ss("Using an unspecified index. Your data will be downloaded and "+"filtered on the client. Consider adding ".concat(e," at ")+"".concat(n," to your security rules for better performance."))}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=qr(e).claims;return"object"===typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=qr(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"===typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),br(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();const o={p:t,d:n};void 0!==r&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Gr(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):ws("Unrecognized action received from server: "+Gr(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){br(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ma,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ma,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Ma),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+ka.nextConnectionId_++,r=this.lastSessionId;let o=!1,s=null;const a=function(){s?s.close():(o=!0,n())},l=function(e){br(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(e)};this.realtime_={close:a,sendRequest:l};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,l]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);o?xs("getToken() completed but was canceled"):(xs("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,s=new sa(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{Ss(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(ws){this.log_("Failed to get token: "+ws),o||(this.repoInfo_.nodeAdmin&&Ss(ws),a())}}}interrupt(e){xs("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){xs("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Zr(this.interruptReasons_)&&(this.reconnectDelay_=Ma,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>Ps(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new da(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){xs("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){xs("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";Br()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+ss.replace(/\./g,"-")]=1,Fr()?e["framework.cordova"]=1:"object"===typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ca.getInstance().currentlyOnline();return Zr(this.interruptReasons_)&&e}}ka.nextPersistentConnectionId_=0,ka.nextConnectionId_=0;class Pa{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Pa(e,t)}}class Da{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Pa(Cs,e),i=new Pa(Cs,t);return 0!==this.compare(n,i)}minPost(){return Pa.MIN}}let Ra;class za extends Da{static get __EMPTY_NODE(){return Ra}static set __EMPTY_NODE(e){Ra=e}compare(e,t){return Is(e.name,t.name)}isDefinedOn(e){throw wr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Pa.MIN}maxPost(){return new Pa(As,Ra)}makePost(e,t){return br("string"===typeof e,"KeyIndex indexValue must always be a string."),new Pa(e,Ra)}toString(){return".key"}}const La=new za;class Oa{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,i&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Fa{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:Fa.RED,this.left=null!=i?i:Ba.EMPTY_NODE,this.right=null!=r?r:Ba.EMPTY_NODE}copy(e,t,n,i,r){return new Fa(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ba.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Ba.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Fa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Fa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Fa.RED=!0,Fa.BLACK=!1;class Ba{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ba.EMPTY_NODE;this.comparator_=e,this.root_=t}insert(e,t){return new Ba(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Fa.BLACK,null,null))}remove(e){return new Ba(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Fa.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Oa(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Oa(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Oa(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Oa(this.root_,null,this.comparator_,!0,e)}}function Na(e,t){return Is(e.name,t.name)}function ja(e,t){return Is(e,t)}let Ua;Ba.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new Fa(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Va=function(e){return"number"===typeof e?"number:"+zs(e):"string:"+e},Ga=function(e){if(e.isLeafNode()){const t=e.val();br("string"===typeof t||"number"===typeof t||"object"===typeof t&&Hr(t,".sv"),"Priority must be a string or number.")}else br(e===Ua||e.isEmpty(),"priority of unexpected type.");br(e===Ua||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let qa,Ha,Wa;class Za{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Za.__childrenNodeConstructor.EMPTY_NODE;this.value_=e,this.priorityNode_=t,this.lazyHash_=null,br(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ga(this.priorityNode_)}static set __childrenNodeConstructor(e){qa=e}static get __childrenNodeConstructor(){return qa}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Za(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Za.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ba(e)?this:".priority"===fa(e)?this.priorityNode_:Za.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Za.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=fa(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(br(".priority"!==n||1===ma(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Za.__childrenNodeConstructor.EMPTY_NODE.updateChild(_a(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Va(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?zs(this.value_):this.value_,this.lazyHash_=ms(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Za.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Za.__childrenNodeConstructor?-1:(br(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,i=Za.VALUE_TYPE_ORDER.indexOf(t),r=Za.VALUE_TYPE_ORDER.indexOf(n);return br(i>=0,"Unknown leaf type: "+t),br(r>=0,"Unknown leaf type: "+n),i===r?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Za.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Xa=new class extends Da{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?Is(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Pa.MIN}maxPost(){return new Pa(As,new Za("[PRIORITY-POST]",Wa))}makePost(e,t){const n=Ha(e);return new Pa(t,new Za("[PRIORITY-POST]",n))}toString(){return".priority"}},Ya=Math.log(2);class Ka{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ya,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Qa=function(e,t,n,i){e.sort(t);const r=function(t,i){const o=i-t;let s,a;if(0===o)return null;if(1===o)return s=e[t],a=n?n(s):s,new Fa(a,s.node,Fa.BLACK,null,null);{const l=parseInt(o/2,10)+t,c=r(t,l),u=r(l+1,i);return s=e[l],a=n?n(s):s,new Fa(a,s.node,Fa.BLACK,c,u)}},o=function(t){let i=null,o=null,s=e.length;const a=function(t,i){const o=s-t,a=s;s-=t;const c=r(o+1,a),u=e[o],h=n?n(u):u;l(new Fa(h,u.node,i,null,c))},l=function(e){i?(i.left=e,i=e):(o=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,Fa.BLACK):(a(i,Fa.BLACK),a(i,Fa.RED))}return o}(new Ka(e.length));return new Ba(i||t,o)};let Ja;const $a={};class el{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return br($a&&Xa,"ChildrenNode.ts has not been loaded"),Ja=Ja||new el({".priority":$a},{".priority":Xa}),Ja}get(e){const t=Wr(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ba?t:null}hasIndex(e){return Hr(this.indexSet_,e.toString())}addIndex(e,t){br(e!==La,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const r=t.getIterator(Pa.Wrap);let o,s=r.getNext();for(;s;)i=i||e.isDefinedOn(s.node),n.push(s),s=r.getNext();o=i?Qa(n,e.getCompare()):$a;const a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;const c=Object.assign({},this.indexes_);return c[a]=o,new el(c,l)}addToIndexes(e,t){const n=Xr(this.indexes_,((n,i)=>{const r=Wr(this.indexSet_,i);if(br(r,"Missing index implementation for "+i),n===$a){if(r.isDefinedOn(e.node)){const n=[],i=t.getIterator(Pa.Wrap);let o=i.getNext();for(;o;)o.name!==e.name&&n.push(o),o=i.getNext();return n.push(e),Qa(n,r.getCompare())}return $a}{const i=t.get(e.name);let r=n;return i&&(r=r.remove(new Pa(e.name,i))),r.insert(e,e.node)}}));return new el(n,this.indexSet_)}removeFromIndexes(e,t){const n=Xr(this.indexes_,(n=>{if(n===$a)return n;{const i=t.get(e.name);return i?n.remove(new Pa(e.name,i)):n}}));return new el(n,this.indexSet_)}}let tl;class nl{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ga(this.priorityNode_),this.children_.isEmpty()&&br(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return tl||(tl=new nl(new Ba(ja),null,el.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||tl}updatePriority(e){return this.children_.isEmpty()?this:new nl(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?tl:t}}getChild(e){const t=fa(e);return null===t?this:this.getImmediateChild(t).getChild(_a(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(br(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Pa(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const o=i.isEmpty()?tl:this.priorityNode_;return new nl(i,o,r)}}updateChild(e,t){const n=fa(e);if(null===n)return t;{br(".priority"!==fa(e)||1===ma(e),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(_a(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,r=!0;if(this.forEachChild(Xa,((o,s)=>{t[o]=s.val(e),n++,r&&nl.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1})),!e&&r&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Va(this.getPriority().val())+":"),this.forEachChild(Xa,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":ms(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new Pa(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Pa(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Pa(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,Pa.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,Pa.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===il?-1:0}withIndex(e){if(e===La||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new nl(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===La||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Xa),n=t.getIterator(Xa);let i=e.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=e.getNext(),r=n.getNext()}return null===i&&null===r}return!1}return!1}}resolveIndex_(e){return e===La?null:this.indexMap_.get(e.toString())}}nl.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const il=new class extends nl{constructor(){super(new Ba(ja),nl.EMPTY_NODE,el.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return nl.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Pa,{MIN:{value:new Pa(Cs,nl.EMPTY_NODE)},MAX:{value:new Pa(As,il)}}),za.__EMPTY_NODE=nl.EMPTY_NODE,Za.__childrenNodeConstructor=nl,Ua=il,function(e){Wa=e}(il);const rl=!0;function ol(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return nl.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),br(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){return new Za(e,ol(t))}if(e instanceof Array||!rl){let n=nl.EMPTY_NODE;return Rs(e,((t,i)=>{if(Hr(e,t)&&"."!==t.substring(0,1)){const e=ol(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(ol(t))}{const n=[];let i=!1;if(Rs(e,((e,t)=>{if("."!==e.substring(0,1)){const r=ol(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new Pa(e,r)))}})),0===n.length)return nl.EMPTY_NODE;const r=Qa(n,Na,(e=>e.name),ja);if(i){const e=Qa(n,Xa.getCompare());return new nl(r,ol(t),new el({".priority":e},{".priority":Xa}))}return new nl(r,ol(t),el.Default)}}!function(e){Ha=e}(ol);class sl extends Da{constructor(e){super(),this.indexPath_=e,br(!ba(e)&&".priority"!==fa(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?Is(e.name,t.name):r}makePost(e,t){const n=ol(e),i=nl.EMPTY_NODE.updateChild(this.indexPath_,n);return new Pa(t,i)}maxPost(){const e=nl.EMPTY_NODE.updateChild(this.indexPath_,il);return new Pa(As,e)}toString(){return ya(this.indexPath_,0).join("/")}}const al=new class extends Da{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Is(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Pa.MIN}maxPost(){return Pa.MAX}makePost(e,t){const n=ol(e);return new Pa(t,n)}toString(){return".value"}};function ll(e){return{type:"value",snapshotNode:e}}function cl(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ul(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function hl(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class dl{constructor(e){this.index_=e}updateChild(e,t,n,i,r,o){br(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const s=e.getImmediateChild(t);return s.getChild(i).equals(n.getChild(i))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(ul(t,s)):br(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(cl(t,n)):o.trackChildChange(hl(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Xa,((e,i)=>{t.hasChild(e)||n.trackChildChange(ul(e,i))})),t.isLeafNode()||t.forEachChild(Xa,((t,i)=>{if(e.hasChild(t)){const r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(hl(t,i,r))}else n.trackChildChange(cl(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?nl.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class pl{constructor(e){this.indexedFilter_=new dl(e.getIndex()),this.index_=e.getIndex(),this.startPost_=pl.getStartPost_(e),this.endPost_=pl.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,r,o){return this.matches(new Pa(t,n))||(n=nl.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=nl.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(nl.EMPTY_NODE);const r=this;return t.forEachChild(Xa,((e,t)=>{r.matches(new Pa(e,t))||(i=i.updateImmediateChild(e,nl.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class fl{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new pl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,o){return this.rangedFilter_.matches(new Pa(t,n))||(n=nl.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,o):this.fullLimitUpdateChild_(e,t,n,r,o)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=nl.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=nl.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(nl.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,nl.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const s=e;br(s.numChildren()===this.limit_,"");const a=new Pa(t,n),l=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),c=this.rangedFilter_.matches(a);if(s.hasChild(t)){const e=s.getImmediateChild(t);let u=i.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=u&&(u.name===t||s.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);const h=null==u?1:o(u,a);if(c&&!n.isEmpty()&&h>=0)return null!=r&&r.trackChildChange(hl(t,n,e)),s.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(ul(t,e));const n=s.updateImmediateChild(t,nl.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=r&&r.trackChildChange(cl(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:c&&o(l,a)>=0?(null!=r&&(r.trackChildChange(ul(l.name,l.node)),r.trackChildChange(cl(t,n))),s.updateImmediateChild(t,n).updateImmediateChild(l.name,nl.EMPTY_NODE)):e}}class ml{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Xa}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return br(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return br(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Cs}hasEnd(){return this.endSet_}getIndexEndValue(){return br(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return br(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:As}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return br(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Xa}copy(){const e=new ml;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function _l(e){const t={};if(e.isDefault())return t;let n;if(e.index_===Xa?n="$priority":e.index_===al?n="$value":e.index_===La?n="$key":(br(e.index_ instanceof sl,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Gr(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Gr(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Gr(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Gr(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Gr(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function gl(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Xa&&(t.i=e.index_.toString()),t}class yl extends aa{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=bs("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(br(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=yl.getListenId_(e,n),s={};this.listens_[o]=s;const a=_l(e._queryParams);this.restRequest_(r+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),Wr(this.listens_,o)===s){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=yl.getListenId_(e,t);delete this.listens_[n]}get(e){const t=_l(e._queryParams),n=e._path.toString(),i=new Lr;return this.restRequest_(n+".json",t,((e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))})),i.promise}refreshAuthToken(e){}restRequest_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((i=>{let[r,o]=i;r&&r.accessToken&&(t.auth=r.accessToken),o&&o.token&&(t.ac=o.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);let t=null;if(a.status>=200&&a.status<300){try{t=Vr(a.responseText)}catch(e){Ss("Failed to parse JSON response for "+s+": "+a.responseText)}n(null,t)}else 401!==a.status&&404!==a.status&&Ss("Got unsuccessful REST response for "+s+" Status: "+a.status),n(a.status);n=null}},a.open("GET",s,!0),a.send()}))}}class vl{constructor(){this.rootNode_=nl.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function xl(){return{value:null,children:new Map}}function bl(e,t,n){if(ba(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=fa(t);e.children.has(i)||e.children.set(i,xl());bl(e.children.get(i),t=_a(t),n)}}function wl(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{wl(i,new da(t.toString()+"/"+e),n)}))}class Tl{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Rs(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Sl{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Tl(e);const n=1e4+2e4*Math.random();Bs(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Rs(e,((e,i)=>{i>0&&Hr(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),Bs(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var El;function Cl(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(El||(El={}));class Al{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=El.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(ba(this.path)){if(null!=this.affectedTree.value)return br(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new da(e));return new Al(pa(),t,this.revert)}}return br(fa(this.path)===e,"operationForChild called for unrelated child."),new Al(_a(this.path),this.affectedTree,this.revert)}}class Il{constructor(e,t){this.source=e,this.path=t,this.type=El.LISTEN_COMPLETE}operationForChild(e){return ba(this.path)?new Il(this.source,pa()):new Il(this.source,_a(this.path))}}class Ml{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=El.OVERWRITE}operationForChild(e){return ba(this.path)?new Ml(this.source,pa(),this.snap.getImmediateChild(e)):new Ml(this.source,_a(this.path),this.snap)}}class kl{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=El.MERGE}operationForChild(e){if(ba(this.path)){const t=this.children.subtree(new da(e));return t.isEmpty()?null:t.value?new Ml(this.source,pa(),t.value):new kl(this.source,pa(),t)}return br(fa(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new kl(this.source,_a(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Pl{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ba(e))return this.isFullyInitialized()&&!this.filtered_;const t=fa(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Dl{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Rl(e,t,n,i,r,o){const s=i.filter((e=>e.type===n));s.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw wr("Should only compare child_ events.");const i=new Pa(t.childName,t.snapshotNode),r=new Pa(n.childName,n.snapshotNode);return e.index_.compare(i,r)}(e,t,n))),s.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);r.forEach((r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))}))}))}function zl(e,t){return{eventCache:e,serverCache:t}}function Ll(e,t,n,i){return zl(new Pl(t,n,i),e.serverCache)}function Ol(e,t,n,i){return zl(e.eventCache,new Pl(t,n,i))}function Fl(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Bl(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Nl;class jl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(Nl||(Nl=new Ba(Ms)),Nl);this.value=e,this.children=t}static fromObject(e){let t=new jl(null);return Rs(e,((e,n)=>{t=t.set(new da(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:pa(),value:this.value};if(ba(e))return null;{const n=fa(e),i=this.children.get(n);if(null!==i){const r=i.findRootMostMatchingPathAndValue(_a(e),t);if(null!=r){return{path:xa(new da(n),r.path),value:r.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(ba(e))return this;{const t=fa(e),n=this.children.get(t);return null!==n?n.subtree(_a(e)):new jl(null)}}set(e,t){if(ba(e))return new jl(t,this.children);{const n=fa(e),i=(this.children.get(n)||new jl(null)).set(_a(e),t),r=this.children.insert(n,i);return new jl(this.value,r)}}remove(e){if(ba(e))return this.children.isEmpty()?new jl(null):new jl(null,this.children);{const t=fa(e),n=this.children.get(t);if(n){const i=n.remove(_a(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new jl(null):new jl(this.value,r)}return this}}get(e){if(ba(e))return this.value;{const t=fa(e),n=this.children.get(t);return n?n.get(_a(e)):null}}setTree(e,t){if(ba(e))return t;{const n=fa(e),i=(this.children.get(n)||new jl(null)).setTree(_a(e),t);let r;return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new jl(this.value,r)}}fold(e){return this.fold_(pa(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,r)=>{n[i]=r.fold_(xa(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,pa(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(ba(e))return null;{const i=fa(e),r=this.children.get(i);return r?r.findOnPath_(_a(e),xa(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,pa(),t)}foreachOnPath_(e,t,n){if(ba(e))return this;{this.value&&n(t,this.value);const i=fa(e),r=this.children.get(i);return r?r.foreachOnPath_(_a(e),xa(t,i),n):new jl(null)}}foreach(e){this.foreach_(pa(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(xa(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Ul{constructor(e){this.writeTree_=e}static empty(){return new Ul(new jl(null))}}function Vl(e,t,n){if(ba(t))return new Ul(new jl(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const r=i.path;let o=i.value;const s=wa(r,t);return o=o.updateChild(s,n),new Ul(e.writeTree_.set(r,o))}{const i=new jl(n),r=e.writeTree_.setTree(t,i);return new Ul(r)}}}function Gl(e,t,n){let i=e;return Rs(n,((e,n)=>{i=Vl(i,xa(t,e),n)})),i}function ql(e,t){if(ba(t))return Ul.empty();{const n=e.writeTree_.setTree(t,new jl(null));return new Ul(n)}}function Hl(e,t){return null!=Wl(e,t)}function Wl(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(wa(n.path,t)):null}function Zl(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Xa,((e,n)=>{t.push(new Pa(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new Pa(e,n.value))})),t}function Xl(e,t){if(ba(t))return e;{const n=Wl(e,t);return new Ul(null!=n?new jl(n):e.writeTree_.subtree(t))}}function Yl(e){return e.writeTree_.isEmpty()}function Kl(e,t){return Ql(pa(),e.writeTree_,t)}function Ql(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let i=null;return t.children.inorderTraversal(((t,r)=>{".priority"===t?(br(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):n=Ql(xa(e,t),r,n)})),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(xa(e,".priority"),i)),n}}function Jl(e,t){return hc(t,e)}function $l(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));br(n>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[n];e.allWrites.splice(n,1);let r=i.visible,o=!1,s=e.allWrites.length-1;for(;r&&s>=0;){const t=e.allWrites[s];t.visible&&(s>=n&&ec(t,i.path)?r=!1:Sa(i.path,t.path)&&(o=!0)),s--}if(r){if(o)return function(e){e.visibleWrites=nc(e.allWrites,tc,pa()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(i.snap)e.visibleWrites=ql(e.visibleWrites,i.path);else{Rs(i.children,(t=>{e.visibleWrites=ql(e.visibleWrites,xa(i.path,t))}))}return!0}return!1}function ec(e,t){if(e.snap)return Sa(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Sa(xa(e.path,n),t))return!0;return!1}function tc(e){return e.visible}function nc(e,t,n){let i=Ul.empty();for(let r=0;r<e.length;++r){const o=e[r];if(t(o)){const e=o.path;let t;if(o.snap)Sa(n,e)?(t=wa(n,e),i=Vl(i,t,o.snap)):Sa(e,n)&&(t=wa(e,n),i=Vl(i,pa(),o.snap.getChild(t)));else{if(!o.children)throw wr("WriteRecord should have .snap or .children");if(Sa(n,e))t=wa(n,e),i=Gl(i,t,o.children);else if(Sa(e,n))if(t=wa(e,n),ba(t))i=Gl(i,pa(),o.children);else{const e=Wr(o.children,fa(t));if(e){const n=e.getChild(_a(t));i=Vl(i,pa(),n)}}}}}return i}function ic(e,t,n,i,r){if(i||r){const o=Xl(e.visibleWrites,t);if(!r&&Yl(o))return n;if(r||null!=n||Hl(o,pa())){const o=function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(Sa(e.path,t)||Sa(t,e.path))};return Kl(nc(e.allWrites,o,t),n||nl.EMPTY_NODE)}return null}{const i=Wl(e.visibleWrites,t);if(null!=i)return i;{const i=Xl(e.visibleWrites,t);if(Yl(i))return n;if(null!=n||Hl(i,pa())){return Kl(i,n||nl.EMPTY_NODE)}return null}}}function rc(e,t,n,i){return ic(e.writeTree,e.treePath,t,n,i)}function oc(e,t){return function(e,t,n){let i=nl.EMPTY_NODE;const r=Wl(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(Xa,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const r=Xl(e.visibleWrites,t);return n.forEachChild(Xa,((e,t)=>{const n=Kl(Xl(r,new da(e)),t);i=i.updateImmediateChild(e,n)})),Zl(r).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return Zl(Xl(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function sc(e,t,n,i){return function(e,t,n,i,r){br(i||r,"Either existingEventSnap or existingServerSnap must exist");const o=xa(t,n);if(Hl(e.visibleWrites,o))return null;{const t=Xl(e.visibleWrites,o);return Yl(t)?r.getChild(n):Kl(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function ac(e,t){return function(e,t){return Wl(e.visibleWrites,t)}(e.writeTree,xa(e.treePath,t))}function lc(e,t,n,i,r,o){return function(e,t,n,i,r,o,s){let a;const l=Xl(e.visibleWrites,t),c=Wl(l,pa());if(null!=c)a=c;else{if(null==n)return[];a=Kl(l,n)}if(a=a.withIndex(s),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=s.getCompare(),n=o?a.getReverseIteratorFrom(i,s):a.getIteratorFrom(i,s);let l=n.getNext();for(;l&&e.length<r;)0!==t(l,i)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,r,o)}function cc(e,t,n){return function(e,t,n,i){const r=xa(t,n),o=Wl(e.visibleWrites,r);if(null!=o)return o;if(i.isCompleteForChild(n))return Kl(Xl(e.visibleWrites,r),i.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function uc(e,t){return hc(xa(e.treePath,t),e.writeTree)}function hc(e,t){return{treePath:e,writeTree:t}}class dc{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;br("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),br(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,hl(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,ul(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,cl(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw wr("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,hl(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const pc=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class fc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Pl(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return cc(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Bl(this.viewCache_),r=lc(this.writes_,i,t,1,n,e);return 0===r.length?null:r[0]}}function mc(e,t,n,i,r){const o=new dc;let s,a;if(n.type===El.OVERWRITE){const l=n;l.source.fromUser?s=yc(e,t,l.path,l.snap,i,r,o):(br(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!ba(l.path),s=gc(e,t,l.path,l.snap,i,r,a,o))}else if(n.type===El.MERGE){const l=n;l.source.fromUser?s=function(e,t,n,i,r,o,s){let a=t;return i.foreach(((i,l)=>{const c=xa(n,i);vc(t,fa(c))&&(a=yc(e,a,c,l,r,o,s))})),i.foreach(((i,l)=>{const c=xa(n,i);vc(t,fa(c))||(a=yc(e,a,c,l,r,o,s))})),a}(e,t,l.path,l.children,i,r,o):(br(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),s=bc(e,t,l.path,l.children,i,r,a,o))}else if(n.type===El.ACK_USER_WRITE){const a=n;s=a.revert?function(e,t,n,i,r,o){let s;if(null!=ac(i,n))return t;{const a=new fc(i,t,r),l=t.eventCache.getNode();let c;if(ba(n)||".priority"===fa(n)){let n;if(t.serverCache.isFullyInitialized())n=rc(i,Bl(t));else{const e=t.serverCache.getNode();br(e instanceof nl,"serverChildren would be complete if leaf node"),n=oc(i,e)}c=e.filter.updateFullNode(l,n,o)}else{const r=fa(n);let u=cc(i,r,t.serverCache);null==u&&t.serverCache.isCompleteForChild(r)&&(u=l.getImmediateChild(r)),c=null!=u?e.filter.updateChild(l,r,u,_a(n),a,o):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(l,r,nl.EMPTY_NODE,_a(n),a,o):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(s=rc(i,Bl(t)),s.isLeafNode()&&(c=e.filter.updateFullNode(c,s,o)))}return s=t.serverCache.isFullyInitialized()||null!=ac(i,pa()),Ll(t,c,s,e.filter.filtersNodes())}}(e,t,a.path,i,r,o):function(e,t,n,i,r,o,s){if(null!=ac(r,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value){if(ba(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return gc(e,t,n,l.getNode().getChild(n),r,o,a,s);if(ba(n)){let i=new jl(null);return l.getNode().forEachChild(La,((e,t)=>{i=i.set(new da(e),t)})),bc(e,t,n,i,r,o,a,s)}return t}{let c=new jl(null);return i.foreach(((e,t)=>{const i=xa(n,e);l.isCompleteForPath(i)&&(c=c.set(e,l.getNode().getChild(i)))})),bc(e,t,n,c,r,o,a,s)}}(e,t,a.path,a.affectedTree,i,r,o)}else{if(n.type!==El.LISTEN_COMPLETE)throw wr("Unknown operation type: "+n.type);s=function(e,t,n,i,r){const o=t.serverCache,s=Ol(t,o.getNode(),o.isFullyInitialized()||ba(n),o.isFiltered());return _c(e,s,n,i,pc,r)}(e,t,n.path,i,o)}const l=o.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),o=Fl(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!i.getNode().equals(o)||!i.getNode().getPriority().equals(o.getPriority()))&&n.push(ll(Fl(t)))}}(t,s,l),{viewCache:s,changes:l}}function _c(e,t,n,i,r,o){const s=t.eventCache;if(null!=ac(i,n))return t;{let a,l;if(ba(n))if(br(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Bl(t),r=oc(i,n instanceof nl?n:nl.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,o)}else{const n=rc(i,Bl(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const c=fa(n);if(".priority"===c){br(1===ma(n),"Can't have a priority with additional path components");const r=s.getNode();l=t.serverCache.getNode();const o=sc(i,n,r,l);a=null!=o?e.filter.updatePriority(r,o):s.getNode()}else{const u=_a(n);let h;if(s.isCompleteForChild(c)){l=t.serverCache.getNode();const e=sc(i,n,s.getNode(),l);h=null!=e?s.getNode().getImmediateChild(c).updateChild(u,e):s.getNode().getImmediateChild(c)}else h=cc(i,c,t.serverCache);a=null!=h?e.filter.updateChild(s.getNode(),c,h,u,r,o):s.getNode()}}return Ll(t,a,s.isFullyInitialized()||ba(n),e.filter.filtersNodes())}}function gc(e,t,n,i,r,o,s,a){const l=t.serverCache;let c;const u=s?e.filter:e.filter.getIndexedFilter();if(ba(n))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,i);c=u.updateFullNode(l.getNode(),e,null)}else{const e=fa(n);if(!l.isCompleteForPath(n)&&ma(n)>1)return t;const r=_a(n),o=l.getNode().getImmediateChild(e).updateChild(r,i);c=".priority"===e?u.updatePriority(l.getNode(),o):u.updateChild(l.getNode(),e,o,r,pc,null)}const h=Ol(t,c,l.isFullyInitialized()||ba(n),u.filtersNodes());return _c(e,h,n,r,new fc(r,h,o),a)}function yc(e,t,n,i,r,o,s){const a=t.eventCache;let l,c;const u=new fc(r,t,o);if(ba(n))c=e.filter.updateFullNode(t.eventCache.getNode(),i,s),l=Ll(t,c,!0,e.filter.filtersNodes());else{const r=fa(n);if(".priority"===r)c=e.filter.updatePriority(t.eventCache.getNode(),i),l=Ll(t,c,a.isFullyInitialized(),a.isFiltered());else{const o=_a(n),c=a.getNode().getImmediateChild(r);let h;if(ba(o))h=i;else{const e=u.getCompleteChild(r);h=null!=e?".priority"===ga(o)&&e.getChild(va(o)).isEmpty()?e:e.updateChild(o,i):nl.EMPTY_NODE}if(c.equals(h))l=t;else{l=Ll(t,e.filter.updateChild(a.getNode(),r,h,o,u,s),a.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function vc(e,t){return e.eventCache.isCompleteForChild(t)}function xc(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function bc(e,t,n,i,r,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=ba(n)?i:new jl(null).setTree(n,i);const u=t.serverCache.getNode();return l.children.inorderTraversal(((n,i)=>{if(u.hasChild(n)){const l=xc(0,t.serverCache.getNode().getImmediateChild(n),i);c=gc(e,c,new da(n),l,r,o,s,a)}})),l.children.inorderTraversal(((n,i)=>{const l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){const l=xc(0,t.serverCache.getNode().getImmediateChild(n),i);c=gc(e,c,new da(n),l,r,o,s,a)}})),c}class wc{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new dl(n.getIndex()),r=(o=n).loadsAllData()?new dl(o.getIndex()):o.hasLimit()?new fl(o):new pl(o);var o;this.processor_=function(e){return{filter:e}}(r);const s=t.serverCache,a=t.eventCache,l=i.updateFullNode(nl.EMPTY_NODE,s.getNode(),null),c=r.updateFullNode(nl.EMPTY_NODE,a.getNode(),null),u=new Pl(l,s.isFullyInitialized(),i.filtersNodes()),h=new Pl(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=zl(h,u),this.eventGenerator_=new Dl(this.query_)}get query(){return this.query_}}function Tc(e,t){const n=Bl(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!ba(t)&&!n.getImmediateChild(fa(t)).isEmpty())?n.getChild(t):null}function Sc(e){return 0===e.eventRegistrations_.length}function Ec(e,t,n){const i=[];if(n){br(null==t,"A cancel should cancel all event registrations.");const r=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,r);t&&i.push(t)}))}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function Cc(e,t,n,i){t.type===El.MERGE&&null!==t.source.queryId&&(br(Bl(e.viewCache_),"We should always have a full cache before handling merges"),br(Fl(e.viewCache_),"Missing event cache, even though we have a server cache"));const r=e.viewCache_,o=mc(e.processor_,r,t,n,i);var s,a;return s=e.processor_,a=o.viewCache,br(a.eventCache.getNode().isIndexed(s.filter.getIndex()),"Event snap not indexed"),br(a.serverCache.getNode().isIndexed(s.filter.getIndex()),"Server snap not indexed"),br(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,Ac(e,o.changes,o.viewCache.eventCache.getNode(),null)}function Ac(e,t,n,i){const r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const r=[],o=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Rl(e,r,"child_removed",t,i,n),Rl(e,r,"child_added",t,i,n),Rl(e,r,"child_moved",o,i,n),Rl(e,r,"child_changed",t,i,n),Rl(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}let Ic,Mc;class kc{constructor(){this.views=new Map}}function Pc(e,t,n,i){const r=t.source.queryId;if(null!==r){const o=e.views.get(r);return br(null!=o,"SyncTree gave us an op for an invalid query."),Cc(o,t,n,i)}{let r=[];for(const o of e.views.values())r=r.concat(Cc(o,t,n,i));return r}}function Dc(e,t,n,i,r){const o=t._queryIdentifier,s=e.views.get(o);if(!s){let e=rc(n,r?i:null),o=!1;e?o=!0:i instanceof nl?(e=oc(n,i),o=!1):(e=nl.EMPTY_NODE,o=!1);const s=zl(new Pl(e,o,!1),new Pl(i,r,!1));return new wc(t,s)}return s}function Rc(e,t,n,i,r,o){const s=Dc(e,t,i,r,o);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,s),function(e,t){e.eventRegistrations_.push(t)}(s,n),function(e,t){const n=e.viewCache_.eventCache,i=[];n.getNode().isLeafNode()||n.getNode().forEachChild(Xa,((e,t)=>{i.push(cl(e,t))}));return n.isFullyInitialized()&&i.push(ll(n.getNode())),Ac(e,i,n.getNode(),t)}(s,n)}function zc(e,t,n,i){const r=t._queryIdentifier,o=[];let s=[];const a=Nc(e);if("default"===r)for(const[l,c]of e.views.entries())s=s.concat(Ec(c,n,i)),Sc(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||o.push(c.query));else{const t=e.views.get(r);t&&(s=s.concat(Ec(t,n,i)),Sc(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||o.push(t.query)))}return a&&!Nc(e)&&o.push(new(br(Ic,"Reference.ts has not been loaded"),Ic)(t._repo,t._path)),{removed:o,events:s}}function Lc(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Oc(e,t){let n=null;for(const i of e.views.values())n=n||Tc(i,t);return n}function Fc(e,t){if(t._queryParams.loadsAllData())return jc(e);{const n=t._queryIdentifier;return e.views.get(n)}}function Bc(e,t){return null!=Fc(e,t)}function Nc(e){return null!=jc(e)}function jc(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Uc=1;class Vc{constructor(e){this.listenProvider_=e,this.syncPointTree_=new jl(null),this.pendingWriteTree_={visibleWrites:Ul.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Gc(e,t,n,i,r){return function(e,t,n,i,r){br(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:t,snap:n,writeId:i,visible:r}),r&&(e.visibleWrites=Vl(e.visibleWrites,t,n)),e.lastWriteId=i}(e.pendingWriteTree_,t,n,i,r),r?Kc(e,new Ml({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function qc(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if($l(e.pendingWriteTree_,t)){let t=new jl(null);return null!=i.snap?t=t.set(pa(),!0):Rs(i.children,(e=>{t=t.set(new da(e),!0)})),Kc(e,new Al(i.path,t,n))}return[]}function Hc(e,t,n){return Kc(e,new Ml({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Wc(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=t._path,s=e.syncPointTree_.get(o);let a=[];if(s&&("default"===t._queryIdentifier||Bc(s,t))){const l=zc(s,t,n,i);0===s.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(o));const c=l.removed;if(a=l.events,!r){const n=-1!==c.findIndex((e=>e._queryParams.loadsAllData())),r=e.syncPointTree_.findOnPath(o,((e,t)=>Nc(t)));if(n&&!r){const t=e.syncPointTree_.subtree(o);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&Nc(t)){return[jc(t)]}{let e=[];return t&&(e=Lc(t)),Rs(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],r=i.query,o=$c(e,i);e.listenProvider_.startListening(ou(r),eu(e,r),o.hashFn,o.onComplete)}}}if(!r&&c.length>0&&!i)if(n){const n=null;e.listenProvider_.stopListening(ou(t),n)}else c.forEach((t=>{const n=e.queryToTagMap.get(tu(t));e.listenProvider_.stopListening(ou(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=tu(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,c)}return a}function Zc(e,t,n,i){const r=nu(e,i);if(null!=r){const i=iu(r),o=i.path,s=i.queryId,a=wa(o,t);return ru(e,o,new Ml(Cl(s),a,n))}return[]}function Xc(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=t._path;let o=null,s=!1;e.syncPointTree_.foreachOnPath(r,((e,t)=>{const n=wa(e,r);o=o||Oc(t,n),s=s||Nc(t)}));let a,l=e.syncPointTree_.get(r);if(l?(s=s||Nc(l),o=o||Oc(l,pa())):(l=new kc,e.syncPointTree_=e.syncPointTree_.set(r,l)),null!=o)a=!0;else{a=!1,o=nl.EMPTY_NODE;e.syncPointTree_.subtree(r).foreachChild(((e,t)=>{const n=Oc(t,pa());n&&(o=o.updateImmediateChild(e,n))}))}const c=Bc(l,t);if(!c&&!t._queryParams.loadsAllData()){const n=tu(t);br(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const i=Uc++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let u=Rc(l,t,n,Jl(e.pendingWriteTree_,r),o,a);if(!c&&!s&&!i){const n=Fc(l,t);u=u.concat(function(e,t,n){const i=t._path,r=eu(e,t),o=$c(e,n),s=e.listenProvider_.startListening(ou(t),r,o.hashFn,o.onComplete),a=e.syncPointTree_.subtree(i);if(r)br(!Nc(a.value),"If we're adding a query, it shouldn't be shadowed");else{const t=a.fold(((e,t,n)=>{if(!ba(e)&&t&&Nc(t))return[jc(t).query];{let e=[];return t&&(e=e.concat(Lc(t).map((e=>e.query)))),Rs(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(ou(i),eu(e,i))}}return s}(e,t,n))}return u}function Yc(e,t,n){const i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=Oc(n,wa(e,t));if(i)return i}));return ic(i,t,r,n,!0)}function Kc(e,t){return Qc(t,e.syncPointTree_,null,Jl(e.pendingWriteTree_,pa()))}function Qc(e,t,n,i){if(ba(e.path))return Jc(e,t,n,i);{const r=t.get(pa());null==n&&null!=r&&(n=Oc(r,pa()));let o=[];const s=fa(e.path),a=e.operationForChild(s),l=t.children.get(s);if(l&&a){const e=n?n.getImmediateChild(s):null,t=uc(i,s);o=o.concat(Qc(a,l,e,t))}return r&&(o=o.concat(Pc(r,e,i,n))),o}}function Jc(e,t,n,i){const r=t.get(pa());null==n&&null!=r&&(n=Oc(r,pa()));let o=[];return t.children.inorderTraversal(((t,r)=>{const s=n?n.getImmediateChild(t):null,a=uc(i,t),l=e.operationForChild(t);l&&(o=o.concat(Jc(l,r,s,a)))})),r&&(o=o.concat(Pc(r,e,i,n))),o}function $c(e,t){const n=t.query,i=eu(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||nl.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=nu(e,n);if(i){const n=iu(i),r=n.path,o=n.queryId,s=wa(r,t);return ru(e,r,new Il(Cl(o),s))}return[]}(e,n._path,i):function(e,t){return Kc(e,new Il({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return Wc(e,n,null,i)}}}}function eu(e,t){const n=tu(t);return e.queryToTagMap.get(n)}function tu(e){return e._path.toString()+"$"+e._queryIdentifier}function nu(e,t){return e.tagToQueryMap.get(t)}function iu(e){const t=e.indexOf("$");return br(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new da(e.substr(0,t))}}function ru(e,t,n){const i=e.syncPointTree_.get(t);br(i,"Missing sync point for query tag that we're tracking");return Pc(i,n,Jl(e.pendingWriteTree_,t),null)}function ou(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(br(Mc,"Reference.ts has not been loaded"),Mc)(e._repo,e._path):e}class su{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new su(t)}node(){return this.node_}}class au{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=xa(this.path_,e);return new au(this.syncTree_,t)}node(){return Yc(this.syncTree_,this.path_)}}const lu=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},cu=function(e,t,n){return e&&"object"===typeof e?(br(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?uu(e[".sv"],t,n):"object"===typeof e[".sv"]?hu(e[".sv"],t):void br(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},uu=function(e,t,n){if("timestamp"===e)return n.timestamp;br(!1,"Unexpected server value: "+e)},hu=function(e,t,n){e.hasOwnProperty("increment")||br(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;"number"!==typeof i&&br(!1,"Unexpected increment value: "+i);const r=t.node();if(br(null!==r&&"undefined"!==typeof r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const o=r.getValue();return"number"!==typeof o?i:o+i},du=function(e,t,n,i){return fu(t,new au(n,e),i)},pu=function(e,t,n){return fu(e,new su(t),n)};function fu(e,t,n){const i=e.getPriority().val(),r=cu(i,t.getImmediateChild(".priority"),n);let o;if(e.isLeafNode()){const i=e,o=cu(i.getValue(),t,n);return o!==i.getValue()||r!==i.getPriority().val()?new Za(o,ol(r)):e}{const i=e;return o=i,r!==i.getPriority().val()&&(o=o.updatePriority(new Za(r))),i.forEachChild(Xa,((e,i)=>{const r=fu(i,t.getImmediateChild(e),n);r!==i&&(o=o.updateImmediateChild(e,r))})),o}}class mu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};this.name=e,this.parent=t,this.node=n}}function _u(e,t){let n=t instanceof da?t:new da(t),i=e,r=fa(n);for(;null!==r;){const e=Wr(i.node.children,r)||{children:{},childCount:0};i=new mu(r,i,e),n=_a(n),r=fa(n)}return i}function gu(e){return e.node.value}function yu(e,t){e.node.value=t,Tu(e)}function vu(e){return e.node.childCount>0}function xu(e,t){Rs(e.node.children,((n,i)=>{t(new mu(n,e,i))}))}function bu(e,t,n,i){n&&!i&&t(e),xu(e,(e=>{bu(e,t,!0,i)})),n&&i&&t(e)}function wu(e){return new da(null===e.parent?e.name:wu(e.parent)+"/"+e.name)}function Tu(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===gu(e)&&!vu(e)}(n),r=Hr(e.node.children,t);i&&r?(delete e.node.children[t],e.node.childCount--,Tu(e)):i||r||(e.node.children[t]=n.node,e.node.childCount++,Tu(e))}(e.parent,e.name,e)}const Su=/[\[\].#$\/\u0000-\u001F\u007F]/,Eu=/[\[\].#$\u0000-\u001F\u007F]/,Cu=10485760,Au=function(e){return"string"===typeof e&&0!==e.length&&!Su.test(e)},Iu=function(e){return"string"===typeof e&&0!==e.length&&!Eu.test(e)},Mu=function(e,t,n,i){i&&void 0===t||ku(Jr(e,"value"),t,n)},ku=function(e,t,n){const i=n instanceof da?new Ea(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Aa(i));if("function"===typeof t)throw new Error(e+"contains a function "+Aa(i)+" with contents = "+t.toString());if(Es(t))throw new Error(e+"contains "+t.toString()+" "+Aa(i));if("string"===typeof t&&t.length>Cu/3&&$r(t)>Cu)throw new Error(e+"contains a string greater than "+Cu+" utf8 bytes "+Aa(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){let n=!1,r=!1;if(Rs(t,((t,o)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!Au(t)))throw new Error(e+" contains an invalid key ("+t+") "+Aa(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=$r(t),Ca(e)}(i,t),ku(e,o,i),function(e){const t=e.parts_.pop();e.byteLength_-=$r(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&r)throw new Error(e+' contains ".value" child '+Aa(i)+" in addition to actual children.")}},Pu=function(e,t,n,i){if((!i||void 0!==n)&&!Iu(n))throw new Error(Jr(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Du=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Pu(e,t,n,i)},Ru=function(e,t){if(".info"===fa(t))throw new Error(e+" failed = Can't modify data under /.info/")},zu=function(e,t){const n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!Au(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Iu(e)}(n))throw new Error(Jr(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Lu{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ou(e,t){let n=null;for(let i=0;i<t.length;i++){const r=t[i],o=r.getPath();null===n||Ta(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(r)}n&&e.eventLists_.push(n)}function Fu(e,t,n){Ou(e,n),Nu(e,(e=>Ta(e,t)))}function Bu(e,t,n){Ou(e,n),Nu(e,(e=>Sa(e,t)||Sa(t,e)))}function Nu(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];if(r){t(r.path)?(ju(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function ju(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();gs&&xs("event: "+n.toString()),Fs(i)}}}const Uu="repo_interrupt",Vu=25;class Gu{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Lu,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=xl(),this.transactionQueueTree_=new mu,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function qu(e,t,n){if(e.stats_=Js(e.repoInfo_),e.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new yl(e.repoInfo_,((t,n,i,r)=>{Zu(e,t,n,i,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Xu(e,!0)),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Gr(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}e.persistentConnection_=new ka(e.repoInfo_,t,((t,n,i,r)=>{Zu(e,t,n,i,r)}),(t=>{Xu(e,t)}),(t=>{!function(e,t){Rs(t,((t,n)=>{Yu(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return Qs[n]||(Qs[n]=t()),Qs[n]}(e.repoInfo_,(()=>new Sl(e.stats_,e.server_))),e.infoData_=new vl,e.infoSyncTree_=new Vc({startListening:(t,n,i,r)=>{let o=[];const s=e.infoData_.getNode(t._path);return s.isEmpty()||(o=Hc(e.infoSyncTree_,t._path,s),setTimeout((()=>{r("ok")}),0)),o},stopListening:()=>{}}),Yu(e,"connected",!1),e.serverSyncTree_=new Vc({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,((n,i)=>{const o=r(n,i);Bu(e.eventQueue_,t._path,o)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Hu(e){const t=e.infoData_.getNode(new da(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Wu(e){return lu({timestamp:Hu(e)})}function Zu(e,t,n,i,r){e.dataUpdateCount++;const o=new da(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let s=[];if(r)if(i){const t=Xr(n,(e=>ol(e)));s=function(e,t,n,i){const r=nu(e,i);if(r){const i=iu(r),o=i.path,s=i.queryId,a=wa(o,t),l=jl.fromObject(n);return ru(e,o,new kl(Cl(s),a,l))}return[]}(e.serverSyncTree_,o,t,r)}else{const t=ol(n);s=Zc(e.serverSyncTree_,o,t,r)}else if(i){const t=Xr(n,(e=>ol(e)));s=function(e,t,n){const i=jl.fromObject(n);return Kc(e,new kl({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,o,t)}else{const t=ol(n);s=Hc(e.serverSyncTree_,o,t)}let a=o;s.length>0&&(a=rh(e,o)),Bu(e.eventQueue_,a,s)}function Xu(e,t){Yu(e,"connected",t),!1===t&&function(e){eh(e,"onDisconnectEvents");const t=Wu(e),n=xl();wl(e.onDisconnect_,pa(),((i,r)=>{const o=du(i,r,e.serverSyncTree_,t);bl(n,i,o)}));let i=[];wl(n,pa(),((t,n)=>{i=i.concat(Hc(e.serverSyncTree_,t,n));const r=ch(e,t);rh(e,r)})),e.onDisconnect_=xl(),Bu(e.eventQueue_,pa(),i)}(e)}function Yu(e,t,n){const i=new da("/.info/"+t),r=ol(n);e.infoData_.updateSnapshot(i,r);const o=Hc(e.infoSyncTree_,i,r);Bu(e.eventQueue_,i,o)}function Ku(e){return e.nextWriteId_++}function Qu(e,t,n,i,r){eh(e,"set",{path:t.toString(),value:n,priority:i});const o=Wu(e),s=ol(n,i),a=Yc(e.serverSyncTree_,t),l=pu(s,a,o),c=Ku(e),u=Gc(e.serverSyncTree_,t,l,c,!0);Ou(e.eventQueue_,u),e.server_.put(t.toString(),s.val(!0),((n,i)=>{const o="ok"===n;o||Ss("set at "+t+" failed: "+n);const s=qc(e.serverSyncTree_,c,!o);Bu(e.eventQueue_,t,s),th(e,r,n,i)}));const h=ch(e,t);rh(e,h),Bu(e.eventQueue_,h,[])}function Ju(e,t,n){let i;i=".info"===fa(t._path)?Wc(e.infoSyncTree_,t,n):Wc(e.serverSyncTree_,t,n),Fu(e.eventQueue_,t._path,i)}function $u(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Uu)}function eh(e){let t="";e.persistentConnection_&&(t=e.persistentConnection_.id+":");for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];xs(t,...i)}function th(e,t,n,i){t&&Fs((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let r=e;i&&(r+=": "+i);const o=new Error(r);o.code=e,t(o)}}))}function nh(e,t,n){return Yc(e.serverSyncTree_,t,n)||nl.EMPTY_NODE}function ih(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transactionQueueTree_;if(t||lh(e,t),gu(t)){const n=sh(e,t);br(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const i=n.map((e=>e.currentWriteId)),r=nh(e,t,i);let o=r;const s=r.hash();for(let c=0;c<n.length;c++){const e=n[c];br(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const i=wa(t,e.path);o=o.updateChild(i,e.currentOutputSnapshotRaw)}const a=o.val(!0),l=t;e.server_.put(l.toString(),a,(i=>{eh(e,"transaction put response",{path:l.toString(),status:i});let r=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(qc(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();lh(e,_u(e.transactionQueueTree_,t)),ih(e,e.transactionQueueTree_),Bu(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)Fs(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{Ss("transaction at "+l.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}rh(e,t)}}),s)}(e,wu(t),n)}else vu(t)&&xu(t,(t=>{ih(e,t)}))}function rh(e,t){const n=oh(e,t),i=wu(n);return function(e,t,n){if(0===t.length)return;const i=[];let r=[];const o=t.filter((e=>0===e.status)),s=o.map((e=>e.currentWriteId));for(let l=0;l<t.length;l++){const o=t[l],c=wa(n,o.path);let u,h=!1;if(br(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)h=!0,u=o.abortReason,r=r.concat(qc(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=Vu)h=!0,u="maxretry",r=r.concat(qc(e.serverSyncTree_,o.currentWriteId,!0));else{const n=nh(e,o.path,s);o.currentInputSnapshot=n;const i=t[l].update(n.val());if(void 0!==i){ku("transaction failed: Data returned ",i,o.path);let t=ol(i);"object"===typeof i&&null!=i&&Hr(i,".priority")||(t=t.updatePriority(n.getPriority()));const a=o.currentWriteId,l=Wu(e),c=pu(t,n,l);o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=c,o.currentWriteId=Ku(e),s.splice(s.indexOf(a),1),r=r.concat(Gc(e.serverSyncTree_,o.path,c,o.currentWriteId,o.applyLocally)),r=r.concat(qc(e.serverSyncTree_,a,!0))}else h=!0,u="nodata",r=r.concat(qc(e.serverSyncTree_,o.currentWriteId,!0))}Bu(e.eventQueue_,n,r),r=[],h&&(t[l].status=2,a=t[l].unwatcher,setTimeout(a,Math.floor(0)),t[l].onComplete&&("nodata"===u?i.push((()=>t[l].onComplete(null,!1,t[l].currentInputSnapshot))):i.push((()=>t[l].onComplete(new Error(u),!1,null)))))}var a;lh(e,e.transactionQueueTree_);for(let l=0;l<i.length;l++)Fs(i[l]);ih(e,e.transactionQueueTree_)}(e,sh(e,n),i),i}function oh(e,t){let n,i=e.transactionQueueTree_;for(n=fa(t);null!==n&&void 0===gu(i);)i=_u(i,n),n=fa(t=_a(t));return i}function sh(e,t){const n=[];return ah(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function ah(e,t,n){const i=gu(t);if(i)for(let r=0;r<i.length;r++)n.push(i[r]);xu(t,(t=>{ah(e,t,n)}))}function lh(e,t){const n=gu(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,yu(t,n.length>0?n:void 0)}xu(t,(t=>{lh(e,t)}))}function ch(e,t){const n=wu(oh(e,t)),i=_u(e.transactionQueueTree_,t);return function(e,t,n){let i=n?e:e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,(t=>{uh(e,t)})),uh(e,i),bu(i,(t=>{uh(e,t)})),n}function uh(e,t){const n=gu(t);if(n){const i=[];let r=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(br(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(br(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(qc(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?yu(t,void 0):n.length=o+1,Bu(e.eventQueue_,wu(t),r);for(let e=0;e<i.length;e++)Fs(i[e])}}const hh=function(e,t){const n=dh(e),i=n.namespace;"firebase.com"===n.domain&&Ts(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||Ts("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ss("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Zs(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new da(n.pathString)}},dh=function(e){let t="",n="",i="",r="",o="",s=!0,a="https",l=443;if("string"===typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(r=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(i){}t+="/"+e}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Ss("Invalid query segment '".concat(n,"' in query '").concat(e,"'"))}return t}(e.substring(Math.min(e.length,h)));c=t.indexOf(":"),c>=0?(s="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),o=i}"ns"in d&&(o=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:s,scheme:a,pathString:r,namespace:o}},ph="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";!function(){let e=0;const t=[]}();class fh{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Gr(this.snapshot.exportVal())}}class mh{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class _h{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return br(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class gh{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return ba(this._path)?null:ga(this._path)}get ref(){return new yh(this._repo,this._path)}get _queryIdentifier(){const e=gl(this._queryParams),t=Ps(e);return"{}"===t?"default":t}get _queryObject(){return gl(this._queryParams)}isEqual(e){if(!((e=eo(e))instanceof gh))return!1;const t=this._repo===e._repo,n=Ta(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class yh extends gh{constructor(e,t){super(e,t,new ml,!1)}get parent(){const e=va(this._path);return null===e?null:new yh(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class vh{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new da(e),n=bh(this.ref,e);return new vh(this._node.getChild(t),n,Xa)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new vh(n,bh(this.ref,t),Xa))))}hasChild(e){const t=new da(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function xh(e,t){return(e=eo(e))._checkNotDeleted("ref"),void 0!==t?bh(e._root,t):e._root}function bh(e,t){return null===fa((e=eo(e))._path)?Du("child","path",t,!1):Pu("child","path",t,!1),new yh(e._repo,xa(e._path,t))}function wh(e,t){e=eo(e),Ru("set",e._path),Mu("set",t,e._path,!1);const n=new Lr;return Qu(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}class Th{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new fh("value",this,new vh(e.snapshotNode,new yh(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new mh(this,e,t):null}matches(e){return e instanceof Th&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Sh{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new mh(this,e,t):null}createEvent(e,t){br(null!=e.childName,"Child events should have a childName.");const n=bh(new yh(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new fh(e.type,this,new vh(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Sh&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Eh(e,t,n,i,r){let o;if("object"===typeof i&&(o=void 0,r=i),"function"===typeof i&&(o=i),r&&r.onlyOnce){const t=n,i=(n,i)=>{Ju(e._repo,e,a),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}const s=new _h(n,o||void 0),a="value"===t?new Th(s):new Sh(t,s);return function(e,t,n){let i;i=".info"===fa(t._path)?Xc(e.infoSyncTree_,t,n):Xc(e.serverSyncTree_,t,n),Fu(e.eventQueue_,t._path,i)}(e._repo,e,a),()=>Ju(e._repo,e,a)}function Ch(e,t,n,i){return Eh(e,"value",t,n,i)}!function(e){br(!Ic,"__referenceConstructor has already been defined"),Ic=e}(yh),function(e){br(!Mc,"__referenceConstructor has already been defined"),Mc=e}(yh);const Ah="FIREBASE_DATABASE_EMULATOR_HOST",Ih={};let Mh=!1;function kh(e,t,n,i,r){let o=i||e.options.databaseURL;void 0===o&&(e.options.projectId||Ts("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),xs("Using default host for project ",e.options.projectId),o="".concat(e.options.projectId,"-default-rtdb.firebaseio.com"));let s,a,l=hh(o,r),c=l.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",PUBLIC_URL:"/treasurehunt",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}[Ah]),a?(s=!0,o="http://".concat(a,"?ns=").concat(c.namespace),l=hh(o,r),c=l.repoInfo):s=!l.repoInfo.secure;const u=r&&s?new Us(Us.OWNER):new js(e.name,e.options,t);zu("Invalid Firebase Database URL",l),ba(l.path)||Ts("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,i){let r=Ih[t.name];r||(r={},Ih[t.name]=r);let o=r[e.toURLString()];o&&Ts("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return o=new Gu(e,Mh,n,i),r[e.toURLString()]=o,o}(c,e,u,new Ns(e.name,n));return new Ph(h,e)}class Ph{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(qu(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new yh(this._repo,pa())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=Ih[t];n&&n[e.key]===e||Ts("Database ".concat(t,"(").concat(e.repoInfo_,") has already been deleted.")),$u(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Ts("Cannot call "+e+" on a deleted database.")}}ka.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},ka.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};!function(e){as("10.7.0"),jo(new to("database",((e,t)=>{let{instanceIdentifier:n}=t;return kh(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n)}),"PUBLIC").setMultipleInstances(!0)),Ho(rs,os,e),Ho(rs,os,"esm2017")}();var Dh,Rh,zh,Lh,Oh,Fh,Bh,Nh,jh,Uh,Vh;const Gh=ar.div(Dh||(Dh=r(["\n  display:flex;\n  flex-direction:row;\n  // margin: 0 -24px;\nposition:relative;\n  flex-grow;\n \n  align-items:center;\n  justify-content:center;\n  width:100%;\n  \n  padding:12px 20px;\n  border-radius:20px;\n  box-sizing:border-box;\n  position:relative;\n\n"]))),qh=ar.div(Rh||(Rh=r(["\n  display:flex;\n  flex-direction:row;\n  width:32px;\n  height:32px;\n  border-radius:16px;\n  align-items:center;\n  justify-content:center;\n  \n"]))),Hh=ar.p(zh||(zh=r(["\n\n  font-size:16px;\n  font-weight:bold;\n"]))),Wh=(ar.div(Lh||(Lh=r(["\n  display:flex;\n  flex:0.3;\n  text-align:right;\n"]))),ar.div(Oh||(Oh=r(["\n   display:flex;\n  flex-direction:row;\n  flex:1.5;\n"]))),ar.p(Fh||(Fh=r(["\nmargin-left:12px;\n  flex:1;\n  // padding-left:4px;\n  box-sizing:border-box;\n  text-align:center;\n"])))),Zh=(ar.p(Bh||(Bh=r(["\nwidth:100%;\n// text-align:right;\n  color:red;\n"]))),ar.p(Nh||(Nh=r(["\n// width:100%;\nmargin-right:4px;\n// text-align:right;\n  // color:red;\n"]))),ar.div(jh||(jh=r(["\n  display:flex;\n  flex-direction:row;\n  align-items:center;\n  flex:1;\n"])))),Xh=ar.div(Uh||(Uh=r(["\n  display:flex;\n  flex-direction:row;\n  align-items:center;\n  justify-content:flex-end;\n  flex:1;\n"])));ar.img(Vh||(Vh=r(["\n  // position:absolute;\n  // // top:50%;\n  // // right:0;\n  // transform: translate(-16px, -50%);\n  width:24px;\n  // opacity:0.25;\n  height:24px;\n\n"])));const Yh=function(t){let{currentTime:n,score:i,incorrect:r,startTime:o,correct:s,formattedAdjustedGameTime:a,position:l,isMyTeam:c,color:u,bonus:h,formattedTime:d}=t;const[p,f]=(0,e.useState)(0);return(0,e.useEffect)((()=>{f(p+1)}),[n]),(0,cr.jsxs)(Gh,{style:{background:c?"#EAEAEA":"white"},children:[(0,cr.jsx)(Zh,{children:(0,cr.jsx)(qh,{style:{background:u.dark},children:(0,cr.jsx)(Hh,{style:{color:u.text},children:l})})}),(0,cr.jsx)(Zh,{children:(0,cr.jsxs)(Wh,{style:{opacity:.6,fontWeight:"light"},children:[a," ",(0,cr.jsx)("br",{}),(0,cr.jsxs)("span",{style:{opacity:1,fontSize:"12px"},children:["(",d," ",(0,cr.jsxs)("span",{style:{color:"rgb(0, 183, 59)"},children:["-",h]})," ",(0,cr.jsxs)("span",{style:{color:"red"},children:[" +",r]}),")"]})]})}),(0,cr.jsx)(Xh,{children:s>=15?(0,cr.jsx)("h1",{style:{marginLeft:"4px",textAlign:"right"},children:"\ud83c\udfc1"}):n<o?(0,cr.jsx)("h1",{style:{marginLeft:"4px",textAlign:"right"},children:"\ud83c\udf7b"}):(0,cr.jsx)("h1",{style:{marginLeft:"4px",fontSize:"24px",textAlign:"right"},children:"\ud83d\udd0e"})}),(0,cr.jsx)("div",{style:{position:"absolute",bottom:"0px",left:"20px",right:"20px",background:"#EAEAEA",height:"1px"}})]})},Kh=()=>{const e={correct:0,incorrect:0,complete:!1,bonus:0,totalTime:0,startTime:(new Date).getTime()};return{blue:e,black:e,red:e,green:e,pink:e,yellow:e}},Qh=(e,t,n,i,r)=>{const o=r||1,s="correct"===i?t.correct+o:t.correct;let a={incorrect:"incorrect"===i?t.incorrect+o:t.incorrect,correct:s,bonus:"bonus"===i?t.bonus+r:t.bonus,totalTime:t.totalTime,startTime:t.startTime};wh(xh(e,"scores/".concat(n)),a)},Jh=e=>{if(e<=0)return"00:00";Math.floor(e/1e3%60);const t=Math.floor(e/1e3/60%60);return[Math.floor(e/1e3/60/60%24).toString().padStart(2,"0"),t.toString().padStart(2,"0")].join(":")};var $h,ed,td,nd,id,rd,od,sd,ad;ar.p($h||($h=r(["\n  color:red;\n"])));const ld=ar.div(ed||(ed=r(["\n  display:flex;\n  width:100%;\n  flex-direction:column;\n  align-items:flex-start;\n  flex:1;\n  margin-top:12px;\n\n"]))),cd=ar.div(td||(td=r(["\n  display:flex;\n  width:100%;\n  flex-direction:row;\n  align-items:flex-start;\n  flex:1;\n  margin-top:12px;\n  padding: 0 12px;\n  box-sizing:border-box;\n\n"]))),ud=ar.div(nd||(nd=r(["\nmargin-top:48px;\nwidth:100%;\n\n"]))),hd=ar.div(id||(id=r(["\nflex:1.5;\n  display:flex;\n  \n"]))),dd=(ar.p(rd||(rd=r(["\n  // font-weight:bold;\n  // text-align:right;\nfont-size:0.75em;\n  width:100%;\n  opacity:0.4;\n"]))),ar.div(od||(od=r(["\nwidth:50px:\n  display:flex;\n  \n  \n  align-items:flex-end;\n  justify-content:flex-end;\n"])))),pd=ar.p(sd||(sd=r(["\n  // font-weight:bold;\n  // text-align:right;\nfont-size:0.75em;\n  width:100%;\n  opacity:0.4;\n\n"]))),fd=ar.p(ad||(ad=r(["\n  // font-weight:bold;\n  text-align:right;\nfont-size:0.75em;\n  width:100%;\n  opacity:0.4;\n\n"])));const md=function(t){let{scores:n,time:i,myTeam:r}=t;const[o,s]=(0,e.useState)();return(0,e.useEffect)((()=>{!function(){if(!n)return;let e=n?Object.keys(n):[],t=[];for(var r=0;r<e.length;r++){let o=n[e[r]],s=o.startTime<i?o.totalTime+(i-o.startTime):o.totalTime,a=s-1e3*o.bonus*60+1e3*o.incorrect*60,l=Jh(s),c=Jh(a);t.push({...o,totalGameTime:s,adjustedGameTime:a,formattedTime:l,formattedAdjustedGameTime:c,team:e[r]})}t=t.sort(((e,t)=>e.adjustedGameTime-t.adjustedGameTime)),s(t)}()}),[n,i]),(0,cr.jsxs)(ud,{children:[(0,cr.jsxs)(cd,{children:[(0,cr.jsx)(hd,{children:(0,cr.jsx)(pd,{children:"Position"})}),(0,cr.jsx)(hd,{children:(0,cr.jsx)(pd,{children:"Total time"})}),(0,cr.jsx)(dd,{children:(0,cr.jsx)(fd,{children:"Status"})})]}),(0,cr.jsx)(ld,{children:o&&o.map(((e,t)=>{const n=mt[e.team];return e?(0,cr.jsx)(Yh,{isMyTeam:r===e.team,position:t+1,color:n,...e,currentTime:i},t):(0,cr.jsx)("div",{},t)}))})]})};var _d,gd,yd,vd;const xd=ar.p(_d||(_d=r(["\n  color:black;\n  user-select:none;\n  text-decoration:none;\n"]))),bd=ar.div(gd||(gd=r(["\n  margin-top:48px;\n  \n  display:flex;\n  align-items:center;\n  justify-content:center;\n"]))),wd=ar.div(yd||(yd=r(["\n  \n  // height:44px;\n\n"]))),Td=ar.a(vd||(vd=r(["\ntext-decoration: none!imporant\n\n\n"])));const Sd=function(e){let{background:t,textColor:n,value:i,onChange:r}=e;return(0,cr.jsx)(bd,{children:(0,cr.jsx)(Td,{href:"tel:07507144826",children:(0,cr.jsx)(wd,{children:(0,cr.jsx)(xd,{children:"Call the North Pole help line"})})})})};var Ed,Cd,Ad,Id,Md,kd,Pd,Dd,Rd,zd,Ld;const Od=ar.div(Ed||(Ed=r(["\n  position:fixed;\n  top:0;\n  left:0;\n  width:100vw;\n  height:100vh;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  padding:0 24px;\n  box-sizing:border-box;\n  background:#00000099;\n  z-index:100000000000000000;\n"]))),Fd=ar.div(Cd||(Cd=r(["\n  background:white;\n  width:100%;\n  border-radius:8px;\n  overflow:hidden;\n  display:flex;\n  flex-direction:column;\n  align-items:center;\n\n  \n\n"]))),Bd=ar.div(Ad||(Ad=r(["\n  position:absolute;\n  right:12px;\n\n  display:flex;\n  align-items:center;\n  justify-content: center;\n  width:44px;\n  height:44px;\n"]))),Nd=ar.img(Id||(Id=r(["\n  width:40px;\n  height:40px;\n  position:absolute;\n  top:12px;\n  right:0px;\n"]))),jd=ar.div(Md||(Md=r(["\n\n  width:100%;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  flex-direction:column;\n  padding:24px 12px;\n  box-sizing:border-box;\n"]))),Ud=ar.h2(kd||(kd=r(["\ntext-align:center;\nfont-size:52px;\ncolor:#275653;\n"]))),Vd=ar.p(Pd||(Pd=r(["\ntext-align:center;\nfont-size:16px;\ncolor:#275653;\n\n"]))),Gd=(ar.div(Dd||(Dd=r(["\n  align-items:center;\n  justify-content:center;\n  padding:24px 12px;\n"]))),ar.div(Rd||(Rd=r(["\n  text-align:center;\n"]))),ar.img(zd||(zd=r(["\n  \n  max-width:100%;\n"])))),qd=ar.div(Ld||(Ld=r(["\n  padding:32px;\n  box-sizing:border-box;\n"])));const Hd=function(t){let{colors:i,textColor:r,smallImage:o,imageSource:s,eyebrow:a,getClue:l,getMap:c,body:u,header:h,onClose:d,displayClue:p,displayMap:f,isClueOverlay:m}=t;const[_,g]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{g(!0)}),[]),(0,cr.jsx)(Od,{children:(0,cr.jsxs)(Fd,{style:_?{opacity:1,transform:"scale(1)",transition:"all 0.33s ease"}:{opacity:0,transform:"scale(0.85)"},children:[(0,cr.jsx)(Bd,{onClick:d,children:(0,cr.jsx)(Nd,{src:n(878)})}),(0,cr.jsx)(Gd,{style:{width:o?"25%":"100%",marginTop:o?"24px":0},src:s}),(0,cr.jsxs)(jd,{children:[a&&(0,cr.jsx)(Vd,{children:a}),h&&(0,cr.jsx)(Ud,{children:h}),u&&(0,cr.jsx)(Vd,{children:u})]}),m&&(0,cr.jsxs)(qd,{children:[!p&&(0,cr.jsx)(mr,{text:"Give me clue (+3mins)",onSubmit:l}),!f&&(0,cr.jsx)(mr,{secondary:!p,text:"Show me a map (+5mins)",onSubmit:c}),(0,cr.jsx)(Sd,{})]})]})})};var Wd=n(483),Zd=n.n(Wd);Zd().accessToken="pk.eyJ1IjoiYm9iYnloZXdpdHQiLCJhIjoiY2xoeXd1cTN0MTdzYzNkbnRpazE5d2xhNyJ9.Ezxvt9Mq-Gf8hvCUa3vbxA";const Xd=t=>{let{lat:n,lon:i}=t;const r=(0,e.useRef)(null),o=(0,e.useRef)(null);(0,e.useRef)(null);return(0,e.useEffect)((()=>{if(o.current)return;o.current=new(Zd().Map)({attributionControl:!1,container:r.current,style:"mapbox://styles/bobbyhewitt/clpxtkiaq001801pl4ss01kp7",center:{lon:i,lat:n},zoom:15,offscreen:!0,preserveDrawingBuffer:!0}),o.current.addControl(new(Zd().GeolocateControl)({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}));(new(Zd().Marker)).setLngLat({lon:i,lat:n}).addTo(o.current)}),[]),(0,cr.jsx)("div",{style:{height:"400px",width:"100%",borderRadius:"20px",overflow:"hidden",marginBottom:"36px"},ref:r,className:"map-container"})};var Yd,Kd,Qd,Jd;const $d=ar.div(Yd||(Yd=r(["\nposition:relative;\n\n  background:#e0c9a6;\n  border-radius:8px;\n  margin-bottom:64px;\n  padding:32px 12px;\n  text-align:center;\n  margin:0 0px 32px 0px; \n"]))),ep=ar.p(Kd||(Kd=r(["\n line-height:1.4em; \n letter-spacing:0.5px;\n margin-bottom:16px;\n"]))),tp=ar.p(Qd||(Qd=r(["\n line-height:1.4em; \n // font-weight:bold;\n\n letter-spacing:0.5px;\n"]))),np=ar.p(Jd||(Jd=r(["\n  font-size:24px;\n  margin: 0 0 24px 0 ;\n\n"])));const ip=function(t){let{answers:n,myScore:i,setOverlay:r,displayMap:o,displayClue:s,getClue:a,colors:l,firstClues:c,team:u}=t,h=n[i.correct];return(0,cr.jsxs)(e.Fragment,{children:[(0,cr.jsx)($d,{style:{background:"#E7EFEF"},children:h&&(0,cr.jsxs)(e.Fragment,{children:[(0,cr.jsxs)(np,{children:["Question ",i.correct+1]}),(0,cr.jsx)(ep,{children:h.directions}),(0,cr.jsx)(ep,{children:h.question})]})}),s&&(0,cr.jsxs)($d,{style:{background:"#E7EFEF",marginTop:"32px"},children:[(0,cr.jsx)(tp,{children:"Clue"}),(0,cr.jsx)(ep,{children:h.clue})]}),(h.coords&&o||h.isPub)&&(0,cr.jsx)(Xd,{...h.coords})]})};var rp,op,sp,ap,lp,cp,up,hp;const dp=ar.div(rp||(rp=r(["\n  width:100%;\n  height:100%;\n  // padding:24px;\n  box-sizing:border-box;\n"]))),pp=ar.div(op||(op=r(["\n  margin-bottom:-20px;\n  display:flex;\n  align-items:center;\n  z-index:-1;\n  jusify-content:center;\n"]))),fp=(ar.h1(sp||(sp=r(["\n  text-align:center;\n  \n"]))),ar.p(ap||(ap=r(["\n  text-align:center;\n  margin-bottom:24px;\n"]))),ar.div(lp||(lp=r(["\n  position:absolute;\n  z-index:-1;\n  opacity:0.9;\n  top:0;\n  left:0;\n  right:0;\n  bottom:0;\n"]))),ar.img(cp||(cp=r(["\n  width:70%;\n  z-index:-1;\n  max-width:400px;\n\n  margin:auto;\n  \n"])))),mp=ar.p(up||(up=r(["\n line-height:1.4em; \n // font-weight:bold;\n\n letter-spacing:0.5px;\n"]))),_p=ar.div(hp||(hp=r(["\n  \n  opacity:0.5;\n  \n  margin:32px 0;\n  display:flex;\n  flex-direction:row;\n  align-items:center;\n  justify-content:center;\n\n"])));const gp=function(e){let{team:t,time:i,displayClue:r,getClue:o,inputValue:s,displayMap:a,setOverlay:l,setInputValue:c,firstClues:u,colors:h,myScore:d,answers:p,onSubmit:f}=e;return(0,cr.jsxs)(dp,{children:[(0,cr.jsx)(pp,{children:(0,cr.jsx)(fp,{src:n(648)})}),(0,cr.jsx)(ip,{colors:h,setOverlay:l,color:h,getClue:o,displayClue:r,displayMap:a,myScore:d,team:t,answers:p}),(0,cr.jsxs)(_p,{onClick:()=>{l({eyebrow:"Santa Satos'",header:"strugglers support",isClueOverlay:!0})},children:[(0,cr.jsx)(mp,{children:"Need help with the question?"}),(0,cr.jsx)("img",{style:{width:"24px",height:"24px"},src:n(426)})]}),(0,cr.jsx)(hr,{incorrectValue:d.incorrect,value:s,onChange:e=>c(e.target.value)}),(0,cr.jsx)(mr,{isDisabled:0===s.length,color:h,onSubmit:f})]})};var yp,vp,xp;const bp=ar.h1(yp||(yp=r(["\n  text-align:center;\n  color:white;\n  font-size:28px;\n"]))),wp=ar.div(vp||(vp=r(["\nz-index:100;\n  position:fixed;\n  border-radius:0 0 20px 20px;\n  top:0;\n  left:0;\n  width:100vw;\n  background:#275653;\n  height:84px;\n  display:flex;\n  align-items:center;\n  flex-direction:column;\n  justify-content:center;\n"]))),Tp=ar.p(xp||(xp=r(["\ncolor:white;\n  text-align:center;\n  font-size:12px;\n"])));const Sp=function(e){let{colors:t}=e;return(0,cr.jsxs)(wp,{style:{background:t.dark},children:[(0,cr.jsx)(bp,{style:{color:t.text},children:"Santa Santos"}),(0,cr.jsx)(Tp,{style:{color:t.text},children:"Making Christmas great again"})]})};var Ep,Cp,Ap,Ip,Mp,kp,Pp,Dp;const Rp=ar.div(Ep||(Ep=r(["\n  width:100%;\n  height:100%;\n  padding:100px 24px 64px 24px;\n  box-sizing:border-box;\n\n"]))),zp=ar.div(Cp||(Cp=r(["\n  position:absolute;\n  z-index:-1;\n  opacity:0.9;\n  top:0;\n  left:0;\n  right:0;\n  bottom:0;\n"]))),Lp=ar.div(Ap||(Ap=r(["\n  width:100%;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n"]))),Op=ar.img(Ip||(Ip=r(["\n  margin:auto;\n  max-width:75%;\n"]))),Fp=ar.div(Mp||(Mp=r(["\nbackground:#E7EFEF;\npadding:24px;\nborder-radius:20px;\n"]))),Bp=ar.h2(kp||(kp=r(["\n  font-size:52px;\n  color:#275653;\n  margin:0;\n  text-align:center;\n"]))),Np=ar.p(Pp||(Pp=r(["\n// margin-bottom:12px;\nmargin:0;\n  font-size:16px;\n  color:#275653;\n  text-align:center;\n"]))),jp=ar.p(Dp||(Dp=r(["\n  color: #717171;\n  font-size:12px;\n  margin-top:12px;\n"])));const Up=function(t){let{team:i,database:r}=t;const o=mt[i],s=bt[i],[a,l]=(0,e.useState)(""),[c,u]=(0,e.useState)(!1),[h,d]=(0,e.useState)(!1),[p,f]=(0,e.useState)(!1),[m,_]=(0,e.useState)(null),[g,y]=(0,e.useState)(null),[v,x]=(0,e.useState)(Date.now()),[b,w]=(0,e.useState)(!1),[T,S]=(0,e.useState)(!1);(0,e.useEffect)((()=>{const e=setInterval((()=>x(Date.now())),1e3);return()=>{clearInterval(e)}}),[]),(0,e.useEffect)((()=>{const e=xh(r,"scores"),t=xh(r,"scores/".concat(i));return Ch(e,(e=>{const t=e.val();_(t)})),Ch(t,(e=>{const t=e.val();y(t),t&&t.complete&&f({header:"Congratulations",body:"You've finished!"})})),()=>{}}),[]);const E=()=>{Qh(r,g,i,"incorrect",3),w(!0),f(!1)},C=()=>{const e=_r(a);let t=g?g.correct:0,o=s[t];if(!o)return void console.log("got no next answer");let c=_r(o.answer);if(e.indexOf(c)>-1){o.rewardsWithPub?f({header:"Correct!",body:"Your reward is a trip to the pub",imageSource:n(816)}):14===t?f({header:"Congratulations!",smallImage:!0,body:"You've made it to Santa Santos (except he's gone home to look after his kid, so you'll have to settle for the rest of us instead).",imageSource:n(816)}):o.isPub?f({header:"Correct!",smallImage:!0,body:"Ask the bar lad or lady for your gift from Santa Santos. Tell them your team colour.",imageSource:n(558)}):f({header:"Correct!",smallImage:!0,eyebrow:"Nice one!",imageSource:n(140)}),d(!1);const e=(()=>{const e=s[g.correct+1];if(e&&e.revealAtDate&&e.revealAtDate>v)return e.revealAtDate;if(e)return!1;{let e=new Date;return e.setFullYear(2024),e=e.getTime(),e}})();return e?(e=>{console.log("updaing",e>v);let t={incorrect:g.incorrect,correct:g.correct+1,complete:!1,bonus:g.bonus,totalTime:g.totalTime+(v-g.startTime),startTime:e};wh(xh(r,"scores/".concat(i)),t)})(e):(w(!1),S(!1),Qh(r,g,i,"correct")),!0}return l(""),d(!0),Qh(r,g,i,"incorrect"),!1},A=()=>{f(!1),l("")};return(0,cr.jsxs)(e.Fragment,{children:[(0,cr.jsx)(Sp,{colors:o}),(0,cr.jsx)("div",{style:m?{opacity:1,transform:"translateY(0)",transition:"all 0.66s ease"}:{opacity:0,transform:"translateY(25px)"},children:(0,cr.jsxs)(Rp,{children:[(0,cr.jsx)(zp,{style:{background:"white"}}),g&&s[g.correct]&&(!s[g.correct].revealAtDate||s[g.correct].revealAtDate<v)?(0,cr.jsx)(gp,{myScore:g,team:i,getClue:E,time:v,inputValue:a,setInputValue:l,setOverlay:f,database:r,answers:s,displayClue:b,displayMap:T,setDisplayMap:S,colors:o,scores:m,onSubmit:()=>{if(a.length>0){u(!0);C()}},overlay:p,onCloseOverlay:A}):(0,cr.jsxs)("div",{style:{paddingTop:"80px"},children:[g&&s[g.correct]&&s[g.correct].revealAtDate&&(0,cr.jsxs)(e.Fragment,{children:[(0,cr.jsx)(Lp,{children:(0,cr.jsx)(Op,{src:n(493)})}),(0,cr.jsxs)(Fp,{children:[(0,cr.jsx)(Np,{children:"Your next clue will be available at:"}),(0,cr.jsxs)(Bp,{children:[s[g.correct].revealAtHour.toString().padStart(2,"0"),":",s[g.correct].revealAtMinute.toString().padStart(2,"0")]})]}),(0,cr.jsx)(jp,{style:{textAlign:"center"},children:"Your clock will restart then too. Have a drink"}),(0,cr.jsx)(jp,{style:{textAlign:"center"},children:"Remember to ask for your gift from Santa Santos at the bar. Tell them your team colour."})]}),g&&!s[g.correct]&&(0,cr.jsxs)(e.Fragment,{children:[(0,cr.jsx)("h1",{style:{textAlign:"center",marginTop:"-64px"},children:"Congratulations, you made it!"}),(0,cr.jsx)(Lp,{children:(0,cr.jsx)(Op,{src:n(816)})}),(0,cr.jsxs)(Fp,{children:[(0,cr.jsx)(Np,{children:"Where on earth is Santa Santos you ask? He's gone home to look after his kid. We knew he had to do that when we started all this. Hard to say why we pursued this storyline. "}),(0,cr.jsx)(Np,{style:{marginTop:"12px"},children:"His elves (who seem to have been around all along after all that) will be conducting the prize ceremony."}),(0,cr.jsx)(Np,{style:{marginTop:"12px"},children:"In the meantime. Have a seat (if there's space) and grab youself a drink!"})]})]})]}),m&&(0,cr.jsx)(md,{scores:m,time:v,myTeam:i})]})}),p&&(0,cr.jsx)(Hd,{...p,colors:o,onClose:A,getClue:E,displayClue:b,displayMap:T,getMap:()=>{Qh(r,g,i,"incorrect",5),S(!0),f(!1)}}),!m&&(0,cr.jsxs)("div",{children:[(0,cr.jsx)("h1",{style:{textAlign:"center",marginTop:"-64px"},children:"Waiting for Xmas"}),(0,cr.jsx)(Lp,{children:(0,cr.jsx)(Op,{src:n(816)})})]})]})};var Vp,Gp;const qp=ar.div(Vp||(Vp=r(["\npadding:12px;\n"]))),Hp=ar.div(Gp||(Gp=r(["\n  display:flex;\n  flex-direction:row;\n"])));const Wp=function(t){let{database:n}=t;const[i,r]=(0,e.useState)(0),[o,s]=(0,e.useState)(null),[a,l]=(0,e.useState)(null),[c,u]=(0,e.useState)(null),h=(0,e.useRef)(Object.keys(mt));(0,e.useEffect)((()=>(Ch(xh(n,"scores"),(e=>{const t=e.val();s(t)})),()=>{})),[]);const d=e=>{l(e)};return(0,cr.jsxs)(qp,{children:[(0,cr.jsx)("p",{style:{marginBottom:"12px"},children:"Enter bonus point value and select team"}),(0,cr.jsx)(hr,{type:"number",onChange:e=>r(e.target.value),placeholder:"Enter value",value:i}),h.current.map(((e,t)=>{const n=mt[e];return(0,cr.jsx)(mr,{secondary:a!==e,text:e,color:n,team:e,onSubmit:d},t)})),(0,cr.jsxs)(Hp,{children:[(0,cr.jsx)(mr,{secondary:"Bonus"!==c,text:"Bonus",color:{dark:"black",text:"white"},onSubmit:()=>u("Bonus")}),(0,cr.jsx)(mr,{secondary:"Penalty"!==c,text:"Penalty",color:{dark:"black",text:"white"},onSubmit:()=>u("Penalty")})]}),(0,cr.jsx)("div",{style:{marginTop:"64px"},children:(0,cr.jsx)(mr,{text:"Submit",onSubmit:()=>{const e=parseInt(i);if(isNaN(e))return;if(!c)return;if(!a)return;if(!o)return;let t="Bonus"===c?"bonus":"incorrect";Qh(n,o[a],a,t,e),l(null),u(null),r(0)}})})]})};const Zp=function(){return(0,cr.jsx)("div",{})};var Xp;const Yp=ar.div(Xp||(Xp=r(["\n  width:100%;\n  height:100%;\n  padding:24px;\n  box-sizing:border-box;\n"])));const Kp=function(e){let{database:t}=e;return(0,cr.jsxs)(Yp,{children:[(0,cr.jsx)(mr,{text:"Start game",onSubmit:()=>{wh(xh(t,"/scores"),Kh())}}),(0,cr.jsx)("div",{style:{marginTop:"24px"},children:(0,cr.jsx)(mr,{text:"Stop game",onSubmit:()=>{const e=xh(t,"/scores");Kh();wh(e,null)}})})]})};var Qp,Jp;Ho("firebase","10.7.0","app");qo({apiKey:"AIzaSyBHwk5NQwZ6n-BXOz9QPy7lo835dGpAxHc",authDomain:"tvot-d52ff.firebaseapp.com",databaseURL:"https://tvot-d52ff.firebaseio.com",projectId:"tvot-d52ff",storageBucket:"tvot-d52ff.appspot.com",messagingSenderId:"776359638884",appId:"1:776359638884:web:4db0292713d034dec0ac71"});const $p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lo;const t=Fo.get(e);if(!t&&e===Lo&&zr())return qo();if(!t)throw Vo.create("no-app",{appName:e});return t}(),t=arguments.length>1?arguments[1]:void 0;const n=Uo(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=Rr("database");e&&function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=eo(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&Ts("Cannot call useEmulator() after instance has already been initialized.");const r=e._repoInternal;let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&Ts('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Us(Us.OWNER);else if(i.mockUserToken){const t="string"===typeof i.mockUserToken?i.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Ar(JSON.stringify({alg:"none",type:"JWT"})),Ar(JSON.stringify(o)),""].join(".")}(i.mockUserToken,e.app.options.projectId);o=new Us(t)}!function(e,t,n,i){e.repoInfo_=new Zs("".concat(t,":").concat(n),!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),i&&(e.authTokenProvider_=i)}(r,t,n,o)}(n,...e)}return n}(),ef=ar.div(Qp||(Qp=r(["\n  width:100%;\n  height:100%;\n  box-sizing:border-box;\n"]))),tf=ar.div(Jp||(Jp=r(["\n  \n  min-height:100vh;\n  width:100vw;\n  // padding:24px;\n  box-sizing:border-box;\n"])));const nf=function(){const[t,n]=(0,e.useState)(!1),i=function(e,t){return ne({basename:null==t?void 0:t.basename,future:nt({},null==t?void 0:t.future,{v7_prependBasename:!0}),history:(n={window:null==t?void 0:t.window},void 0===n&&(n={}),_((function(e,t){let{pathname:n="/",search:i="",hash:r=""}=m(e.location.hash.substr(1));return n.startsWith("/")||n.startsWith(".")||(n="/"+n),p("",{pathname:n,search:i,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){let n=e.document.querySelector("base"),i="";if(n&&n.getAttribute("href")){let t=e.location.href,n=t.indexOf("#");i=-1===n?t:t.slice(0,n)}return i+"#"+("string"===typeof t?t:f(t))}),(function(e,t){h("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(t)+")")}),n)),hydrationData:(null==t?void 0:t.hydrationData)||it(),routes:e,mapRouteProperties:tt,window:null==t?void 0:t.window}).initialize();var n}([{path:"/",element:(0,cr.jsx)(Zp,{})},{path:"/donotgotothispage",element:(0,cr.jsx)(Kp,{database:$p})},{path:"/83b05fba-47b0-4153-9274-9a63a381abc7",element:(0,cr.jsx)(Up,{team:"black",database:$p})},{path:"/0efdbd4b-94d4-47cc-b2a8-9b7a4f60b742",element:(0,cr.jsx)(Up,{team:"blue",database:$p})},{path:"/48792db6-3295-4c2e-87f6-b8dfc1a8faf2",element:(0,cr.jsx)(Up,{team:"red",database:$p})},{path:"/79984603-ab35-4f27-a1dc-71fa3fda72b7",element:(0,cr.jsx)(Up,{team:"green",database:$p})},{path:"/02d5bbad-7958-42a6-9c76-db0976861e6e",element:(0,cr.jsx)(Up,{team:"pink",database:$p})},{path:"/0ba73577-8b1f-4fb1-8b76-1a4c140ba448",element:(0,cr.jsx)(Up,{team:"yellow",database:$p})},{path:"/onlybobbycangotothispage",element:(0,cr.jsx)(Wp,{database:$p})}]);return(0,cr.jsx)(tf,{children:(0,cr.jsx)(ef,{children:$p&&(0,cr.jsx)(ht,{router:i})})})},rf=e=>{e&&e instanceof Function&&n.e(787).then(n.bind(n,787)).then((t=>{let{getCLS:n,getFID:i,getFCP:r,getLCP:o,getTTFB:s}=t;n(e),i(e),r(e),o(e),s(e)}))};i.createRoot(document.getElementById("root")).render((0,cr.jsx)(e.StrictMode,{children:(0,cr.jsx)(nf,{})})),rf()})()})();
//# sourceMappingURL=main.0295dbf7.js.map